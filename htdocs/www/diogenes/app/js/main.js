var locations = [  
    {  
        "id":0,
        "departamento":"Amazonas",
        "ciudades":[  
            "Leticia",
            "Puerto Nari\u00f1o"
			
        ]
    },
    {  
        "id":1,
        "departamento":"Antioquia",
        "ciudades":[  
            "Abejorral",
            "Abriaqu\u00ed",
            "Alejandr\u00eda",
            "Amag\u00e1",
            "Amalfi",
            "Andes",
            "Angel\u00f3polis",
            "Angostura",
            "Anor\u00ed",
            "Anz\u00e1",
            "Apartad\u00f3",
            "Arboletes",
            "Argelia",
            "Armenia",
            "Barbosa",
            "Bello",
            "Belmira",
            "Betania",
            "Betulia",
            "Brice\u00f1o",
            "Buritic\u00e1",
            "C\u00e1ceres",
            "Caicedo",
            "Caldas",
            "Campamento",
            "Ca\u00f1asgordas",
            "Caracol\u00ed",
            "Caramanta",
            "Carepa",
            "Carolina del Pr\u00edncipe",
            "Caucasia",
            "Chigorod\u00f3",
            "Cisneros",
            "Ciudad Bol\u00edvar",
            "Cocorn\u00e1",
            "Concepci\u00f3n",
            "Concordia",
            "Copacabana",
            "Dabeiba",
            "Donmat\u00edas",
            "Eb\u00e9jico",
            "El Bagre",
            "El Carmen de Viboral",
            "El Pe\u00f1ol",
            "El Retiro",
            "El Santuario",
            "Entrerr\u00edos",
            "Envigado",
            "Fredonia",
            "Frontino",
            "Giraldo",
            "Girardota",
            "G\u00f3mez Plata",
            "Granada",
            "Guadalupe",
            "Guarne",
            "Guatap\u00e9",
            "Heliconia",
            "Hispania",
            "Itag\u00fc\u00ed",
            "Ituango",
            "Jard\u00edn",
            "Jeric\u00f3",
            "La Ceja",
            "La Estrella",
            "La Pintada",
            "La Uni\u00f3n",
            "Liborina",
            "Maceo",
            "Marinilla",
            "Medell\u00edn",
            "Montebello",
            "Murind\u00f3",
            "Mutat\u00e1",
            "Nari\u00f1o",
            "Nech\u00ed",
            "Necocl\u00ed",
            "Olaya",
            "Peque",
            "Pueblorrico",
            "Puerto Berr\u00edo",
            "Puerto Nare",
            "Puerto Triunfo",
            "Remedios",
            "Rionegro",
            "Sabanalarga",
            "Sabaneta",
            "Salgar",
            "San Andr\u00e9s de Cuerquia",
            "San Carlos",
            "San Francisco",
            "San Jer\u00f3nimo",
            "San Jos\u00e9 de la Monta\u00f1a",
            "San Juan de Urab\u00e1",
            "San Luis",
            "San Pedro de Urab\u00e1",
            "San Pedro de los Milagros",
            "San Rafael",
            "San Roque",
            "San Vicente",
            "Santa B\u00e1rbara",
            "Santa Fe de Antioquia",
            "Santa Rosa de Osos",
            "Santo Domingo",
            "Segovia",
            "Sons\u00f3n",
            "Sopetr\u00e1n",
            "T\u00e1mesis",
            "Taraz\u00e1",
            "Tarso",
            "Titirib\u00ed",
            "Toledo",
            "Turbo",
            "Uramita",
            "Urrao",
            "Valdivia",
            "Valpara\u00edso",
            "Vegach\u00ed",
            "Venecia",
            "Vig\u00eda del Fuerte",
            "Yal\u00ed",
            "Yarumal",
            "Yolomb\u00f3",
            "Yond\u00f3",
            "Zaragoza"
        ]
    },
    {  
        "id":2,
        "departamento":"Arauca",
        "ciudades":[  
            "Arauca",
            "Arauquita",
            "Cravo Norte",
            "Fortul",
            "Puerto Rond\u00f3n",
            "Saravena",
            "Tame"
        ]
    },
    {  
        "id":3,
        "departamento":"Atl\u00e1ntico",
        "ciudades":[  
            "Baranoa",
            "Barranquilla",
            "Campo de la Cruz",
            "Candelaria",
            "Galapa",
            "Juan de Acosta",
            "Luruaco",
            "Malambo",
            "Manat\u00ed",
            "Palmar de Varela",
            "Pioj\u00f3",
            "Polonuevo",
            "Ponedera",
            "Puerto Colombia",
            "Repel\u00f3n",
            "Sabanagrande",
            "Sabanalarga",
            "Santa Luc\u00eda",
            "Santo Tom\u00e1s",
            "Soledad",
            "Su\u00e1n",
            "Tubar\u00e1",
            "Usiacur\u00ed"
        ]
    },
    {  
        "id":4,
        "departamento":"Bol\u00edvar",
        "ciudades":[  
            "Ach\u00ed",
            "Altos del Rosario",
            "Arenal",
            "Arjona",
            "Arroyohondo",
            "Barranco de Loba",
            "Brazuelo de Papayal",
            "Calamar",
            "Cantagallo",
            "Cartagena de Indias",
            "Cicuco",
            "Clemencia",
            "C\u00f3rdoba",
            "El Carmen de Bol\u00edvar",
            "El Guamo",
            "El Pe\u00f1\u00f3n",
            "Hatillo de Loba",
            "Magangu\u00e9",
            "Mahates",
            "Margarita",
            "Mar\u00eda la Baja",
            "Momp\u00f3s",
            "Montecristo",
            "Morales",
            "Noros\u00ed",
            "Pinillos",
            "Regidor",
            "R\u00edo Viejo",
            "San Crist\u00f3bal",
            "San Estanislao",
            "San Fernando",
            "San Jacinto del Cauca",
            "San Jacinto",
            "San Juan Nepomuceno",
            "San Mart\u00edn de Loba",
            "San Pablo",
            "Santa Catalina",
            "Santa Rosa",
            "Santa Rosa del Sur",
            "Simit\u00ed",
            "Soplaviento",
            "Talaigua Nuevo",
            "Tiquisio",
            "Turbaco",
            "Turban\u00e1",
            "Villanueva",
            "Zambrano"
        ]
    },
    {  
        "id":5,
        "departamento":"Boyac\u00e1",
        "ciudades":[  
            "Almeida",
            "Aquitania",
            "Arcabuco",
            "Bel\u00e9n",
            "Berbeo",
            "Bet\u00e9itiva",
            "Boavita",
            "Boyac\u00e1",
            "Brice\u00f1o",
            "Buenavista",
            "Busbanz\u00e1",
            "Caldas",
            "Campohermoso",
            "Cerinza",
            "Chinavita",
            "Chiquinquir\u00e1",
            "Ch\u00edquiza",
            "Chiscas",
            "Chita",
            "Chitaraque",
            "Chivat\u00e1",
            "Chivor",
            "Ci\u00e9nega",
            "C\u00f3mbita",
            "Coper",
            "Corrales",
            "Covarach\u00eda",
            "Cubar\u00e1",
            "Cucaita",
            "Cu\u00edtiva",
            "Duitama",
            "El Cocuy",
            "El Espino",
            "Firavitoba",
            "Floresta",
            "Gachantiv\u00e1",
            "G\u00e1meza",
            "Garagoa",
            "Guacamayas",
            "Guateque",
            "Guayat\u00e1",
            "G\u00fcic\u00e1n",
            "Iza",
            "Jenesano",
            "Jeric\u00f3",
            "La Capilla",
            "La Uvita",
            "La Victoria",
            "Labranzagrande",
            "Macanal",
            "Marip\u00ed",
            "Miraflores",
            "Mongua",
            "Mongu\u00ed",
            "Moniquir\u00e1",
            "Motavita",
            "Muzo",
            "Nobsa",
            "Nuevo Col\u00f3n",
            "Oicat\u00e1",
            "Otanche",
            "Pachavita",
            "P\u00e1ez",
            "Paipa",
            "Pajarito",
            "Panqueba",
            "Pauna",
            "Paya",
            "Paz del R\u00edo",
            "Pesca",
            "Pisba",
            "Puerto Boyac\u00e1",
            "Qu\u00edpama",
            "Ramiriqu\u00ed",
            "R\u00e1quira",
            "Rond\u00f3n",
            "Saboy\u00e1",
            "S\u00e1chica",
            "Samac\u00e1",
            "San Eduardo",
            "San Jos\u00e9 de Pare",
            "San Luis de Gaceno",
            "San Mateo",
            "San Miguel de Sema",
            "San Pablo de Borbur",
            "Santa Mar\u00eda",
            "Santa Rosa de Viterbo",
            "Santa Sof\u00eda",
            "Santana",
            "Sativanorte",
            "Sativasur",
            "Siachoque",
            "Soat\u00e1",
            "Socha",
            "Socot\u00e1",
            "Sogamoso",
            "Somondoco",
            "Sora",
            "Sorac\u00e1",
            "Sotaquir\u00e1",
            "Susac\u00f3n",
            "Sutamarch\u00e1n",
            "Sutatenza",
            "Tasco",
            "Tenza",
            "Tiban\u00e1",
            "Tibasosa",
            "Tinjac\u00e1",
            "Tipacoque",
            "Toca",
            "Tog\u00fc\u00ed",
            "T\u00f3paga",
            "Tota",
            "Tunja",
            "Tunungu\u00e1",
            "Turmequ\u00e9",
            "Tuta",
            "Tutaz\u00e1",
            "\u00dambita",
            "Ventaquemada",
            "Villa de Leyva",
            "Viracach\u00e1",
            "Zetaquira"
        ]
    },
    {  
        "id":6,
        "departamento":"Caldas",
        "ciudades":[  
            "Aguadas",
            "Anserma",
            "Aranzazu",
            "Belalc\u00e1zar",
            "Chinchin\u00e1",
            "Filadelfia",
            "La Dorada",
            "La Merced",
            "Manizales",
            "Manzanares",
            "Marmato",
            "Marquetalia",
            "Marulanda",
            "Neira",
            "Norcasia",
            "P\u00e1cora",
            "Palestina",
            "Pensilvania",
            "Riosucio",
            "Risaralda",
            "Salamina",
            "Saman\u00e1",
            "San Jos\u00e9",
            "Sup\u00eda",
            "Victoria",
            "Villamar\u00eda",
            "Viterbo"
        ]
    },
    {  
        "id":7,
        "departamento":"Caquet\u00e1",
        "ciudades":[  
            "Albania",
            "Bel\u00e9n de los Andaqu\u00edes",
            "Cartagena del Chair\u00e1",
            "Curillo",
            "El Doncello",
            "El Paujil",
            "Florencia",
            "La Monta\u00f1ita",
            "Mil\u00e1n",
            "Morelia",
            "Puerto Rico",
            "San Jos\u00e9 del Fragua",
            "San Vicente del Cagu\u00e1n",
            "Solano",
            "Solita",
            "Valpara\u00edso"
        ]
    },
    {  
        "id":8,
        "departamento":"Casanare",
        "ciudades":[  
            "Aguazul",
            "Ch\u00e1meza",
            "Hato Corozal",
            "La Salina",
            "Man\u00ed",
            "Monterrey",
            "Nunch\u00eda",
            "Orocu\u00e9",
            "Paz de Ariporo",
            "Pore",
            "Recetor",
            "Sabanalarga",
            "S\u00e1cama",
            "San Luis de Palenque",
            "T\u00e1mara",
            "Tauramena",
            "Trinidad",
            "Villanueva",
            "Yopal"
        ]
    },
    {  
        "id":9,
        "departamento":"Cauca",
        "ciudades":[  
            "Almaguer",
            "Argelia",
            "Balboa",
            "Bol\u00edvar",
            "Buenos Aires",
            "Cajib\u00edo",
            "Caldono",
            "Caloto",
            "Corinto",
            "El Tambo",
            "Florencia",
            "Guachen\u00e9",
            "Guap\u00ed",
            "Inz\u00e1",
            "Jambal\u00f3",
            "La Sierra",
            "La Vega",
            "L\u00f3pez de Micay",
            "Mercaderes",
            "Miranda",
            "Morales",
            "Padilla",
            "P\u00e1ez",
            "Pat\u00eda",
            "Piamonte",
            "Piendam\u00f3",
            "Popay\u00e1n",
            "Puerto Tejada",
            "Purac\u00e9",
            "Rosas",
            "San Sebasti\u00e1n",
            "Santa Rosa",
            "Santander de Quilichao",
            "Silvia",
            "Sotar\u00e1",
            "Su\u00e1rez",
            "Sucre",
            "Timb\u00edo",
            "Timbiqu\u00ed",
            "Torib\u00edo",
            "Totor\u00f3",
            "Villa Rica"
        ]
    },
    {  
        "id":10,
        "departamento":"Cesar",
        "ciudades":[  
            "Aguachica",
            "Agust\u00edn Codazzi",
            "Astrea",
            "Becerril",
            "Bosconia",
            "Chimichagua",
            "Chiriguan\u00e1",
            "Curuman\u00ed",
            "El Copey",
            "El Paso",
            "Gamarra",
            "Gonz\u00e1lez",
            "La Gloria (Cesar)",
            "La Jagua de Ibirico",
            "La Paz",
            "Manaure Balc\u00f3n del Cesar",
            "Pailitas",
            "Pelaya",
            "Pueblo Bello",
            "R\u00edo de Oro",
            "San Alberto",
            "San Diego",
            "San Mart\u00edn",
            "Tamalameque",
            "Valledupar"
        ]
    },
    {  
        "id":11,
        "departamento":"Choc\u00f3",
        "ciudades":[  
            "Acand\u00ed",
            "Alto Baud\u00f3",
            "Bagad\u00f3",
            "Bah\u00eda Solano",
            "Bajo Baud\u00f3",
            "Bojay\u00e1",
            "Cant\u00f3n de San Pablo",
            "C\u00e9rtegui",
            "Condoto",
            "El Atrato",
            "El Carmen de Atrato",
            "El Carmen del Dari\u00e9n",
            "Istmina",
            "Jurad\u00f3",
            "Litoral de San Juan",
            "Llor\u00f3",
            "Medio Atrato",
            "Medio Baud\u00f3",
            "Medio San Juan",
            "N\u00f3vita",
            "Nuqu\u00ed",
            "Quibd\u00f3",
            "R\u00edo Ir\u00f3",
            "R\u00edo Quito",
            "Riosucio",
            "San Jos\u00e9 del Palmar",
            "Sip\u00ed",
            "Tad\u00f3",
            "Uni\u00f3n Panamericana",
            "Ungu\u00eda"
        ]
    },
    {  
        "id":12,
        "departamento":"Cundinamarca",
        "ciudades":[  
            "Agua de Dios",
            "Alb\u00e1n",
            "Anapoima",
            "Anolaima",
            "Apulo",
            "Arbel\u00e1ez",
            "Beltr\u00e1n",
            "Bituima",
            "Bogot\u00e1",
            "Bojac\u00e1",
            "Cabrera",
            "Cachipay",
            "Cajic\u00e1",
            "Caparrap\u00ed",
            "C\u00e1queza",
            "Carmen de Carupa",
            "Chaguan\u00ed",
            "Ch\u00eda",
            "Chipaque",
            "Choach\u00ed",
            "Chocont\u00e1",
            "Cogua",
            "Cota",
            "Cucunub\u00e1",
            "El Colegio",
            "El Pe\u00f1\u00f3n",
            "El Rosal",
            "Facatativ\u00e1",
            "F\u00f3meque",
            "Fosca",
            "Funza",
            "F\u00faquene",
            "Fusagasug\u00e1",
            "Gachal\u00e1",
            "Gachancip\u00e1",
            "Gachet\u00e1",
            "Gama",
            "Girardot",
            "Granada",
            "Guachet\u00e1",
            "Guaduas",
            "Guasca",
            "Guataqu\u00ed",
            "Guatavita",
            "Guayabal de S\u00edquima",
            "Guayabetal",
            "Guti\u00e9rrez",
            "Jerusal\u00e9n",
            "Jun\u00edn",
            "La Calera",
            "La Mesa",
            "La Palma",
            "La Pe\u00f1a",
            "La Vega",
            "Lenguazaque",
            "Machet\u00e1",
            "Madrid",
            "Manta",
            "Medina",
            "Mosquera",
            "Nari\u00f1o",
            "Nemoc\u00f3n",
            "Nilo",
            "Nimaima",
            "Nocaima",
            "Pacho",
            "Paime",
            "Pandi",
            "Paratebueno",
            "Pasca",
            "Puerto Salgar",
            "Pul\u00ed",
            "Quebradanegra",
            "Quetame",
            "Quipile",
            "Ricaurte",
            "San Antonio del Tequendama",
            "San Bernardo",
            "San Cayetano",
            "San Francisco",
            "San Juan de Rioseco",
            "Sasaima",
            "Sesquil\u00e9",
            "Sibat\u00e9",
            "Silvania",
            "Simijaca",
            "Soacha",
            "Subachoque",
            "Suesca",
            "Supat\u00e1",
            "Susa",
            "Sutatausa",
            "Tabio",
            "Tausa",
            "Tena",
            "Tenjo",
            "Tibacuy",
            "Tibirita",
            "Tocaima",
            "Tocancip\u00e1",
            "Topaip\u00ed",
            "Ubal\u00e1",
            "Ubaque",
            "Ubat\u00e9",
            "Une",
            "\u00datica",
            "Venecia",
            "Vergara",
            "Vian\u00ed",
            "Villag\u00f3mez",
            "Villapinz\u00f3n",
            "Villeta",
            "Viot\u00e1",
            "Yacop\u00ed",
            "Zipac\u00f3n",
            "Zipaquir\u00e1"
        ]
    },
    {  
        "id":13,
        "departamento":"C\u00f3rdoba",
        "ciudades":[  
            "Ayapel",
            "Buenavista",
            "Canalete",
            "Ceret\u00e9",
            "Chim\u00e1",
            "Chin\u00fa",
            "Ci\u00e9naga de Oro",
            "Cotorra",
            "La Apartada",
            "Lorica",
            "Los C\u00f3rdobas",
            "Momil",
            "Montel\u00edbano",
            "Monter\u00eda",
            "Mo\u00f1itos",
            "Planeta Rica",
            "Pueblo Nuevo",
            "Puerto Escondido",
            "Puerto Libertador",
            "Pur\u00edsima",
            "Sahag\u00fan",
            "San Andr\u00e9s de Sotavento",
            "San Antero",
            "San Bernardo del Viento",
            "San Carlos",
            "San Jos\u00e9 de Ur\u00e9",
            "San Pelayo",
            "Tierralta",
            "Tuch\u00edn",
            "Valencia"
        ]
    },
    {  
        "id":14,
        "departamento":"Guain\u00eda",
        "ciudades":[  
            "In\u00edrida"
        ]
    },
    {  
        "id":15,
        "departamento":"Guaviare",
        "ciudades":[  
            "Calamar",
            "El Retorno",
            "Miraflores",
            "San Jos\u00e9 del Guaviare"
        ]
    },
    {  
        "id":16,
        "departamento":"Huila",
        "ciudades":[  
            "Acevedo",
            "Agrado",
            "Aipe",
            "Algeciras",
            "Altamira",
            "Baraya",
            "Campoalegre",
            "Colombia",
            "El Pital",
            "El\u00edas",
            "Garz\u00f3n",
            "Gigante",
            "Guadalupe",
            "Hobo",
            "\u00cdquira",
            "Isnos",
            "La Argentina",
            "La Plata",
            "N\u00e1taga",
            "Neiva",
            "Oporapa",
            "Paicol",
            "Palermo",
            "Palestina",
            "Pitalito",
            "Rivera",
            "Saladoblanco",
            "San Agust\u00edn",
            "Santa Mar\u00eda",
            "Suaza",
            "Tarqui",
            "Tello",
            "Teruel",
            "Tesalia",
            "Timan\u00e1",
            "Villavieja",
            "Yaguar\u00e1"
        ]
    },
    {  
        "id":17,
        "departamento":"La Guajira",
        "ciudades":[  
            "Albania",
            "Barrancas",
            "Dibulla",
            "Distracci\u00f3n",
            "El Molino",
            "Fonseca",
            "Hatonuevo",
            "La Jagua del Pilar",
            "Maicao",
            "Manaure",
            "Riohacha",
            "San Juan del Cesar",
            "Uribia",
            "Urumita",
            "Villanueva"
        ]
    },
    {  
        "id":18,
        "departamento":"Magdalena",
        "ciudades":[  
            "Algarrobo",
            "Aracataca",
            "Ariguan\u00ed",
            "Cerro de San Antonio",
            "Chibolo",
            "Chibolo",
            "Ci\u00e9naga",
            "Concordia",
            "El Banco",
            "El Pi\u00f1\u00f3n",
            "El Ret\u00e9n",
            "Fundaci\u00f3n",
            "Guamal",
            "Nueva Granada",
            "Pedraza",
            "Piji\u00f1o del Carmen",
            "Pivijay",
            "Plato",
            "Pueblo Viejo",
            "Remolino",
            "Sabanas de San \u00c1ngel",
            "Salamina",
            "San Sebasti\u00e1n de Buenavista",
            "San Zen\u00f3n",
            "Santa Ana",
            "Santa B\u00e1rbara de Pinto",
            "Santa Marta",
            "Sitionuevo",
            "Tenerife",
            "Zapay\u00e1n",
            "Zona Bananera"
        ]
    },
    {  
        "id":19,
        "departamento":"Meta",
        "ciudades":[  
            "Acac\u00edas",
            "Barranca de Up\u00eda",
            "Cabuyaro",
            "Castilla la Nueva",
            "Cubarral",
            "Cumaral",
            "El Calvario",
            "El Castillo",
            "El Dorado",
            "Fuente de Oro",
            "Granada",
            "Guamal",
            "La Macarena",
            "La Uribe",
            "Lejan\u00edas",
            "Mapirip\u00e1n",
            "Mesetas",
            "Puerto Concordia",
            "Puerto Gait\u00e1n",
            "Puerto Lleras",
            "Puerto L\u00f3pez",
            "Puerto Rico",
            "Restrepo",
            "San Carlos de Guaroa",
            "San Juan de Arama",
            "San Juanito",
            "San Mart\u00edn",
            "Villavicencio",
            "Vista Hermosa"
        ]
    },
    {  
        "id":20,
        "departamento":"Nari\u00f1o",
        "ciudades":[  
            "Aldana",
            "Ancuy\u00e1",
            "Arboleda",
            "Barbacoas",
            "Bel\u00e9n",
            "Buesaco",
            "Chachag\u00fc\u00ed",
            "Col\u00f3n",
            "Consac\u00e1",
            "Contadero",
            "C\u00f3rdoba",
            "Cuaspud",
            "Cumbal",
            "Cumbitara",
            "El Charco",
            "El Pe\u00f1ol",
            "El Rosario",
            "El Tabl\u00f3n",
            "El Tambo",
            "Francisco Pizarro",
            "Funes",
            "Guachucal",
            "Guaitarilla",
            "Gualmat\u00e1n",
            "Iles",
            "Imu\u00e9s",
            "Ipiales",
            "La Cruz",
            "La Florida",
            "La Llanada",
            "La Tola",
            "La Uni\u00f3n",
            "Leiva",
            "Linares",
            "Los Andes",
            "Mag\u00fc\u00ed Pay\u00e1n",
            "Mallama",
            "Mosquera",
            "Nari\u00f1o",
            "Olaya Herrera",
            "Ospina",
            "Pasto",
            "Policarpa",
            "Potos\u00ed",
            "Providencia",
            "Puerres",
            "Pupiales",
            "Ricaurte",
            "Roberto Pay\u00e1n",
            "Samaniego",
            "San Bernardo",
            "San Jos\u00e9 de Alb\u00e1n",
            "San Lorenzo",
            "San Pablo",
            "San Pedro de Cartago",
            "Sandon\u00e1",
            "Santa B\u00e1rbara",
            "Santacruz",
            "Sapuyes",
            "Taminango",
            "Tangua",
            "Tumaco",
            "T\u00faquerres",
            "Yacuanquer"
        ]
    },
    {  
        "id":21,
        "departamento":"Norte de Santander",
        "ciudades":[  
            "\u00c1brego",
            "Arboledas",
            "Bochalema",
            "Bucarasica",
            "C\u00e1chira",
            "C\u00e1cota",
            "Chin\u00e1cota",
            "Chitag\u00e1",
            "Convenci\u00f3n",
            "C\u00facuta",
            "Cucutilla",
            "Duran\u00eda",
            "El Carmen",
            "El Tarra",
            "El Zulia",
            "Gramalote",
            "Hacar\u00ed",
            "Herr\u00e1n",
            "La Esperanza",
            "La Playa de Bel\u00e9n",
            "Labateca",
            "Los Patios",
            "Lourdes",
            "Mutiscua",
            "Oca\u00f1a",
            "Pamplona",
            "Pamplonita",
            "Puerto Santander",
            "Ragonvalia",
            "Salazar de Las Palmas",
            "San Calixto",
            "San Cayetano",
            "Santiago",
            "Santo Domingo de Silos",
            "Sardinata",
            "Teorama",
            "Tib\u00fa",
            "Toledo",
            "Villa Caro",
            "Villa del Rosario"
        ]
    },
    {  
        "id":22,
        "departamento":"Putumayo",
        "ciudades":[  
            "Col\u00f3n",
            "Mocoa",
            "Orito",
            "Puerto As\u00eds",
            "Puerto Caicedo",
            "Puerto Guzm\u00e1n",
            "Puerto Legu\u00edzamo",
            "San Francisco",
            "San Miguel",
            "Santiago",
            "Sibundoy",
            "Valle del Guamuez",
            "Villagarz\u00f3n"
        ]
    },
    {  
        "id":23,
        "departamento":"Quind\u00edo",
        "ciudades":[  
            "Armenia",
            "Buenavista",
            "Calarc\u00e1",
            "Circasia",
            "C\u00f3rdoba",
            "Filandia",
            "G\u00e9nova",
            "La Tebaida",
            "Montenegro",
            "Pijao",
            "Quimbaya",
            "Salento"
        ]
    },
    {  
        "id":24,
        "departamento":"Risaralda",
        "ciudades":[  
            "Ap\u00eda",
            "Balboa",
            "Bel\u00e9n de Umbr\u00eda",
            "Dosquebradas",
            "Gu\u00e1tica",
            "La Celia",
            "La Virginia",
            "Marsella",
            "Mistrat\u00f3",
            "Pereira",
            "Pueblo Rico",
            "Quinch\u00eda",
            "Santa Rosa de Cabal",
            "Santuario"
        ]
    },
    {  
        "id":25,
        "departamento":"San Andr\u00e9s y Providencia",
        "ciudades":[  
            "Providencia y Santa Catalina Islas",
            "San Andr\u00e9s"
        ]
    },
    {  
        "id":26,
        "departamento":"Santander",
        "ciudades":[  
            "Aguada",
            "Albania",
            "Aratoca",
            "Barbosa",
            "Barichara",
            "Barrancabermeja",
            "Betulia",
            "Bol\u00edvar",
            "Bucaramanga",
            "Cabrera",
            "California",
            "Capitanejo",
            "Carcas\u00ed",
            "Cepit\u00e1",
            "Cerrito",
            "Charal\u00e1",
            "Charta",
            "Chima",
            "Chipat\u00e1",
            "Cimitarra",
            "Concepci\u00f3n",
            "Confines",
            "Contrataci\u00f3n",
            "Coromoro",
            "Curit\u00ed",
            "El Carmen de Chucur\u00ed",
            "El Guacamayo",
            "El Pe\u00f1\u00f3n",
            "El Play\u00f3n",
            "El Socorro",
            "Encino",
            "Enciso",
            "Flori\u00e1n",
            "Floridablanca",
            "Gal\u00e1n",
            "G\u00e1mbita",
            "Gir\u00f3n",
            "Guaca",
            "Guadalupe",
            "Guapot\u00e1",
            "Guavat\u00e1",
            "G\u00fcepsa",
            "Hato",
            "Jes\u00fas Mar\u00eda",
            "Jord\u00e1n",
            "La Belleza",
            "La Paz",
            "Land\u00e1zuri",
            "Lebrija",
            "Los Santos",
            "Macaravita",
            "M\u00e1laga",
            "Matanza",
            "Mogotes",
            "Molagavita",
            "Ocamonte",
            "Oiba",
            "Onzaga",
            "Palmar",
            "Palmas del Socorro",
            "P\u00e1ramo",
            "Piedecuesta",
            "Pinchote",
            "Puente Nacional",
            "Puerto Parra",
            "Puerto Wilches",
            "Rionegro",
            "Sabana de Torres",
            "San Andr\u00e9s",
            "San Benito",
            "San Gil",
            "San Joaqu\u00edn",
            "San Jos\u00e9 de Miranda",
            "San Miguel",
            "San Vicente de Chucur\u00ed",
            "Santa B\u00e1rbara",
            "Santa Helena del Op\u00f3n",
            "Simacota",
            "Suaita",
            "Sucre",
            "Surat\u00e1",
            "Tona",
            "Valle de San Jos\u00e9",
            "V\u00e9lez",
            "Vetas",
            "Villanueva",
            "Zapatoca"
        ]
    },
    {  
        "id":27,
        "departamento":"Sucre",
        "ciudades":[  
            "Buenavista",
            "Caimito",
            "Chal\u00e1n",
            "Colos\u00f3",
            "Corozal",
            "Cove\u00f1as",
            "El Roble",
            "Galeras",
            "Guaranda",
            "La Uni\u00f3n",
            "Los Palmitos",
            "Majagual",
            "Morroa",
            "Ovejas",
            "Sampu\u00e9s",
            "San Antonio de Palmito",
            "San Benito Abad",
            "San Juan de Betulia",
            "San Marcos",
            "San Onofre",
            "San Pedro",
            "Sinc\u00e9",
            "Sincelejo",
            "Sucre",
            "Tol\u00fa",
            "Tol\u00fa Viejo"
        ]
    },
    {  
        "id":28,
        "departamento":"Tolima",
        "ciudades":[  
            "Alpujarra",
            "Alvarado",
            "Ambalema",
            "Anzo\u00e1tegui",
            "Armero",
            "Ataco",
            "Cajamarca",
            "Carmen de Apical\u00e1",
            "Casabianca",
            "Chaparral",
            "Coello",
            "Coyaima",
            "Cunday",
            "Dolores",
            "El Espinal",
            "Fal\u00e1n",
            "Flandes",
            "Fresno",
            "Guamo",
            "Herveo",
            "Honda",
            "Ibagu\u00e9",
            "Icononzo",
            "L\u00e9rida",
            "L\u00edbano",
            "Mariquita",
            "Melgar",
            "Murillo",
            "Natagaima",
            "Ortega",
            "Palocabildo",
            "Piedras",
            "Planadas",
            "Prado",
            "Purificaci\u00f3n",
            "Rioblanco",
            "Roncesvalles",
            "Rovira",
            "Salda\u00f1a",
            "San Antonio",
            "San Luis",
            "Santa Isabel",
            "Su\u00e1rez",
            "Valle de San Juan",
            "Venadillo",
            "Villahermosa",
            "Villarrica"
        ]
    },
    {  
        "id":29,
        "departamento":"Valle del Cauca",
        "ciudades":[  
            "Alcal\u00e1",
            "Andaluc\u00eda",
            "Ansermanuevo",
            "Argelia",
            "Bol\u00edvar",
            "Buenaventura",
            "Buga",
            "Bugalagrande",
            "Caicedonia",
            "Cali",
            "Calima",
            "Candelaria",
            "Cartago",
            "Dagua",
            "El \u00c1guila",
            "El Cairo",
            "El Cerrito",
            "El Dovio",
            "Florida",
            "Ginebra",
            "Guacar\u00ed",
            "Jamund\u00ed",
            "La Cumbre",
            "La Uni\u00f3n",
            "La Victoria",
            "Obando",
            "Palmira",
            "Pradera",
            "Restrepo",
            "Riofr\u00edo",
            "Roldanillo",
            "San Pedro",
            "Sevilla",
            "Toro",
            "Trujillo",
            "Tulu\u00e1",
            "Ulloa",
            "Versalles",
            "Vijes",
            "Yotoco",
            "Yumbo",
            "Zarzal"
        ]
    },
    {  
        "id":30,
        "departamento":"Vaup\u00e9s",
        "ciudades":[  
            "Carur\u00fa",
            "Mit\u00fa",
            "Taraira"
        ]
    },
    {  
        "id":31,
        "departamento":"Vichada",
        "ciudades":[  
            "Cumaribo",
            "La Primavera",
            "Puerto Carre\u00f1o",
            "Santa Rosal\u00eda"
        ]
    }
];
window.addEventListener('popstate', function(event) 
{
	PUM.close(1515);
	history.pushState(null, null, window.location.pathname);
}, false);
// APP START START
jQuery(document).ready( function(){loadCheck();});
function loadCheck()
{
	
	showLoaderActive = 1;
	entityAlive = "1";
	
	actualMT = "";
	actualUser = "";
	actualEntity = "";
	citizenOrigin = "c";
	classOrigin = "g"
	actualLoadedFileFormat = "";
	actualEditData = "";
	actualContractData = "";
	actualFileOrigin = "";
	viewMode = "0";
	actualVisitCords = "";
	
	actualReportIf = "General";
	filteredResult = [];
	fixedActis = [];
	
	// FILE STARTERS
	actualLoadedFile = "";
	actualEventPic = "";
	actualAssistForm = "";
	actualRequestFile = "";
	actualVisitPlanFile = "";
	actualAssistPicFile = "";
	actualClassPicFile = "";
	actualCommentFile = "";
	actualCommentCloseFile = "";
	actualSignCheck = "No";
	
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	
	// Action index
	actionsDictionary = {};
	actionsDictionary.a0 = "Inicia sesión";
	actionsDictionary.a1 = "Creación";
	actionsDictionary.a2 = "Edición";
	actionsDictionary.a3 = "Eliminación";
	actionsDictionary.a4 = "Aprobación";
	actionsDictionary.a5 = "";
	actionsDictionary.a6 = "";
	actionsDictionary.a7 = "";
	actionsDictionary.a8 = "";
	actionsDictionary.a9 = "Cierra sesión";
	
	// Location index
	locationsDictionary = {};
	locationsDictionary.home = "Inicio";
	locationsDictionary.profile = "Perfíl de usuario";
	locationsDictionary.contract = "Contratos";
	locationsDictionary.register = "Registro";
	locationsDictionary.user = "Maestro Usuarios";
	locationsDictionary.entity = "Entidades";
	locationsDictionary.activity = "Actividades";
	locationsDictionary.program = "Programas";
	locationsDictionary.zone = "Comuna o corregimiento";
	locationsDictionary.hood = "Barrio o vereda";
	locationsDictionary.citizen = "Ciudadanos";
	locationsDictionary.group = "Grupos";
	locationsDictionary.etarie = "Ciclos etarios";
	locationsDictionary.classEdit = "Clases";
	locationsDictionary.condition = "Condiciones";
	locationsDictionary.etnia = "Etnias";
	locationsDictionary.institute = "Instituciones";
	locationsDictionary.eventR = "Eventos";
	locationsDictionary.eventRB = "Eventos por Solicitud";
	
	

	// States index
	statesDictionary = {};
	statesDictionary.s0 = "Inactivo";
	statesDictionary.s1 = "Activo";
	statesDictionary.s2 = "Solicitud";
	statesDictionary.s3 = "Cesión";
	statesDictionary.s4 = "Asignado";
	
	// reqevent states
	reqStatesDictionary = {};
	reqStatesDictionary.s1 = "Solicitud";
	reqStatesDictionary.s2 = "Asignado";
	reqStatesDictionary.s3 = "Rechazado";
	reqStatesDictionary.s4 = "Cerrado";
	
	
	// User types index
	utypesDictionary = {};
	utypesDictionary.General = "Sin asignar";
	utypesDictionary.Principal1 = "Secretario";
	utypesDictionary.Principal2 = "Jefe de oficina";
	utypesDictionary.Principal3 = "Fortalecimiento";
	utypesDictionary.Superior = "Super Admin";
	utypesDictionary.Coordinador = "Coordinador";
	utypesDictionary.Cogestor = "Cogestor";
	utypesDictionary.Director = "Director";
	utypesDictionary.Instructor = "Instructor";
	utypesDictionary.Visitador = "Visitador";
	utypesDictionary.Llamadas = "Llamadas";
	
	// Cesion states index
	cesionStatesDictionary = {};
	cesionStatesDictionary.s0 = "";
	cesionStatesDictionary.s1 = "Disponible para cesión";
	cesionStatesDictionary.s2 = "Solicitado en cesión";
	
	// GENDERS
	genders = ["Masculino", "Femenino", "Tomboy", "Transexual", "BiGénero", "Intersexual","No Binario", "Sin Género", "No estoy seguro", "Prefiero no decir", "Otro"];
	
	// genders = ["MÃ¡sculino", "Femenino", "Tomboy", "Transexual", "BiGÃ©nero", "Intersexual","No Binario", "Sin GÃ©nero", "No estoy seguro", "Prefiero no decir", "Otro"];
	
	// URBAN/RURAL
	urbral = ["Urbano", "Rural"];
	
	// INSTITUCIONAL/COMUNITARIO
	instcom = ["Institucional", "Comunitario"];
	
	// PRESENCIAL/VIRTUAL
	previr = ["Presencial", "Virtual", "Presencial/Virtual"];
	
	// PRESENCIAL/VIRTUAL
	generalGraFilters = ["Asistencia", "Grupos", "Cobertura", "Clases", "Horas", "Eventos", "Visitas realizadas", "Visitas recibidas"];
	
	// LOCAL ARRAYS ----------
	weekDays = ["Domingo","Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"];
	// weekDays2 = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado","Domingo"];
	
	weekDays2 = {};
	weekDays2["0"] = "Domingo";
	weekDays2["1"] = "Lunes";
	weekDays2["2"] = "Martes";
	weekDays2["3"] = "Miércoles";
	weekDays2["4"] = "Jueves";
	weekDays2["5"] = "Viernes";
	weekDays2["6"] = "Sábado";
	
	
	timeOptions = [];
	for(var i=1; i<24; i++)
	{
		if(i<10)
		{
			var hour = "0"+i+":00";
			var ten1 = "0"+i+":10";
			var quarter1 = "0"+i+":15";
			var ten2 = "0"+i+":20";
			var half = "0"+i+":30";
			var ten3 = "0"+i+":40";
			var quarter2 = "0"+i+":45";
			var ten4 = "0"+i+":50";
		}
		else
		{
			var hour = i+":00";
			var ten1 = i+":10";
			var quarter1 = i+":15";
			var ten2 = i+":20";
			var half = i+":30";
			var ten3 = i+":40";
			var quarter2 = i+":45";
			var ten4 = i+":50";
		}
		
		timeOptions.push(hour);
		// timeOptions.push(ten1);
		timeOptions.push(quarter1);
		// timeOptions.push(ten2);
		timeOptions.push(half);
		// timeOptions.push(ten3);
		timeOptions.push(quarter2);
		// timeOptions.push(ten4);
	}
	// LOCAL ARRAYS ----------
	
	if(imfoo == "home"){root = "";}
	else{root ="../";}
	
	langPickIni();
	
	history.pushState("", "empty", "");
	jQuery("#username").on('keyup', function (e) { if (e.keyCode === 13) {login();}});
	jQuery("#password").on('keyup', function (e) { if (e.keyCode === 13) {login();}});

	
	theCroppie = null;
	actualCroppedPic = "";
	prepareImgCropper();
	prepareFileLoader();
	
}
// -------- GEOLOCATION
function success(pos) 
{
	var crd = pos.coords;
	// console.log('Your current position is:');
	// console.log('Latitude : ' + crd.latitude);
	// console.log('Longitude: ' + crd.longitude);	
	// console.log('More or less ' + crd.accuracy + ' meters.');
	
	var decimals = 6;
	
	var lat = String(crd.latitude);
	var latParts = lat.split(".");
	var latInt = latParts[0];
	var latDec = latParts[1];
	latDec = latDec.substring(0, decimals);
	lat = latInt+"."+latDec;
	
	var lon = String(crd.longitude);
	var lonParts = lon.split(".");
	var lonInt = lonParts[0];
	var lonDec = lonParts[1];
	var lonDec = lonDec.substring(0, decimals);
	lon = lonInt+"."+lonDec;
	
	
	actualVisitCords = lat+", "+lon;
	console.log(actualVisitCords)
	
	var showCoords = fixCoords(actualVisitCords);
	
	if(document.getElementById("geoLine"))
	{
		document.getElementById("geoLine").innerHTML = showCoords;
	}
	else
	{
		console.log("coord fill failed");
	}
	
};
function error(err) 
{
	actualVisitCords = "Negado por usuario";
	fastPop("Usuario ha negado permiso para ubicación, para consultar como activar el permiso visitar: <a href='https://www.youtube.com/watch?v=jXWJZXGeKIM' target='blank'>Instrucciones para activar ubicación</a> ", 8000);
	console.warn('ERROR(' + err.code + '): ' + err.message);
	
	setTimeout(function(){PUM.close(1515);}, 500);
	
	
};
function fixCoords(coord)
{
	console.log(coord)
	if(coord != "" && coord != null )
	{
		var c1 = coord.split(", ")[0];
		var c2 = coord.split(", ")[1];
		
		var pieces1 = c1.split(".");
		var pieces2 = c2.split(".");
		
		var newDecLat = pieces1[1][0]+pieces1[1][1]+pieces1[1][2];
		var newDecLon = pieces2[1][0]+pieces2[1][1]+pieces2[1][2];
		
		var newCoord = pieces1[0]+"."+newDecLat+", "+pieces2[0]+"."+newDecLon;
	}
	else
	{
		var newCoord = "-";
	}
	
	return newCoord;
}
// -------- GEOLOCATION
function liveRefresh()
{
	var loc = window.location.href;
	var imported = document.createElement('script');
	
	imported.src = root+'app/js/live.js';
	
	// console.log("Welcome to Diogenes");
	
	if(loc.includes("192.168"))
	{
		document.head.appendChild(imported);
		document.getElementById("coverloader").style.display = "none";
		showLoaderActive = 0;
		
	}
	else
	{
		
		document.getElementById("coverloader").style.display = "none";
		document.getElementById("coverloader").style.display = "none";
	}
}
function langPickIni()
{
	langGetIni("es_co");
	jQuery.datetimepicker.setLocale("es");
}
function langGetIni(l) 
{
	var info ={};
	info.lang = l;
	lang = l;
	// console.log(info)
	sendAjax("users","langGet",info,function(response)
	{
		console.log(response)
		if(imfoo == "home"){}

		entities = response.message.entities;
		programs = response.message.programs;
		projects = response.message.projects;
		activities = response.message.activities;
		AllAct = response.message.activities;
		zones = response.message.zones;
		allZones = response.message.zones
		hoods = response.message.hoods;
		allHoods = response.message.hoods;
		institutes = response.message.institutes;
		conditions = response.message.conditions;
		etnias = response.message.etnias;
		etaries = response.message.etaries;
		hoods = parentAdder("hoods");
		
		
		// NEW MASTERS
		tipoin = response.message.tipoin;
		migrea = response.message.migrea;
		convac = response.message.convac;
		tipoco = response.message.tipoco;
		tipovi = response.message.tipovi;
		eps = response.message.eps;
		patoen = response.message.patoen;
		trasdes = response.message.trasdes;
		riskfa = response.message.riskfa;
		prevfa = response.message.prevfa;
		edlevel = response.message.edlevel;
		courses = response.message.courses;
		ocucond = response.message.ocucond;
		ingrec = response.message.ingrec;
		tiposo = response.message.tiposo;
		usuarios = response.message.users;
		inigroups = response.message.inigroups;
		components = response.message.components;
		scomponents = response.message.scomponents;
		genres = response.message.genres;
		
		

		var entPicker = document.getElementById("userEntity");
		entPicker.innerHTML = "";

		var entPickerRec = document.getElementById("userEntityRec");
		entPickerRec.innerHTML = "";
		
		// FILL ENTITIES
		selectFiller("userEntity", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		selectFiller("userEntityRec", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// TEST LOGIN
		// document.getElementById("userEntity").value = "001";
		// document.getElementById("username").value = "incocrea@outlook.com";
		// document.getElementById("password").value = "Harolito2015";
		// login();
		// TEST LOGIN
        // console.log(response)
		language = response.message.lang;
		setLang();
	});
}
function setLang()
{
	for (var text in language)
	{
		if(document.getElementById(text))
		{
			var element = document.getElementById(text);
			element.innerHTML = language[text];

			if(element.type == "text" || element.type == "password"){element.placeholder = language[text];}
			if(element.type == "textarea" || element.type == "password"){element.innerHTML = "";element.placeholder = language[text];}
		}
	}
	
	// console.log(getUrlParameter("me"))
	
	if(getUrlParameter("me"))
	{
		console.log("passrec")
		recSetPop();
		return;
	}

	checkLogin();
}
function checkLogin()
{
	if (window.localStorage.getItem("tmpkey")) 
	{
		var c = localStorage.getItem("tmpkey");
		var info = {};
		info.c = c;
		
		var method = "rlAud";
		
		sendAjax("users",method,info,function(response)
		{
			
			var ans = response.message;
			console.log(ans)
			
			entityAlive = ans.ENTITY_ALIVE;
			
			if(ans == "Disabled")
			{
				fastPop("Este usuario ha sido desactivado contacte a soporte técnico para conocer la posible causa.", 5000);
				return;
			}
			if(ans == "Caller")
			{
				fastPop("Este usuario es de tipo llamadas y se ha vencido su tiempo de acceso.", 5000);
				return;
			}
			if(response.message == "ne")
			{
				userData = "";
				setLoged("0");
			}
			else
			{
				userData = response.message;
				// console.log(userData);
				actualUser = userData.USER_CODE;
				actualEntity = userData.USER_ENTITY;
				actualCity = userData.USER_CITY;
				
				if(userData.USER_PIC != "")
				{document.getElementById("profilePicMenu").src = userData.USER_PIC;}
				
				setLoged("1");
			}
		});
	}
	else
	{
		
		userData = "";
		actualUser = "";
		
		actualEntity = "";
		
		// IF NOT LOGED AND NOT HOME.... SEND TO HOME
		
		setLoged("0");
	}

}
// RELOAD USER DATA
function userDataReload()
{
	var c = localStorage.getItem("tmpkey");
	var info = {};
	info.c = c;
	var method = "rlAud";
	sendAjax("users",method,info,function(response)
	{
		var ans = response.message;
		console.log(ans)
		userData = response.message;
		
		// SET DIRECTOR USER ACTIS
		if(userData.USER_CTYPE == "Director")
		{userData.USER_ACTIVITIES = getActisFromPrograms(userData.USER_PROGRAMS);}
	});
}

// FILES ADMIN------------------
function prepareFileLoader()
{
	document.querySelector('#fileSelectorfile').addEventListener('change', function()
	{
		var reader = new FileReader();
		reader.readAsDataURL(this.files[0]);
		reader.onload = function(e) 
		{
			
			console.log(e)
			
			var fileSelector = document.getElementById('fileSelectorfile');
			var spfname = fileSelector.value.split('.');
			var spfnameLen = spfname.length;
			var format = spfname[(spfnameLen-1)];
			
			console.log(actualFileOrigin)
			// SET LOAD LINK AS LOAD ORIGIN
			if(actualFileOrigin == "excuse")
			{var fileLink = document.getElementById("loadExcuseLink");}
			if(actualFileOrigin == "assist")
			{var fileLink = document.getElementById("loadAssistFormatLink");}
			if(actualFileOrigin == "event")
			{var fileLink = document.getElementById("loadEventPicLink");}
			if(actualFileOrigin == "request")
			{var fileLink = document.getElementById("loadRequestFileLink");}
			if(actualFileOrigin == "comment")
			{var fileLink = document.getElementById("loadCommentLink");}
			if(actualFileOrigin == "commentClose")
			{var fileLink = document.getElementById("loadCommentCloseLink");}
			if(actualFileOrigin == "csv")
			{var fileLink = document.getElementById("loadCsvLink");}
			
			// VISIT FORM
			// if(actualFileOrigin == "planClass")
			// {var fileLink = document.getElementById("planClassLink");}
			if(actualFileOrigin == "assistPic")
			{var fileLink = document.getElementById("assistListLink");}
			if(actualFileOrigin == "classPic")
			{var fileLink = document.getElementById("classPicLink");}

			// console.log(format);
			// console.log(reader.result);
			
			// LOAD FILE NOT PIC EXCLUSIVE
			if(actualFileOrigin == "assist" || actualFileOrigin == "excuse" || actualFileOrigin == "request" || actualFileOrigin == "comment" || actualFileOrigin == "commentClose" || actualFileOrigin == "csv")
			{
				if(actualFileOrigin == "event" && format != "jpg" && format != "JPG" && format != "jpeg" && format != "JPEG" && format != "pdf" && format != "PDF")
				{
					actualLoadedFile = "";
					actualLoadedFileFormat = "";
					fastPop("Tipo de archivo invalido, solo puedes cargar archivos tipo jpg o pdf", 4000);
					fileSelector.value = "";
					fileLink.innerHTML = "Cargar foto o pdf";
					return;
				}
				if(actualFileOrigin == "comment" && format != "pdf" && format != "PDF")
				{
					actualLoadedFile = "";
					actualLoadedFileFormat = "";
					fastPop("Tipo de archivo invalido, solo puedes cargar archivos pdf", 4000);
					fileSelector.value = "";
					fileLink.innerHTML = "Cargar pdf";
					return;
				}
				if(actualFileOrigin == "commentClose" && format != "pdf" && format != "PDF")
				{
					actualLoadedFile = "";
					actualLoadedFileFormat = "";
					fastPop("Tipo de archivo invalido, solo puedes cargar archivos pdf", 4000);
					fileSelector.value = "";
					fileLink.innerHTML = "Cargar pdf";
					return;
				}
				if(actualFileOrigin == "csv" && format != "csv" && format != "CSV")
				{
					actualLoadedFile = "";
					actualLoadedFileFormat = "";
					fastPop("Tipo de archivo invalido, solo puedes cargar archivos csv", 4000);
					fileSelector.value = "";
					fileLink.innerHTML = "Cargar csv";
					return;
				}
			}
			else if(actualFileOrigin == "planClass")
			{
				if(actualFileOrigin == "planClass" && format != "jpg" && format != "JPG" && format != "jpeg" && format != "JPEG" && format != "pdf" && format != "PDF" && format != "xls" && format != "XLS" && format != "doc" && format != "DOC" && format != "xlsx" && format != "XLSX" && format != "docx" && format != "DOCX")
				{
					actualLoadedFile = "";
					actualLoadedFileFormat = "";
					fastPop("Tipo de archivo invalido, solo puedes cargar archivos tipo jpg, pdf, doc o xls", 4000);
					fileSelector.value = "";
					fileLink.innerHTML = "Cargar plan de clase";
					return;
				}
			}
			// LOAD FILE PIC EXCLUSIVE
			else
			{
				if(format != "jpg" && format != "JPG" && format != "jpeg" && format != "JPEG")
				{
					actualLoadedFile = "";
					actualLoadedFileFormat = "";
					
					actualEventPic = "";
					actualEventPicFormat = "";
					
					fastPop("Tipo de archivo invalido, solo puedes cargar archivos tipo jpg", 4000);
					fileSelector.value = "";
					fileLink.innerHTML = "Cargar foto";
					return;
				}
				
				// RESIZE PIC FOR LOAD
				var resize_width = 600;
			
				var img = new Image();
				img.src = e.target.result;
				img.name = e.target.name;
				img.size = e.target.size;
				img.onload = function(el)
				{
					var elem = document.createElement('canvas');//create a canvas
					var scaleFactor = resize_width / el.target.width;
					elem.width = resize_width;
					elem.height = el.target.height * scaleFactor;
					var ctx = elem.getContext('2d');
					ctx.drawImage(el.target, 0, 0, elem.width, elem.height);
					var pic = ctx.canvas.toDataURL('image/jpeg', 0.7);
					actualEventPic = pic;
					actualEventPicFormat = format;
				}
				
				fileLink.innerHTML = fileSelector.value;
				
			}
			
			if(format == "jpg" || format == "JPG" || format == "jpeg" || format == "JPEG")
			{
				
				// RESIZE PIC FOR LOAD
				var resize_width = 600;
			
				var img = new Image();
				img.src = e.target.result;
				img.name = e.target.name;
				img.size = e.target.size;
				img.onload = function(el)
				{
					var elem = document.createElement('canvas');//create a canvas
					var scaleFactor = resize_width / el.target.width;
					elem.width = resize_width;
					elem.height = el.target.height * scaleFactor;
					var ctx = elem.getContext('2d');
					ctx.drawImage(el.target, 0, 0, elem.width, elem.height);
					var pic = ctx.canvas.toDataURL('image/jpeg', 0.7);
					
					var result = pic;
					
					if(actualFileOrigin == "excuse")
					{
						actualLoadedFile = result;
						actualLoadedFileFormat = format;
					}
					else if(actualFileOrigin == "assist")
					{
						actualAssistForm = result;
						actualAssistFormFormat = format;
					}
					else if(actualFileOrigin == "request")
					{
						actualRequestFile = result;
						actualRequestFileFormat = format;
					}
					// else if(actualFileOrigin == "planClass")
					// {
						// actualVisitPlanFile = result;
						// actualVisitPlanFileFormat = format;
					// }
					else if(actualFileOrigin == "assistPic")
					{
						actualAssistPicFile = result;
						actualAssistPicFileFormat = format;
					}
					else if(actualFileOrigin == "classPic")
					{
						actualClassPicFile = result;
						actualClassPicFileFormat = format;
					}
					
					actualEventPic = pic;
					actualEventPicFormat = format;
				}
				
				
			}
			else
			{
				var result = reader.result;
				
				if(actualFileOrigin == "excuse")
				{
					actualLoadedFile = result;
					actualLoadedFileFormat = format;
				}
				else if(actualFileOrigin == "assist")
				{
					actualAssistForm = result;
					actualAssistFormFormat = format;
				}
				else if(actualFileOrigin == "request")
				{
					actualRequestFile = result;
					actualRequestFileFormat = format;
				}
				else if(actualFileOrigin == "comment")
				{
					actualCommentFile = result;
					actualCommentFileFormat = format;
					
				}
				else if(actualFileOrigin == "commentClose")
				{
					actualCommentCloseFile = result;
					actualCommentCloseFileFormat = format;
					
				}
				else if(actualFileOrigin == "assistPic")
				{
					actualAssistPicFile = result;
					actualAssistPicFileFormat = format;
				}
				else if(actualFileOrigin == "classPic")
				{
					actualClassPicFile = result;
					actualClassPicFileFormat = format;
				}
				else if(actualFileOrigin == "csv")
				{
					actualCsvFile = result;
					actualCsvFileFormat = format;
					fileLink.innerHTML = fileSelector.value;
					document.getElementById("fileSelectorfile").value = "";
					loadCsv(actualFileOrigin);
					fileSelector.value = "";
					fileLink.innerHTML = "Cargar csv";
					return;
				}
			}
			

			fileLink.innerHTML = fileSelector.value;
			
			document.getElementById("fileSelectorfile").value = "";
		}
		
	})
}

// IMG ADMIN------------------
function prepareImgCropper()
{
	document.querySelector('#fileSelector').addEventListener('change', function()
	{
		var reader = new FileReader();
		reader.onload = function(e) 
		{
			var img = new Image;
			var fileSelector = document.getElementById('fileSelector');
			var spfname = fileSelector.value.split('.');
			var spfnameLen = spfname.length;
			var format = spfname[(spfnameLen-1)];
			
			console.log(format)
			
			if(format != "jpg" && format != "JPG" && format != "jpeg" && format != "JPEG")
			{
				actualCroppedPic = "";
				fastPop("Tipo de archivo invalido, solo puedes cargar archivos tipo jpg", 4000);
				fileSelector.value = "";
				return;
			}
			
			var size = parseInt(e.loaded/1000);
			
			img.onload = function() 
			{
				var fileSelector = document.getElementById('fileSelector');
				var spfname = fileSelector.value.split('.');
				var spfnameLen = spfname.length;
				var format = spfname[(spfnameLen-1)];

				var w = img.width;
				var h = img.height;

				croppieQ = 0.7;
				console.log(size)
				
				if(size <= 499)
				{
					croppieQ = 0.7;
				}
				if(size <= 500 && size >= 999)
				{
					croppieQ = 0.5;
				}
				if(size >= 1000)
				{
					croppieQ = 0.4;
				}
				args = 
				{
					url: e.target.result,
					orientation: 1, 
				}
				croppieSet();

			};
			
			img.src = reader.result;
		}
		reader.readAsDataURL(this.files[0]);
	})
}
// -----------CROPPIE--------------
function croppieSet()
{


	if(theCroppie != null){theCroppie.destroy();}
	
	console.log("gets-1")
	
	var container = document.getElementById("croppieBox");
	container.innerHTML = "";
	var cpie = document.createElement("div");
	cpie.id = "cpie";
	
	var footer = document.createElement("div");
	footer.className = "modal-footer";
	
	var cancel = document.createElement("button");
	cancel.className = "btn btn-secondary btn-sm";
	cancel.onclick = function ()
	{
		PUM.close(1530);
		document.getElementById("fileSelector").value = "";
	}
	cancel.innerHTML = "Cancelar";
	
	console.log("gets0")
	
	var accept = document.createElement("button");
	accept.className = "btn btn-primary btn-sm";
	accept.onclick = function ()
	{
		getCroppieR();
	}
	accept.innerHTML = "Guardar";

	footer.appendChild(cancel);
	footer.appendChild(accept);
	
	console.log("gets")

	container.appendChild(cpie);
	container.appendChild(footer);

	if(jQuery(window).width() < 800)
	{
		var opts = 
		{
			viewport: { width: 180, height: 200 },
			boundary: { width: 180, height: 200 },
			showZoomer: true,
			enableOrientation: true,
			mouseWheelZoom: 'ctrl',
			
		}
	}
	else
	{
		if(actualPicType == "0")
		{
			var opts = 
			{
				viewport: { width: 180, height: 200},
				boundary: { width: 180, height: 200 },
				showZoomer: true,
				enableOrientation: true,
				mouseWheelZoom: 'ctrl',
			}
		}
		
		
	}
	
	theCroppie = new Croppie(document.getElementById('cpie'), opts);
	theCroppie.bind(args);
	
	
	PUM.open(1530);
	
	var zoomBar = document.getElementsByClassName("cr-slider")[0];
	
	if(jQuery(window).width() < 800)
	{
		zoomBar.value = "0.3";
		var pic = document.getElementsByClassName("cr-image")[0];
	}
	else
	{
		zoomBar.value = "1";
		zoomBar.min = "0.3";
	}
	zoomBar.max = "1.5";
	
	
}
function getCroppieR()
{
	var args =
	{
		type: 'base64',
		size: 'original',
		format: 'jpeg',
		quality: croppieQ,
		circle: false
	}	
	
	theCroppie.result(args).then(function(resp) 
	{
		actualCroppedPic = resp;
		if(actualPicType == "0")
		{
			PUM.close(1530);
			document.getElementById("USER_PIC").src = actualCroppedPic;
		}
		
	});

}

// -------------SESSION---------------
function setLoged(mode)
{
	
	lockRequest = "0";
	
	if(mode == "1")
	{	
		// PURIFY MASTERS IF NOT SUPERIOR
		
		if(userData.USER_CTYPE != "Superior")
		{
			programs = purifyEntity(programs,"PROGRAM_ENTITY");
			projects = purifyEntity(projects,"PROJECT_ENTITY");
			activities = purifyEntity(activities,"ACTIVITY_ENTITY");
			zones = purifyCity(zones,"ZONE_CITY");
			hoods = purifyCity(hoods,"HOOD_CITY");
			institutes = purifyCity(institutes,"INSTITUTE_CITY");
			// conditions = purifyEntity(conditions,"CONDITION_ENTITY");
			// etnias = purifyEntity(etnias,"ETNIA_ENTITY");
			etaries = purifyEntity(etaries,"ETARIE_ENTITY");
			
		}
		else
		{
			console.log(activities);
		}
		
		
		
		jQuery('html, body').animate({scrollTop : 1}, 300);
		// SHOW
		jQuery('#mainheader').show();
		jQuery('#loginbox').hide();
		jQuery('#homeBox').show();

		// SET DIRECTOR USER ACTIS
		if(userData.USER_CTYPE == "Director")
		{userData.USER_ACTIVITIES = getActisFromPrograms(userData.USER_PROGRAMS);}
		
		setMenuItems();
		
		
		if(userData.USER_CALLER == "1")
		{
			loadIf("callsB");
		}
		else
		{
			loadIf("contractsB");
			// loadIf("reportsB");
			// loadIf("usersB");
			// loadIf("citizensB");
			// loadIf("groupsB");
			// loadIf("visitsB");
			// loadIf("visitsDoneB");
			// loadIf("classesB");
			// loadIf("institutesB");
			// loadIf("eventsB");
			// loadIf("eventsRB");
			// loadIf("etariesB");
			// loadIf("welcomeB");
			// loadIf("programsB");
			// loadIf("projectsB");
			// loadIf("activitiesB");
			// loadIf("entitiesB");
			// loadIf("zonesB");
			// loadIf("hoodsB");
			// loadIf("logB");
			// loadIf("mastersB");
			// loadIf("remitionsB"); 
			
			// loadIf("agendaB");
			
			// actualRemitionData = {};
			// actualRemitionData.IS_MINE= "0"
			// actualRemitionData.REM_ACTIVITY= "9aff43e652365b20b436673ac4059bc2"
			// actualRemitionData.REM_AUTOR= "b2e9f4a1932e72b72b4a7be84bd8e752"
			// actualRemitionData.REM_AUTOR_NAME= "LIGA DE TAEKWONDO  DE RISARALDA"
			// actualRemitionData.REM_CITIZEN= "10031785"
			// actualRemitionData.REM_CITIZEN_NAME= "Harold Velez"
			// actualRemitionData.REM_CODE= "eb43dafc0716d7cc108230fac6015ba9"
			// actualRemitionData.REM_CONTRATIST= "c1d7bef433edc61a6b01319bcdc64f69"
			// actualRemitionData.REM_CONTRATIST_NAME= "Ana InÃ©s Andrich"
			// actualRemitionData.REM_DATE= "2022-03-09"
			// actualRemitionData.REM_ENTITY= "001"
			// actualRemitionData.REM_LINE= "1"
			// actualRemitionData.REM_ORPHAN= 0
			// actualRemitionData.REM_REQUESTER= "54321"
			// actualRemitionData.REM_REQUESTER_NAME= "xxx xxx"
			// actualRemitionData.REM_REQUESTER_TYPE= "0e80774f18d7e4e095c02828274a7345"
			// actualRemitionData.REM_STATE= "0"
			// loadIf("attendB");
			
			
			setTimeout(function(){return}, 500);
			


		}
		
	}
	if(mode == "0")
	{
		jQuery('html, body').animate({scrollTop : 1}, 300);
		// SHOW
		jQuery('#loginbox').show();
		// HIDE
		jQuery('#mainheader').hide();
		jQuery('#regBox').hide();
		jQuery('#homeBox').hide();

	}
	
	liveRefresh();
	
}
function purifyEntity(list,key)
{
	var newList = [];
	
	for(var i=0; i<list.length; i++)
	{
		var item = list[i];
		if(item[key] == actualEntity)
		{newList.push(item);}
	}
	return newList;
}
function purifyCity(list,key)
{
	var newList = [];
	
	for(var i=0; i<list.length; i++)
	{
		var item = list[i];
		if(item[key] == actualCity)
		{newList.push(item);}
	}
	return newList;
}
function setMenuItems()
{
	var menuBox = document.getElementById("myTopnav");
	menuBox.innerHTML = "";
	
	var headerLine = document.getElementById("headerLine");
	
	if(userData.USER_CALLER == "1")
	{
		headerLine.innerHTML = userData.USER_NAME+" "+userData.USER_LASTNAME+" - "+utypesDictionary["Llamadas"];
	}
	else
	{
		headerLine.innerHTML = userData.USER_NAME+" "+userData.USER_LASTNAME+" - "+utypesDictionary[userData.USER_CTYPE];
	}
	
	
	// HOME ICON
	menuBox.appendChild(menuCreator("welcomeBmenu", "welcomeB", "<i class='fas fa-home'></i>"));
		
	// MENUS BY USER
	
	// console.log(userData);
	
	// CALLER USER MENU
	if(userData.USER_CALLER == "1")
	{
		menuBox.appendChild(menuCreator("callsBmenu", "callsB", "Llamadas"));
		menuBox.appendChild(menuCreator("exitMenu", "logout", "Cerrar sesión"));
		// MOBILE ICON
		menuBox.appendChild(menuCreator("respBox", "respBox", "<i class='fa fa-bars'>"));
		return;
	}
	
	
	// NOT CALLER USER MENU
	if(userData.USER_CTYPE == "General")
	{
		menuBox.appendChild(menuCreator("contractsBmenu", "contractsB", "Contratos"));
	}
	if(userData.USER_CTYPE == "Director")
	{
		menuBox.appendChild(menuCreator("contractsBmenu", "contractsB", "Contratos"));
		// menuBox.appendChild(menuCreator("citizensBmenu", "citizensB", "Ciudadanos"));
		menuBox.appendChild(menuCreator("groupsBmenu", "groupsB", "Grupos"));
		menuBox.appendChild(menuCreator("classesBmenu", "classesB", "Clases"));
		menuBox.appendChild(menuCreator("eventsBmenu", "eventsB", "Eventos"));
		menuBox.appendChild(menuCreator("eventsRBmenu", "eventsRB", "Eventos por solicitud"));
		menuBox.appendChild(menuCreator("visitsBmenu", "visitsB", "Pre-visitas"));
		menuBox.appendChild(menuCreator("visitsDoneBmenu", "visitsDoneB", "Visitas"));
		menuBox.appendChild(menuCreator("reportsBmenu", "reportsB", "Reportes"));
		
		if(userData.USER_CONTRACT_CANREM == "Si")
		{
			menuBox.appendChild(menuCreator("remitionsBmenu", "remitionsB", "Atenciones"));
		}
		if(userData.USER_CONTRACT_CANREM_GET == "Si")
		{
			menuBox.appendChild(menuCreator("agendaBmenu", "agendaB", "Agenda"));
		}

	}
	if(userData.USER_CTYPE == "Coordinador")
	{
		menuBox.appendChild(menuCreator("contractsBmenu", "contractsB", "Contratos"));
		// menuBox.appendChild(menuCreator("citizensBmenu", "citizensB", "Ciudadanos"));
		menuBox.appendChild(menuCreator("groupsBmenu", "groupsB", "Grupos"));
		menuBox.appendChild(menuCreator("classesBmenu", "classesB", "Clases"));
		menuBox.appendChild(menuCreator("eventsBmenu", "eventsB", "Eventos"));menuBox.appendChild(menuCreator("etariesBmenu", "eventsRB", "Eventos por solicitud"));
		menuBox.appendChild(menuCreator("visitsBmenu", "visitsB", "Pre-visitas"));
		menuBox.appendChild(menuCreator("visitsDoneBmenu", "visitsDoneB", "Visitas"));
		
		if(userData.USER_CONTRACT_CANREM == "Si")
		{
			menuBox.appendChild(menuCreator("remitionsBmenu", "remitionsB", "Atenciones"));
		}
		if(userData.USER_CONTRACT_CANREM_GET == "Si")
		{
			menuBox.appendChild(menuCreator("agendaBmenu", "agendaB", "Agenda"));
		}
	}
	if(userData.USER_CTYPE == "Cogestor")
	{
		menuBox.appendChild(menuCreator("contractsBmenu", "contractsB", "Contratos"));
		menuBox.appendChild(menuCreator("groupsBmenu", "groupsB", "Grupos"));
		menuBox.appendChild(menuCreator("classesBmenu", "classesB", "Clases"));
		menuBox.appendChild(menuCreator("eventsBmenu", "eventsB", "Eventos"));
		menuBox.appendChild(menuCreator("eventsRBmenu", "eventsRB", "Eventos por solicitud"));
		menuBox.appendChild(menuCreator("visitsBmenu", "visitsB", "Pre-visitas"));
		menuBox.appendChild(menuCreator("visitsDoneBmenu", "visitsDoneB", "Visitas"));
		menuBox.appendChild(menuCreator("reportsBmenu", "reportsB", "Reportes"));
		
		if(userData.USER_CONTRACT_CANREM == "Si")
		{
			menuBox.appendChild(menuCreator("remitionsBmenu", "remitionsB", "Atenciones"));
		}
		if(userData.USER_CONTRACT_CANREM_GET == "Si")
		{
			menuBox.appendChild(menuCreator("agendaBmenu", "agendaB", "Agenda"));
		}
	}
	if(userData.USER_CTYPE == "Instructor")
	{
		menuBox.appendChild(menuCreator("contractsBmenu", "contractsB", "Contratos"));
		menuBox.appendChild(menuCreator("groupsBmenu", "groupsB", "Grupos"));
		menuBox.appendChild(menuCreator("classesBmenu", "classesB", "Clases"));
		menuBox.appendChild(menuCreator("eventsBmenu", "eventsB", "Eventos"));
		menuBox.appendChild(menuCreator("eventsRBmenu", "eventsRB", "Eventos por solicitud"));
		menuBox.appendChild(menuCreator("reportsBmenu", "reportsB", "Reportes"));
		
		if(userData.USER_CONTRACT_CANREM == "Si")
		{
			menuBox.appendChild(menuCreator("remitionsBmenu", "remitionsB", "Atenciones"));
		}
		if(userData.USER_CONTRACT_CANREM_GET == "Si")
		{
			menuBox.appendChild(menuCreator("agendaBmenu", "agendaB", "Agenda"));
		}
	}
	if(userData.USER_CTYPE == "Visitador")
	{
		menuBox.appendChild(menuCreator("contractsBmenu", "contractsB", "Contratos"));
		menuBox.appendChild(menuCreator("visitsBmenu", "visitsB", "Pre-visitas"));
		menuBox.appendChild(menuCreator("visitsDoneBmenu", "visitsDoneB", "Visitas"));
		menuBox.appendChild(menuCreator("reportsBmenu", "reportsB", "Reportes"));
	}
	if(userData.USER_CTYPE == "Principal1" || userData.USER_CTYPE == "Principal2" || userData.USER_CTYPE == "Principal3" )
	{
		menuBox.appendChild(menuCreator("contractsBmenu", "contractsB", "Contratos"));
		menuBox.appendChild(menuCreator("programsBmenu", "programsB", "Programas"));
		menuBox.appendChild(menuCreator("projectsBmenu", "projectsB", "Proyectos"));
		menuBox.appendChild(menuCreator("activitiesBmenu", "activitiesB", "Actividades"));
		// menuBox.appendChild(menuCreator("conditionsBmenu", "conditionsB", "Condiciones"));
		// menuBox.appendChild(menuCreator("etniasBmenu", "etniasB", "Etnias"));
		// menuBox.appendChild(menuCreator("etariesBmenu", "etariesB", "Edades"));
		menuBox.appendChild(menuCreator("usersBmenu", "usersB", "Usuarios"));
		// menuBox.appendChild(menuCreator("citizensBmenu", "citizensB", "Ciudadanos"));
		menuBox.appendChild(menuCreator("groupsBmenu", "groupsB", "Grupos"));
		menuBox.appendChild(menuCreator("classesBmenu", "classesB", "Clases"));
		menuBox.appendChild(menuCreator("eventsBmenu", "eventsB", "Eventos"));
		menuBox.appendChild(menuCreator("eventsRBmenu", "eventsRB", "Eventos por solicitud"));
		
		menuBox.appendChild(menuCreator("visitsDoneBmenu", "visitsDoneB", "Visitas"));
		menuBox.appendChild(menuCreator("reportsBmenu", "reportsB", "Reportes"));
		menuBox.appendChild(menuCreator("remitionsBmenu", "remitionsB", "Atenciones"));
		menuBox.appendChild(menuCreator("agendaBmenu", "agendaB", "Agenda"));
	}
	if(userData.USER_CTYPE == "Superior")
	{
		menuBox.appendChild(menuCreator("contractsBmenu", "contractsB", "Contratos"));
		menuBox.appendChild(menuCreator("programsBmenu", "programsB", "Programas"));
		menuBox.appendChild(menuCreator("projectsBmenu", "projectsB", "Proyectos"));
		menuBox.appendChild(menuCreator("activitiesBmenu", "activitiesB", "Actividades"));
		menuBox.appendChild(menuCreator("entitiesBmenu", "entitiesB", "Entidades"));
		// menuBox.appendChild(menuCreator("institutesBmenu", "institutesB", "Lugares de servicio"));
		// menuBox.appendChild(menuCreator("zonesBmenu", "zonesB", "Comunas"));
		// menuBox.appendChild(menuCreator("hoodsBmenu", "hoodsB", "Barrios"));
		// menuBox.appendChild(menuCreator("conditionsBmenu", "conditionsB", "Condiciones"));
		// menuBox.appendChild(menuCreator("etniasBmenu", "etniasB", "Etnias"));
		// menuBox.appendChild(menuCreator("etariesBmenu", "etariesB", "Edades"));
		menuBox.appendChild(menuCreator("usersBmenu", "usersB", "Usuarios"));
		menuBox.appendChild(menuCreator("citizensBmenu", "citizensB", "Ciudadanos"));
		menuBox.appendChild(menuCreator("groupsBmenu", "groupsB", "Grupos"));
		menuBox.appendChild(menuCreator("classesBmenu", "classesB", "Clases"));
		menuBox.appendChild(menuCreator("eventsBmenu", "eventsB", "Eventos"));
		menuBox.appendChild(menuCreator("eventsRBmenu", "eventsRB", "Eventos por solicitud"));
		menuBox.appendChild(menuCreator("visitsDoneBmenu", "visitsDoneB", "Visitas"));
		menuBox.appendChild(menuCreator("reportsBmenu", "reportsB", "Reportes"));
		menuBox.appendChild(menuCreator("remitionsBmenu", "remitionsB", "Atenciones"));
		menuBox.appendChild(menuCreator("logBmenu", "logB", "Log"));
		menuBox.appendChild(menuCreator("mastersBmenu", "mastersB", "Maestros"));
	}

	menuBox.appendChild(menuCreator("exitMenu", "logout", "Cerrar sesión"));
	
	// MOBILE ICON
	menuBox.appendChild(menuCreator("respBox", "respBox", "<i class='fa fa-bars'>"));
	
}
function menuCreator(id, iface, content)
{
	var item = document.createElement("a");
	item.href = "javascript:void(0)";
	item.innerHTML = content;
	item.iface = iface;
	item.className = ".topnav a";
	item.id = id;
	
	if(iface == "logout")
	{
		item.onclick = function ()
		{logout();}
	}
	else if(iface == "respBox")
	{
		item.className = "icon";
		item.onclick = function ()
		{myFunction();}
	}
	else
	{
		item.onclick = function ()
		{loadIf(this.iface,this);}
	}

	return item;
}
function login()
{
	var entity = document.getElementById("userEntity").value.replace(/\s+/g, '');
	var email = document.getElementById("username").value.toLowerCase().replace(/\s+/g, '');
	var pssw = document.getElementById("password").value;
	var info = {};
	info.entity = entity;
	info.email = email;
	info.pssw = pssw;
	actualMT = "0";
	imfoo = "home";
	
	if(entity == "")
	{
		fastPop("Debe seleccionar la institución.", 2000);
		return;
	}
	if(email == "")
	{
		fastPop("Debe escribir el email de usuario.", 2000);
		return;
	}
	if(!checkEmail(email))
	{
		// fastPop("Debes ingresar un Email válido.", 2000);
		// return;
	}
	if(pssw == "")
	{
		fastPop("Debe escribir la contraseña de usuario.", 2000);
		return;
	}
	
	loadManager(1, "loginButton");
	sendAjax("users","login",info,function(response)
	{
		loadManager(0, "loginButton");
		var ans = response.message;
		console.log(ans)
		
		entityAlive = ans.ENTITY_ALIVE;
		
		if(ans == "Disabled")
		{
			fastPop("Este usuario ha sido desactivado contacte a soporte técnico para conocer la posible causa.", 5000);
			return;
		}
		if(ans == "Caller")
		{
			fastPop("Este usuario es de tipo llamadas y se ha vencido su tiempo de acceso.", 5000);
			return;
		}
		else if(ans == "")
		{
			fastPop("Institución, email o contraseña incorrectos", 2000);
		}
		else
		{
			console.log("activo");
			userData = ans;
			console.log(userData);
			if(userData.USER_PIC != "")
			{document.getElementById("profilePicMenu").src = userData.USER_PIC;}
			actualUser = userData.USER_CODE;
			actualEntity = userData.USER_ENTITY;
			actualCity = userData.USER_CITY;
			localStorage.setItem("tmpkey", actualUser);
			setLoged("1");
		}
	});
}
function logout()
{
	document.getElementById("coverloader").style.display = "block";
	localStorage.removeItem("tmpkey");
	var info = {};
	actualMT = "9";
	imfoo = "home";
	
	loadManager(1, "exitMenu");
	sendAjax("users","logout",info,function(response)
	{
		loadManager(0, "exitMenu");
		
		userData = "";
		
		var loc = window.location.href;
		if(loc.includes("192.168"))
		{
			location.replace("http://192.168.0.60/www/diogenes/");
		}
		else
		{
			location.replace("https://sistemadiogenes.com/");
		}
		
	});
	
	
}
function recPop()
{
	PUM.open(948);
	document.getElementById("passRecField").value = "";
	
	var acceptB = document.getElementById("recoverConfirmButton");
	acceptB.innerHTML = language["accept"];
	acceptB.onclick = function()
	{
		var entity = document.getElementById("userEntityRec").value.replace(/\s+/g, '');
		var email = document.getElementById("passRecField").value.replace(/\s+/g, '');
		
		if(entity == "")
		{
			fastPop("Debes seleccionar la institución.", 2000);
			return;
		}
		if(email == "")
		{
			fastPop("Debes escribir el Email.", 2000);
			return;
		}
		if(!checkEmail(email))
		{
			// fastPop("Debes ingresar un Email válido.", 2000);
			// return;
		}
		
		var info = {};
		info.entity = entity;
		info.email = email;
		info.lang = lang;
		
		loadManager(1, "recoverConfirmButton");
		sendAjax("users","mailExist",info,function(response)
		{
			loadManager(0, "recoverConfirmButton");
			var ans = response.message;
			console.log(ans)
			
			if(ans == "notSent")
			{
				setTimeout(function()
				{
					fastPop("No existe un usuario con esta combinación de institución y Email", 3000); 
				}, 500);
				return;
			}
			else if(ans == "notmail")
			{
				setTimeout(function()
				{
					fastPop("Para recuperar la contraseña de este usuario debe contactar a soporte técnico.", 5000);
				
					closeRecover();
				}, 500);
			}
			else
			{
				setTimeout(function()
				{
					fastPop("Se ha enviado un Email con las instrucciones de recuperación, en caso de no verlo en la bandeja de entrada revisar la bandeja de correo no deseado o spam", 5000);
				
					closeRecover();
				}, 500);
				
				
				
			}
			
		});
		
	}
	var cancelB = document.getElementById("recoverCancelButton");
	cancelB.innerHTML = language["cancel"];
	cancelB.onclick = function(){closeRecover()}
	
}
function closeRecover()
{
	PUM.close(948);
}
function recSetPop()
{
	document.getElementById("coverloader").style.display = "block";
	PUM.open(944);
	tmpkey = getUrlParameter("tmpkey");
	document.getElementById("passRecSetField1").value = "";
	document.getElementById("passRecSetField2").value = "";
	
	var acceptB = document.getElementById("recoverSetConfirmButton");
	acceptB.innerHTML = "Establecer";
	acceptB.onclick = function()
	{
		var pass1 = document.getElementById("passRecSetField1").value.replace(/\s+/g, '');
		var pass2 = document.getElementById("passRecSetField2").value.replace(/\s+/g, '');
		
		if(pass1 == "")
		{
			fastPop("Debes escribir la contraseña.", 2000);
			return;
		}
		if(pass1 != pass2)
		{
			fastPop("La contraseña y la confirmación no coinciden", 2000);
			return;
		}
	
		var info = {};
		info.code = tmpkey;
		info.pass = pass1;
		loadManager(1, "recoverSetConfirmButton");
		sendAjax("users","setPass",info,function(response)
		{
			loadManager(0, "recoverSetConfirmButton");
			var ans = response.message;
			userData = "";
			localStorage.removeItem("tmpkey");
			
			fastPop("Contraseña establecida", 3000);
			setTimeout(function()
			{
				
				var loc = window.location.href;
				if(loc.includes("192.168"))
				{
					window.location.href = "http://192.168.0.60/www/diogenes/";
				}
				else
				{
					window.location.href = "https://sistemadiogenes.com/";
				}
				
			
			}, 3000);
			
			
		});
		
	}

}
function getUrlParameter(sParam) 
{
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
        }
    }
};
function sendContact()
{
	var info = {};
	info.name = document.getElementById("contactNameField").value;
	info.email = document.getElementById("contactMailField").value.toLowerCase().replace(/\s+/g, '');
	info.message = document.getElementById("contactMslField").value;
	
	if(info.name == "" || info.email == "" || info.message == "")
	{
		fastPop(language["mustFieldsReg"], 2000);
		return;
	}
	if(!checkEmail(info.email))
	{
		fastPop("Debes ingresar un Email válido.", 2000);
		return;
	}
	
	sendAjax("users","sendContact",info,function(response)
	{
		var ans = response.message;
		console.log(ans);
		fastPop(language["messageSent"], 6000);
	});
	
}

// -------------MENU---------------
function gomenu(menu)
{
	jQuery('html, body').animate( {scrollTop : 0}, 300 );
	
	console.log("to define home if load");
	return;
	
	var innerSections = ["#homeBox","#regBox","#contactsBox","#likesBox", "#statsBox","#friendProfileBox"];
	showManager(innerSections,"0");
	
	showManager(["#"+menu],"1");
	var width = jQuery( window ).width();
	if(width < 768){document.getElementById(menu).style.marginTop = "80px";}
	else{document.getElementById(menu).style.marginTop = "70px";}

	if(menu == "homeBox")
	{
		randomHome();
		return;
	}
	if(menu == "likesBox")
	{
		actualLikes = [];
		blockSize = 50;
		iniLikeRange = 0;
		endLikeRange = iniLikeRange+blockSize;
		actualLikeFilter = "2";
		
		var filter1 = document.getElementById("likeFilter1");
		filter1.className = "likeFilter";
		filter1.innerHTML = language["likeFilter1"];
		filter1.onclick = function (){actualLikeFilter = "";getLikes("likeFilter1");}
		
		var filter2 = document.getElementById("likeFilter2");
		filter2.className = "likeFilter";
		filter2.innerHTML = language["likeFilter2"];
		filter2.onclick = function (){actualLikeFilter = "1";getLikes("likeFilter2");}
		
		var filter3 = document.getElementById("likeFilter3");
		filter3.className = "likeFilter";
		filter3.innerHTML = language["likeFilter3"];
		filter3.onclick = function (){actualLikeFilter = "2";getLikes("likeFilter3");}

		getLikes("menuLikesBox");
	}
	if(menu == "contactsBox")
	{
		document.getElementById("inviteMail").value = "";
		getFriends(userData.CODE, "0");
		return;
	}
	if(menu == "regBox")
	{
		document.getElementById("usernameReg").value = userData.NAME;
		document.getElementById("usermailReg").value = userData.EMAIL;
		document.getElementById("usermailReg2").value = userData.EMAIL;
		document.getElementById("userbdayReg").value = userData.BDAY;
		document.getElementById("userCelReg").value = userData.PHONE;
		document.getElementById("userGenderReg").value = userData.GENDER;
		document.getElementById("userLocationReg").value = userData.LOCATION;
		document.getElementById("userPass1Reg").value = "******";
		document.getElementById("userPass2Reg").value = "******";
		actualAvatar = userData.AVATAR;
		document.getElementById("profileIcon").src = "app/isrc/avatars/av"+actualAvatar+".png";
		
		return;
	}
	if(menu == "statsBox")
	{
		getStats();
	}

}
function myFunction() 
{
  var x = document.getElementById("myTopnav");
  if (x.className === "topnav") {
    x.className += " responsive";
  } else {
    x.className = "topnav";
  }
}


// -------------APP FUNCTIONS---------------


// FORMS SPECIALS
function goTopPop()
{
	// -------------------------------------------------------------------
	// SCROLL TOP IN FORMS
	var contentsList = document.getElementsByClassName("pum-content");
	for(var i=0; i<contentsList.length; i++)
	{contentsList[i].scrollTop = 0;}
	// SCROLL TOP IN FORMS
	// -------------------------------------------------------------------
}
function cleaRequest(pick)
{
	if(pick == "")
	{
		document.getElementById("CONTRACT_NUMBER").onblur = function (){}
	}
	else if(pick == "Contrato nuevo")
	{
		document.getElementById("CONTRACT_NUMBER").onblur = function (){}
	}
	else
	{
		document.getElementById("CONTRACT_NUMBER").onblur = function ()
		{checkContractState(this.value, "1");}
	}
	
	document.getElementById("CONTRACT_NUMBER").value = "";
	document.getElementById("CONTRACT_INIDATE").value = "";
	document.getElementById("CONTRACT_ENDATE").value = "";
	document.getElementById("CONTRACT_USERTYPE").value = "";
	document.getElementById("CONTRACT_USERTYPE").onchange();
	document.getElementById("CONTRACT_INIDATE").disabled = false;
	document.getElementById("CONTRACT_ENDATE").disabled = false;
	document.getElementById("CONTRACT_USERTYPE").disabled = false;
}
function checkContractState(number, state)
{
	if(number == "")
	{cleaRequest("3");	return;}
	
	var info = {};
	info.CONTRACT_NUMBER = number;
	info.CONTRACT_CESION_STATE = state;
	info.CONTRACT_ENTITY = userData.USER_ENTITY;

	sendAjax("users","checkContractState",info,function(response)
	{
		var ans = response.message;
		console.log(ans);
		
		if(info.CONTRACT_CESION_STATE == "1")
		{
			if(ans.length > 0)
			{
				
				var saveButton = document.getElementById("popFormSaveButton");
				saveButton.onclick = function (){saveContract('2');}
				
				var contractData = ans[0];
				
				actualEditData = contractData;
				
				var allActivities = activities;
				
				document.getElementById("CONTRACT_INIDATE").value = contractData.CONTRACT_INIDATE;
				document.getElementById("CONTRACT_INIDATE").disabled = true;
				
				document.getElementById("CONTRACT_ENDATE").value = contractData.CONTRACT_ENDATE;
				document.getElementById("CONTRACT_ENDATE").disabled = true;
				
				document.getElementById("CONTRACT_USERTYPE").value = contractData.CONTRACT_USERTYPE;
				document.getElementById("CONTRACT_USERTYPE").disabled = true;
				
				document.getElementById("CONTRACT_USERTYPE").onchange();
				
				var locked = "1";
				
				var clistP = JSON.parse(contractData.CONTRACT_PROGRAM);
				// SET MULTIPICKER PROGRAM
				multiSelectFillerDic("CONTRACT_PROGRAM", "PROGRAM_CODE", "PROGRAM_NAME", programs, clistP,"1",locked);
				
				if(contractData.CONTRACT_USERTYPE == "Cogestor")
				{
					var myActis = [];
				
					// SHOW ONLY COG SELECTED
					for(var i=0; i<activities.length; i++)
					{
						var item = activities[i];
						if(item.ACTIVITY_COG == "1")
						{myActis.push(item);}
					}
					allActivities = myActis;
				}
				
				
				// SET MULTIPICKER ACTIVITIES
				var clistA = JSON.parse(contractData.CONTRACT_ACTIVITIES);
				console.log(clistA);
				multiSelectFillerDic("CONTRACT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_NAME", allActivities, clistA, "1",locked);
				
				var clistZ = JSON.parse(contractData.CONTRACT_ZONES);
				// SET MULTIPICKER ZONES
				multiSelectFillerDic("CONTRACT_ZONES", "ZONE_CODE", "ZONE_NAME", zones, clistZ, "1",locked);
				
			}
			else
			{
				
				console.log("No contract");
				cleaRequest('3');
				fastPop("No existe un contrato en estado de cesión con el número ingresado",3000);
			}
			
			
			
		}

	});
	
	
}

// SAVERS/EDITERS-----
function saveContract(mode)
{

	var info = {};
	
	info.CONTRACT_REQTYPE = document.getElementById("CONTRACT_REQTYPE").value;
	info.CONTRACT_NUMBER = document.getElementById("CONTRACT_NUMBER").value;
	info.CONTRACT_INIDATE = document.getElementById("CONTRACT_INIDATE").value;
	info.CONTRACT_ENDATE = document.getElementById("CONTRACT_ENDATE").value;
	info.CONTRACT_USERTYPE = document.getElementById("CONTRACT_USERTYPE").value;
	
	info.CONTRACT_PROGRAM = getMultiCheckValue("CONTRACT_PROGRAM");
	
	
	// console.log(info.CONTRACT_PROGRAM);
	
	// info.CONTRACT_ACTIVITIES = getMultiCheckValue("CONTRACT_ACTIVITIES");
	info.CONTRACT_ACTIVITIES = JSON.stringify(getPickedIds("CONTRACT_ACTIVITIES"));
	
	info.CONTRACT_ZONES = getMultiCheckValue("CONTRACT_ZONES");
	
	info.CONTRACT_REQUESTER = userData.USER_CODE;
	info.CONTRACT_ENTITY = userData.USER_ENTITY;
	
	info.MODE = mode;
	
	// console.log(info);
	
	// return
	
	
	if(info.CONTRACT_REQTYPE == ""){fastPop("Debe seleccionar el tipo de solicitud.", 2000);return;}
	if(info.CONTRACT_NUMBER == ""){fastPop("Debe ingresar un número de contrato.", 2000);return;}
	if(info.CONTRACT_INIDATE == ""){fastPop("Debe seleccionar la fecha inicial.", 2000);return;}
	if(info.CONTRACT_ENDATE == ""){fastPop("Debe seleccionar la fecha final.", 2000);return;}
	if(info.CONTRACT_USERTYPE == ""){fastPop("Debe seleccionar el tipo de usuario.", 2000);return;}
	
	// REQUESTED FIELDS ACCORDING UTYPE
	
	if(info.CONTRACT_USERTYPE == "Director")
	{
		if(info.CONTRACT_PROGRAM == "[]"){fastPop("Debe seleccionar programa.", 2000);return;}
		info.CONTRACT_ACTIVITIES = getActisFromPrograms(info.CONTRACT_PROGRAM);
		
	}
	if(info.CONTRACT_USERTYPE == "Coordinador")
	{
		// if(info.CONTRACT_PROGRAM == "[]"){fastPop("Debe seleccionar programa.", 2000);return;}
		if(info.CONTRACT_ACTIVITIES == "[]"){fastPop("Debe seleccionar Actividad.", 2000);return;}
	}
	if(info.CONTRACT_USERTYPE == "Instructor")
	{
		if(info.CONTRACT_ACTIVITIES == "[]"){fastPop("Debe seleccionar Actividad.", 2000);return;}
	}
	if(info.CONTRACT_USERTYPE == "Cogestor")
	{
		if(info.CONTRACT_ACTIVITIES == "[]"){fastPop("Debe seleccionar Actividad.", 2000);return;}
		if(info.CONTRACT_ZONES == "[]"){fastPop("Debe seleccionar Comuna o corregimiento.", 2000);return;}
	}
	
	// CHECK DATES INTEGRITY
	var d1 = new Date(info.CONTRACT_INIDATE).getTime();
	var d2 = new Date(info.CONTRACT_ENDATE).getTime();
	if(d1 >= d2)
	{fastPop("la fecha inicial no puede ser igual o posterior a la final", 4000);return;}
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE == "0")
	{
		info.USER_EMAIL = userData.USER_EMAIL;
	}
	else if(info.MODE == "1")
	{
		
		// SAVE EDIT
		info.CONTRACT_CODE = actualEditData.CONTRACT_CODE;
		info.CONTRACT_ENTITY = actualEditData.CONTRACT_ENTITY;
		
		// GOALS BLOCK
		// GOALS BLOCK
		
		info.CONTRACT_VISIT_GOALS = "";
		info.CONTRACT_OTHER_GOALS = "";
		
		info.CONTRACT_CANREM = document.getElementById("CONTRACT_CANREM").value;
		info.CONTRACT_CANREM_GET = document.getElementById("CONTRACT_CANREM_GET").value;

		var utype = actualEditData.CONTRACT_USERTYPE;
		
		if(utype == "Director" || utype == "Coordinador" || utype == "Cogestor" || utype == "Visitador")
		{

			// GET VISIT GOALS AS USER TYPE
			// console.log("enter1");
			var visitGoals = [];
			
			var visiTable = document.getElementById("wp_contracts_visit_goals");
			var lines = visiTable.children;
			
			for(var i=1; i<lines.length; i++)
			{
				var line = lines[i];
				
				var lineId = line.children[0].id.split("cell-")[1];
				var lineV1 = line.children[1].children[0].value;
				// var lineV2 = line.children[2].children[0].value;
				var lineV2 = 0;
				
				var item = {};
				item.ID = lineId;
				item.V1 = lineV1;
				item.V2 = lineV2;
				
				// if(lineV1 > 0 || lineV2 > 0){visitGoals.push(item);}
				visitGoals.push(item);
			}
			
			// if(visitGoals.length == 0)
			// {fastPop("Debe establecer por lo menos 1 meta de visita.", 4000);return;}
			
			info.CONTRACT_VISIT_GOALS = JSON.stringify(visitGoals);
		}
		
		if(utype == "Cogestor" || utype == "Instructor" || utype == "Coordinador" || utype == "Director")
		{
			// GET OTHER GOALS AS USER TYPE
			
			var otherGoals = [];
			
			var otherTable = document.getElementById("wp_contracts_other_goals");
			var lines = otherTable.children;
			
			if(lines.length == 2)
			{
				
				// if(lines[1].innerHTML == "Sin resultados")
				// {fastPop("Debe establecer por lo menos 1 meta de grupo.", 4000);return;}
			}
			
			// console.log(lines);
			
			if(lines.length > 1 && lines[1].innerHTML != "Sin resultados")
			{
			
				for(var i=1; i<lines.length; i++)
				{
					var line = lines[i];
					
					var lineId = line.children[0].innerHTML.split("Grupo ")[1].split("</span>")[0];
					var lineV1 = line.children[1].children[0].value;
					var lineV2 = line.children[2].children[0].value;
					var lineV3 = line.children[3].children[0].value;
					
					var locked = line.children[4].children[0];
					
					if(locked.tagName.toLowerCase() == 'i')
					{
						console.log("enter A");
						var lineV4 = locked.reg.FIELD4;
						
						var item = {};
						item.ID = lineId;
						item.V1 = lineV1;
						item.V2 = lineV2;
						item.V3 = lineV3;
						item.V4 = lineV4;
					}
					else
					{
						console.log("enter B");
						var item = {};
						item.ID = lineId;
						item.V1 = lineV1;
						item.V2 = lineV2;
						item.V3 = lineV3;
					}
					
					otherGoals.push(item);
				}
			}
			
			// console.log(otherGoals);
			
			// return
			
			
			info.CONTRACT_OTHER_GOALS = JSON.stringify(otherGoals);
			
			// GET EVENT GOALS AS USER TYPE
			var eventGoals = [];
			
			var eventTable = document.getElementById("wp_contracts_event_goals");
			var lines = eventTable.children;
			
			for(var i=1; i<lines.length; i++)
			{
				var line = lines[i];
				
				var lineId = line.children[0].id.split("cell-")[1];
				var lineV1 = line.children[1].children[0].value;
				var lineV2 = line.children[2].children[0].value;
				
				var item = {};
				item.ID = lineId;
				item.V1 = lineV1;
				item.V2 = lineV2;
				
				// if(lineV1 > 0 || lineV2 > 0){visitGoals.push(item);}
				eventGoals.push(item);
			}
			
			// if(eventGoals.length == 0)
			// {fastPop("Debe establecer por lo menos 1 meta de evento.", 4000);return;}
			
			info.CONTRACT_EVENT_GOALS = JSON.stringify(eventGoals);
			
			// GOALS BLOCK
			// GOALS BLOCK
		}
		else{info.CONTRACT_EVENT_GOALS = JSON.stringify([]);}
		
	}
	
	else
	{
		info.CONTRACT_CODE = actualEditData.CONTRACT_CODE;
	}
	
	console.log(info)
	
	// return;
	
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveContract",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans);
		
		if(ans == "enviado")
		{
			fastPop("Se envió su solicitud de contrato y esta en espera de aprobación.",3000);
			refreshTable("wp_contracts");
			PUM.close(1515);			
		}
		if(ans == "cesionRequest")
		{
			fastPop("Se envió su solicitud de cesión de contrato y esta en espera de aprobación.",3000);
			refreshTable("wp_contracts");
			PUM.close(1515);			
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe una solicitud o contrato activo con este número para esta entidad",4000);
		}
		else if(ans == "updated")
		{
			fastPop("Contrato actualizado",2000);
			refreshTable("wp_contracts");
			PUM.close(1515);	
		}
		else if(ans == "cross")
		{
			fastPop("Las fecha de inicio o final establecidas se cruza con otro contrato asignado a este contratista.",7000);
			return;
		}
		
	});
	
}
function saveProgram(mode)
{
	var info = {};
	
	info.PROGRAM_ENTITY = document.getElementById("PROGRAM_ENTITY").value;
	info.PROGRAM_NAME = document.getElementById("PROGRAM_NAME").value;
	
	info.MODE = mode;
	
	if(info.PROGRAM_ENTITY == ""){fastPop("Debe seleccionar la entidad.", 2000);return;}
	if(info.PROGRAM_NAME == ""){fastPop("Debe escribir el nombre del programa.", 2000);return;}
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE == "1")
	{info.PROGRAM_CODE = actualEditData.PROGRAM_CODE;}
	else{info.PROGRAM_CODE = "";}
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveProgram",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		
		if(ans == "Created")
		{
			fastPop("Se ha creado el programa",3000);
			refreshTable("wp_programs");
			PUM.close(1515);	
			
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe un programa con este nombre para esta entidad",3000);
		}
		else if(ans == "updated")
		{
			fastPop("Programa actualizado",3000);
			refreshTable("wp_programs");
			PUM.close(1515);	
		}
		
	});
	
}
function saveProject(mode)
{
	var info = {};
	
	info.PROJECT_ENTITY = document.getElementById("PROJECT_ENTITY").value;
	info.PROJECT_PROGRAM = document.getElementById("PROJECT_PROGRAM").value;
	info.PROJECT_NAME = document.getElementById("PROJECT_NAME").value;
	
	info.MODE = mode;
	
	if(info.PROJECT_ENTITY == ""){fastPop("Debe seleccionar la entidad.", 2000);return;}
	if(info.PROJECT_PROGRAM == ""){fastPop("Debe seleccionar el programa del proyecto.", 2000);return;}
	if(info.PROJECT_NAME == ""){fastPop("Debe escribir el nombre del proyecto.", 2000);return;}
		
	// SET DATA ACCORDING TO MODE
	if(info.MODE == "1")
	{info.PROJECT_CODE = actualEditData.PROJECT_CODE;}
	else{info.PROJECT_CODE = "";}
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveProject",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans)
		if(ans == "Created")
		{
			fastPop("Se ha creado el proyecto",3000);
			refreshTable("wp_projects");
			PUM.close(1515);	
			
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe un proyecto con este nombre para esta entidad",3000);
		}
		else if(ans == "updated")
		{
			fastPop("Proyecto actualizado",3000);
			refreshTable("wp_projects");
			PUM.close(1515);	
		}
		
	});
	
}
function saveActivity(mode)
{
	var info = {};
	
	info.ACTIVITY_ENTITY = document.getElementById("ACTIVITY_ENTITY").value;
	info.ACTIVITY_PROJECT = document.getElementById("ACTIVITY_PROJECT").value;
	info.ACTIVITY_NAME = document.getElementById("ACTIVITY_NAME").value;
	info.ACTIVITY_COG = document.getElementById("ACTIVITY_COG").value;
	
	info.MODE = mode;
	
	if(info.ACTIVITY_ENTITY == ""){fastPop("Debe seleccionar la entidad.", 2000);return;}
	if(info.ACTIVITY_PROJECT == ""){fastPop("Debe seleccionar el programa de la actividad.", 2000);return;}
	if(info.ACTIVITY_NAME == ""){fastPop("Debe escribir el nombre de la actividad.", 2000);return;}
	if(info.ACTIVITY_COG == ""){fastPop("Debe Seleccionar si la actividad estará activa para los cogestores.", 2000);return;}
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE == "1")
	{info.ACTIVITY_CODE = actualEditData.ACTIVITY_CODE;}
	else{info.ACTIVITY_CODE = "";}
	
	loadManager(1, "popFormSaveButton");
	
	sendAjax("users","saveActivity",info,function(response)
	{
		
		loadManager(0, "popFormSaveButton");
		
		var ans = response.message;
		
		if(ans == "Created")
		{
			fastPop("Se ha creado la actividad",3000);
			refreshTable("wp_activities");
			PUM.close(1515);	
			
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe una actividad con este nombre para esta entidad",3000);
		}
		else if(ans == "updated")
		{
			fastPop("Actividad actualizada",3000);
			refreshTable("wp_activities");
			PUM.close(1515);	
		}
		
	});
	
}
function saveEntity(mode)
{
	var info = {};
	
	info.ENTITY_CITY = document.getElementById("ENTITY_CITY").value;
	info.ENTITY_NAME = document.getElementById("ENTITY_NAME").value;
	info.ENTITY_VUNTIL = document.getElementById("ENTITY_VUNTIL").value;
	
	info.MODE = mode;
	
	if(info.ENTITY_CITY == ""){fastPop("Debe seleccionar ciudad.", 2000);return;}
	if(info.ENTITY_NAME == ""){fastPop("Debe escribir el nombre de la entidad.", 2000);return;}
	if(info.ENTITY_VUNTIL == ""){fastPop("Debe seleccionar la fecha de vencimiento.", 2000);return;}
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE == "1")
	{info.ENTITY_CODE = actualEditData.ENTITY_CODE;}
	else{info.ENTITY_CODE = "";}
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveEntity",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		
		if(ans == "Created")
		{
			fastPop("Se ha creado la entidad",3000);
			refreshTable("wp_entities");
			PUM.close(1515);	
			
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe una entidad con este nombre",3000);
		}
		else if(ans == "updated")
		{
			fastPop("Entidad actualizada",3000);
			refreshTable("wp_entities");
			PUM.close(1515);	
		}
		
	});
	
}
function saveZone(mode)
{
	var info = {};
	
	info.ZONE_CITY = document.getElementById("ZONE_CITY").value;
	info.ZONE_TYPE = document.getElementById("ZONE_TYPE").value;
	
	info.ZONE_NAME = document.getElementById("ZONE_NAME").value;
	
	info.MODE = mode;
	
	if(info.ZONE_CITY == ""){fastPop("Debe seleccionar la ciudad.", 2000);return;}
	if(info.ZONE_NAME == ""){fastPop("Debe escribir el nombre de la comuna o corregimiento.", 2000);return;}
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE == "1")
	{info.ZONE_CODE = actualEditData.ZONE_CODE;}
	else{info.ZONE_CODE = "";}
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveZone",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		
		if(ans == "Created")
		{
			fastPop("Se ha creado la comuna o corregimiento",3000);
			refreshTable("wp_zones");
			PUM.close(1515);	
			
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe una comuna o corregimiento con este nombre",3000);
		}
		else if(ans == "updated")
		{
			fastPop("Comuna o corregimiento actualizado",3000);
			refreshTable("wp_zones");
			PUM.close(1515);	
		}
		
	});
	
}
function saveHood(mode)
{
	var info = {};
	
	info.HOOD_CITY = tmpHoodCity;
	info.HOOD_ZONE = document.getElementById("HOOD_ZONE").value;
	info.HOOD_TYPE = document.getElementById("HOOD_TYPE").value;
	info.HOOD_NAME = document.getElementById("HOOD_NAME").value;
	
	info.MODE = mode;
	
	if(info.HOOD_ZONE == ""){fastPop("Debe seleccionar la comuna o corregimiento.", 2000);return;}
	if(info.HOOD_NAME == ""){fastPop("Debe escribir el nombre del barrio o vereda.", 2000);return;}
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE == "1")
	{info.HOOD_CODE = actualEditData.HOOD_CODE;}
	else{info.HOOD_CODE = "";}
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveHood",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		
		if(ans == "Created")
		{
			fastPop("Se ha creado el barrio o vereda",3000);
			refreshTable("wp_hoods");
			PUM.close(1515);	
			
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe un barrio o vereda con este nombre para esta comuna o corregimiento",3000);
		}
		else if(ans == "updated")
		{
			fastPop("Barrio o vereda actualizada",3000);
			refreshTable("wp_hoods");
			PUM.close(1515);	
		}
		
	});
	
}
function saveCondition(mode)
{
	var info = {};
	
	// info.CONDITION_ENTITY = document.getElementById("CONDITION_ENTITY").value;
	info.CONDITION_ENTITY = "-";
	info.CONDITION_NAME = document.getElementById("CONDITION_NAME").value;
	
	info.MODE = mode;
	
	// if(info.CONDITION_ENTITY == ""){fastPop("Debe seleccionar la entidad.", 2000);return;}
	if(info.CONDITION_NAME == ""){fastPop("Debe escribir el nombre de la Condición.", 2000);return;}
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE == "1")
	{info.CONDITION_CODE = actualEditData.CONDITION_CODE;}
	else{info.CONDITION_CODE = "";}
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveCondition",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		
		if(ans == "Created")
		{
			fastPop("Se ha creado la Condición",3000);
			refreshTable("wp_conditions");
			PUM.close(1515);	
			
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe una Condición con este nombre para esta entidad",3000);
		}
		else if(ans == "updated")
		{
			fastPop("Condición actualizada",3000);
			refreshTable("wp_conditions");
			PUM.close(1515);	
		}
		
	});
	
}
function saveEtnia(mode)
{
	var info = {};
	
	// info.ETNIA_ENTITY = document.getElementById("ETNIA_ENTITY").value;
	info.ETNIA_ENTITY = "-";
	info.ETNIA_NAME = document.getElementById("ETNIA_NAME").value;
	
	info.MODE = mode;
	
	// if(info.ETNIA_ENTITY == ""){fastPop("Debe seleccionar la entidad.", 2000);return;}
	if(info.ETNIA_NAME == ""){fastPop("Debe escribir el nombre de la Etnia.", 2000);return;}
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE == "1")
	{info.ETNIA_CODE = actualEditData.ETNIA_CODE;}
	else{info.ETNIA_CODE = "";}
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveEtnia",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		
		if(ans == "Created")
		{
			fastPop("Se ha creado la Etnia",3000);
			refreshTable("wp_etnias");
			PUM.close(1515);	
			
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe una Etnia con este nombre para esta entidad",3000);
		}
		else if(ans == "updated")
		{
			fastPop("Etnia actualizada",3000);
			refreshTable("wp_etnias");
			PUM.close(1515);	
		}
		
	});
	
}
function aprobeContract()
{
	var info = {};
	
	actualMT = "4";
	
	info.CONTRACT_NUMBER = document.getElementById("CONTRACT_NUMBER").value;
	info.CONTRACT_INIDATE = document.getElementById("CONTRACT_INIDATE").value;
	info.CONTRACT_ENDATE = document.getElementById("CONTRACT_ENDATE").value;
	
	info.CONTRACT_ENTITY = actualEditData.CONTRACT_ENTITY;
	info.CONTRACT_REQUESTER = actualEditData.CONTRACT_REQUESTER;
	info.CONTRACT_CODE = actualEditData.CONTRACT_CODE;
	info.CONTRACT_APROVED_BY = userData.USER_CODE;
	info.USER_EMAIL = actualEditData.CONTRACT_REQUESTER_EMAIL
	
	
	info.CONTRACT_CANREM = document.getElementById("CONTRACT_CANREM").value;
	info.CONTRACT_CANREM_GET = document.getElementById("CONTRACT_CANREM_GET").value;
	
	if(info.CONTRACT_CANREM == ""){fastPop("Debe seleccionar si el contrato podrá crear atenciones", 4000);return;}
	if(info.CONTRACT_CANREM_GET == ""){fastPop("Debe seleccionar si el contrato podrá atender", 4000);return;}
	
	// CHECK DATES INTEGRITY
	var d1 = new Date(info.CONTRACT_INIDATE).getTime();
	var d2 = new Date(info.CONTRACT_ENDATE).getTime();
	if(d1 >= d2)
	{fastPop("la fecha inicial no puede ser igual o posterior a la final", 4000);return;}
	
	// GOALS BLOCK
	// GOALS BLOCK
	
	info.CONTRACT_VISIT_GOALS = "";
	info.CONTRACT_OTHER_GOALS = "";
	info.CONTRACT_EVENT_GOALS = "";

	var utype = actualEditData.CONTRACT_USERTYPE;
	
	if(utype == "Director" || utype == "Coordinador" || utype == "Cogestor" || utype == "Visitador")
	{

		// GET VISIT GOALS AS USER TYPE
		var visitGoals = [];
		
		var visiTable = document.getElementById("wp_contracts_visit_goals");
		var lines = visiTable.children;
		
		for(var i=1; i<lines.length; i++)
		{
			var line = lines[i];
			
			var lineId = line.children[0].id.split("cell-")[1];
			var lineV1 = line.children[1].children[0].value;
			// var lineV2 = line.children[2].children[0].value;
			var lineV2 = 0;
			
			var item = {};
			item.ID = lineId;
			item.V1 = lineV1;
			item.V2 = lineV2;
			
			// if(lineV1 > 0 || lineV2 > 0){visitGoals.push(item);}
			visitGoals.push(item);
		}
		
		// if(visitGoals.length == 0)
		// {fastPop("Debe establecer por lo menos 1 meta de visita.", 4000);return;}
		
		info.CONTRACT_VISIT_GOALS = JSON.stringify(visitGoals);
	}
	
	if(utype == "Cogestor" || utype == "Instructor" || utype == "Coordinador" || utype == "Director")
	{
		// GET OTHER GOALS AS USER TYPE
	
		var otherGoals = [];
		
		var otherTable = document.getElementById("wp_contracts_other_goals");
		var lines = otherTable.children;
		
		console.log(lines.length)
		
		if(lines.length == 2)
		{
			
			// if(lines[1].innerHTML == "Sin resultados")
			// {fastPop("Debe establecer por lo menos 1 meta de grupo.", 4000);return;}
		}
		
		if(lines.length > 1 && lines[1].innerHTML != "Sin resultados")
		{
			for(var i=1; i<lines.length; i++)
			{
				var line = lines[i];
				
				var lineId = line.children[0].innerHTML.split("Grupo ")[1].split("</span>")[0];
				var lineV1 = line.children[1].children[0].value;
				var lineV2 = line.children[2].children[0].value;
				var lineV3 = line.children[3].children[0].value;
				
				var locked = line.children[4].children[0];
				
				if(locked.tagName.toLowerCase() == 'i')
				{
					console.log("enter A");
					var lineV4 = locked.reg.FIELD4;
					
					var item = {};
					item.ID = lineId;
					item.V1 = lineV1;
					item.V2 = lineV2;
					item.V3 = lineV3;
					item.V4 = lineV4;
				}
				else
				{
					console.log("enter B");
					var item = {};
					item.ID = lineId;
					item.V1 = lineV1;
					item.V2 = lineV2;
					item.V3 = lineV3;
				}
				
				otherGoals.push(item);
			}
		}
	
		info.CONTRACT_OTHER_GOALS = JSON.stringify(otherGoals);
		
		// GET EVENT GOALS AS USER TYPE
		var eventGoals = [];
		
		var eventTable = document.getElementById("wp_contracts_event_goals");
		var lines = eventTable.children;
		
		for(var i=1; i<lines.length; i++)
		{
			var line = lines[i];
			
			var lineId = line.children[0].id.split("cell-")[1];
			var lineV1 = line.children[1].children[0].value;
			var lineV2 = line.children[2].children[0].value;
			
			var item = {};
			item.ID = lineId;
			item.V1 = lineV1;
			item.V2 = lineV2;
			
			// if(lineV1 > 0 || lineV2 > 0){visitGoals.push(item);}
			eventGoals.push(item);
		}
		
		// if(eventGoals.length == 0)
		// {fastPop("Debe establecer por lo menos 1 meta de evento.", 4000);return;}
		
		info.CONTRACT_EVENT_GOALS = JSON.stringify(eventGoals);
		
		
		
	}
	
	
	
	console.log(info);
	
	// return
	// GOALS BLOCK
	// GOALS BLOCK
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","aprobeContract",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans);
		
		if(ans == "exist")
		{
			fastPop("Ya existe un contrato con este número para esta entidad, no puede repetirlo.",3000);
			return;
		}
		
		if(ans == "enviado")
		{
			fastPop("Contrato aprobado se ha enviado una notificación al usuario.",4000);
			refreshTable("wp_contracts");
			PUM.close(1515);			
		}
	});
	
}
function saveUdata(mode)
{
	
	var info = {};
	info.USER_ENTITY = document.getElementById("USER_ENTITY").value;
	info.USER_NAME = document.getElementById("USER_NAME").value;
	info.USER_LASTNAME = document.getElementById("USER_LASTNAME").value;
	info.USER_IDTYPE = document.getElementById("USER_IDTYPE").value;
	info.USER_IDNUM = document.getElementById("USER_IDNUM").value;
	info.USER_IMFOO = imfoo;
	
	console.log(imfoo);
	
	if(imfoo != "user")
	{
		info.USER_BDAY = document.getElementById("USER_BDAY").value;
		if(info.USER_BDAY == ""){fastPop("Debe seleccionar la fecha de nacimiento.", 2000);return;}
		if(userData != "")
		{
			info.USER_TYPE = userData.USER_TYPE;
		}
		else
		{
			info.USER_TYPE = "General";
		}
		info.USER_PIC = actualCroppedPic;
	}
	else
	{
		info.USER_BDAY = "";
		info.USER_TYPE = document.getElementById("USER_TYPE").value;
		if(info.USER_TYPE == ""){fastPop("Debe seleccionar tipo de usuario.", 2000);return;}
		info.USER_PIC = actualCroppedPic;
	}
	
	info.USER_PHONE = document.getElementById("USER_PHONE").value;
	info.USER_EMAIL = document.getElementById("USER_EMAIL").value;
	info.USER_PASS = document.getElementById("USER_PASS").value;
	info.USER_PASS2 = document.getElementById("USER_PASS2").value;
	
	info.MODE = mode;
	
	if(info.USER_ENTITY == ""){fastPop("Debe seleccionar entidad.", 2000);return;}
	if(info.USER_NAME == ""){fastPop("Debe escribir el nombre.", 2000);return;}
	if(info.USER_LASTNAME == ""){fastPop("Debe escribir los apellidos.", 2000);return;}
	if(info.USER_IDTYPE == ""){fastPop("Debe seleccionar el tipo de documento.", 2000);return;}
	if(info.USER_IDNUM == ""){fastPop("Debe escribir el numero de documento.", 2000);return;}
	
	if(info.USER_PHONE == ""){fastPop("Debe escribir el Teléfono.", 2000);return;}
	if(info.USER_EMAIL == ""){fastPop("Debe escribir el email.", 2000);return;}
	if(info.USER_PASS == ""){fastPop("Debe escribir la contraseña.", 2000);return;}
	if(info.USER_PASS2 == ""){fastPop("Debe escribir la confirmación de contraseña.", 2000);return;}


	if(info.USER_PASS != info.USER_PASS2)
	{
		fastPop("Las contraseñas no coinciden", 2000);
		return;
	}
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE != "0")
	{
		if(info.USER_PASS != "******")
		{info.CHANGEPASS = "1";}
		else{info.CHANGEPASS = "0";}
		
		if(imfoo != "user")
		{
			info.USER_CODE = userData.USER_CODE;
		}
		else
		{
			info.USER_CODE = actualEditData.USER_CODE;
		}
		
		// NOT CHANGE PIC IF NOT SAME USER
		if(userEditing != 1)
		{
			if(userData.USER_CODE != actualEditData.USER_CODE)
			{info.USER_PIC = actualEditData.USER_PIC;}
		}
		
		info.USER_CALLER_GOAL = document.getElementById("USER_CALLER_GOAL").value;
		info.USER_CALLER_ENDATE = document.getElementById("USER_CALLER_ENDATE").value;

	}
	else
	{
		info.USER_CODE = "";
		// CHECK ACCEPT
		if(document.getElementById("condCheck"))
		{
			var checked = document.getElementById("condCheck").checked;
			if(!checked){fastPop("Debe aceptar el tratamiendo de los datos", 2000);return;}
		}
		
	}
	
	console.log(info);
	// return
		
	loadManager(1, "popFormSaveButton");
	sendAjax("users","register",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans)
		
		if(ans == "exists")
		{
			fastPop("Ya existe un usuario con esta combinación de entidad y email.", 6000);
			// PUM.close(1515);
			return;
		}
		else if(ans == "updatednpc" || ans == "updatednpcP")
		{
			fastPop(language["dataSaved"], 2000);
			// SAME PASS
			
			if(imfoo != "user")
			{
				userData.USER_ENTITY = info.USER_ENTITY;
				userData.USER_NAME = info.USER_NAME;
				userData.USER_LASTNAME = info.USER_LASTNAME;
				userData.USER_IDTYPE = info.USER_IDTYPE;
				userData.USER_IDNUM = info.USER_IDNUM;
				userData.USER_BDAY = info.USER_BDAY;
				userData.USER_PHONE = info.USER_PHONE;
				userData.USER_PIC = info.USER_PIC;
				
				PUM.close(1515);
			
				if(actualCroppedPic != "")
				{document.getElementById("profilePicMenu").src = actualCroppedPic;}
				else
				{document.getElementById("profilePicMenu").src ="app/isrc/blankPic.png";}
			}
			else
			{
				console.log("other changed")
				refreshTable("wp_trusers");
				PUM.close(1515);
			}
			
			
			
			return;
		}
		else if(ans == "updatedpc" || ans == "updatedpcP")
		{
			fastPop(language["dataSavedPass"], 2000);
			
			if(imfoo != "user")
			{
				document.getElementById("USER_PASS").value = "******";
				document.getElementById("USER_PASS2").value = "******";
				// CHANGED PASS
				userData.USER_ENTITY = info.USER_ENTITY;
				userData.USER_NAME = info.USER_NAME;
				userData.USER_LASTNAME = info.USER_LASTNAME;
				userData.USER_IDTYPE = info.USER_IDTYPE;
				userData.USER_IDNUM = info.USER_IDNUM;
				userData.USER_BDAY = info.USER_BDAY;
				userData.USER_PHONE = info.USER_PHONE;
				userData.USER_PIC = info.USER_PIC;
				
				PUM.close(1515);
		
				if(actualCroppedPic != "")
				{document.getElementById("profilePicMenu").src = actualCroppedPic;}
				else
				{document.getElementById("profilePicMenu").src ="app/isrc/blankPic.png";}
			}
			else
			{
				console.log("other changed pass")
				refreshTable("wp_trusers");
				PUM.close(1515);
			}
			return;
		}
		else
		{
			
			fastPop("Registro exitoso", 2000);
			
			document.getElementById("userEntity").value = info.USER_ENTITY;
			document.getElementById("username").value = info.USER_EMAIL;
			document.getElementById("password").value = info.USER_PASS;
			
			PUM.close(1515);

			if(imfoo != "user")
			{
				setTimeout(function(){ login(); }, 2000);
			}
			else
			{
				refreshTable("wp_trusers");
			}
		}
		
	});
}
function saveCitizen(mode)
{

	var info = {};
	info.CITIZEN_NAME = document.getElementById("CITIZEN_NAME").value.replace(/['"]+/g, '');
	info.CITIZEN_LASTNAME = document.getElementById("CITIZEN_LASTNAME").value.replace(/['"]+/g, '');
	info.CITIZEN_IDTYPE = document.getElementById("CITIZEN_IDTYPE").value;
	info.CITIZEN_IDNUM = document.getElementById("CITIZEN_IDNUM").value;
	info.CITIZEN_BDAY = document.getElementById("CITIZEN_BDAY").value;
	info.CITIZEN_PHONE = document.getElementById("CITIZEN_PHONE").value.replace(/['"]+/g, '');
	info.CITIZEN_EMAIL = document.getElementById("CITIZEN_EMAIL").value;


	var picked = document.getElementById("SEARCH_BUTTON_CITIZEN_CITY").pickedCode;
	info.CITIZEN_CITY = picked;

	var picked = document.getElementById("SEARCH_BUTTON_CITIZEN_BIRTH_CITY").pickedCode;
	info.CITIZEN_BIRTH_CITY = picked;

	
	var picked = document.getElementById("SEARCH_BUTTON_CITIZEN_ZONE").pickedCode;
	info.CITIZEN_ZONE = picked;
	
	
	
	var hood = document.getElementById("SEARCH_BUTTON_CITIZEN_HOOD").pickedCode;
	info.CITIZEN_HOOD = hood;
	
	info.CITIZEN_LEVEL = document.getElementById("CITIZEN_LEVEL").value;
	info.CITIZEN_ADDRESS = document.getElementById("CITIZEN_ADDRESS").value.replace(/['"]+/g, '');
	info.CITIZEN_GENDER = document.getElementById("CITIZEN_GENDER").value;
	info.CITIZEN_ETNIA = document.getElementById("CITIZEN_ETNIA").value;
	info.CITIZEN_CONDITION = getMultiCheckValue("CITIZEN_CONDITION");

	info.MODE = mode;
	
	if(info.CITIZEN_NAME == ""){fastPop("Debe escribir el nombre.", 2000);return;}
	if(info.CITIZEN_LASTNAME == ""){fastPop("Debe escribir los apellidos.", 2000);return;}
	if(info.CITIZEN_IDTYPE == ""){fastPop("Debe seleccionar el tipo de documento.", 2000);return;}
	if(info.CITIZEN_IDNUM == ""){fastPop("Debe escribir el numero de documento.", 2000);return;}
	if(info.CITIZEN_GENDER == ""){fastPop("Debe seleccionar el Género.", 2000);return;}	
	if(info.CITIZEN_PHONE == ""){fastPop("Debe escribir el Teléfono.", 2000);return;}
	
	if(!checkEmail(info.CITIZEN_EMAIL) && info.CITIZEN_EMAIL != "")
	{fastPop("Debe ingresar un Email válido.", 2000); return;}
	
	// IGNORE FIELDS REQUEST FOR SPECIAL ORIGINS
	// console.log(citizenOrigin)
	if(citizenOrigin != "ev" && citizenOrigin != "evr" && citizenOrigin != "gr" && citizenOrigin != "eve" && citizenOrigin != "evre" && citizenOrigin != "gre" && citizenOrigin != "remC")
	{
		
		if(info.CITIZEN_CITY == ""){fastPop("Debe seleccionar la ciudad de residencia.", 2000);return;}
		if(info.CITIZEN_ZONE == ""){fastPop("Debe seleccionar la comuna o corregimiento.", 2000);return;}
		if(info.CITIZEN_HOOD == ""){fastPop("Debe seleccionar el barrio o vereda.", 2000);return;}
		if(info.CITIZEN_LEVEL == ""){fastPop("Debe ingresar el estrato.", 2000);return;}
		
		
		if(info.CITIZEN_BDAY == ""){fastPop("Debe seleccionar la fecha de nacimiento.", 2000);return;}
		if(info.CITIZEN_ADDRESS == ""){fastPop("Debe escribir la dirección.", 2000);return;}
		if(info.CITIZEN_ETNIA == ""){fastPop("Debe seleccionar la etnia.", 2000);return;}
		if(JSON.parse(info.CITIZEN_CONDITION).length == 0){fastPop("Debe seleccionar como mínimo 1 Condición.", 2000);return;}
		
		
		
	}
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE != "0")
	{info.CITIZEN_CODE = actualEditData.CITIZEN_CODE;}
	else
	{info.CITIZEN_CODE = "";}
	
	// ASIGN TO GROUP OR CLASS IF NOT FROM CITIZENS
	if(citizenOrigin == "g")
	{
		info.GROUP_ADD = "y";
		info.GROUP_CODE = actualGroupCode;
	}
	else if(citizenOrigin == "cl")
	{
		info.GROUP_ADD = "cl";
		info.GROUP_CODE = actualGroupCode;
		info.CLASS_CODE = actualClassCode;
	}
	else
	{info.GROUP_ADD = "n";}
	
	// NEW FIELDS
	
	
	var picked = document.getElementById("SEARCH_BUTTON_CITIZEN_ETNIA_IND").pickedCode;
	info.CITIZEN_ETNIA_IND = picked;
	var picked = document.getElementById("SEARCH_BUTTON_CITIZEN_ORIGIN_COUNTRY").pickedCode;
	info.CITIZEN_ORIGIN_COUNTRY = picked;
	var picked = document.getElementById("SEARCH_BUTTON_CITIZEN_DESTINY_COUNTRY").pickedCode;
	info.CITIZEN_DESTINY_COUNTRY = picked;
	info.CITIZEN_STAY_REASON = document.getElementById("CITIZEN_STAY_REASON").value;
	info.CITIZEN_MIGREXP = document.getElementById("CITIZEN_MIGREXP").value;
	info.CITIZEN_INDATE = document.getElementById("CITIZEN_INDATE").value;
	info.CITIZEN_OUTDATE = document.getElementById("CITIZEN_OUTDATE").value;
	info.CITIZEN_RETURN_REASON = document.getElementById("CITIZEN_RETURN_REASON").value;
	info.CITIZEN_SITAC = document.getElementById("CITIZEN_SITAC").value;
	// -------
	info.CITIZEN_ACUDIENT = document.getElementById("CITIZEN_ACUDIENT").value;
	
	info.CITIZEN_SISCORE = document.getElementById("CITIZEN_SISCORE").value;
	info.CITIZEN_CONVAC = document.getElementById("CITIZEN_CONVAC").value;
	info.CITIZEN_TIPOCO = document.getElementById("CITIZEN_TIPOCO").value;
	info.CITIZEN_TIPOVI = document.getElementById("CITIZEN_TIPOVI").value;
	info.CITIZEN_HANDICAP = document.getElementById("CITIZEN_HANDICAP").value;
	info.CITIZEN_ETGROUP = document.getElementById("CITIZEN_ETGROUP").value;
	// -------
	info.CITIZEN_SECURITY = document.getElementById("CITIZEN_SECURITY").value;
	var picked = document.getElementById("SEARCH_BUTTON_CITIZEN_EPS").pickedCode;
	info.CITIZEN_EPS = picked;
	var picked = document.getElementById("SEARCH_BUTTON_CITIZEN_PATOEN").pickedCode;
	info.CITIZEN_PATOEN = picked;
	info.CITIZEN_TRASDES = document.getElementById("CITIZEN_TRASDES").value;
	info.CITIZEN_RISKFA = getMultiCheckValue("CITIZEN_RISKFA");
	info.CITIZEN_PREVFA = getMultiCheckValue("CITIZEN_PREVFA");
	info.CITIZEN_WEIGHT = document.getElementById("CITIZEN_WEIGHT").value;
	info.CITIZEN_HEIGHT = document.getElementById("CITIZEN_HEIGHT").value;
	info.CITIZEN_IMC = document.getElementById("CITIZEN_IMC").value;
	info.CITIZEN_IMC_RATE = document.getElementById("CITIZEN_IMC_RATE").value;
	// -------
	info.CITIZEN_EDLEVEL = document.getElementById("CITIZEN_EDLEVEL").value;
	var picked = document.getElementById("SEARCH_BUTTON_CITIZEN_INSTITUTE").pickedCode;
	info.CITIZEN_INSTITUTE = picked;
	// -------
	info.CITIZEN_COURSES = document.getElementById("CITIZEN_COURSES").value;
	info.CITIZEN_OCUCOND = document.getElementById("CITIZEN_OCUCOND").value;
	info.CITIZEN_INGREC = document.getElementById("CITIZEN_INGREC").value;
	
	
	// CHECK ACCEPT
	if(document.getElementById("condCheck"))
	{
		var checked = document.getElementById("condCheck").checked;
		if(!checked){fastPop("Debe aceptar el tratamiendo de los datos", 2000);return;}
	}
	
	
	console.log(info)
	
	// return;

	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveCitizen",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans)
		
		if(ans == "Created")
		{
			if(citizenOrigin == "g")
			{
				fastPop("Se ha creado el ciudadano y se ha agregado al grupo.",3000);
				refreshTable("wp_groups");
			}
			else if(citizenOrigin == "ev")
			{
				invoquedCitizenData = info;
				setTimeout(function()
				{
					fastPop("Se ha creado el cooperador.",3000);
					loadForm("event");
					var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
					
					document.getElementById("EVENT_COOPERATOR").lastvalue = newValue;
					document.getElementById("EVENT_COOPERATOR").value = newValue;
				}, 500);

			}
			else if(citizenOrigin == "eve")
			{
				invoquedCitizenData = info;
				setTimeout(function()
				{
					fastPop("Se ha creado el cooperador.",3000);
					editDataForm("event");
					var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
					
					document.getElementById("EVENT_COOPERATOR").lastvalue = newValue;
					document.getElementById("EVENT_COOPERATOR").value = newValue;
				}, 500);

			}
			else if(citizenOrigin == "evr")
			{
				invoquedCitizenData = info;
				setTimeout(function()
				{
					fastPop("Se ha creado el solicitante.",3000);
					loadForm("eventR");
					var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
					
					document.getElementById("EVENT_REQUESTER").lastvalue = newValue;
					document.getElementById("EVENT_REQUESTER").value = newValue;
				}, 500);

			}
			else if(citizenOrigin == "evre")
			{
				invoquedCitizenData = info;
				setTimeout(function()
				{
					fastPop("Se ha creado el solicitante.",3000);
					editDataForm("eventR");
					var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
					
					if(requestState == "4")
					{
						document.getElementById("EVENT_COOPERATOR").lastvalue = newValue;
						document.getElementById("EVENT_COOPERATOR").value = newValue;
					}
					else
					{
						document.getElementById("EVENT_REQUESTER").lastvalue = newValue;
						document.getElementById("EVENT_REQUESTER").value = newValue;
					}
					
				}, 500);

			}
			else if(citizenOrigin == "gr")
			{
				invoquedCitizenData = info;
				setTimeout(function()
				{
					fastPop("Se ha creado el cooperador.",3000);
					loadForm("group");
					var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
					
					document.getElementById("GROUP_COPERATOR").lastvalue = newValue;
					document.getElementById("GROUP_COPERATOR").value = newValue;
				}, 500);

			}
			else if(citizenOrigin == "gre")
			{
				invoquedCitizenData = info;
				setTimeout(function()
				{
					fastPop("Se ha creado el cooperador.",3000);
					editDataForm("group");
					var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
					
					document.getElementById("GROUP_COPERATOR").lastvalue = newValue;
					document.getElementById("GROUP_COPERATOR").value = newValue;
				}, 500);

			}
			else if(citizenOrigin == "cl")
			{
				fastPop("Se ha creado el ciudadano y se ha agregado a la clase.",3000);
				refreshTable("wp_classes");
			}
			else if(citizenOrigin == "rem")
			{
				fastPop("Se ha creado el ciudadano para atender.",2000);
				console.log("nuevo atendido");
				actualEditData = info;
				actualRemCitizen = info.CITIZEN_IDNUM;
				actualRemCitizenName = info.CITIZEN_NAME+" "+info.CITIZEN_LASTNAME;
				setTimeout(function(){loadForm("rem");}, 1000);
			}
			else if(citizenOrigin == "remC")
			{
				fastPop("Se ha creado el solicitante.",2000);
				console.log("nuevo solicitante");
				setTimeout(function(){loadForm("rem");}, 1000);
			}
			else
			{
				fastPop("Se ha creado el ciudadano.",3000);
				refreshTable("wp_citizens");
			}
			PUM.close(1515);	
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe un ciudadano con este número de id.",3000);
		}
		else if(ans == "ingroup")
		{
			fastPop("Este ciudadano ya esta en el grupo.",3000);
			return;
		}
		else if(ans == "inClass")
		{
			fastPop("Este ciudadano ya esta en la clase.",3000);
			return;
		}
		else if(ans == "updated")
		{
			if(citizenOrigin == "g")
			{
				fastPop("Se ha agregado el ciudadano.",2000);
				refreshTable("wp_groups");
			}
			else if(citizenOrigin == "cl")
			{
				fastPop("Se ha agregado el ciudadano.",2000);
				refreshTable("wp_classes");
			}
			else if(citizenOrigin == "rem")
			{
				fastPop("Se ha actualizado y seleccionado el ciudadano.",2000);
				actualRemCitizen = info.CITIZEN_IDNUM;
				actualRemCitizenName = info.CITIZEN_NAME+" "+info.CITIZEN_LASTNAME;
				setTimeout(function(){loadForm("rem");}, 1000);
			}
			else if(citizenOrigin == "remC")
			{
				fastPop("Se ha actualizado el ciudadano.",2000);
				actualRemCitizen = info.CITIZEN_IDNUM;
				actualRemCitizenName = info.CITIZEN_NAME+" "+info.CITIZEN_LASTNAME;
				setTimeout(function(){loadForm("rem");}, 1000);
			}
			else if(citizenOrigin == "loadCitRem" || citizenOrigin == "loadReqRem")
			{
				fastPop("Se ha actualizado el ciudadano.",2000);
			}
			else
			{
				fastPop("Ciudadano actualizado",3000);
				refreshTable("wp_citizens");
			}
			PUM.close(1515);	
		}
		
	});
}
function saveGroup(mode)
{
	
	var info = {};
	info.GROUP_ENTITY = document.getElementById("GROUP_ENTITY").value;
	info.GROUP_NAME = document.getElementById("GROUP_NAME").value;
	
	var activity = document.getElementById("SEARCH_BUTTON_GROUP_ACTIVITY").pickedCode;
	info.GROUP_ACTIVITY = activity;
	
	// info.GROUP_ACTIVITY = document.getElementById("GROUP_ACTIVITY").value;
	
	var hood = document.getElementById("SEARCH_BUTTON_GROUP_HOOD").pickedCode;
	info.GROUP_HOOD = hood;
	
	info.GROUP_INSTYPE = document.getElementById("GROUP_INSTYPE").value;
	
	var institute = document.getElementById("SEARCH_BUTTON_GROUP_INSTITUTE").pickedCode;
	info.GROUP_INSTITUTE = institute;
	
	info.GROUP_PREVIR = document.getElementById("GROUP_PREVIR").value;
	info.GROUP_ADDRESS = document.getElementById("GROUP_ADDRESS").value;
	info.GROUP_COORDS = document.getElementById("GROUP_COORDS").value;
	info.GROUP_COPERATOR = document.getElementById("GROUP_COPERATOR").value;
	
	info.GROUP_SERVPLACE = document.getElementById("GROUP_SERVPLACE").value;
	info.GROUP_PROCESS = document.getElementById("GROUP_PROCESS").value;
	

	info.MODE = mode;
	
	if(info.GROUP_ENTITY == ""){fastPop("Debe seleccionar entidad.", 2000);return;}
	if(info.GROUP_COPERATOR == ""){fastPop("Debe ingresar el id valido del cooperador.", 2000);return;}
	if(info.GROUP_NAME == ""){fastPop("Debe escribir el nombre.", 2000);return;}

	if(info.GROUP_ACTIVITY == ""){fastPop("Debe seleccionar la actividad.", 2000);return;}
	if(info.GROUP_HOOD == ""){fastPop("Debe seleccionar el barrio o vereda.", 2000);return;}
	
	if(info.GROUP_INSTYPE == ""){fastPop("Debe seleccionar el tipo de Institucional/Comunitario.", 2000);return;}
	if(info.GROUP_SERVPLACE == "Si")
	{
		if(info.GROUP_INSTITUTE == ""){fastPop("Debe seleccionar la institución.", 2000);return;}
	}
	
	
	if(info.GROUP_SERVPLACE == ""){fastPop("Debe si es un lugar de servicio guardado.", 2000);return;}
	if(info.GROUP_PROCESS == ""){fastPop("Debe seleccionar si el grupo es de proceso continuo.", 2000);return;}
	if(info.GROUP_PREVIR == ""){fastPop("Debe seleccionar el tipo de Presencial/Virtual.", 2000);return;}
	if(info.GROUP_PREVIR == "Presencial" || info.GROUP_PREVIR == "Presencial/Virtual")
	{
		if(info.GROUP_ADDRESS == ""){fastPop("Debe escribir la dirección.", 2000);return;}
		if(info.GROUP_COORDS == ""){fastPop("Debe escribir las coordenadas.", 2000);return;}
	}
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE != "0")
	{info.GROUP_CODE = actualEditData.GROUP_CODE;}
	else
	{info.GROUP_CODE = "";}
		
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveGroup",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans)
		
		if(ans == "Created")
		{
			fastPop("Se ha creado el grupo",3000);
			refreshTable("wp_groups");
			PUM.close(1515);	
			
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe un grupo con este nombre",3000);
		}
		else if(ans == "updated")
		{
			fastPop("Grupo actualizado",3000);
			refreshTable("wp_groups");
			PUM.close(1515);	
		}
		
	});
}
function saveRem(mode)
{
	
	console.log("hi");
	
	var info = {};
	
	if(userData.USER_CTYPE != "Superior"){info.REM_ENTITY = userData.USER_ENTITY;}
	else{info.REM_ENTITY = "001";}
		
	info.REM_CITIZEN = actualRemCitizen;
	info.REM_CITIZEN_NAME = actualRemCitizenName;
	info.REM_AUTOR = userData.USER_CODE;
	info.REM_AUTOR_NAME	= userData.USER_NAME+" "+userData.USER_LASTNAME;
	info.REM_ENTITY = userData.USER_ENTITY;
	info.REM_DATE = document.getElementById("REM_DATE").value
	info.REM_REQUESTER = document.getElementById("REM_REQUESTER").value.split("-")[0];
	
	info.REM_REQUESTER_TYPE = document.getElementById("REM_REQUESTER_TYPE").value;
	
	var activity = document.getElementById("SEARCH_BUTTON_REM_ACTIVITY").pickedCode;
	info.REM_ACTIVITY = activity;
	var contratist = document.getElementById("SEARCH_BUTTON_REM_CONTRATIST").pickedCode;
	info.REM_CONTRATIST = contratist;
	
	info.REM_COMMENT = document.getElementById("REM_COMMENT").value;
	info.REM_COMMENT_DATE = document.getElementById("REM_COMMENT_DATE").value;
		
	info.MODE = mode;
	
	if(info.REM_REQUESTER == ""){fastPop("Debe ingresar un id de solicitante.", 2000);return;}
	if(info.REM_DATE == ""){fastPop("Debe ingresar la fecha.", 2000);return;}
	if(info.REM_REQUESTER_TYPE == ""){fastPop("Debe seleccionar un tipo de solicitante.", 2000);return;}
	
	info.REM_REQUESTER_NAME = document.getElementById("REM_REQUESTER").value.split("-")[1];

	if(info.REM_ACTIVITY == ""){fastPop("Debe seleccionar la actividad.", 2000);return;}
	if(info.REM_CONTRATIST == ""){fastPop("Debe seleccionar contratista.", 2000);return;}
	if(info.REM_COMMENT == ""){fastPop("Debe escribir un motivo.", 2000);return;}
	if(info.REM_COMMENT_DATE == ""){fastPop("Debe seleccionar una fecha de motivo.", 2000);return;}
	
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE != "0"){info.REM_CODE = actualEditData.REM_CODE;}
	else{info.REM_CODE = "";}
	
	console.log(info);
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveRem",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans)
		
		if(ans == "Created")
		{
			fastPop("Se ha creado la atención",3000);
			refreshTable("wp_remitions");
			PUM.close(1515);	
			
		}
	});
}
function saveAssignation(mode)
{
	var info = {};
	
	info.CONTRACT_CODE = document.getElementById("CONTRACT_LIST").value;
	info.GROUP_CODE = actualEditData.GROUP_CODE;
	
	if(info.CONTRACT_CODE == ""){fastPop("Debe seleccionar un contrato.", 2000);return;}
	
	
	
	var otherGoals = [];
	var otherTable = document.getElementById("wp_contracts_other_goals_assign");
	var lines = otherTable.children;
	
	if(lines.length == 2)
	{
		
		if(lines[1].innerHTML == "Sin resultados")
		{fastPop("No hay asignación para guardar", 4000);return;}
	}
	
	var isGrouPicked = 0;
	
	if(lines.length > 1 && lines[1].innerHTML != "Sin resultados")
	{
	
		for(var i=1; i<lines.length; i++)
		{
			var line = lines[i];
			
			var lineId = line.children[0].innerHTML.split("Grupo ")[1].split("</span>")[0];
			var lineV1 = line.children[1].innerHTML.split("<span>")[1].split("</span>")[0];
			var lineV2 = line.children[2].innerHTML.split("<span>")[1].split("</span>")[0];
			var lineV3 = line.children[3].innerHTML.split("<span>")[1].split("</span>")[0];
			
			var item = {};
			item.ID = lineId;
			item.V1 = lineV1;
			item.V2 = lineV2;
			item.V3 = lineV3;
			
			var iconGroup = line.children[4].children[0].group;
			if(iconGroup != ""){item.V4 = iconGroup;}
			
			if(actualEditData.GROUP_CODE == iconGroup)
			{isGrouPicked = 1;}

			otherGoals.push(item);
		}
	}
	
	if(isGrouPicked == 0){fastPop("Debe seleccionar un grupo al cual asignar.", 2000);return;}
	
	info.CONTRACT_OTHER_GOALS = JSON.stringify(otherGoals);
	

	console.log(info);
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveAssignation",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans);
		
		// return
		
		if(ans == "updated")
		{
			fastPop("Asignación actualizada",2000);
			refreshTable("wp_groups");
			PUM.close(1515);	
		}
		
		if(info.CONTRACT_CODE == userData.USER_CONTRACT)
		{
			console.log("is my contract!")
			userDataReload();
		}
		
		
	});
	
}
function saveGroupHours()
{
	var info = {};
	
	info.GROUP_HOURS = JSON.stringify(actualGroupHours);
	info.GROUP_CODE = actualEditData.GROUP_CODE;
	info.GROUP_CONTRACT = userData.USER_CONTRACT;
	info.GROUP_CONTRATIST = userData.USER_CODE;
	
	console.log(info);
	// return

	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveGroupHours",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans);

		
		if(ans == "updated")
		{
			setTimeout(function(){fastPop("Horarios actualizados",2000);}, 300);
			refreshTable("wp_groups");
			PUM.close(1515);	
		}
		else
		{
			fastPop(ans,5000)
		}
		
	});
	
}
function saveExcuse()
{
	var info = {};
	var excuse = {};
	excuse.EXCUSE_REASON = document.getElementById("EXCUSE_REASON").value;
	excuse.EXCUSE_COMMENTS = document.getElementById("EXCUSE_COMMENTS").value.replace(/['"]+/g, '');
	excuse.EXCUSE_FILE = actualLoadedFile;
	excuse.EXCUSE_FORMAT = actualLoadedFileFormat;
	
	if(excuse.EXCUSE_REASON == ""){fastPop("Debe seleccionar una causa de cancelación.", 2000);return;}
	if(excuse.EXCUSE_COMMENTS == ""){fastPop("Debe escribir comentario de cancelación.", 2000);return;}
	
	var excuse = JSON.stringify(excuse);

	info.CLASS_CODE = actualClassCode;
	info.CLASS_EXCUSE = excuse;
	
	console.log(info);
	// return

	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveExcuse",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans);

		if(ans == "updated")
		{
			setTimeout(function(){fastPop("Excusa guardada",2000);}, 300);
			refreshTable("wp_classes");
			PUM.close(1515);	
		}
		
	});
	
}
function saveEtarie(mode)
{
	var info = {};
	
	info.ETARIE_ENTITY = document.getElementById("ETARIE_ENTITY").value;
	info.ETARIE_NAME = document.getElementById("ETARIE_NAME").value;
	info.ETARIE_FROM = document.getElementById("ETARIE_FROM").value;
	info.ETARIE_TO = document.getElementById("ETARIE_TO").value;
	
	info.MODE = mode;
	
	if(info.ETARIE_ENTITY == ""){fastPop("Debe seleccionar la entidad.", 2000);return;}
	if(info.ETARIE_NAME == ""){fastPop("Debe escribir el nombre del ciclo etario.", 2000);return;}
	if(info.ETARIE_FROM == ""){fastPop("Debe escribir el valor de inicio del ciclo etario.", 2000);return;}
	if(info.ETARIE_TO == ""){fastPop("Debe escribir el valor de fin del ciclo etario.", 2000);return;}

	// SET DATA ACCORDING TO MODE
	if(info.MODE == "1")
	{info.ETARIE_CODE = actualEditData.ETARIE_CODE;}
	else{info.ETARIE_CODE = "";}
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveEtarie",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		
		if(ans == "Created")
		{
			fastPop("Se ha creado el ciclo etario",3000);
			refreshTable("wp_etaries");
			PUM.close(1515);	
			
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe un ciclo etario con este nombre para esta entidad",3000);
		}
		else if(ans == "updated")
		{
			fastPop("Ciclo etario actualizado",3000);
			refreshTable("wp_etaries");
			PUM.close(1515);	
		}
		
	});
	
}
function saveClass(mode)
{
	var info = {};
	
	var group = document.getElementById("SEARCH_BUTTON_CLASS_GROUP").pickedCode;
	info.CLASS_GROUP = group;
	if(info.CLASS_GROUP == ""){fastPop("Debe seleccionar el grupo.", 2000);return;}
	info.CLASS_DATE = document.getElementById("CLASS_DATE").value;
	if(info.CLASS_DATE == ""){fastPop("Debe seleccionar la fecha.", 2000);return;}
	
	if(mode == 0)
	{
		// GET FROM NEW FIELD
		var activity = document.getElementById("SEARCH_BUTTON_CLASS_GROUP_ACTIVITY").pickedCode;
		info.CLASS_ACTIVITY = activity;
		if(info.CLASS_ACTIVITY == ""){fastPop("Debe seleccionar la actividad.", 2000);return;}
		
		info.CLASS_TUTOR = actualClassGroupData.GROUP_TUTOR;
		
		if(actualClassGroupData.GROUP_CITIZENS != null && actualClassGroupData.GROUP_CITIZENS != "null" && actualClassGroupData.GROUP_CITIZENS != "")
		{
			// ADD AGE TO CITIZENS
			info.CLASS_CITIZENS = JSON.parse(actualClassGroupData.GROUP_CITIZENS);
			var citizens = info.CLASS_CITIZENS;
			for(var i=0; i<citizens.length; i++)
			{
				var dude = citizens[i];
				var dudeBday = dude.CITIZEN_BDAY;
				var classDate = info.CLASS_DATE;
				var age = parseInt(getdDiff(dudeBday, classDate)/365);
				info.CLASS_CITIZENS[i].CITIZEN_AGE = age;
			}
		}
		else{info.CLASS_CITIZENS = [];}
		info.CLASS_GROUP_DATA = "";
		info.CLASS_CONTRACT_NUMBER = actualClassGroupData.GROUP_CONTRACT_NUMBER;
	}
	
	info.CLASS_ENTITY = document.getElementById("CLASS_ENTITY").value;
	
	if(info.CLASS_ENTITY == ""){fastPop("Debe seleccionar la entidad.", 2000);return;}
	
	info.CLASS_DATE = info.CLASS_DATE.split(" ")[0];
	// BUILD AND CHECK HOUR
	var date = new Date(document.getElementById("CLASS_DATE").value+" 12:00:00");
	var weekday = date.getDay();
	
	jQuery.get("https://ipinfo.io", function(response) 
	{if(response.country == "DE"){weekday = weekday-1; if(weekDay < 0){weekDay = 0;}}}, "jsonp");
	
	var hour = {};
	hour.GROUP_TIME_DAY = weekDays2[weekday];
	hour.GROUP_TIME_INI = document.getElementById("GROUP_TIME_INI").value;
	hour.GROUP_TIME_END = document.getElementById("GROUP_TIME_END").value;
	if(hour.GROUP_TIME_INI == ""){fastPop("Debe seleccionar la hora de inicio.", 2000);return;}
	if(hour.GROUP_TIME_END == ""){fastPop("Debe seleccionar la hora de fin.", 2000);return;}

	info.CLASS_HOUR = hour;
	info.CLASS_EXCUSE = "";
	info.CLASS_TIME_INI = hour.GROUP_TIME_INI;
	info.CLASS_TIME_END = hour.GROUP_TIME_END;
	
	info.MODE = mode;
	
	// CHECK DATE HOUR NOT > NOW PENDING
	var newDateDate = info.CLASS_DATE+" "+hour.GROUP_TIME_INI+":00";
	var nowDate = getNow();
	if(newDateDate > nowDate)
	{fastPop("La fecha/hora de la clase no puede ser posterior a la fecha/hora actual", 3000);return;}

	// CHECK COMPARE HOURS
	var time1 = hour.GROUP_TIME_INI;
	var time2 = hour.GROUP_TIME_END;
	var time1Date= new Date("01/01/2000 "+time1);
	var time2Date= new Date("01/01/2000 "+time2);
	if(time1Date >= time2Date )
	{fastPop("La hora inicial no puede ser posterior o igual a la final", 2000);return;}

	// CHECK IF DAY INI OR END HOUR IN DAY RANGE
	var sameGroupClasses = [];
	for(var i=0; i<actualClassesList.length; i++)
	{
		var item = actualClassesList[i];
		if(item.CLASS_GROUP == info.CLASS_GROUP && item.CLASS_DATE.split(" ")[0] == info.CLASS_DATE)
		{
			if(info.MODE == "1")
			{if(item.CLASS_CODE != actualEditData.CLASS_CODE){sameGroupClasses.push(item);}}
			else{sameGroupClasses.push(item);}
		}
	}
	
	console.log(sameGroupClasses);
	
	// CHECK FOR COINCIDENCE HOURS IN COMUN DATE GROUP CLASES
	for(var i=0; i<sameGroupClasses.length; i++)
	{
		var item = sameGroupClasses[i];
		var itemHours = JSON.parse(item.CLASS_HOUR);
		var itemIni = itemHours.GROUP_TIME_INI;
		var itemEnd = itemHours.GROUP_TIME_END;
		
		var initialHour = new Date("01/01/2000 "+hour.GROUP_TIME_INI);
		var finalHour = new Date("01/01/2000 "+hour.GROUP_TIME_END);
		var itemIniHour = new Date("01/01/2000 "+itemIni);
		var itemEndHour = new Date("01/01/2000 "+itemEnd);
		
		if(initialHour >= itemIniHour && initialHour <= itemEndHour)
		{fastPop("La hora de inicio se cruza con una clase creada para este mismo día y grupo.", 4000);return;}
		
		if(finalHour <= itemEndHour && finalHour >= itemIniHour)
		{fastPop("La hora final se cruza con una clase creada para este mismo día y grupo.", 4000);return;}
	}
	

	// SET DATA ACCORDING TO MODE
	if(info.MODE == "1")
	{info.CLASS_CODE = actualEditData.CLASS_CODE;}
	else{info.CLASS_CODE = "";}
	
	console.log(info);
	// return;
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveClass",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans)

		if(ans == "Created")
		{
			fastPop("Se ha creado la clase",3000);
			refreshTable("wp_classes");
			PUM.close(1515);	
			
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe una clase en este horario para este grupo",3000);
		}
		else if(ans == "classCross")
		{
			fastPop("Ya existe una clase en este horario y día para este contratista",3000);
		}
		else if(ans == "updated")
		{
			fastPop("Clase actualizada",3000);
			refreshTable("wp_classes");
			PUM.close(1515);	
		}
		
	});
	
}
function saveInstitute(mode)
{
	var info = {};
	
	info.INSTITUTE_CITY = document.getElementById("INSTITUTE_CITY").value;
	info.INSTITUTE_ZONE = document.getElementById("INSTITUTE_ZONE").value;
	
	var hood = document.getElementById("SEARCH_BUTTON_INSTITUTE_HOOD").pickedCode;
	
	info.INSTITUTE_HOOD = hood;
	info.INSTITUTE_ADDRESS= document.getElementById("INSTITUTE_ADDRESS").value;
	info.INSTITUTE_COORDS = document.getElementById("INSTITUTE_COORDS").value;
	info.INSTITUTE_NAME = document.getElementById("INSTITUTE_NAME").value;
	info.INSTITUTE_EDU = document.getElementById("INSTITUTE_EDU").value;
	
	info.MODE = mode;
	
	if(info.INSTITUTE_NAME == ""){fastPop("Debe escribir el nombre de la institución.", 2000);return;}
	if(info.INSTITUTE_CITY == ""){fastPop("Debe seleccionar la ciudad.", 2000);return;}
	if(info.INSTITUTE_ZONE == ""){fastPop("Debe seleccionar la Comuna/Corregimiento.", 2000);return;}
	if(info.INSTITUTE_EDU == ""){fastPop("Debe seleccionar si es una institución educativa.", 2000);return;}
	
	
	
	if(info.INSTITUTE_HOOD == ""){fastPop("Debe seleccionar el Barrio/Vereda.", 2000);return;}
	
	
	
	if(info.INSTITUTE_ADDRESS == ""){fastPop("Debe escribir la dirección.", 2000);return;}
	if(info.INSTITUTE_COORDS == ""){fastPop("Debe ingresar la coordenada.", 2000);return;}
	
	
	console.log(info)
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE == "1")
	{info.INSTITUTE_CODE = actualEditData.INSTITUTE_CODE;}
	else{info.INSTITUTE_CODE = "";}
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveInstitute",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		
		if(ans == "Created")
		{
			fastPop("Se ha creado la institución",3000);
			refreshTable("wp_institutes");
			PUM.close(1515);	
			
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe una institución con este nombre y esta ciudad",3000);
		}
		else if(ans == "updated")
		{
			fastPop("Institución actualizada",3000);
			refreshTable("wp_institutes");
			PUM.close(1515);	
		}
		
	});
	
}
function saveEvent(mode)
{
	
	var info = {};
	info.EVENT_CREATED = getNow();
	info.EVENT_ENTITY = document.getElementById("EVENT_ENTITY").value;
	info.EVENT_OWNER = userData.USER_CODE;
	info.EVENT_DATE_INI = document.getElementById("EVENT_DATE_INI").value;
	info.EVENT_DATE_END = document.getElementById("EVENT_DATE_END").value;
	
	var hood = document.getElementById("SEARCH_BUTTON_EVENT_HOOD").pickedCode;
	info.EVENT_HOOD = hood;
	
	
	info.EVENT_PREVIR = document.getElementById("EVENT_PREVIR").value;
	info.EVENT_ADDRESS = document.getElementById("EVENT_ADDRESS").value;
	info.EVENT_COORDS = document.getElementById("EVENT_COORDS").value;
	info.EVENT_ACTIVITIES = getMultiCheckValue("EVENT_ACTIVITIES");
	info.EVENT_INSTYPE = document.getElementById("EVENT_INSTYPE").value;
	
	var institute = document.getElementById("SEARCH_BUTTON_EVENT_INSTITUTE").pickedCode;
	info.EVENT_INSTITUTE = institute;
	
	info.EVENT_SUPPORT_TEAM = JSON.stringify(actualSupportList);
	info.EVENT_COOPTYPE = document.getElementById("EVENT_COOPTYPE").value;
	info.EVENT_COOPERATOR = document.getElementById("EVENT_COOPERATOR").value;
	info.EVENT_NAME = document.getElementById("EVENT_NAME").value;
	info.EVENT_ASSIST = actualAssistList;
	info.EVENT_RESUME = document.getElementById("EVENT_RESUME").value;
	info.EVENT_SERVPLACE = document.getElementById("EVENT_SERVPLACE").value;
	info.EVENT_CONTRACT_CODE = userData.USER_CONTRACT;
	info.EVENT_SHEET = actualAssistForm;
	info.EVENT_PIC = actualEventPic;
	info.MODE = mode;
	
	// console.log(userData)
	
	// return
	
	// GET ASSIST TOTALS
	var totalSex = 0;
	var totalEtarie = 0;
	var totalEtnia = 0;
	var totalHandicap = 0;
	var totalLGTBI = 0;
	
	for(var i=0; i<actualAssistList.length; i++)
	{
		var item = actualAssistList[i];
		var val = parseInt(item.ASSIST_VALUE);
		
		if(item.ASSIST_TYPE == "SEX")
		{totalSex = totalSex+val;}
		
		if(item.ASSIST_TYPE == "ETARIE")
		{totalEtarie = totalEtarie+val;}
		
		if(item.ASSIST_TYPE == "ETNIA")
		{totalEtnia = totalEtnia+val;}
		
		if(item.ASSIST_TYPE == "HANDICAP")
		{totalHandicap = totalHandicap+val;}
		
		if(item.ASSIST_TYPE == "LGTBI")
		{totalLGTBI = totalLGTBI+val;}
	}
	
	info.EVENT_TOTAL_PEOPLE = totalSex;
	
	var warnDelay = 4000;
	
	if(totalEtarie != totalSex){fastPop(language["warnAssisTotal"], warnDelay);return;}
	if(totalEtnia != totalSex){fastPop(language["warnAssisTotalEtnia"], warnDelay);return;}
	if(totalHandicap > totalSex){fastPop(language["warnAssisTotalDis"], warnDelay);return;}
	if(totalLGTBI > totalSex){fastPop(language["warnAssisTotalLGTBI"], warnDelay);return;}
	if(info.EVENT_COOPTYPE == ""){fastPop("Debe seleccionar el tipo de cooperador.", 2000);return;}
	if(info.EVENT_COOPERATOR == ""){fastPop("Debe ingresar el cooperador.", 2000);return;}
	
	// SAVE CHECKS ACTIVATE ON FINISH EVENTS ----
	if(info.EVENT_ENTITY == ""){fastPop("Debe seleccionar entidad.", 2000);return;}
	if(info.EVENT_DATE_INI == ""){fastPop("Debe seleccionar la fecha de inicio.", 2000);return;}
	if(info.EVENT_DATE_END == ""){fastPop("Debe seleccionar la fecha de fin.", 2000);return;}
	
	// CHECK INIDATE
	var time1Date= new Date(info.EVENT_CREATED);
	var time2Date= new Date(info.EVENT_DATE_INI);
	if(time1Date <= time2Date )
	{fastPop("La fecha/hora de inicio del evento no puede ser posterior a la actual.", 3000);return;}
	// CHECK ENDATE
	var time1Date= new Date(info.EVENT_CREATED);
	var time2Date= new Date(info.EVENT_DATE_END);
	if(time1Date <= time2Date )
	{fastPop("La fecha/hora de fin del evento no puede ser posterior a la actual.", 3000);return;}
	
	// CHECK INI END COMPARE
	var time1Date= new Date(info.EVENT_DATE_INI);
	var time2Date= new Date(info.EVENT_DATE_END);
	if(time1Date >= time2Date )
	{fastPop("La fecha/hora de inicio del evento no puede superior o igual a la final.", 3000);return;}
	
	if(info.EVENT_HOOD == ""){fastPop("Debe seleccionar el barrio o vereda.", 2000);return;}
	
	if(info.EVENT_PREVIR == ""){fastPop("Debe seleccionar presencial/virtual.", 2000);return;}
	if(info.EVENT_PREVIR == "Presencial")
	{
		if(info.EVENT_ADDRESS == ""){fastPop("Debe escribir la dirección.", 2000);return;}
		if(info.EVENT_COORDS == ""){fastPop("Debe escribir las coordenadas.", 2000);return;}
	}
	if(JSON.parse(info.EVENT_ACTIVITIES).length == 0){fastPop("Debe seleccionar al menos una actividad de dirección de evento.", 2000);return;}
	if(info.EVENT_INSTYPE == ""){fastPop("Debe seleccionar institucional/comunitario.", 2000);return;}
	if(info.EVENT_SERVPLACE == "Si")
	{
		if(info.EVENT_INSTITUTE == ""){fastPop("Debe seleccionar la institución.", 2000);return;}
	}
	if(info.EVENT_NAME == ""){fastPop("Debe escribir el nombre o proposito del evento.", 2000);return;}
	if(info.EVENT_TOTAL_PEOPLE == 0){fastPop("El evento debe tener asistencia.", 2000);return;}
	if(info.EVENT_RESUME == ""){fastPop("Debe escribir el resumen del evento.", 2000);return;}
	if(info.EVENT_SHEET == ""){fastPop("Debe cargar el formato de conteo.", 2000);return;}
	if(info.EVENT_PIC == ""){fastPop("Debe cargar la foto del evento.", 2000);return;}
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE != "0")
	{info.EVENT_CODE = actualEditData.EVENT_CODE;}
	else
	{info.EVENT_CODE = "";}

	console.log(info)

	// loadManager(1, "popFormSaveButton");
	sendAjax("users","saveEvent",info,function(response)
	{
		// loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans)
		
		// return;
		
		if(ans == "Created")
		{
			fastPop("Se ha creado el evento",3000);
			refreshTable("wp_events");
			PUM.close(1515);	
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe un evento con este nombre",3000);
		}
		else if(ans == "eventCross")
		{
			fastPop("Ya existe otro evento para este contratista que se cruza con este día y hora",3000);
		}
		else if(ans == "updated")
		{
			fastPop("Evento actualizado",3000);
			refreshTable("wp_events");
			PUM.close(1515);	
		}
		
	});
}
function saveEventR(mode)
{
	var info = {};
	
	// SELECT REQUEST 0 FIELDS
	info.EVENT_CREATED = getNow();
	info.EVENT_AUTHOR = userData.USER_CODE;
	info.EVENT_ENTITY = document.getElementById("EVENT_ENTITY").value;
	info.EVENT_REQUESTER = document.getElementById("EVENT_REQUESTER").value;
	info.EVENT_ORIGIN = document.getElementById("EVENT_ORIGIN").value;
	info.EVENT_RADICATE = document.getElementById("EVENT_RADICATE").value;
	info.EVENT_REQUEST_DATE = document.getElementById("EVENT_REQUEST_DATE").value;
	info.EVENT_REQUEST_TYPE = document.getElementById("EVENT_REQUEST_TYPE").value;
	info.EVENT_INSTYPE = document.getElementById("EVENT_INSTYPE").value;
	
	var institute = document.getElementById("SEARCH_BUTTON_EVENT_INSTITUTE").pickedCode;
	info.EVENT_INSTITUTE = institute;
	
	info.EVENT_REQUEST_ACTIVITY = document.getElementById("EVENT_REQUEST_ACTIVITY").value;
	info.EVENT_NAME = document.getElementById("EVENT_NAME").value;
	info.EVENT_EXPECTED = document.getElementById("EVENT_EXPECTED").value;
	
	
	var hood = document.getElementById("SEARCH_BUTTON_EVENT_HOOD").pickedCode;
	info.EVENT_HOOD = hood;
	
	
	info.EVENT_PREVIR = document.getElementById("EVENT_PREVIR").value;
	info.EVENT_ADDRESS = document.getElementById("EVENT_ADDRESS").value;
	info.EVENT_COORDS = document.getElementById("EVENT_COORDS").value;
	info.EVENT_DATE_INIR = document.getElementById("EVENT_DATE_INIR").value;
	info.EVENT_DATE_ENDR = document.getElementById("EVENT_DATE_ENDR").value;
	info.EVENT_DESCRIPTION = document.getElementById("EVENT_DESCRIPTION").value;
	info.EVENT_SERVPLACE = document.getElementById("EVENT_SERVPLACE").value;
	
	info.EVENT_NEEDS = actualNeedsList;
	info.EVENT_REQUEST_FILE = actualRequestFile;
		
	info.MODE = mode;

	// SAVE CHECKS
	if(info.EVENT_ENTITY == ""){fastPop("Debe seleccionar entidad.", 2000);return;}
	if(info.EVENT_REQUESTER == ""){fastPop("Debe ingresar el id. de solicitante.", 2000);return;}
	if(info.EVENT_ORIGIN == ""){fastPop("Debe seleccionar el origen.", 2000);return;}
	if(info.EVENT_RADICATE == ""){fastPop("Debe ingresar el radicado.", 2000);return;}
	if(info.EVENT_REQUEST_DATE == ""){fastPop("Debe seleccionar la fecha de solicitud.", 2000);return;}
	if(info.EVENT_REQUEST_TYPE == ""){fastPop("Debe seleccionar el tipo de solicitud.", 2000);return;}
	if(info.EVENT_INSTYPE == ""){fastPop("Debe seleccionar tipo de solicitante.", 2000);return;}
	if(info.EVENT_INSTYPE == "Institucional")
	{if(info.EVENT_INSTITUTE == ""){fastPop("Debe seleccionar la institución.", 2000);return;}}
	if(info.EVENT_REQUEST_ACTIVITY == ""){fastPop("Debe seleccionar la actividad solicitud.", 2000);return;}
	if(info.EVENT_NAME == ""){fastPop("Debe escribir el nombre o proposito del evento.", 2000);return;}
	if(info.EVENT_EXPECTED == ""){fastPop("Debe escribir el número de asistentes esperados.", 2000);return;}
	if(info.EVENT_HOOD == ""){fastPop("Debe seleccionar el barrio o vereda.", 2000);return;}
	if(info.EVENT_PREVIR == ""){fastPop("Debe seleccionar presencial/virtual.", 2000);return;}
	if(info.EVENT_PREVIR == "Presencial")
	{
		if(info.EVENT_ADDRESS == ""){fastPop("Debe escribir la dirección.", 2000);return;}
		if(info.EVENT_COORDS == ""){fastPop("Debe escribir las coordenadas.", 2000);return;}
	}
	if(info.EVENT_DATE_INIR == ""){fastPop("Debe seleccionar la fecha de inicio.", 2000);return;}
	if(info.EVENT_DATE_ENDR == ""){fastPop("Debe seleccionar la fecha de fin.", 2000);return;}
	// CHECK INI END COMPARE
	var time1Date= new Date(info.EVENT_DATE_INIR);
	var time2Date= new Date(info.EVENT_DATE_ENDR);
	if(time1Date >= time2Date )
	{fastPop("La fecha/hora de inicio del evento no puede superior o igual a la final.", 3000);return;}
	if(info.EVENT_DESCRIPTION == ""){fastPop("Debe ingresar la descripción del evento.", 2000);return;}
	
	// GESTION FIELDS-----------------------------------
	// GESTION FIELDS-----------------------------------
	// GESTION FIELDS-----------------------------------
	
	
	// info.EVENT_OWNER = document.getElementById("EVENT_OWNER").value;
	
	var director = document.getElementById("SEARCH_BUTTON_EVENT_OWNER").pickedCode;
	info.EVENT_OWNER = director;
	
	
	info.EVENT_ACTIVITIES = getMultiCheckValue("EVENT_ACTIVITIES");
	info.EVENT_DATE_INI = document.getElementById("EVENT_DATE_INI").value;
	info.EVENT_DATE_END = document.getElementById("EVENT_DATE_END").value;
	info.EVENT_SUPPORT_TEAM = JSON.stringify(actualSupportList);

	if(requestState == "1" || requestState == "2")
	{
		info.EVENT_ASSIST = actualAssistList;
		
		if(info.EVENT_DATE_INI == ""){fastPop("Debe seleccionar la fecha de inicio de ejecución para el evento.", 2000);return;}
		if(info.EVENT_DATE_END == ""){fastPop("Debe seleccionar la fecha de fin de ejecución para el evento.", 2000);return;}
		
		// CHECK INI END COMPARE
		var time1Date= new Date(info.EVENT_DATE_INI);
		var time2Date= new Date(info.EVENT_DATE_END);
		if(time1Date >= time2Date )
		{fastPop("La fecha/hora de inicio de ejecución del evento no puede superior o igual a la final.", 3000);return;}
		
		if(info.EVENT_OWNER == ""){fastPop("Debe seleccionar el director del evento.", 2000);return;}
		if(JSON.parse(info.EVENT_ACTIVITIES).length == 0){fastPop("Debe seleccionar al menos una actividad de dirección de evento.", 2000);return;}
		
		info.EVENT_TOTAL_PEOPLE = 0;
		
	}
	
	// CLOSURE FIELDS
	
	info.EVENT_COOPERATOR = document.getElementById("EVENT_COOPERATOR").value;
	info.EVENT_COOPTYPE = document.getElementById("EVENT_COOPTYPE").value;
	info.EVENT_RESUME = document.getElementById("EVENT_RESUME").value;
	info.EVENT_SHEET = actualAssistForm;
	info.EVENT_PIC = actualEventPic;
	
	if(requestState == "4")
	{
		info.EVENT_ASSIST = actualAssistList;
		
		// GET ASSIST TOTALS
		var totalSex = 0;
		var totalEtarie = 0;
		var totalEtnia = 0;
		var totalHandicap = 0;
		var totalLGTBI = 0;
		
		for(var i=0; i<actualAssistList.length; i++)
		{
			var item = actualAssistList[i];
			var val = parseInt(item.ASSIST_VALUE);
			
			if(item.ASSIST_TYPE == "SEX")
			{totalSex = totalSex+val;}
			
			if(item.ASSIST_TYPE == "ETARIE")
			{totalEtarie = totalEtarie+val;}
			
			if(item.ASSIST_TYPE == "ETNIA")
			{totalEtnia = totalEtnia+val;}
			
			if(item.ASSIST_TYPE == "HANDICAP")
			{totalHandicap = totalHandicap+val;}
			
			if(item.ASSIST_TYPE == "LGTBI")
			{totalLGTBI = totalLGTBI+val;}
		}
		
		info.EVENT_TOTAL_PEOPLE = totalSex;

		if(info.EVENT_COOPERATOR == ""){fastPop("Debe ingresar el cooperador.", 2000);return;}
		if(info.EVENT_COOPTYPE == ""){fastPop("Debe seleccionar el tipo de cooperador.", 2000);return;}
		
		var warnDelay = 4000;
		
		if(totalEtarie != totalSex){fastPop(language["warnAssisTotal"], warnDelay);return;}
		if(totalEtnia != totalSex){fastPop(language["warnAssisTotalEtnia"], warnDelay);return;}
		if(totalHandicap > totalSex){fastPop(language["warnAssisTotalDis"], warnDelay);return;}
		if(totalLGTBI > totalSex){fastPop(language["warnAssisTotalLGTBI"], warnDelay);return;}
		
		if(info.EVENT_TOTAL_PEOPLE == 0){fastPop("El evento debe tener asistencia.", 2000);return;}
		if(info.EVENT_RESUME == ""){fastPop("Debe escribir el resumen del evento.", 2000);return;}
		if(info.EVENT_SHEET == ""){fastPop("Debe cargar el formato de conteo.", 2000);return;}
		if(info.EVENT_PIC == ""){fastPop("Debe cargar la foto del evento.", 2000);return;}
		
	}

	// SET DATA ACCORDING TO MODE
	if(info.MODE != "0")
	{
		info.EVENT_CODE = actualEditData.EVENT_CODE;
		info.EVENT_STATUS = actualEditData.EVENT_STATUS;
		info.LOCAL_REQUEST_STATUS = requestState;
	}
	else
	{
		info.EVENT_CODE = "";
		info.EVENT_STATUS = "1";
		info.LOCAL_REQUEST_STATUS = "0";
	}

	console.log(info)
	// return

	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveEventR",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans)
		
		if(ans == "Created")
		{
			fastPop("Se ha creado el evento",3000);
			refreshTable("wp_events_r");
			PUM.close(1515);	
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe un evento con este nombre",3000);
		}
		else if(ans == "updated")
		{
			if(info.EVENT_STATUS == "1")
			{fastPop("Evento asignado",3000);}
			else
			{fastPop("Evento actualizado",3000);}
			
			refreshTable("wp_events_r");
			PUM.close(1515);	
		}
		
	});
}
function saveTrasferEvent(mode)
{
	var info = {};
	
	info.EVENT_REQUEST_ACTIVITY = document.getElementById("EVENT_REQUEST_ACTIVITY").value;
	info.EVENT_CODE = actualEditData.EVENT_CODE;
	
	if(info.EVENT_REQUEST_ACTIVITY == ""){fastPop("Debe seleccionar la actividad.", 2000);return;}
	
	console.log(info);
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveTrasferEvent",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		
		fastPop("Traslado completado", 2000);
		refreshTable("wp_events_r");
		PUM.close(1515);
		
	});
	
}
function saveReject(mode)
{
	var info = {};
	
	info.EVENT_REJECT_REASON = document.getElementById("EVENT_REJECT_REASON").value;
	info.EVENT_CODE = actualEditData.EVENT_CODE;
	
	if(info.EVENT_REJECT_REASON == ""){fastPop("Debe escribir la causa de rechazo.", 2000);return;}
	
	console.log(info);
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveReject",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		
		fastPop("Traslado completado", 2000);
		refreshTable("wp_events_r");
		PUM.close(1515);
		
	});
	
}
function saveVisit(mode)
{
	var info = {};
	
	info.VISIT_ENTITY = userData.USER_ENTITY;
	info.VISIT_DONE = document.getElementById("VISIT_DONE").value;
	info.VISIT_TYPE = document.getElementById("VISIT_TYPE").value;
	info.VISIT_ASSISTQTY = document.getElementById("VISIT_ASSISTQTY").value;
	info.VISIT_NOASSISTQTY = document.getElementById("VISIT_NOASSISTQTY").value;
	info.VISIT_STONTIME = document.getElementById("VISIT_STONTIME").value;
	info.VISIT_TOOLS = document.getElementById("VISIT_TOOLS").value;
	info.VISIT_GOODTIME = document.getElementById("VISIT_GOODTIME").value;
	info.VISIT_GOODPLACE = document.getElementById("VISIT_GOODPLACE").value;
	info.VISIT_FORMAT = document.getElementById("VISIT_FORMAT").value;
	info.VISIT_PDELIVER = document.getElementById("VISIT_PDELIVER").value;
	info.VISIT_COHERENT = document.getElementById("VISIT_COHERENT").value;
	info.VISIT_EASY = document.getElementById("VISIT_EASY").value;
	info.VISIT_ORIENT = document.getElementById("VISIT_ORIENT").value;
	info.VISIT_EXPRESSION = document.getElementById("VISIT_EXPRESSION").value;
	info.VISIT_PRESENT = document.getElementById("VISIT_PRESENT").value;
	info.VISIT_VERIFIED = document.getElementById("VISIT_VERIFIED").value;
	info.VISIT_ACOMPLISH = document.getElementById("VISIT_ACOMPLISH").value;
	info.VISIT_CONTRATIST_SIGN = document.getElementById("VISIT_CONTRATIST_SIGN").value;
	info.VISIT_SIGNED = actualSignCheck;
	info.VISIT_COMMENTS = document.getElementById("VISIT_COMMENTS").value;
	info.VISIT_CONTRACT_CODE = userData.USER_CONTRACT;

	
	// REPLACE FOR GEOLOC
	// REPLACE FOR GEOLOC
	// REPLACE FOR GEOLOC
	// REPLACE FOR GEOLOC
	
	if(actualVisitCords != "")
	{
		actualCapturedCoord = actualVisitCords;
	}
	else
	{
		actualCapturedCoord = "";
	}
	
	console.log(actualCapturedCoord);
	
	if(actualCapturedCoord == "Negado por usuario")
	{
		fastPop("Usuario ha negado permiso para ubicación, para consultar como activar el permiso visitar: <a href='https://www.youtube.com/watch?v=jXWJZXGeKIM' target='blank'>Instrucciones para activar ubicación</a>", 6000);
		return;
	}

	
		
	// console.log("visit plan: "+ actualVisitPlanFile)
	// console.log("visit assist: "+ actualAssistPicFile)
	// console.log("visit classpic: "+ actualClassPicFile)
	
	// FILES
	info.VISIT_CLASS_PLAN = actualVisitPlanFile;
	info.VISIT_ASSIST_LIST = actualAssistPicFile;
	info.VISIT_CLASSPIC = actualClassPicFile;
	
	
	// console.log(info)	
	
	// return
	
	var gData = actualEditData.GROUP_DATA;
	
	info.MODE = mode;
	// SET DATA ACCORDING TO MODE
	if(info.MODE == "1")
	{
		info.VISIT_CODE = actualEditData.VISIT_CODE;
		info.VISIT_CLASS = actualEditData.VISIT_CLASS;
		info.VISIT_DATE = actualEditData.VISIT_DATE;
	}
	else
	{
		// KEY FIELDS
		info.VISIT_GROUP = actualEditData.GROUP_DATA.GROUP_CODE;
		info.VISIT_CONTRACT = actualEditData.GROUP_DATA.GROUP_CONTRACT;
		info.VISIT_ACTIVITY = actualEditData.GROUP_DATA.GROUP_ACTIVITY;
		info.VISIT_CLASS_DATE = actualEditData.CLASS_DATE
		info.VISIT_CLASS_INI_TIME = actualEditData.GROUP_TIME_INI;
		info.VISIT_COORD = actualCapturedCoord;
		
		
		info.VISIT_CLASS_COORD = actualEditData.GROUP_DATA.GROUP_COORDS;
		
		
		info.VISIT_HOOD = actualEditData.GROUP_DATA.GROUP_HOOD;
		info.VISIT_ADDRESS = actualEditData.GROUP_DATA.GROUP_ADDRESS;
		info.VISIT_MODE = actualEditData.GROUP_DATA.GROUP_PREVIR;
		info.VISIT_ZONE = getZoneCodeFromHood(actualEditData.GROUP_DATA.GROUP_HOOD);
		
		var contratistText = gData.CONTRACT_REQUESTER_ID+
						"<br>"+gData.CONTRACT_REQUESTER_NAME+
						"<br>"+gData.CONTRACT_REQUESTER_EMAIL+
						"<br>"+gData.CONTRACT_REQUESTER_PHONE;
	
		info.VISIT_CONTRATIST = contratistText;

		var visitorText = 	userData.USER_IDNUM+
							"<br>"+userData.USER_NAME+" "+userData.USER_LASTNAME+
							"<br>"+userData.USER_EMAIL+
							"<br>"+userData.USER_PHONE;
		
		info.VISIT_VISITOR = visitorText;
		
		info.VISIT_CODE = "";
		info.VISIT_CLASS = actualVisitClass;
		info.VISIT_DATE = getNow();
		
	}
	
	console.log(info)
	
	// return
	// SAVE CHECKS
	
	if(info.VISIT_DONE == ""){fastPop("Debe seleccionar la actividad se realizó.", 2000);return;}
	if(info.VISIT_TYPE == ""){fastPop("Debe seleccionar el tipo de visita.", 2000);return;}
	if(info.VISIT_ASSISTQTY == ""){fastPop("Debe ingresar el número de asistentes.", 2000);return;}
	
	
	if(info.VISIT_DONE == "Si")
	{
		if(info.VISIT_NOASSISTQTY == ""){fastPop("Debe ingresar el número de ausentes.", 2000);return;}
		if(info.VISIT_STONTIME == ""){fastPop("Debe seleccionar si la actividad inició a tiempo.", 2000);return;}
		if(info.VISIT_TOOLS == ""){fastPop("Debe seleccionar si las herramientas fueron adecuadas.", 2000);return;}

		if(info.VISIT_TYPE == "Verificación")
		{
			if(info.VISIT_GOODTIME == ""){fastPop("Debe seleccionar si el horario es adecuado.", 2000);return;}
			if(info.VISIT_GOODPLACE == ""){fastPop("Debe seleccionar si el lugar es adecuado.", 2000);return;}
		}
		else
		{
			if(info.VISIT_FORMAT == ""){fastPop("Debe seleccionar el formato es adecuado.", 2000);return;}
			if(info.VISIT_PDELIVER == ""){fastPop("Debe seleccionar si entregp a tiempo el plan.", 2000);return;}
			if(info.VISIT_COHERENT == ""){fastPop("Debe seleccionar si el plan es coherente.", 2000);return;}
			if(info.VISIT_EASY == ""){fastPop("Debe seleccionar si facilita el cumplimiento de objetivos.", 2000);return;}
			if(info.VISIT_ORIENT == ""){fastPop("Debe seleccionar si orienta correctamente.", 2000);return;}
			if(info.VISIT_EXPRESSION == ""){fastPop("Debe seleccionar si se expresa correctamente.", 2000);return;}
			if(info.VISIT_PRESENT == ""){fastPop("Debe seleccionar si la presentación es adecuada.", 2000);return;}
			if(info.VISIT_VERIFIED == ""){fastPop("Debe seleccionar si verifica la asistencia.", 2000);return;}
			if(info.VISIT_ACOMPLISH == ""){fastPop("Debe seleccionar si a su criterio cumple con los objetivos.", 2000);return;}
			// if(info.VISIT_CLASS_PLAN == ""){fastPop("Debe cargar el plan de clase.", 2000);return;}
			
		}
		
		
		if(info.MODE == "1")
		{
			if(actualEditData.VISIT_MODE == "Presencial" || actualEditData.VISIT_MODE == "Presencial/Virtual")
			{
				if(info.VISIT_CONTRATIST_SIGN == ""){fastPop("Debe ingresar la firma del contratista visitado (su contraseña de acceso al aplicativo).", 2000);return;}
				// if(info.VISIT_ASSIST_LIST == ""){fastPop("Debe cargar la foto del formato de asistencia.", 2000);return;}
			}
		}
		else
		{
			if(actualEditData.GROUP_DATA.GROUP_PREVIR == "Presencial" || actualEditData.GROUP_DATA.GROUP_PREVIR == "Presencial/Virtual")
			{
				if(info.VISIT_CONTRATIST_SIGN == ""){fastPop("Debe ingresar la firma del contratista visitado (su contraseña de acceso al aplicativo).", 2000);return;}
				if(info.VISIT_ASSIST_LIST == ""){fastPop("Debe cargar la foto del formato de asistencia.", 2000);return;}
			}
			
			if(info.VISIT_CLASSPIC == ""){fastPop("Debe cargar la foto de la clase.", 2000);return;}
			
		}

		
		
	}
	else if(info.VISIT_DONE == "No por otra causa")
	{
		if(info.VISIT_NOASSISTQTY == ""){fastPop("Debe ingresar el número de ausentes.", 2000);return;}
		
		
		if(info.MODE == "1")
		{
			if(actualEditData.VISIT_MODE == "Presencial" || actualEditData.VISIT_MODE == "Presencial/Virtual")
			{
				if(info.VISIT_CONTRATIST_SIGN == ""){fastPop("Debe ingresar la firma del contratista visitado (su contraseña de acceso al aplicativo).", 2000);return;}
				// if(info.VISIT_ASSIST_LIST == ""){fastPop("Debe cargar la foto del formato de asistencia.", 2000);return;}
			}
		}
		else
		{
			if(actualEditData.GROUP_DATA.GROUP_PREVIR == "Presencial" || actualEditData.GROUP_DATA.GROUP_PREVIR == "Presencial/Virtual")
			{
				if(info.VISIT_CONTRATIST_SIGN == ""){fastPop("Debe ingresar la firma del contratista visitado (su contraseña de acceso al aplicativo).", 2000);return;}
				if(info.VISIT_ASSIST_LIST == ""){fastPop("Debe cargar la foto del formato de asistencia.", 2000);return;}
			}
		}
		
	}
	
	if(info.VISIT_COMMENTS == ""){fastPop("Debe ingresar las observaciones de la visita.", 2000);return;}


	console.log(info)		
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveVisit",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		
		if(info.MODE == "1")
		{
			fastPop("Visita actualizada", 2000);
			refreshTable("wp_visits");
			PUM.close(1515);
			return;
		}

		actualSignCheck = "No";
		
		fastPop("Visita registrada", 2000);
		refreshTable("wp_visitable");
		PUM.close(1515);
		
	});
	
}
function saveComment(type)
{
	var info = {};
	
	console.log(type);
	
	// DEFAULT FIELDS
	info.REMCOM_ENTITY = userData.USER_ENTITY;
	info.REMCOM_COMMENT_DATE = document.getElementById("REMCOM_COMMENT_DATE").value
	info.REMCOM_COMMENT = document.getElementById("REMCOM_COMMENT").value.replace(/['"]+/g, '');
	info.REMCOM_COMMENT = document.getElementById("REMCOM_COMMENT").value.replace(/['"]+/g, '');
	info.REMCOM_SPECIAL = document.getElementById("REMCOM_SPECIAL").value;
	info.REMCOM_FILE = actualCommentFile;
	info.REMCOM_LINE = actualRemitionData.REM_LINE;
	info.REMCOM_TYPE = actualComment;
	info.REMCOM_REMINI = actualRemitionData.REM_DATE;
	info.REMCOM_DATE = getNow();
	info.REMCOM_CREATED_BY = userData.USER_CODE;
	
	info.REMCOM_AUTOR_CONTRACT = userData.USER_CONTRACT;
	
	info.REMCOM_REMSTATE = actualRemitionData.REM_STATE;
	
	info.REMCOM_AUTOR = actualRemitionData.REM_AUTOR;
	info.REMCOM_AUTOR_NAME = actualRemitionData.REM_AUTOR_NAME;
	
	info.REMCOM_CONTRATIST = actualRemitionData.REM_CONTRATIST;
	info.REMCOM_CONTRATIST_NAME = actualRemitionData.REM_CONTRATIST_NAME;
	info.REMCOM_ACTIVITY = actualRemitionData.REM_ACTIVITY;
	// VARIABLE FIELDS
	info.REMCOM_NEW_ACTIVITY = "";
	info.REMCOM_NEW_CONTRATIST = "";
	info.REMCOM_NEW_CONTRATIST_NAME = "";
	info.REMCOM_GROUP = "";
	info.REMCOM_MODE = type;
	info.REMCOM_CITIZEN = actualRemitionData.REM_CITIZEN;
	info.REMCOM_CITIZEN_NAME = actualRemitionData.REM_CITIZEN_NAME;
	info.REMCOM_REQUESTER = actualRemitionData.REM_REQUESTER;
	info.REMCOM_REQUESTER_TYPE = actualRemitionData.REM_REQUESTER_TYPE;
	info.REMCOM_REQUESTER_NAME = actualRemitionData.REM_REQUESTER_NAME;
	
	info.REMCOM_REM_AUTOR = userData.USER_CODE;
	info.REMCOM_REM_AUTOR_NAME = userData.USER_NAME+" "+userData.USER_LASTNAME;
	
	info.REMCOM_USER_CONTRACT = userData.USER_CONTRACT;
	info.REMCOM_REM_CODE = actualRemitionData.REM_CODE;
	
	var userCommentDate = (info.REMCOM_COMMENT_DATE+":00").replaceAll("/", '-');
	var now = getNow();
	console.log(userCommentDate);
	console.log(now);
	if(userCommentDate > now){{fastPop("La fecha/hora del motivo no puede superar la fecha/hora actual.", 2000);return;}}
	
	if(info.REMCOM_COMMENT == ""){fastPop("Debe escribir un motivo.", 2000);return;}
	if(info.REMCOM_COMMENT_DATE == ""){fastPop("Debe seleccionar una fecha y hora del motivo.", 2000);return;}
	if(info.REMCOM_SPECIAL == ""){fastPop("Debe seleccionar si el motivo es especial.", 2000);return;}
	
	
	
	info.REMCOM_COMPONENT = "";
	info.REMCOM_SCOMPONENT = "";
	
	
	if(type == "addGroup" || type == "quitGroup")
	{
		var group = document.getElementById("SEARCH_BUTTON_REMCOM_GROUP").pickedCode;
		info.REMCOM_GROUP = group;

		if(info.REMCOM_GROUP == ""){fastPop("Debe seleccionar un grupo.", 2000);return;}
	}
	if(type == "remit")
	{
		var activity = document.getElementById("SEARCH_BUTTON_REMCOM_ACTIVITY").pickedCode;
		info.REMCOM_NEW_ACTIVITY = activity;
		var contratist = document.getElementById("SEARCH_BUTTON_REMCOM_CONTRATIST").pickedCode;
		info.REMCOM_NEW_CONTRATIST = contratist;
		
		if(info.REMCOM_ACTIVITY == ""){fastPop("Debe seleccionar una actividad.", 2000);return;}
		if(info.REMCOM_CONTRATIST == ""){fastPop("Debe seleccionar un contratista.", 2000);return;}
	}
	if(type == "close")
	{
		info.REMCOM_REMSTATE = "1";
	}
	if(type == "date")
	{
		
		info.REMCOM_DATE_DATE = document.getElementById("REMCOM_DATE_DATE").value;
		info.REMCOM_DATE_INI = document.getElementById("REMCOM_DATE_INI").value;
		info.REMCOM_DATE_END = document.getElementById("REMCOM_DATE_END").value;
		info.REMCOM_DATE_PLACE = document.getElementById("REMCOM_DATE_PLACE").value;

		
		if(info.REMCOM_DATE_DATE == ""){fastPop("Debe seleccionar una fecha.", 2000);return;}
		if(info.REMCOM_DATE_INI == ""){fastPop("Debe seleccionar una hora de inicio.", 2000);return;}
		if(info.REMCOM_DATE_END == ""){fastPop("Debe seleccionar una hora de fin.", 2000);return;}
		if(info.REMCOM_DATE_PLACE == ""){fastPop("Debe ingresar el lugar de la cita.", 2000);return;}

		var today = getNow().split(" ")[0];
		var diffDays = getdDiff(today, info.REMCOM_DATE_DATE);
		if(diffDays < 0){fastPop("La fecha de la cita no puede ser anterior a la actual", 2000);return;}
		

		var time1 = info.REMCOM_DATE_INI;
		var time2 = info.REMCOM_DATE_END;
		var time1Date= new Date("01/01/2000 "+time1);
		var time2Date= new Date("01/01/2000 "+time2);
		if(time1Date >= time2Date )
		{fastPop("La hora inicial no puede ser posterior o igual a la final", 2000);return;}
		
		
	}
	if(type == "reopen")
	{
		info.REMCOM_REMSTATE = "0";
	}
	if(type == "remClose")
	{
		
		
		var activity = document.getElementById("SEARCH_BUTTON_REMCOM_ACTIVITY").pickedCode;
		info.REMCOM_ACTIVITY = activity;
		var contratist = document.getElementById("SEARCH_BUTTON_REMCOM_CONTRATIST").pickedCode;
		info.REMCOM_NEW_CONTRATIST = contratist;
		info.REMCOM_COMMENT_CLOSE = document.getElementById("REMCOM_COMMENT_CLOSE").value.replace(/['"]+/g, '');
		info.REMCOM_SPECIAL_CLOSE = document.getElementById("REMCOM_SPECIAL_CLOSE").value;
		info.REMCOM_FILE_CLOSE = actualCommentCloseFile;
		
		if(info.REMCOM_ACTIVITY == ""){fastPop("Debe seleccionar una actividad.", 2000);return;}
		if(info.REMCOM_NEW_CONTRATIST == ""){fastPop("Debe seleccionar un contratista.", 2000);return;}
		if(info.REMCOM_COMMENT_CLOSE == ""){fastPop("Debe ingresar un motivo de cierre.", 2000);return;}
		if(info.REMCOM_SPECIAL_CLOSE == ""){fastPop("Debe seleccionar si el motivo de cierre es especial.", 2000);return;}
		
		console.log(info);
		
		loadManager(1, "popFormSaveButton");
		sendAjax("users","saveCommentRC",info,function(response)
		{
			loadManager(0, "popFormSaveButton");
			var ans = response.message;
			
			fastPop("Se ha remitido y cerrado la actividad",3000);return;
			refreshTable("wp_remitions");
			PUM.close(1515);	
			
			return;
		});
		
		return;
		
	}
	if(type == "decition")
	{
		var component = document.getElementById("SEARCH_BUTTON_REMCOM_COMPONENT").pickedCode;
		info.REMCOM_COMPONENT = component;
		var scomponent = document.getElementById("SEARCH_BUTTON_REMCOM_SCOMPONENT").pickedCode;
		info.REMCOM_SCOMPONENT = scomponent;
		
		if(info.REMCOM_COMPONENT == ""){fastPop("Debe seleccionar un componente.", 2000);return;}
		if(info.REMCOM_SCOMPONENT == ""){fastPop("Debe seleccionar un sub componente.", 2000);return;}
	}
	
	
	console.log(info);
	// return;

	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveComment",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans);
		
		if(ans == "dateCross")
		{
			fastPop("Esta cita se cruza con una clase para este contratista",3000);return;
		}
		if(ans == "citaCross")
		{
			fastPop("Esta cita se cruza con otra cita abierta para este contratista",3000);return;
		}
		
		// return;
		
		if(actualComment == "normalComment")
		{
			fastPop("Se ha creado el comentario",2000);
		}
		else if(actualComment == "addGroup")
		{
			fastPop("Se ha agregado el ciudadano al grupo",2000);
		}
		else if(actualComment == "quitGroup")
		{
			fastPop("Se ha sacado al ciudadano del grupo",2000);
		}
		else if(actualComment == "remit")
		{
			fastPop("Se ha remitido al ciudadano",2000);
		}
		else if(actualComment == "date")
		{
			fastPop("Se ha creado la cita",2000);
			
		}
		else if(actualComment == "close")
		{
			actualRemitionData.REM_STATE= "1";
			loadIf("attendB");
			fastPop("Se ha cerrado la atención",2000);
		}
		else if(actualComment == "reopen")
		{
			actualRemitionData.REM_STATE= "0";
			loadIf("attendB");
			fastPop("Se ha re abierto la atención",2000);
		}
		
		refreshTable("wp_attend");
		PUM.close(1515);	
		
		
	});
	
}
function editDate()
{
	var info = {};
	
	info.DATE_CODE = actualEditData.DATE_CODE;
	info.REMCOM_CITIZEN = actualEditData.DATE_CITIZEN;
	info.REMCOM_CITIZEN_NAME = actualEditData.DATE_CITIZEN_NAME;
	info.REMCOM_CONTRATIST = actualEditData.DATE_CONTRATIST;
	info.REMCOM_USER_CONTRACT = userData.USER_CONTRACT;
	info.REMCOM_DATE_DATE = document.getElementById("DATE_DATE").value;
	info.REMCOM_DATE_INI = document.getElementById("DATE_DATE_INI").value;
	info.REMCOM_DATE_END = document.getElementById("DATE_DATE_END").value;
	info.REMCOM_DATE_PLACE = document.getElementById("DATE_PLACE").value;

	
	if(info.REMCOM_DATE_DATE == ""){fastPop("Debe seleccionar una fecha.", 2000);return;}
	if(info.REMCOM_DATE_INI == ""){fastPop("Debe seleccionar una hora de inicio.", 2000);return;}
	if(info.REMCOM_DATE_END == ""){fastPop("Debe seleccionar una hora de fin.", 2000);return;}
	if(info.REMCOM_DATE_PLACE == ""){fastPop("Debe ingresar el lugar de la cita.", 2000);return;}

	var today = getNow().split(" ")[0];
	var diffDays = getdDiff(today, info.REMCOM_DATE_DATE);
	if(diffDays < 0){fastPop("La fecha de la cita no puede ser anterior a la actual", 2000);return;}
	

	var time1 = info.REMCOM_DATE_INI;
	var time2 = info.REMCOM_DATE_END;
	var time1Date= new Date("01/01/2000 "+time1);
	var time2Date= new Date("01/01/2000 "+time2);
	if(time1Date >= time2Date )
	{fastPop("La hora inicial no puede ser posterior o igual a la final", 3000);return;}

	// CHECK DATE CANT BE BEFORE NOW
	
	var dateFull = info.REMCOM_DATE_DATE+" "+info.REMCOM_DATE_INI+":00";
	var dateNow = getNow();
	
	if(dateFull < dateNow){fastPop("La fecha hora inicial no puede ser anterior a este momento", 3000);return;}
	
	
	console.log(info);
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","editDate",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans);
		
		if(ans == "dateCross")
		{
			fastPop("Esta cita se cruza con una clase para este contratista",3000);return;
		}
		if(ans == "citaCross")
		{
			fastPop("Esta cita se cruza con otra cita abierta para este contratista",3000);return;
		}

		
		fastPop("Cita actualizada",3000);
			
		refreshTable("wp_dates");
		PUM.close(1515);
		
		
	});

}
function dateClose()
{
	var info = {};
	
	info.DATE_CODE = actualEditData.DATE_CODE;
	info.DATE_CLOSE_COMMENT = document.getElementById("DATE_CLOSE_COMMENT").value.replace(/['"]+/g, '');
	
	if(info.DATE_CLOSE_COMMENT == ""){fastPop("Debe ingresar un comentario.", 2000);return;}
	
	console.log(info);
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","dateClose",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans);

		fastPop("Cita cerrada",3000);
			
		refreshTable("wp_dates");
		PUM.close(1515);
		
		
	});

}

// EDIT FILLER---------
function formEditFiller(containerId, data)
{
	var fieldsBox = document.querySelector("#"+containerId);
	var keys = Object.keys(data);
	
	// console.log(keys)
	
	var ignore = [];
	
	for(var i=0; i<keys.length; i++)
	{
		var item = keys[i];
		if(ignore.includes(item)){continue;}
		if(fieldsBox.querySelector("#"+item) != null)
		{document.getElementById(item).value = data[item];}
	}
	
	actualMT = "2";
}

function getKeys(dictionary)
{
	var keys = Object.keys(dictionary);
	var list = [];
	for(var i=0; i<keys.length; i++)
	{
		var item = keys[i];
		list.push(item);
	}
	return list;
}

// INTERFACES MANAGE-----
function loadIf(iface, menu)
{
	
	var ifacesBox = document.getElementById("mainBox");
	var interfaces = ifacesBox.children;
	
	for(var i=0; i<interfaces.length; i++)
	{
		var item = interfaces[i];
		document.getElementById(item.id).style.display = "none";
	}
	
	document.getElementById(iface).style.display = "block";
	
	ifaceBuilder(iface);

	// MARK MENUS
	var menuBox = document.getElementById("myTopnav");
	var menus = menuBox.children;
	
	for(var i=0; i<menus.length; i++)
	{
		var item = menus[i];
		if(i<(menus.length)-1){item.className = ".topnav a";}
	}
	if(menu != null)
	{
		menu.className = "active";
		myFunction();
	}
	else
	{
		document.getElementById("welcomeBmenu").className = "active";
	}
}

// INTERFACES BUILDER
function ifaceBuilder(type)
{
	
	// CLEAR ALL INTERFACES TO AVOID FILTER ERROR
	var interfaces = document.getElementById("mainBox").children;
	for(var i=0; i<interfaces.length; i++)
	{
		var iface = interfaces[i];
		iface.innerHTML = "";
	}
	
	var ifaceBox = document.getElementById(type);
	// ifaceBox.innerHTML = "";
	
	var title = document.createElement("div");
	title.className = "col-12";
	var titleLine = document.createElement("span");
	titleLine.className = "ifTitle";
	
	var buttonBox = document.createElement("div");
	buttonBox.className = "row ifaceButtonsBox";
	
	var filtersBox = document.createElement("div");
	filtersBox.id = "filtersBox";
	filtersBox.innerHTML = "";
	filtersBox.className = "row filtersBox";
	
	title.appendChild(titleLine);
	if(type == "welcomeB")
	{
		// TITLE
		titleLine.innerHTML = "Inicio";
		
		ifaceBox.appendChild(title);
	}
	if(type == "contractsB")
	{

		// TITLE
		titleLine.innerHTML = "Contratos";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Solicitar";
		button1.onclick = function ()
		{
			console.log(lockRequest)
			if(lockRequest == "1")
			{
				fastPop("Usted tiene una solicitud de contrato pendiente o un contrato activo  actualmente, no podrá hacer nuevas solicitudes", 6000);
				return;
			}
			
			
			loadForm("contract");
		}
		
		if(userData.USER_CTYPE != "Principal1" && userData.USER_CTYPE != "Principal2" && userData.USER_CTYPE != "Principal3" )
		{
			buttonBox.appendChild(button1);
		}
		
		var button2 = buttonCreator([12,4,4,2], "Descargar contratos", function(){refreshTable("wp_contracts", "contracts")});
		
		// FILTERS 
		var CONTRACT_OWNER_F = fieldCreator([12,4,4,2], "Contratista", "input", "text", "CONTRACT_OWNER_F");
		
		var CONTRACT_USERTYPE_F = fieldCreator([12,4,4,2], "Tipo de usuario", "input", "text", "CONTRACT_USERTYPE_F");
		
		var CONTRACT_ACTIVITIES_F = fieldCreator([12,4,4,2], "Actividad", "input", "text", "CONTRACT_ACTIVITIES_F");
		
		var CONTRACT_NUMBER_F = fieldCreator([12,4,4,2], "# Contrato", "input", "text", "CONTRACT_NUMBER_F");
		
		
		var CONTRACT_ACTIVE_F = fieldCreator([12,4,4,2], "Estado", "select", "select", "CONTRACT_ACTIVE_F");
		
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_contracts")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_contracts")
		});
		
		filtersBox.appendChild(CONTRACT_OWNER_F);
		filtersBox.appendChild(CONTRACT_USERTYPE_F);
		filtersBox.appendChild(CONTRACT_ACTIVITIES_F);
		filtersBox.appendChild(CONTRACT_NUMBER_F);
		filtersBox.appendChild(CONTRACT_ACTIVE_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		filtersBox.appendChild(button2);
		
		
		// TABLE
		var table = tableDraw("wp_contracts",["Entidad","# contrato","Rango fechas","Tipo usuario","Actividades", "Comuna o corregimiento","Solicitante", "Contratista", "Aprobado por", "Estado", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(buttonBox);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		// FILL USERTYPES
		var options = ["Solicitud","Asignado","Vencido"];
		selectFiller("CONTRACT_ACTIVE_F", "Seleccione estado", options);
		
		
		// document.getElementById("CONTRACT_NUMBER_F").value = "4444";
		
		// setDateField("CONTRACT_INIDATE_F");
		
		refreshTable("wp_contracts");
		
	}
	if(type == "usersB")
	{
		// TITLE
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear usuario especial";
		button1.onclick = function ()
		{loadForm("user");}
		buttonBox.appendChild(button1);
		
		// TABLE
		var table = tableDraw("wp_trusers",["Entidad",  "Tipo documento", "Documento","Nombre", "Usuario", "Teléfono", "Estado", "Opciones"]);

		ifaceBox.appendChild(title);
		
		if(userData.USER_CTYPE != "Superior")
		{
			titleLine.innerHTML = "Usuarios";
		}
		else
		{
			titleLine.innerHTML = "Usuarios Super Admin";
			ifaceBox.appendChild(buttonBox);
		}
		
		// FILTERS 
		var USER_NAME_F = fieldCreator([12,4,4,2], "Nombre", "input", "text", "USER_NAME_F");
		var USER_LASTNAME_F = fieldCreator([12,4,4,2], "Apellido", "input", "text", "USER_LASTNAME_F");
		var USER_IDNUM_F = fieldCreator([12,4,4,2], "# Documento", "input", "text", "USER_IDNUM_F");
		
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_trusers")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_trusers")
		});
		
		filtersBox.appendChild(USER_NAME_F);
		filtersBox.appendChild(USER_LASTNAME_F);
		filtersBox.appendChild(USER_IDNUM_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_trusers");
		
	}
	if(type == "citizensB")
	{
		// TITLE
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear ciudadano";
		button1.onclick = function ()
		{
			citizenOrigin = "c";
			loadForm("citizen");
		}
		buttonBox.appendChild(button1);
		


		
		// FILTERS 
		var CITIZEN_NAME_F = fieldCreator([12,4,4,2], "Nombre", "input", "text", "CITIZEN_NAME_F");
		var CITIZEN_LASTNAME_F = fieldCreator([12,4,4,2], "Apellido", "input", "text", "CITIZEN_LASTNAME_F");
		var CITIZEN_IDNUM_F = fieldCreator([12,4,4,2], "# Documento", "input", "text", "CITIZEN_IDNUM_F");
		var CITIZEN_ETNIA_F = fieldCreator([12,4,4,2], "Etnia", "input", "text", "CITIZEN_ETNIA_F");
		var CITIZEN_CONDITION_F = fieldCreator([12,4,4,2], "Condición", "input", "text", "CITIZEN_CONDITION_F");
		
		var searchButton = buttonCreator([12,4,4,1], "Buscar", function(){refreshTable("wp_citizens")});
		
		var clearFiltersButton = buttonCreator([12,4,4,1], "Limpiar", function()
		{
			clearFilters();
			refreshTable("wp_citizens")
		});
		
		filtersBox.appendChild(CITIZEN_NAME_F);
		filtersBox.appendChild(CITIZEN_LASTNAME_F);
		filtersBox.appendChild(CITIZEN_IDNUM_F);
		filtersBox.appendChild(CITIZEN_ETNIA_F);
		filtersBox.appendChild(CITIZEN_CONDITION_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_citizens",["Nombre", "Tipo Id.", "# Id.", "Nacimiento", "Teléfono", "Email", "Género", "Etnia", "Condición", "Opciones"]);

		ifaceBox.appendChild(title);
		ifaceBox.appendChild(buttonBox);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		titleLine.innerHTML = "Ciudadanos";
		
		refreshTable("wp_citizens");
		
	}
	if(type == "logB")
	{
		// TITLE
		titleLine.innerHTML = "Log";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Limpiar log";
		button1.onclick = function ()
		{
			var params = ["",""];
			confirmBox(language["confirm"], "¿Desea limpiar el log de la aplicación?",clearLog, params);
		}
		
		buttonBox.appendChild(button1);
		
		// FILTERS (SAMPLE COMMENTED)
		
		var LOG_DATE_INI_F = fieldCreator([12,4,4,2], "Fecha inicial", "input", "text", "LOG_DATE_INI_F");
		var LOG_DATE_END_F = fieldCreator([12,4,4,2], "Fecha final", "input", "text", "LOG_DATE_END_F");
		
		var LOG_ENTITY = fieldCreator([12,4,4,2], "Entidad", "input", "text", "LOG_ENTITY");
		var LOG_USER = fieldCreator([12,4,4,2], "Usuario", "input", "text", "LOG_USER");
		var LOG_MT = fieldCreator([12,4,4,2], "Operación", "select", "select", "LOG_MT");
		var LOG_IFACE = fieldCreator([12,4,4,2], "Ubicación", "select", "select", "LOG_IFACE");
		
		
		
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_log")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_log")
		});
		
		filtersBox.appendChild(LOG_DATE_INI_F);
		filtersBox.appendChild(LOG_DATE_END_F);
		filtersBox.appendChild(LOG_ENTITY);
		filtersBox.appendChild(LOG_USER);
		filtersBox.appendChild(LOG_MT);
		filtersBox.appendChild(LOG_IFACE);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_log",["Usuario", "Fecha/hora","Ubicación", "Operación", "Entidad"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(buttonBox);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		// SET DATE FIELDS
		setDateField("LOG_DATE_INI_F");
		setDateField("LOG_DATE_END_F");
		
		var locKeys = Object.keys(locationsDictionary);
		var options = [];
		for(var i=0; i<locKeys.length; i++)
		{
			var item = {};
			item.TYPE = locKeys[i];
			item.DESC = locationsDictionary[locKeys[i]];
			options.push(item);
		}
		
		// FILL SPECIAL TYPES
		selectFiller("LOG_IFACE", "Seleccione interfaz", options, "TYPE", "DESC");
		
		
		var opKeys = Object.keys(actionsDictionary);
		var options = [];
		for(var i=0; i<opKeys.length; i++)
		{
			if(actionsDictionary[opKeys[i]] == ""){continue;}
			var item = {};
			item.TYPE = opKeys[i].split("a")[1];
			item.DESC = actionsDictionary[opKeys[i]];
			options.push(item);
		}
		
		// FILL SPECIAL TYPES
		selectFiller("LOG_MT", "Seleccione operación", options, "TYPE", "DESC");
		
		
		
		
		
		refreshTable("wp_log");
	}
	if(type == "programsB")
	{
		// TITLE
		titleLine.innerHTML = "Programas";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear programa";
		button1.onclick = function ()
		{loadForm("program");}
		
		// FILTERS 
		var PROGRAM_ENTITY_F = fieldCreator([12,4,4,2], "Entidad", "input", "text", "PROGRAM_ENTITY_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_programs")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_programs")
		});
		
		filtersBox.appendChild(PROGRAM_ENTITY_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		
		
		// TABLE
		var table = tableDraw("wp_programs",["Entidad","Nombre", "Opciones"]);
		
		
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_programs");
	}
	if(type == "projectsB")
	{
		// TITLE
		titleLine.innerHTML = "Proyectos";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear proyecto";
		button1.onclick = function ()
		{loadForm("project");}
		
		
		// FILTERS 
		var PROJECT_NAME_F = fieldCreator([12,4,4,2], "Proyecto", "input", "text", "PROJECT_NAME_F");
		
		var PROJECT_PROGRAM_F = fieldCreator([12,4,4,2], "Programa", "input", "text", "PROJECT_PROGRAM_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_projects")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_projects")
		});
		
		filtersBox.appendChild(PROJECT_NAME_F);
		filtersBox.appendChild(PROJECT_PROGRAM_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_projects",["Entidad","Proyecto", "Programa","Opciones"]);
		
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_projects");
	}
	if(type == "activitiesB")
	{
		// TITLE
		titleLine.innerHTML = "Actividades";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear actividad";
		button1.onclick = function ()
		{loadForm("activity");}
		
		
		// FILTERS 
		var ACTIVITY_NAME_F = fieldCreator([12,4,4,2], "Actividad", "input", "text", "ACTIVITY_NAME_F");
		
		var ACTIVITY_PROJECT_F = fieldCreator([12,4,4,2], "Proyecto", "input", "text", "ACTIVITY_PROJECT_F");
		
		var ACTIVITY_PROGRAM_F = fieldCreator([12,4,4,2], "Programa", "input", "text", "ACTIVITY_PROGRAM_F");
		
		
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_activities")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_activities")
		});
		
		filtersBox.appendChild(ACTIVITY_NAME_F);
		filtersBox.appendChild(ACTIVITY_PROJECT_F);
		filtersBox.appendChild(ACTIVITY_PROGRAM_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		
		
		// TABLE
		var table = tableDraw("wp_activities",["Entidad","Actividad", "Atiende eventos por solicitud", "Proyecto","Programa","Opciones"]);
		
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_activities");
	}
	if(type == "entitiesB")
	{
		// TITLE
		titleLine.innerHTML = "Entidades";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear entidad";
		button1.onclick = function ()
		{loadForm("entity");}
		
		// FILTERS 
		var ENTITY_CITY_F = fieldCreator([12,4,4,2], "Ciudad", "input", "text", "ENTITY_CITY_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_entities")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_entities")
		});
		
		filtersBox.appendChild(ENTITY_CITY_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		
		
		// TABLE
		var table = tableDraw("wp_entities",["Ciudad","Entidad","Activa hasta", "Opciones"]);
		
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_entities");
	}
	if(type == "callsB")
	{
		// TITLE
		titleLine.innerHTML = "Llamadas";
		
		// BUTTONS--
		// var button1 = document.createElement("button");
		// button1.className = "ifaceButton";
		// button1.innerHTML = "Crear etnia";
		// button1.onclick = function ()
		// {loadForm("etnia");}
		
		
		// TABLE
		// var table = tableDraw("wp_etnias",["Entidad","Nombre", "Opciones"]);
		
		
		
		ifaceBox.appendChild(title);
		// ifaceBox.appendChild(button1);
		// ifaceBox.appendChild(filtersBox);
		// ifaceBox.appendChild(table);
		
		// refreshTable("wp_calls");
	}
	if(type == "groupsB")
	{
		// TITLE
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear grupo";
		button1.onclick = function ()
		{
			citizenOrigin = "gr";
			loadForm("group");
		}
		buttonBox.appendChild(button1);

		// FILTERS 
		var GROUP_NAME_F = fieldCreator([12,4,4,2], "Nombre de grupo", "input", "text", "GROUP_NAME_F");
		
		var GROUP_ZONE_F = fieldCreator([12,4,4,2], "Comuna/Corregimiento", "input", "text", "GROUP_ZONE_F");
		
		var GROUP_HOOD_F = fieldCreator([12,4,4,2], "Barrio/Vereda", "input", "text", "GROUP_HOOD_F");
		
		var GROUP_PROJECT_F = fieldCreator([12,4,4,2], "Proyecto", "input", "text", "GROUP_PROJECT_F");
		
		var GROUP_CONTRATIST_F = fieldCreator([12,4,4,2], "Contratista", "input", "text", "GROUP_CONTRATIST_F");
		
		var GROUP_ACTIVE_F = fieldCreator([12,4,4,2], "Estado", "select", "select", "GROUP_ACTIVE_F");

		
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_groups")});
		var button2 = buttonCreator([12,4,4,2], "Descargar grupos", function(){refreshTable("wp_groups", "groups")});
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar", function()
		{
			clearFilters();
			refreshTable("wp_groups")
		});
		
		filtersBox.appendChild(GROUP_NAME_F);
		filtersBox.appendChild(GROUP_ZONE_F);
		filtersBox.appendChild(GROUP_HOOD_F);
		filtersBox.appendChild(GROUP_PROJECT_F);
		filtersBox.appendChild(GROUP_CONTRATIST_F);
		filtersBox.appendChild(GROUP_ACTIVE_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		filtersBox.appendChild(button2);
		
		// TABLE
		var table = tableDraw("wp_groups",["Nombre grupo","Contratista", "Proyecto", "Actividad", "Presencial/Virtual","Institucional/Comunitario","Barrio o vereda", "Dirección o nombre de lugar", "Coordenadas","Horarios", "Ciudadanos", "Opciones"]);

		ifaceBox.appendChild(title);
		
		var utype = userData.USER_CTYPE;
		
		if(utype == "Superior" || utype == "Principal3" || utype == "Director" || utype == "Coordinador")
		{
			ifaceBox.appendChild(buttonBox);
		}
		
		
		
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		// FILL USERTYPES
		var options = ["Activo", "Inactivo"];
		selectFiller("GROUP_ACTIVE_F", "Seleccione estado", options);
		
		titleLine.innerHTML = "Grupos";
		
		// document.getElementById("GROUP_NAME_F").value = "GRUPO 4:";
		
		refreshTable("wp_groups");
		
	}
	if(type == "classesB")
	{
		// TITLE
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear clase";
		button1.onclick = function ()
		{
			getClassGroups();
		}
		var utype = userData.USER_CTYPE;
		if(utype == "Superior" || utype == "Principal3" || utype == "Director" || utype == "Coordinador"){}
		buttonBox.appendChild(button1);

		// FILTERS 
		var CLASS_DATE_INI_F = fieldCreator([12,4,4,2], "Fecha inicial", "input", "text", "CLASS_DATE_INI_F");
		var CLASS_DATE_END_F = fieldCreator([12,4,4,2], "Fecha final", "input", "text", "CLASS_DATE_END_F");
		var CLASS_GNAME_F = fieldCreator([12,4,4,2], "Nombre grupo", "input", "text", "CLASS_GNAME_F");
		var CLASS_CONTRATIST_F = fieldCreator([12,4,4,2], "Contratista", "input", "text", "CLASS_CONTRATIST_F");
		var CLASS_ACTIVITY_F = fieldCreator([12,4,4,2], "Actividad", "input", "text", "CLASS_ACTIVITY_F");
		var CLASS_PROJECT_F = fieldCreator([12,4,4,2], "Proyecto", "input", "text", "CLASS_PROJECT_F");
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_classes")});
		var button2 = buttonCreator([12,4,4,2], "Descargar asistencia", function(){refreshTable("wp_classes", "classAssist")});
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_classes")
		});
		
		filtersBox.appendChild(CLASS_DATE_INI_F);
		filtersBox.appendChild(CLASS_DATE_END_F);
		filtersBox.appendChild(CLASS_GNAME_F);
		filtersBox.appendChild(CLASS_CONTRATIST_F);
		filtersBox.appendChild(CLASS_ACTIVITY_F);
		filtersBox.appendChild(CLASS_PROJECT_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		filtersBox.appendChild(button2);
		
		
		
		// TABLE
		var table = tableDraw("wp_classes",["Fecha", "Horario", "Grupo", "Contratista", "Actividad", "Presencial/Virtual", "Institucional/Comunitario", "Barrio/Vereda", "Estado", "Asistentes", "Opciones"]);

		ifaceBox.appendChild(title);
		ifaceBox.appendChild(buttonBox);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		// SET DATE FIELDS
		setDateField("CLASS_DATE_INI_F");
		setDateField("CLASS_DATE_END_F");
		
		titleLine.innerHTML = "Clases";
		
		// document.getElementById("CLASS_DATE_INI_F").value = "2022-03-12";
		// document.getElementById("CLASS_DATE_END_F").value = "2022-03-12";
		// document.getElementById("CLASS_CONTRATIST_F").value = "andrich";
		
		refreshTable("wp_classes");
		
	}
	if(type == "eventsB")
	{
		// TITLE
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear evento";
		button1.onclick = function ()
		{
			eventsMode = 0;
			viewMode = "0";
			citizenOrigin = "ev";
			checkEventGoals();
		}
		buttonBox.appendChild(button1);
		
		var button2 = buttonCreator([12,4,4,2], "Descargar eventos", function(){refreshTable("wp_events", "events")});
		// FILTERS 
		var EVENT_DATE_INI_F = fieldCreator([12,4,4,2], "Fecha inicial", "input", "text", "EVENT_DATE_INI_F");
		var EVENT_DATE_END_F = fieldCreator([12,4,4,2], "Fecha final", "input", "text", "EVENT_DATE_END_F");
		var EVENT_NAME_F = fieldCreator([12,4,4,2], "Nombre evento", "input", "text", "EVENT_NAME_F");
		var EVENT_OWNER_F = fieldCreator([12,4,4,2], "Contratista", "input", "text", "EVENT_OWNER_F");
		var EVENT_ACTIVITY_F = fieldCreator([12,4,4,2], "Actividad", "input", "text", "EVENT_ACTIVITY_F");
		var EVENT_SUPPORT_F = fieldCreator([12,4,4,2], "Nombre apoyo", "input", "text", "EVENT_SUPPORT_F");
		var EVENT_HOOD_F = fieldCreator([12,4,4,2], "Barrio", "input", "text", "EVENT_HOOD_F");
		
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_events")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_events")
		});
		
		filtersBox.appendChild(EVENT_DATE_INI_F);
		filtersBox.appendChild(EVENT_DATE_END_F);
		filtersBox.appendChild(EVENT_NAME_F);
		filtersBox.appendChild(EVENT_OWNER_F);
		filtersBox.appendChild(EVENT_ACTIVITY_F);
		filtersBox.appendChild(EVENT_SUPPORT_F);
		filtersBox.appendChild(EVENT_HOOD_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		filtersBox.appendChild(button2);
		
		// TABLE
		var table = tableDraw("wp_events",["Fecha", "Nombre o propósito de evento", "Nombre contratista", "Apoyos", "Presencial/Virtual", "Institucional/Comunitario", "Barrio o vereda", "Total asistentes", "Opciones"]);

		ifaceBox.appendChild(title);
		
		// ONLY CONTRACT USERS CAN CREATE EVENTS
		if(userData.USER_CONTRACT != "")
		{ifaceBox.appendChild(buttonBox);}
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		titleLine.innerHTML = "Eventos";
		
		// SET DATE FIELDS
		setDateField("EVENT_DATE_INI_F");
		setDateField("EVENT_DATE_END_F");
		
		
		// document.getElementById("EVENT_DATE_INI_F").value = "2021-04-01";
		// document.getElementById("EVENT_DATE_END_F").value = "2021-04-30";
		
		refreshTable("wp_events");
		
	}
	if(type == "eventsRB")
	{
		// TITLE
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear evento por solicitud";
		button1.onclick = function ()
		{
			requestState = "0";
			viewMode = "0";
			eventsMode = 0;
			citizenOrigin = "evr";
			checkEventGoals();
		}
		
		var utype = userData.USER_CTYPE;
		
		console.log(utype)
		
		if(utype == "Principal1" || utype == "Principal2" || utype == "Principal3" || utype == "Superior" ||utype == "Director" || utype == "Coordinador" || utype == "Cogestor")
		{
			console.log("enters")
			buttonBox.appendChild(button1);
		}
		
		var button2 = buttonCreator([12,4,4,2], "Descargar eventos", function(){refreshTable("wp_events_r", "events")});
		// FILTERS 
		var EVENT_DATE_INI_F = fieldCreator([12,4,4,2], "Fecha inicial", "input", "text", "EVENT_DATE_INI_F");
		var EVENT_DATE_END_F = fieldCreator([12,4,4,2], "Fecha final", "input", "text", "EVENT_DATE_END_F");
		var EVENT_RADICATE_F = fieldCreator([12,4,4,2], "Radicado", "input", "text", "EVENT_RADICATE_F");
		var EVENT_NAME_F = fieldCreator([12,4,4,2], "Nombre evento", "input", "text", "EVENT_NAME_F");
		var EVENT_OWNER_F = fieldCreator([12,4,4,2], "Contratista", "input", "text", "EVENT_OWNER_F");
		var EVENT_ACTIVITY_F = fieldCreator([12,4,4,2], "Actividad", "input", "text", "EVENT_ACTIVITY_F");
		var EVENT_SUPPORT_F = fieldCreator([12,4,4,2], "Nombre apoyo", "input", "text", "EVENT_SUPPORT_F");
		var EVENT_HOOD_F = fieldCreator([12,4,4,2], "Barrio", "input", "text", "EVENT_HOOD_F");
		
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_events_r")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_events_r")
		});
		
		filtersBox.appendChild(EVENT_DATE_INI_F);
		filtersBox.appendChild(EVENT_DATE_END_F);
		filtersBox.appendChild(EVENT_RADICATE_F);
		filtersBox.appendChild(EVENT_NAME_F);
		filtersBox.appendChild(EVENT_OWNER_F);
		filtersBox.appendChild(EVENT_ACTIVITY_F);
		filtersBox.appendChild(EVENT_SUPPORT_F);
		filtersBox.appendChild(EVENT_HOOD_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		filtersBox.appendChild(button2);
		
		// TABLE
		var table = tableDraw("wp_events_r",["Fecha solicitud","Fecha ejecución", "Nombre del evento", "Nombre creador solicitud", "Nombre solicitante","Nombre contratista", "Tipo",  "Barrio o vereda",  "Fecha solicitada",  "Apoyo","Asistentes","Estado", "Opciones"]);

		ifaceBox.appendChild(title);
		// ONLY CONTRACT USERS CAN CREATE EVENTS
		ifaceBox.appendChild(buttonBox);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		titleLine.innerHTML = "Eventos por solicitud";
		
		// SET DATE FIELDS
		setDateField("EVENT_DATE_INI_F");
		setDateField("EVENT_DATE_END_F");
		
		refreshTable("wp_events_r");
		
	}
	if(type == "visitsB")
	{
		// TITLE
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Visitas disponibles";
		button1.onclick = function ()
		{loadForm("institute");}
		// buttonBox.appendChild(button1);
		
		var visitData = document.createElement("span");
		visitData.id = "visitData";
		visitData.className = "visitData";
		visitData.innerHTML = "Visitas a realizar en el Día: ";
		buttonBox.appendChild(visitData);
		
		// FILTERS 
		// var GROUP_NAME_F = fieldCreator([12,4,4,2], "Nombre de grupo", "input", "text", "GROUP_NAME_F");
		
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_visitable")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_visitable")
		});
		
		// filtersBox.appendChild(GROUP_NAME_F);
		// filtersBox.appendChild(searchButton);
		// filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_visitable",["Fecha y hora clase", "Datos contratista", "Datos cooperador", "Actividad", "Modalidad", "Nombre del grupo", "Institución", "Dirección o nombre del lugar", "Opciones"]);

		ifaceBox.appendChild(title);
		
		var utype = userData.USER_CTYPE;
		
		ifaceBox.appendChild(buttonBox);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		titleLine.innerHTML = "Clases para visitar";
		
		refreshTable("wp_visitable");
		
	}
	if(type == "visitsDoneB")
	{
		// TITLE
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Visitas disponibles";
		button1.onclick = function ()
		{loadForm("institute");}
		// buttonBox.appendChild(button1);
		
		
		// FILTERS 
		var VISIT_DATE_INI_F = fieldCreator([12,4,4,2], "Fecha inicial", "input", "text", "VISIT_DATE_INI_F");
		var VISIT_DATE_END_F = fieldCreator([12,4,4,2], "Fecha final", "input", "text", "VISIT_DATE_END_F");
		var VISIT_VISITOR_F = fieldCreator([12,4,4,2], "Nombre visitador", "input", "text", "VISIT_VISITOR_F");
		var VISIT_CONTRATIST_F = fieldCreator([12,4,4,2], "Nombre contratista", "input", "text", "VISIT_CONTRATIST_F");
		var VISIT_GNAME_F = fieldCreator([12,4,4,2], "Grupo", "input", "text", "VISIT_GNAME_F");
		var VISIT_HOOD_F = fieldCreator([12,4,4,2], "Barrio", "input", "text", "VISIT_HOOD_F");
		var VISIT_ZONE_F = fieldCreator([12,4,4,2], "Comuna", "input", "text", "VISIT_ZONE_F");
		var VISIT_TYPE_F = fieldCreator([12,4,4,2], "Tipo de visita", "input", "text", "VISIT_TYPE_F");
		var VISIT_ACTIVITY_F = fieldCreator([12,4,4,2], "Actividad", "input", "text", "VISIT_ACTIVITY_F");
		
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_visits")});
		var button2 = buttonCreator([12,4,4,2], "Descargar visitas", function(){refreshTable("wp_visits", "visits")});		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_visits")
		});
		
		filtersBox.appendChild(VISIT_DATE_INI_F);
		filtersBox.appendChild(VISIT_DATE_END_F);
		filtersBox.appendChild(VISIT_VISITOR_F);
		filtersBox.appendChild(VISIT_CONTRATIST_F);
		filtersBox.appendChild(VISIT_GNAME_F);
		filtersBox.appendChild(VISIT_ZONE_F);
		filtersBox.appendChild(VISIT_HOOD_F);
		filtersBox.appendChild(VISIT_TYPE_F);
		filtersBox.appendChild(VISIT_ACTIVITY_F);
		
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		filtersBox.appendChild(button2);
		
		
		// TABLE
		var table = tableDraw("wp_visits",["Fecha y ubicación clase", "Fecha y ubicación visita", "Tipo visita", "Datos contratista", "Datos visitador", "Nombre grupo", "Actividad", "Barrio/Vereda", "Actividad realizada", "Dirección", "Asistentes visita-clase/ totales", "Opciones"]);

		ifaceBox.appendChild(title);
		
		var utype = userData.USER_CTYPE;
		
		ifaceBox.appendChild(buttonBox);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		titleLine.innerHTML = "Visitas realizadas";
		
		// SET DATE FIELDS
		setDateField("VISIT_DATE_INI_F");
		setDateField("VISIT_DATE_END_F");
		
		refreshTable("wp_visits");
		
	}
	if(type == "reportsB")
	{
		
		// TITLE
		titleLine.innerHTML = "Reportes";
		
		
		// FILTERS 
		var REPORT_PICKER = fieldCreator([12,4,4,3], "Seleccionar reporte", "select", "select", "REPORT_PICKER");
		var INIDATE_PICKER = fieldCreator([12,4,4,3], "Fecha inicial", "input", "text", "INIDATE_PICKER");
		var ENDDATE_PICKER = fieldCreator([12,4,4,3], "Fecha final", "input", "text", "ENDDATE_PICKER");
		var searchButton = buttonCreator([12,4,4,3], "Extraer clases", function(){loadReport()});

		filtersBox.appendChild(REPORT_PICKER);
		filtersBox.appendChild(INIDATE_PICKER);
		filtersBox.appendChild(ENDDATE_PICKER);
		filtersBox.appendChild(searchButton);

		var reportsMainBox = document.createElement("div");
		reportsMainBox.className = "row col-xs-12 col-sm-12 col-md-12 col-lg-12 reportsMainBox";
		reportsMainBox.id = "REPORTS_MAIN_BOX";
		

		ifaceBox.appendChild(title);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(reportsMainBox);
		
		// SET DATE FIELDS
		setDateField("INIDATE_PICKER");
		setDateField("ENDDATE_PICKER");
		
		
		// FILL USERTYPES
		var options = ["General"];
		selectFiller("REPORT_PICKER", "Seleccione reporte", options);
		
		reportStart();

	}
	if(type == "mastersB")
	{
		// TITLE
		titleLine.innerHTML = "Maestros";
		
		// FILTERS 
		var MASTERS_F = fieldCreator([12,4,4,2], "Maestros", "select", "select", "MASTERS_F");
		
		// filtersBox.appendChild(MASTERS_F);
		
		var mastersBox = document.createElement("div");
		mastersBox.id = "MASTERS_BOX";
		mastersBox.className = "col-12 mastersBox";
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(MASTERS_F);
		// ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(mastersBox);
		
		
		
		var options = ["Condiciones", "Condición ocupacional", "Convivencia actual","Componente", "Barrios", "Comunas", "Etnias", "Edades", "EPS", "Factores de riesgo", "Factores preventivos", "Formación", "Género", "Ingresos económicos", "Lugares de servicio", "Nivel educativo", "Patología enfermedades", "Razones migración", "Sub-componente", "Tipo de consumo", "Tipo de indígena", "Tipo solicitante", "Tipos de violencia", "Trastornos de desarrollo"];
		selectFiller("MASTERS_F", "Seleccione maestro", options);
		
		document.getElementById("MASTERS_F").onchange = function ()
		{
			console.log(this.value);
			var pick = this.value;
			
			var type = "";
			
			if(pick == "Edades"){type = "etariesB";}
			if(pick == "Condiciones"){type = "conditionsB";}
			if(pick == "Convivencia actual"){type = "convac";}
			if(pick == "Condición ocupacional"){type = "ocucondB";}
			if(pick == "Barrios"){type = "hoodsB";}
			if(pick == "Comunas"){type = "zonesB";}
			if(pick == "Etnias"){type = "etniasB";}
			if(pick == "EPS"){type = "eps";}
			if(pick == "Factores de riesgo"){type = "riskfa";}
			if(pick == "Factores preventivos"){type = "prevfa";}
			if(pick == "Formación"){type = "courses";}
			if(pick == "Género"){type = "genre";}
			if(pick == "Ingresos económicos"){type = "ingrec";}
			if(pick == "Lugares de servicio"){type = "institutesB";}
			if(pick == "Nivel educativo"){type = "edlevelB";}
			if(pick == "Patología enfermedades"){type = "patoen";}
			if(pick == "Razones migración"){type = "migrea";}
			if(pick == "Tipo de consumo"){type = "tipoco";}
			if(pick == "Tipo de indígena"){type = "tipoin";}
			if(pick == "Tipo solicitante"){type = "tiposo";}
			if(pick == "Tipos de violencia"){type = "tipovi";}
			if(pick == "Trastornos de desarrollo"){type = "trasdes";}
			if(pick == "Componente"){type = "component";}
			if(pick == "Sub-componente"){type = "scomponent";}
			
			ifaceBuilderMasters(type);
		}
		
		
		// document.getElementById("MASTERS_F").value = "Componente";
		// document.getElementById("MASTERS_F").onchange();
		
	}
	if(type == "remitionsB")
	{
		// TITLE
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear atención";
		button1.onclick = function ()
		{
			citizenOrigin = "rem";
			loadForm("citizen");
			// loadForm("rem");
		}
		
		var utype = userData.USER_CTYPE;
		
		if(utype != "Superior" && utype != "Principal1" && utype != "Principal2" && utype != "Principal3"){buttonBox.appendChild(button1);}
		
		

		// FILTERS 
		var REM_DATE_F = fieldCreator([12,4,4,2], "Fecha", "input", "text", "REM_DATE_F");
		var REM_AUTOR_F = fieldCreator([12,4,4,2], "Remisor", "input", "text", "REM_AUTOR_F");
		var REM_CITIZEN_F = fieldCreator([12,4,4,2], "Ciudadano", "input", "text", "REM_CITIZEN_F");
		var REM_CONTRATIST_F = fieldCreator([12,4,4,2], "Remitido a", "input", "text", "REM_CONTRATIST_F");
		var REM_ACTIVITY_F = fieldCreator([12,4,4,2], "Actividad", "input", "text", "REM_ACTIVITY_F");
		var REM_STATE_F = fieldCreator([12,4,4,2], "Estado", "select", "select", "REM_STATE_F");
		

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_remitions")});
		var button2 = buttonCreator([12,4,4,2], "Descargar atenciones", function()
		{
			// fastPop("En desarrollo", 2000);
			// return
			refreshTable("wp_remitions", "remitions")
			
		});
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar", function()
		{
			clearFilters();
			refreshTable("wp_remitions")
		});
		
		filtersBox.appendChild(REM_DATE_F);
		filtersBox.appendChild(REM_AUTOR_F);
		filtersBox.appendChild(REM_CITIZEN_F);
		filtersBox.appendChild(REM_CONTRATIST_F);
		filtersBox.appendChild(REM_ACTIVITY_F);
		filtersBox.appendChild(REM_STATE_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		filtersBox.appendChild(button2);
		
		// TABLE
		var table = tableDraw("wp_remitions",["Fecha", "Línea de atención","Remisor", "Ciudadano","Remitido a", "Actividad","Opciones"]);

		ifaceBox.appendChild(title);
		
		var utype = userData.USER_CTYPE;
		
		
		
		
		ifaceBox.appendChild(buttonBox);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		titleLine.innerHTML = "Atenciones";
		
		
		setDateField("REM_DATE_F");
		
		getRemActiContracts();
		
		// FILL USERTYPES
		var options = ["Abierta", "Cerrada"];
		selectFiller("REM_STATE_F", "Seleccione estado", options);
		
		refreshTable("wp_remitions");
		
	}
	if(type == "attendB")
	{
		// TITLE
		
		// console.log(actualRemitionData);
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Añadir comentario";
		button1.onclick = function ()
		{
			actualComment = "normalComment";
			loadForm("remComment");
		}
		if(actualRemitionData.REM_STATE == "0")
		{buttonBox.appendChild(button1);}
		
		
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Agregar a grupo";
		button1.onclick = function ()
		{
			// GET ALL ENTITY GROUPS
			
			var info = {};
			info.ENTITY = userData.USER_ENTITY;
			
			sendAjax("users","getEntityGroups",info,function(response)
			{
				var ans = response.message;
				// console.log(ans);
				groups = ans;
				actualComment = "addGroup";
				loadForm("remComment");
				
			});
			
			
		}
		if(actualRemitionData.REM_STATE == "0")
		{buttonBox.appendChild(button1);}
		
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Sacar de grupo";
		button1.onclick = function ()
		{
			
			var info = {};
			info.ENTITY = userData.USER_ENTITY;
			
			sendAjax("users","getEntityGroups",info,function(response)
			{
				var ans = response.message;
				console.log(ans);
				groups = ans;
				actualComment = "quitGroup";
				loadForm("remComment");
				
			});
		}
		if(actualRemitionData.REM_STATE == "0")
		{buttonBox.appendChild(button1);}
		
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Remitir";
		button1.onclick = function ()
		{
			
			var info = {};
	
			sendAjax("users","getRemActiContracts",info,function(response)
			{
				var ans = response.message;
				// console.log(ans);
				var contracts = ans.active;
				remContratists = ans.contratists;
				
				var remActivities = [];
				
				for(var i=0; i<contracts.length; i++)
				{
					var contract = contracts[i];
					var actis = contract
					
					if(contract.CONTRACT_ACTIVITIES != null && contract.CONTRACT_ACTIVITIES != "")
					{
						actis = JSON.parse(contract.CONTRACT_ACTIVITIES);
						
						for(var a=0; a<actis.length; a++)
						{
							var acti = actis[a];
							if(!remActivities.includes(acti)){remActivities.push(acti);break;}
						}
					}
				}
				
				fixedActis = [];
				
				for(var i=0; i<remActivities.length; i++)
				{
					var fullActi = {};
					var thearray = JSON.stringify([remActivities[i]]);
					var acti = getFriendDescs(thearray,"activities");
					fullActi.ACTIVITY_CODE = remActivities[i];
					fullActi.ACTIVITY_DETAIL = acti;
					if(fullActi.ACTIVITY_DETAIL != ""){fixedActis.push(fullActi)}
				}
				
				setActParents();
				
				actualComment = "remit";
				loadForm("remComment");
				
			});
			
			
			
			
		}
		if(actualRemitionData.REM_STATE == "0")
		{buttonBox.appendChild(button1);}
		
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Citar";
		button1.onclick = function ()
		{
			actualComment = "date";
			loadForm("remComment");
		}
		if(actualRemitionData.REM_STATE == "0")
		{buttonBox.appendChild(button1);}
		
		
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Decisión";
		button1.onclick = function ()
		{
			actualComment = "decition";
			loadForm("remComment");
		}
		if(actualRemitionData.REM_STATE == "0")
		{buttonBox.appendChild(button1);}
		
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Cerrar Atención";
		button1.onclick = function ()
		{
			actualComment = "close";
			loadForm("remComment");
		}
		if(actualRemitionData.REM_STATE == "0")
		{buttonBox.appendChild(button1);}
	
		
		
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Re abrir";
		button1.onclick = function ()
		{
			actualComment = "reopen";
			loadForm("remComment");
		}
		if(actualRemitionData.REM_STATE == "1")
		{buttonBox.appendChild(button1);}

		// FILTERS 
		var REMCOM_MODE_F = fieldCreator([12,4,4,2], "Modo de lista", "select", "select", "REMCOM_MODE_F");
		var REMCOM_START_DATE_F = fieldCreator([12,4,4,2], "Fecha inicio", "input", "text", "REMCOM_START_DATE_F");
		var REMCOM_AUTOR_F = fieldCreator([12,4,4,2], "Remisor", "input", "text", "REMCOM_AUTOR_F");
		var REMCOM_CONTRATIST_F = fieldCreator([12,4,4,2], "Contratista", "input", "text", "REMCOM_CONTRATIST_F");
		var REMCOM_COMMENT_F = fieldCreator([12,4,4,2], "Comentario", "input", "text", "REMCOM_COMMENT_F");
		var REMCOM_STATE_F = fieldCreator([12,4,4,2], "Estado", "select", "select", "REMCOM_STATE_F");
		var REMCOM_SPECIAL_F = fieldCreator([12,4,4,2], "Especial", "select", "select", "REMCOM_SPECIAL_F");
		var REMCOM_TYPE_F = fieldCreator([12,4,4,2], "Tipo comentario", "select", "select", "REMCOM_TYPE_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_attend")});
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar", function()
		{
			clearFilters();
			refreshTable("wp_attend")
		});
		
		filtersBox.appendChild(REMCOM_MODE_F);
		filtersBox.appendChild(REMCOM_START_DATE_F);
		filtersBox.appendChild(REMCOM_AUTOR_F);
		filtersBox.appendChild(REMCOM_CONTRATIST_F);
		filtersBox.appendChild(REMCOM_COMMENT_F);
		filtersBox.appendChild(REMCOM_STATE_F);
		filtersBox.appendChild(REMCOM_SPECIAL_F);
		filtersBox.appendChild(REMCOM_TYPE_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		// filtersBox.appendChild(button2);
		
		// TABLE
		var table = tableDraw("wp_attend",["Línea de atención", "Actividad","Remisor", "Contratista", "Comentario", "Especial", "Grupo", "Remitido a", "Nueva actividad", "Estado actividad","Adjunto"]);

		ifaceBox.appendChild(title);
		
		var utype = userData.USER_CTYPE;

		ifaceBox.appendChild(buttonBox);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		// console.log(actualRemitionData);
		
		actualCitizenData = actualRemitionData.REM_CITIZEN_NAME+" Id."+actualRemitionData.REM_CITIZEN;
		
		actualRequesterData = actualRemitionData.REM_REQUESTER_NAME+" Id."+actualRemitionData.REM_REQUESTER;
		
		titleLine.innerHTML = "Atención "+actualRemitionData.REM_LINE+"<br>Usuario atendido:"+actualCitizenData+"<span onclick='loadCitRem()' class='loadCitRem'> Detalles ciudadano</span><br>Usuario que solicitó: "+actualRequesterData+"<span onclick='loadReqRem()' class='loadCitRem'> Detalles ciudadano</span><br>";
		
		
		setDateField("REMCOM_START_DATE_F");
		
		getRemActiContracts();
		
		var options = ["Línea de atención", "Mi atención", "Todo el historial"];
		selectFiller("REMCOM_MODE_F", "Seleccione modo de lista", options);
		
		var options = ["Si", "No"];
		selectFiller("REMCOM_SPECIAL_F", "Seleccione opción", options);
		
		var options = ["Abierta", "Cerrada"];
		selectFiller("REMCOM_STATE_F", "Seleccione estado", options);
		
		var options = ["Normal", "Agrupación", "Desagrupación", "Atención", "Cita", "Cierre", "Decisión", "Re apertura"];
		selectFiller("REMCOM_TYPE_F", "Seleccione tipo", options);
		
		document.getElementById("REMCOM_MODE_F").value = "Línea de atención";
		
		refreshTable("wp_attend");
		
	}
	if(type == "agendaB")
	{
		// TITLE
		
		
		// FILTERS 
		var DATE_CONTRATIST_F = fieldCreator([12,4,4,2], "Contratista", "input", "text", "DATE_CONTRATIST_F");
		var DATE_INIDATE_F = fieldCreator([12,4,4,2], "Fecha inicio", "input", "text", "DATE_INIDATE_F");
		var DATE_ENDATE_F = fieldCreator([12,4,4,2], "Fecha fin", "input", "text", "DATE_ENDATE_F");
		
		
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_dates")});
		var button2 = buttonCreator([12,4,4,2], "Descargar citas", function(){refreshTable("wp_dates", "dates")});
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar", function()
		{
			clearFilters();
			refreshTable("wp_dates")
		});
		
		filtersBox.appendChild(DATE_CONTRATIST_F);
		filtersBox.appendChild(DATE_INIDATE_F);
		filtersBox.appendChild(DATE_ENDATE_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		filtersBox.appendChild(button2);
		
		// TABLE
		var table = tableDraw("wp_dates",["Prioridad","Línea", "Contratista", "Ciudadano", "Fecha/Hora", "Lugar","Comentario","Opciones"]);
		
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		titleLine.innerHTML = "Agenda";
		
		
		// SET DATE FIELDS
		setDateField("DATE_INIDATE_F");
		setDateField("DATE_ENDATE_F");
		
		refreshTable("wp_dates");
		
		return
	}
}

function loadCitRem()
{
	citizenOrigin = "loadCitRem";
	var id = actualCitizenData.split(".")[1];
	loadForm("citizen");
	document.getElementById("CITIZEN_IDNUM").value = id;
	document.getElementById("CITIZEN_IDNUM").onblur();
}

function loadReqRem()
{
	citizenOrigin = "loadReqRem";
	var id = actualRequesterData.split(".")[1];
	loadForm("citizen");
	document.getElementById("CITIZEN_IDNUM").value = id;
	document.getElementById("CITIZEN_IDNUM").onblur();
}

function ifaceBuilderMasters(type)
{
	
	console.log("");
	var ifaceBox = document.getElementById("MASTERS_BOX");
	ifaceBox.innerHTML = "";
	
	var title = document.createElement("div");
	title.className = "col-12";
	var titleLine = document.createElement("span");
	titleLine.className = "ifTitle";
	
	var buttonBox = document.createElement("div");
	buttonBox.className = "row ifaceButtonsBox";
	
	var filtersBox = document.createElement("div");
	filtersBox.id = "filtersBox";
	filtersBox.innerHTML = "";
	filtersBox.className = "row filtersBox";
	
	// ETARIES
	if(type == "etariesB")
	{
		// TITLE
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear rango";
		button1.onclick = function ()
		{loadForm("etarie");}
		buttonBox.appendChild(button1);

		// FILTERS 
		var ETARIE_ENTITY_F = fieldCreator([12,4,4,2], "Entidad", "input", "text", "ETARIE_ENTITY_F");
		
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_etaries")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_etaries")
		});
		
		filtersBox.appendChild(ETARIE_ENTITY_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_etaries",["Entidad", "Nombre rango de edad", "Desde", "Hasta", "Opciones"]);

		ifaceBox.appendChild(title);
		
		var utype = userData.USER_CTYPE;
		
		if(utype == "Superior" || utype == "Principal3")
		{ifaceBox.appendChild(buttonBox);}
		
		
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		titleLine.innerHTML = "Ciclos etarios";
		
		refreshTable("wp_etaries");
		
	}
	
	if(type == "conditionsB")
	{
		// TITLE
		titleLine.innerHTML = "Condiciones";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear Condición";
		button1.onclick = function ()
		{loadForm("condition");}
		
		
		// FILTERS 
		var CONDITION_NAME_F = fieldCreator([12,4,4,2], "Condición", "input", "text", "CONDITION_NAME_F");
		
		

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_conditions")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_conditions")
		});
		
		filtersBox.appendChild(CONDITION_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		
		
		
		
		// TABLE
		var table = tableDraw("wp_conditions",["Condición", "Opciones"]);
		
		
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_conditions");
	}
	
	if(type == "etniasB")
	{
		// TITLE
		titleLine.innerHTML = "Etnias";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear etnia";
		button1.onclick = function ()
		{loadForm("etnia");}
		
		
		// FILTERS 
		var ETNIA_NAME_F = fieldCreator([12,4,4,2], "Etnia", "input", "text", "ETNIA_NAME_F");
		
		

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_etnias")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_etnias")
		});
		
		filtersBox.appendChild(ETNIA_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		
		
		// TABLE
		var table = tableDraw("wp_etnias",["Etnia", "Opciones"]);
		
		
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_etnias");
	}
	
	// UNIMASTERS
	if(type == "edlevelB")
	{
		// TITLE
		titleLine.innerHTML = "Nivel educativo";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear nivel educativo";
		button1.onclick = function ()
		{loadForm("edlevel");}

		// FILTERS 
		var EDLEVEL_NAME_F = fieldCreator([12,4,4,2], "Nivel educativo", "input", "text", "EDLEVEL_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_edlevel")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_edlevel")
		});
		
		filtersBox.appendChild(EDLEVEL_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_master_edlevel",["Nivel educativo", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_edlevel");
	}
	
	if(type == "ocucondB")
	{
		// TITLE
		titleLine.innerHTML = "Condición Ocupacional";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear condición ocupacional";
		button1.onclick = function ()
		{loadForm("ocucond");}

		// FILTERS 
		var OCUCOND_NAME_F = fieldCreator([12,4,4,2], "Condición Ocupacional", "input", "text", "OCUCOND_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_ocucond")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_ocucond")
		});
		
		filtersBox.appendChild(OCUCOND_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_master_ocucond",["Condición Ocupacional", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_ocucond");
	}
	
	if(type == "trasdes")
	{
		// TITLE
		titleLine.innerHTML = "Trastornos de Desarrollo";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear trastornos de desarrollo";
		button1.onclick = function ()
		{loadForm("trasdes");}

		// FILTERS 
		var OCUCOND_NAME_F = fieldCreator([12,4,4,2], "Trastornos de Desarrollo", "input", "text", "OCUCOND_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_trasdes")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_trasdes")
		});
		
		filtersBox.appendChild(OCUCOND_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_master_trasdes",["Trastorno de Desarrollo", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_trasdes");
	}
	
	if(type == "tipovi")
	{
		// TITLE
		titleLine.innerHTML = "Tipos de Violencia";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear Tipo de Violencia";
		button1.onclick = function ()
		{loadForm("tipovi");}

		// FILTERS 
		var OCUCOND_NAME_F = fieldCreator([12,4,4,2], "Tipos de Violencia", "input", "text", "OCUCOND_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_tipovi")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_tipovi")
		});
		
		filtersBox.appendChild(OCUCOND_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_master_tipovi",["Tipo de Violencia", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_tipovi");
	}
	
	if(type == "genre")
	{
		// TITLE
		titleLine.innerHTML = "Género";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear género";
		button1.onclick = function ()
		{loadForm("genre");}

		// FILTERS 
		var GENRE_NAME_F = fieldCreator([12,4,4,2], "Género", "input", "text", "GENRE_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_genre")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_genre")
		});
		
		filtersBox.appendChild(GENRE_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_master_genre",["Género", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_genre");
	}
	
	if(type == "eps")
	{
		// TITLE
		titleLine.innerHTML = "EPS";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear EPS";
		button1.onclick = function ()
		{loadForm("eps");}

		// FILTERS 
		var EPS_NAME_F = fieldCreator([12,4,4,2], "EPS", "input", "text", "EPS_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_eps")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_eps")
		});
		
		filtersBox.appendChild(EPS_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_master_eps",["EPS", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_eps");
	}
	
	if(type == "riskfa")
	{
		// TITLE
		titleLine.innerHTML = "Factores de riesgo";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear Factor de riesgo";
		button1.onclick = function ()
		{loadForm("riskfa");}

		// FILTERS 
		var RISKFA_NAME_F = fieldCreator([12,4,4,2], "Factor de riesgo", "input", "text", "RISKFA_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_riskfa")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_riskfa")
		});
		
		filtersBox.appendChild(RISKFA_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_master_riskfa",["Factor de riesgo", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_riskfa");
	}
	
	if(type == "prevfa")
	{
		// TITLE
		titleLine.innerHTML = "Factores preventivos";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear Factor preventivo";
		button1.onclick = function ()
		{loadForm("prevfa");}

		// FILTERS 
		var PREVFA_NAME_F = fieldCreator([12,4,4,2], "Factor preventivo", "input", "text", "PREVFA_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_prevfa")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_prevfa")
		});
		
		filtersBox.appendChild(PREVFA_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_master_prevfa",["Factor preventivo", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_prevfa");
	}
	
	if(type == "ingrec")
	{
		// TITLE
		titleLine.innerHTML = "Factores preventivos";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear Ingreso Económico";
		button1.onclick = function ()
		{loadForm("ingrec");}

		// FILTERS 
		var INGREC_NAME_F = fieldCreator([12,4,4,2], "Ingreso Económico", "input", "text", "INGREC_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_ingrec")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_ingrec")
		});
		
		filtersBox.appendChild(INGREC_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_master_ingrec",["Ingreso Económico", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_ingrec");
	}
	
	if(type == "convac")
	{
		// TITLE
		titleLine.innerHTML = "Convivencia actual";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear Convivencia actual";
		button1.onclick = function ()
		{loadForm("convac");}

		// FILTERS 
		var CONVAC_NAME_F = fieldCreator([12,4,4,2], "Convivencia actual", "input", "text", "CONVAC");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_convac")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_convac")
		});
		
		filtersBox.appendChild(CONVAC_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_master_convac",["Convivencia actual", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_convac");
	}
	
	if(type == "patoen")
	{
		// TITLE
		titleLine.innerHTML = "Patología enfermedades";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear Patología enfermedad";
		button1.onclick = function ()
		{loadForm("patoen");}

		// FILTERS 
		var PATOEN_NAME_F = fieldCreator([12,4,4,2], "Patología enfermedad", "input", "text", "PATOEN_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_patoen")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_patoen")
		});
		
		filtersBox.appendChild(PATOEN_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_master_patoen",["Patología enfermedad", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_patoen");
	}
	
	if(type == "courses")
	{
		// TITLE
		titleLine.innerHTML = "Formación";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear Formación";
		button1.onclick = function ()
		{loadForm("courses");}

		// FILTERS 
		var COURSES_NAME_F = fieldCreator([12,4,4,2], "Formación", "input", "text", "COURSES_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_courses")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_courses")
		});
		
		filtersBox.appendChild(COURSES_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_master_courses",["Formación", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_courses");
	}
	
	if(type == "tipoco")
	{
		// TITLE
		titleLine.innerHTML = "Tipo de consumo";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear tipo de consumo";
		button1.onclick = function ()
		{loadForm("tipoco");}

		// FILTERS 
		var TIPOCO_NAME_F = fieldCreator([12,4,4,2], "Tipo de consumo", "input", "text", "TIPOCO_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_tipoco")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_tipoco")
		});
		
		filtersBox.appendChild(TIPOCO_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		
		// TABLE
		var table = tableDraw("wp_master_tipoco",["Tipo de consumo", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_tipoco");
	}
	
	if(type == "tiposo")
	{
		// TITLE
		titleLine.innerHTML = "Tipo de solicitante";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear tipo de solicitante";
		button1.onclick = function ()
		{loadForm("tiposo");}

		// FILTERS 
		var TIPOSO_NAME_F = fieldCreator([12,4,4,2], "Tipo de solicitante", "input", "text", "TIPOSO_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_tiposo")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_tiposo");
		});
		
		filtersBox.appendChild(TIPOSO_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		
		// TABLE
		var table = tableDraw("wp_master_tiposo",["Tipo de solicitante", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_tiposo");
	}
	
	if(type == "migrea")
	{
		// TITLE
		titleLine.innerHTML = "Razones de migración";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear razón de migración";
		button1.onclick = function ()
		{loadForm("migrea");}

		// FILTERS 
		var MIGREA_NAME_F = fieldCreator([12,4,4,2], "Razones de migración", "input", "text", "MIGREA_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_migrea")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_migrea");
		});
		
		filtersBox.appendChild(MIGREA_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		
		// TABLE
		var table = tableDraw("wp_master_migrea",["Razones de migración", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_migrea");
	}
	
	if(type == "tipoin")
	{
		// TITLE
		titleLine.innerHTML = "Tipos de indígena";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear Tipo de indígena";
		button1.onclick = function ()
		{loadForm("tipoin");}

		// FILTERS 
		var TIPOIN_NAME_F = fieldCreator([12,4,4,2], "Tipo de indígena", "input", "text", "TIPOIN_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_tipoin")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_tipoin");
		});
		
		filtersBox.appendChild(TIPOIN_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		
		// TABLE
		var table = tableDraw("wp_master_tipoin",["Tipo de indígena", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_tipoin");
	}
	
	if(type == "institutesB")
	{
		// TITLE
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear Lugar de servicio";
		button1.onclick = function ()
		{loadForm("institute");}
		buttonBox.appendChild(button1);
		
		
		
		// FILE BOX
		
		var loadFile = document.createElement("span");
		loadFile.id = "loadCsvLink";
		// loadFile.className = "loadFileLink";
		loadFile.className = "loadFileLinkCsv";
		loadFile.innerHTML = "Cargar csv";
		loadFile.onclick = function ()
		{
			actualFileOrigin = "csv";
			document.getElementById("fileSelectorfile").click();
		}
		buttonBox.appendChild(loadFile);
		
		

		// FILTERS 
		var INSTITUTE_NAME_F = fieldCreator([12,4,4,2], "Institución", "input", "text", "INSTITUTE_NAME_F");
		
		var INSTITUTE_CITY_F = fieldCreator([12,4,4,2], "Ciudad", "input", "text", "INSTITUTE_CITY_F");
		
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_institutes")});
		var button2 = buttonCreator([12,4,4,2], "Descargar lugares", function(){refreshTable("wp_institutes", "institutes")});
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_institutes")
		});
		
		
		filtersBox.appendChild(INSTITUTE_NAME_F);
		filtersBox.appendChild(INSTITUTE_CITY_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		filtersBox.appendChild(button2);
		
		
		// TABLE
		var table = tableDraw("wp_institutes",["Lugar de servicio", "Ciudad", "Comuna/Corregimiento", "Barrio/Vereda", "Dirección", "Coordenada", "Opciones"]);

		ifaceBox.appendChild(title);
		
		var utype = userData.USER_CTYPE;
		
		ifaceBox.appendChild(buttonBox);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		titleLine.innerHTML = "Lugares de servicio";
		
		refreshTable("wp_institutes");
		
	}
	
	if(type == "zonesB")
	{
		// TITLE
		titleLine.innerHTML = "Comunas o corregimientos";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear comuna o corregimiento";
		button1.onclick = function ()
		{loadForm("zone");}
		
		
		// FILTERS 
		var ZONE_CITY_F = fieldCreator([12,4,4,2], "Ciudad", "input", "text", "ZONE_CITY_F");
		
		var ZONE_TYPE_F = fieldCreator([12,4,4,2], "Tipo", "input", "text", "ZONE_TYPE_F");
		
		var ZONE_NAME_F = fieldCreator([12,4,4,2], "Comuna/Corregimiento", "input", "text", "ZONE_NAME_F");
		
		
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_zones")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_zones")
		});
		
		filtersBox.appendChild(ZONE_CITY_F);
		filtersBox.appendChild(ZONE_TYPE_F);
		filtersBox.appendChild(ZONE_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		
		// TABLE
		var table = tableDraw("wp_zones",["Ciudad","Tipo de comunidad","Comuna/Corregimiento", "Opciones"]);
		
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_zones");
	}
	
	if(type == "hoodsB")
	{
		// TITLE
		titleLine.innerHTML = "Barrios o veredas";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear barrio o vereda";
		button1.onclick = function ()
		{loadForm("hood");}
		
		
		
		// FILTERS 
		var HOOD_CITY_F = fieldCreator([12,4,4,2], "Ciudad", "input", "text", "HOOD_CITY_F");
		
		var HOOD_ZONE_F = fieldCreator([12,4,4,2], "Comuna/Corregimiento", "input", "text", "HOOD_ZONE_F");
		
		var HOOD_ZONE_TYPE_F = fieldCreator([12,4,4,2], "Tipo sector", "input", "text", "HOOD_ZONE_TYPE_F");
		
		var HOOD_NAME_F = fieldCreator([12,4,4,2], "Barrio/Vereda", "input", "text", "HOOD_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_hoods")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_hoods")
		});
		
		filtersBox.appendChild(HOOD_CITY_F);
		filtersBox.appendChild(HOOD_ZONE_F);
		filtersBox.appendChild(HOOD_ZONE_TYPE_F);
		filtersBox.appendChild(HOOD_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		
		
		// TABLE
		var table = tableDraw("wp_hoods",["Ciudad","Comuna o corregimiento","Tipo de sector","Barrio/Vereda", "Opciones"]);
		
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_hoods");
	}
	
	if(type == "component")
	{
		// TITLE
		titleLine.innerHTML = "Componentes";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear Componente";
		button1.onclick = function ()
		{loadForm("component");}
		
		// FILTERS 
		var COMPONENT_NAME_F = fieldCreator([12,4,4,2], "Componente", "input", "text", "COMPONENT_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_component")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_component");
		});
		
		filtersBox.appendChild(COMPONENT_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_master_component",["Componente","Actividades", "Opciones"]);
		
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_component");
	}
	
	if(type == "scomponent")
	{
		// TITLE
		titleLine.innerHTML = "Sub Componentes";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Crear Sub Componente";
		button1.onclick = function ()
		{
			
			var info = {};
			
			sendAjax("users","getComponents",info,function(response)
			{
				var ans = response.message;
				console.log(ans);
				components = ans;
				loadForm("scomponent");
				
			});
		}
		
		// FILTERS 
		var SCOMPONENT_NAME_F = fieldCreator([12,4,4,2], "Sub Componente", "input", "text", "SCOMPONENT_NAME_F");

		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("wp_master_scomponent")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("wp_master_scomponent");
		});
		
		filtersBox.appendChild(SCOMPONENT_NAME_F);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("wp_master_scomponent",["Sub Componente","Componente", "Opciones"]);
		
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(button1);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("wp_master_scomponent");
	}
}

function loadCsv(type)
{
	var info = {}
	info.csv = actualCsvFile;
	info.type = type;
	
	console.log(info);
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","loadCsv",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans);
		
		fastPop("Tabla actualizada", 2000);
		
		refreshTable("wp_institutes");
		
		setTimeout(function(){document.getElementById("loadCsvLink").innerHTML = "Cargar csv";}, 500);
		
		
		
		
		
	});
}

function loadReport()
{
	actualReportIf = document.getElementById("REPORT_PICKER").value;
	var inidate = document.getElementById("INIDATE_PICKER").value;
	var endate = document.getElementById("ENDDATE_PICKER").value;
	
	if(document.getElementById("REPORT_PICKER").value == "")
	{fastPop("Debe seleccionar el tipo de reporte", 2000);return;}

	if(document.getElementById("INIDATE_PICKER").value == "")
	{fastPop("Debe seleccionar una fecha inicial", 2000);return;}

	if(document.getElementById("ENDDATE_PICKER").value == "")
	{fastPop("Debe seleccionar una fecha final", 2000);return;}
	
	// RESET FULL DB FROM DB -----
	rPrograms = actualDB.programs; //filtered
	rContratists = actualDB.contratists; //filtered
	rContract = actualDB.contracts; //filtered
	rProjects = actualDB.projects; //filtered
	rActivities = actualDB.activities; //filtered
	rGenders = arrayFixer(genders, "GENDER_CODE", "GENDER_NAME"); //filtered
	rEtnia = actualDB.etnias; //filtered
	rInstcom = arrayFixer(instcom, "INSTCOM_CODE", "INSTCOM_NAME"); //filtered
	rPrevir = arrayFixer(previr, "PREVIR_CODE", "PREVIR_NAME"); //filtered
	rZones = actualDB.zones; //filtered
	rHoods = actualDB.hoods; //filtered
	rGroups = actualDB.groups; //filtered
	rCitizens = actualDB.citizens; //filtered
	rUrbral = arrayFixer(urbral, "URBRAL_CODE", "URBRAL_NAME"); //filtered
	rEtaries = actualDB.etaries; //filtered
	rConditions = actualDB.conditions; //filtered
	rEvents = actualDB.events; //filtered
	rVisits = actualDB.visits; //filtered
	
	var info = {};
	
	info.INIDATE = inidate;
	info.ENDATE = endate;
	info.ENTITY = userData.USER_ENTITY;
	info.ADMIN = userData.USER_TYPE;
	
	console.log(info);
	
	
	
	loadManager(1);
	
	sendAjax("users","getClassBlock",info,function(response)
	{
		var ans = response.message;
		console.log(ans);

		var reportsBox = document.getElementById("REPORTS_MAIN_BOX");
		reportsBox.innerHTML = "";

		if(actualReportIf == "General")
		{
			actualClasses = ans.classes;
			actualExcused = ans.excused;
			
			graFilters = arrayFixer(generalGraFilters, "GRAFILTER_CODE", "GRAFILTER_NAME"); 
			
			// FILTER MAIN TABLES TO INCLUDED IN CLASSES BLOCK
			filteredDB("General", actualClasses);

			// GENERAL FILTERS CREATE
			var G_TYPE = fieldCreator([12,4,4,12], "Tipo de reporte", "select", "select", "G_TYPE");
			reportsBox.appendChild(G_TYPE);
			
			var PERCENT_PICKER = fieldCreator([12,4,4,6], "% Asistencia", "input", "number", "PERCENT_PICKER");
			reportsBox.appendChild(PERCENT_PICKER);
			
			var MONTHS_PICKER = fieldCreator([12,4,4,6], "Meses de continuidad", "input", "number", "MONTHS_PICKER");
			reportsBox.appendChild(MONTHS_PICKER);
			
			var subfiltersBox = document.createElement("div");
			subfiltersBox.className = "row col-xs-12 col-sm-12 col-md-12 col-lg-12 subfiltersBox ";
			subfiltersBox.id = "SUB_FILTERS_MAIN_BOX";
			
			// TABLE
			var sheeTable = tableDraw("wp_report_sheet_general",["Dato", "Detalle"]);
			
			var reportSheet = document.createElement("div");
			reportSheet.className = "col-12 reportSheet";
			reportSheet.id = "SHEET_BOX";
			reportSheet.appendChild(sheeTable);
			
			reportsBox.appendChild(subfiltersBox);
			reportsBox.appendChild(reportSheet);
			
			var GFILTERS_PICKER = fieldCreator([12,4,4,2], "Filtros gráfico", "multiselect", "select", "GFILTERS_PICKER");
			
			
			
			var GENERAL_CHART = fieldCreator([12,4,4,10], "", "chartBox", "chartBox", "GENERAL_CHART");
			
			reportsBox.appendChild(GFILTERS_PICKER);
			reportsBox.appendChild(GENERAL_CHART);
			
			// TABLE
			var totalsTable = tableDraw("wp_report_indicators",["", "", "", ""]);
			
			var totalSheet = document.createElement("div");
			totalSheet.className = "col-12 reportSheet";
			totalSheet.id = "TOTAL_SHEET_BOX";
			totalSheet.appendChild(totalsTable);
			
			reportsBox.appendChild(totalSheet);
			
			// TABLE
			var totalsTableAssist = tableDraw("wp_report_Assist_Detail",["Contratista", "Clases dictadas", "Clases no dictadas", "Clases con Excusa"]);
			
			var totalSheetA = document.createElement("div");
			totalSheetA.className = "col-12 reportSheet";
			totalSheetA.id = "TOTAL_ASSIST_BOX";
			totalSheetA.appendChild(totalsTableAssist);
			
			reportsBox.appendChild(totalSheetA);
			
			
			// TABLE
			var totalsTableEvents = tableDraw("wp_report_Events_Detail",["Contratista", "Total eventos", "Eventos internos", "Eventos por solicitud", "Eventos dirigidos", "Eventos apoyados", "Total servicios"]);
			
			var totalSheetB = document.createElement("div");
			totalSheetB.className = "col-12 reportSheet";
			totalSheetB.id = "TOTAL_EVENT_BOX";
			totalSheetB.appendChild(totalsTableEvents);
			
			reportsBox.appendChild(totalSheetB);
			
			
			// console.log(reportsBox);
			
			document.getElementById("GFILTERS_PICKER").className = "chartBoxControls";
			
			// FILL USERTYPES
			var options = ["Programas", "Proyectos", "Contratistas", "Contratos", "Grupos", "Ciudadano"];
			selectFiller("G_TYPE", "Seleccione tipo de reporte", options);
			
			document.getElementById("G_TYPE").onchange = function ()
			{
				console.log(this.value);
				
				var pick = this.value;
				
				var subfiltersBox = document.getElementById("SUB_FILTERS_MAIN_BOX");
				subfiltersBox.innerHTML = "";
				
				
				if(this.value == ""){return;}
				
				
				// --------
				var PROGRAMS_PICKER = fieldCreator([12,4,4,3], "Programas", "multiselect", "select", "PROGRAMS_PICKER");
				var PROJECT_PICKER = fieldCreator([12,4,4,3], "Proyectos", "multiselect", "select", "PROJECT_PICKER");
				var ACTIVITY_PICKER = fieldCreator([12,4,4,3], "Actividades", "multiselect", "select", "ACTIVITY_PICKER");
				var ETARIES_PICKER = fieldCreator([12,4,4,3], "Rangos de edad", "multiselect", "select", "ETARIES_PICKER");
				var CONDITIONS_PICKER = fieldCreator([12,4,4,3], "Condiciones", "multiselect", "select", "CONDITIONS_PICKER");
				var GENDER_PICKER = fieldCreator([12,4,4,3], "Genero", "multiselect", "select", "GENDER_PICKER");
				var ETNIA_PICKER = fieldCreator([12,4,4,3], "Etnia", "multiselect", "select", "ETNIA_PICKER");
				var INSTCOM_PICKER = fieldCreator([12,4,4,3], "Institucional/Comunitario", "multiselect", "select", "INSTCOM_PICKER");
				var PREVIR_PICKER = fieldCreator([12,4,4,3], "Presencial/Virtual", "multiselect", "select", "PREVIR_PICKER");
				var URBRAL_PICKER = fieldCreator([12,4,4,4], "Urbano/Rural", "multiselect", "select", "URBRAL_PICKER");
				var ZONE_PICKER = fieldCreator([12,4,4,4], "Comuna/Corregimiento", "multiselect", "select", "ZONE_PICKER");
				var HOOD_PICKER = fieldCreator([12,4,4,4], "Barrio/Vereda", "multiselect", "select", "HOOD_PICKER");
				var CONTRATISTS_PICKER = fieldCreator([12,4,4,3], "Contratistas", "multiselect", "select", "CONTRATISTS_PICKER");
				var CONTRACT_PICKER = fieldCreator([12,4,4,3], "Contrato", "multiselect", "select", "CONTRACT_PICKER");
				var GROUP_PICKER = fieldCreator([12,4,4,3], "Grupos", "multiselect", "select", "GROUP_PICKER");
				var CITIZEN_PICKER = fieldCreator([12,4,4,3], "Ciudadanos", "multiselect", "select", "CITIZEN_PICKER");
				
				mainActualFilters = ["PROGRAMS_PICKER", "PROJECT_PICKER", "ACTIVITY_PICKER", "ETARIES_PICKER", "CONDITIONS_PICKER", "GENDER_PICKER", "ETNIA_PICKER", "INSTCOM_PICKER", "PREVIR_PICKER", "URBRAL_PICKER", "ZONE_PICKER", "HOOD_PICKER", "CONTRATISTS_PICKER", "CONTRACT_PICKER", "GROUP_PICKER", "CITIZEN_PICKER", "GFILTERS_PICKER"];
				// ---------
				
				
				
				
				if(pick == "Programas")
				{
					var filters = [PERCENT_PICKER, MONTHS_PICKER, PROGRAMS_PICKER, ACTIVITY_PICKER, ETARIES_PICKER, CONDITIONS_PICKER, GENDER_PICKER, ETNIA_PICKER, INSTCOM_PICKER, PREVIR_PICKER, URBRAL_PICKER, ZONE_PICKER, HOOD_PICKER];
				}
				else if(pick == "Proyectos")
				{
					var filters = [PERCENT_PICKER, MONTHS_PICKER, PROJECT_PICKER, ACTIVITY_PICKER, ETARIES_PICKER, CONDITIONS_PICKER, GENDER_PICKER, ETNIA_PICKER, INSTCOM_PICKER, PREVIR_PICKER, URBRAL_PICKER, ZONE_PICKER, HOOD_PICKER];
				}
				else if(pick == "Contratistas")
				{
					var filters = [PERCENT_PICKER, MONTHS_PICKER, CONTRATISTS_PICKER, ACTIVITY_PICKER, ETARIES_PICKER, CONDITIONS_PICKER, GENDER_PICKER, ETNIA_PICKER, INSTCOM_PICKER, PREVIR_PICKER, URBRAL_PICKER, ZONE_PICKER, HOOD_PICKER];
				}
				else if(pick == "Contratos")
				{
					var filters = [PERCENT_PICKER, MONTHS_PICKER, CONTRACT_PICKER, ACTIVITY_PICKER, ETARIES_PICKER, CONDITIONS_PICKER, GENDER_PICKER, ETNIA_PICKER, INSTCOM_PICKER, PREVIR_PICKER, URBRAL_PICKER, ZONE_PICKER, HOOD_PICKER];
				}
				else if(pick == "Grupos")
				{
					var filters = [PERCENT_PICKER, MONTHS_PICKER, GROUP_PICKER, ACTIVITY_PICKER, ETARIES_PICKER, CONDITIONS_PICKER, GENDER_PICKER, ETNIA_PICKER, INSTCOM_PICKER, PREVIR_PICKER, URBRAL_PICKER, ZONE_PICKER, HOOD_PICKER];
				}
				else if(pick == "Ciudadano")
				{
					var filters = [CITIZEN_PICKER, ACTIVITY_PICKER, INSTCOM_PICKER, PREVIR_PICKER, URBRAL_PICKER, ZONE_PICKER, HOOD_PICKER];
				}
				
				// ADD FILTERS
				for(var i=0; i<filters.length; i++)
				{subfiltersBox.appendChild(filters[i]);}
				
				// FILL FILTERS IF ADDED
				for(var i=0; i<mainActualFilters.length; i++)
				{
					var item = mainActualFilters[i];
					
					if(item == "PROGRAMS_PICKER"){var field1 = "PROGRAM_CODE";var field2 = "PROGRAM_NAME";var filist = rPrograms;}
					if(item == "PROJECT_PICKER"){var field1 = "PROJECT_CODE";var field2 = "PROJECT_NAME";var filist = rProjects;}
					if(item == "ACTIVITY_PICKER"){var field1 = "ACTIVITY_CODE";var field2 = "ACTIVITY_NAME";var filist = rActivities;}
					if(item == "ETARIES_PICKER"){var field1 = "ETARIE_CODE";var field2 = "ETARIE_NAME";var filist = rEtaries;}
					if(item == "CONDITIONS_PICKER"){var field1 = "CONDITION_CODE";var field2 = "CONDITION_NAME";var filist = rConditions;}
					if(item == "GENDER_PICKER"){var field1 = "GENDER_CODE";var field2 = "GENDER_NAME";var filist = rGenders;}
					if(item == "ETNIA_PICKER"){var field1 = "ETNIA_CODE";var field2 = "ETNIA_NAME";var filist = rEtnia;}
					if(item == "INSTCOM_PICKER"){var field1 = "INSTCOM_CODE";var field2 = "INSTCOM_NAME";var filist = rInstcom;}
					if(item == "PREVIR_PICKER"){var field1 = "PREVIR_CODE";var field2 = "PREVIR_NAME";var filist = rPrevir;}
					if(item == "URBRAL_PICKER"){var field1 = "URBRAL_CODE";var field2 = "URBRAL_NAME";var filist = rUrbral;}
					if(item == "ZONE_PICKER"){var field1 = "ZONE_CODE";var field2 = "ZONE_NAME";var filist = rZones;}
					if(item == "HOOD_PICKER"){var field1 = "HOOD_CODE";var field2 = "HOOD_NAME";var filist = rHoods;}
					if(item == "CONTRATISTS_PICKER"){var field1 = "USER_CODE";var field2 = "USER_FULL_NAME";var filist = rContratists;}
					if(item == "CONTRACT_PICKER"){var field1 = "CONTRACT_CODE";var field2 = "CONTRACT_NUMBER";var filist = rContract;}
					if(item == "GROUP_PICKER"){var field1 = "GROUP_CODE";var field2 = "GROUP_NAME";var filist = rGroups;}
					if(item == "CITIZEN_PICKER"){var field1 = "CITIZEN_IDNUM";var field2 = "CITIZEN_FULL_NAME";var filist = rCitizens;}
					if(item == "GFILTERS_PICKER"){var field1 = "GRAFILTER_CODE";var field2 = "GRAFILTER_NAME";var filist = graFilters;}
					
					
					if(document.getElementById(item))
					{multiSelectFillerDicF(item, field1, field2, filist, [], "1","0");}
				}
				
				
				if(document.getElementById("PERCENT_PICKER"))
				{document.getElementById("PERCENT_PICKER").value = 0;}
			
				if(document.getElementById("MONTHS_PICKER"))
				{document.getElementById("MONTHS_PICKER").value = 1;}
				
				
				var searchButton = buttonCreator([12,4,4,12], "Aplicar filtros actuales", function(){applyFilters("General")});
				
				
				subfiltersBox.appendChild(searchButton);
				
				document.getElementById("Aplicar filtros actuales").className = "filtersButtonR";
				
					

			}
			
			document.getElementById("G_TYPE").value = "Programas";
			document.getElementById("G_TYPE").onchange();
			
			
			
			loadManager(0);
		}
		
	});

}

function applyFilters(type)
{
	if(type == "General")
	{
		var filters = {};
		for(var i=0; i<mainActualFilters.length; i++)
		{
			if(document.getElementById(mainActualFilters[i]))
			{filters[mainActualFilters[i]] = getPickedIds(mainActualFilters[i]);}
			
		}
		
		
		
		
		loadManager(1);
		
		
		var sheet = [];
		var inidate = {}; inidate.NAME = "Fecha inicio"; inidate.DETAIL = document.getElementById("INIDATE_PICKER").value;
		var enddate = {}; enddate.NAME = "Fecha fin"; enddate.DETAIL = document.getElementById("ENDDATE_PICKER").value;
		var thearray = JSON.stringify([userData.USER_ENTITY]);
		
		var ent = getFriendDescs(thearray,"entities");
		var entity = {}; entity.NAME = "Entidad"; entity.DETAIL = ent;
		
		
		// GET FILTERED RESULTS AND SELECTIONS FOR SHEET
		var pickedResults = getResults(filters);
		
		var pro = getFriendDescs(JSON.stringify(fPrograms),"programs", "line");
		var programs = {}; programs.NAME = "Programas"; programs.DETAIL = pro;
		
		var prj = getFriendDescs(JSON.stringify(fProjects),"projects", "line");
		var projects = {}; projects.NAME = "Proyectos"; projects.DETAIL = prj;
		
		var act = getFriendDescs(JSON.stringify(fActivities),"activities", "line");
		var activities = {}; activities.NAME = "Actividades"; activities.DETAIL = act;
		
		var ctt = getFriendDescs(JSON.stringify(fContratists),"users", "line");
		var contratists = {}; contratists.NAME = "Contratistas"; contratists.DETAIL = ctt;
		
		var ctc = getFriendDescs(JSON.stringify(fContract),"contracts", "line");
		var contratcs = {}; contratcs.NAME = "Contratos"; contratcs.DETAIL = ctc;
		
		var grp = getFriendDescs(JSON.stringify(fGroups),"groups", "line");
		var groups = {}; groups.NAME = "Grupos"; groups.DETAIL = grp;
		
		// var ctz = getFriendDescs(JSON.stringify(fCitizens),"citizens", "line");
		// var citizens = {}; citizens.NAME = "Ciudadanos"; citizens.DETAIL = ctz;
		
		var eta = getFriendDescs(JSON.stringify(fEtaries),"etaries", "line");
		var etaries = {}; etaries.NAME = "Rangos de edades"; etaries.DETAIL = eta;
		
		var cnd = getFriendDescs(JSON.stringify(fConditions),"conditions", "line");
		var conditions = {}; conditions.NAME = "Condiciones"; conditions.DETAIL = cnd;
		
		var gdr = getFriendDescs(JSON.stringify(fGenders),"genders", "line");
		var genders = {}; genders.NAME = "Géneros"; genders.DETAIL = gdr;
		
		var etn = getFriendDescs(JSON.stringify(fEtnia),"etnias", "line");
		var etnias = {}; etnias.NAME = "Etnias"; etnias.DETAIL = etn;
		
		var urb = getFriendDescs(JSON.stringify(fUrbral),"urbral", "line");
		var urbral = {}; urbral.NAME = "Urbano/Rural"; urbral.DETAIL = urb;
		
		var zon = getFriendDescs(JSON.stringify(fZones),"zones", "line");
		var zones = {}; zones.NAME = "Comuna/Corregimiento"; zones.DETAIL = zon;
		
		var hod = getFriendDescs(JSON.stringify(fHoods),"hoods", "line");
		var hoods = {}; hoods.NAME = "Barrio/Vereda"; hoods.DETAIL = hod;
		
		var icm = getFriendDescs(JSON.stringify(fInstcom),"instcom", "line");
		var instcom = {}; instcom.NAME = "Institucional/Comunitario"; instcom.DETAIL = icm;
		
		var pvr = getFriendDescs(JSON.stringify(fPrevir),"previr", "line");
		var previr = {}; previr.NAME = "Presencial/Virtual"; previr.DETAIL = pvr;
		
		if(document.getElementById("PERCENT_PICKER"))
		{
			var ass = document.getElementById("PERCENT_PICKER").value;
			var assist = {}; assist.NAME = "Asistencia"; assist.DETAIL = ass;
			
			var mth = document.getElementById("MONTHS_PICKER").value;
			var months = {}; months.NAME = "Meses de continuidad"; months.DETAIL = mth;
		}
		
		sheet.push(inidate);
		sheet.push(enddate);
		sheet.push(entity);
		sheet.push(programs);
		sheet.push(projects);
		sheet.push(activities);
		sheet.push(contratists);
		sheet.push(contratcs);
		sheet.push(groups);
		// sheet.push(citizens);
		sheet.push(etaries);
		sheet.push(conditions);
		sheet.push(genders);
		sheet.push(etnias);
		sheet.push(urbral);
		sheet.push(zones);
		sheet.push(hoods);
		sheet.push(instcom);
		sheet.push(previr);
		
		if(document.getElementById("PERCENT_PICKER"))
		{
			sheet.push(assist);
			sheet.push(months);
		}
		
		tableCreator("wp_report_sheet_general", sheet);
		
		
		filteredResult = pickedResults;
		// console.log(filteredResult);
		
		// GET DONE EVENTS
		closedEvents = [];
		for(var i=0; i<rEvents.length; i++)
		{
			var ev = rEvents[i];
			if(ev.EVENT_STATUS == "4" && ev.EVENT_TYPE == "1"){closedEvents.push(ev);}
			if(ev.EVENT_STATUS == "1" && ev.EVENT_TYPE == "0"){closedEvents.push(ev);}
		}
		
		
		
		// GET EVENT ADDITIONS FOR FILTERS
		for(var i=0; i<closedEvents.length; i++)
		{
			var ev = closedEvents[i];
			var actis = ev.EVENT_ACTIVITIES;
			if(actis != null && actis != "null" && actis != "")
			{
				actis = JSON.parse(actis);
				var eventProPro = "";
				for(var a=0; a<actis.length; a++)
				{
					var act = actis[a];
					var propro = getActivityParents(act)
					eventProPro = eventProPro+propro;
				}
				closedEvents[i].EVENT_PROPRO = eventProPro;
			}
		}

		filteredResultEvents = [];
		
		// APPLY EVENTS FILTERS
		
		// SUBTIPO PROGRAMA: PROGRAMA, ACTIVIDADES
		if(document.getElementById("G_TYPE").value == "Programas")
		{
			// ADD FOR PROGRAM
			var filterPicks = getPickedIds("PROGRAMS_PICKER")
			
			for(var i=0; i<filterPicks.length; i++)
			{
				var pick = filterPicks[i];
				for(var c=0; c<closedEvents.length; c++)
				{
					var eventProPro = closedEvents[c].EVENT_PROPRO;

					// ACTIVATE FOR REAL
					if(eventProPro.includes(pick))
					{
						if(!filteredResultEvents.includes(closedEvents[c]))
						{filteredResultEvents.push(closedEvents[c]);}
					}
					
					// if(!filteredResultEvents.includes(closedEvents[c]))
					// {filteredResultEvents.push(closedEvents[c]);}
				}
			}
			
		}
		// SUBTIPO PROYECTO: PROYECTO, ACTIVIDADES
		else if(document.getElementById("G_TYPE").value == "Proyectos")
		{
			// ADD FOR PROJECT
			var filterPicks = getPickedIds("PROJECT_PICKER")

			for(var i=0; i<filterPicks.length; i++)
			{
				var pick = filterPicks[i];
				
				for(var c=0; c<closedEvents.length; c++)
				{
					var eventProPro = closedEvents[c].EVENT_PROPRO;
					if(eventProPro.includes(pick))
					{
						if(!filteredResultEvents.includes(closedEvents[c]))
						{filteredResultEvents.push(closedEvents[c]);}
					}
				}
			}
		}
		// SUBTIPO CONTRATISTA: CONTRATISTA, ACTIVIDADES (DIRIGIDO O APOYO)
		else if(document.getElementById("G_TYPE").value == "Contratistas")
		{
			var filterPicks = getPickedIds("CONTRATISTS_PICKER")
			console.log(filterPicks);

			for(var i=0; i<filterPicks.length; i++)
			{
				var pick = filterPicks[i];
				
				for(var c=0; c<closedEvents.length; c++)
				{
					var owner = closedEvents[c].EVENT_OWNER;
					var support = closedEvents[c].EVENT_SUPPORT_TEAM;
					
					// GET SUPPORT CONTRACT OWNERS AS SUPPORT OWNERS String, THEN CHECK IF INCLUDED
					// GET SUPPORT CONTRACT OWNERS AS SUPPORT OWNERS String, THEN CHECK IF INCLUDED
					
					if(owner.includes(pick) || support.includes(pick))
					{
						if(!filteredResultEvents.includes(closedEvents[c]))
						{filteredResultEvents.push(closedEvents[c]);}
					}

					// if(!filteredResultEvents.includes(closedEvents[c]))
					// {filteredResultEvents.push(closedEvents[c]);}
				}
			}
			
		}
		// SUBTIPO CONTRATOS: CONTRATO, ACTIVIDADES
		else if(document.getElementById("G_TYPE").value == "Contratos")
		{
			// SUBTIPO CONTRATOS: CONTRATO, ACTIVIDADES
			
			var filterPicks = getPickedIds("CONTRACT_PICKER")
			for(var i=0; i<filterPicks.length; i++)
			{
				var pick = filterPicks[i];

				for(var c=0; c<closedEvents.length; c++)
				{
					var contract = closedEvents[c].EVENT_CONTRACT_CODE;
					if(contract.includes(pick))
					{
						if(!filteredResultEvents.includes(closedEvents[c]))
						{filteredResultEvents.push(closedEvents[c]);}
					}
				}
			}
		}
		
		// ADD EVENTS FOR ACTIVITY
		
		// DISABLED BY RESQUEST
		
		// var filterPicks = getPickedIds("ACTIVITY_PICKER")
		// for(var i=0; i<filterPicks.length; i++)
		// {
			// var pick = filterPicks[i];
			
			// for(var e=0; e<closedEvents.length; e++)
			// {
				// var eventActis = closedEvents[e].EVENT_ACTIVITIES;
				
				// if(eventActis.includes(pick))
				// {
					// if(!filteredResultEvents.includes(closedEvents[e]))
					// {filteredResultEvents.push(closedEvents[e]);}
				// }
			// }
		// }

		// ------------------------------VISITS-----------------------
		// ------------------------------VISITS-----------------------
		// ------------------------------VISITS-----------------------
		
		
		// GET VISITS TO APPLY FILTERS
		
		
		// GET EVENT ADDITIONS FOR VISITS
		for(var i=0; i<rVisits.length; i++)
		{
			var vis = rVisits[i];
			var actis = vis.VISIT_ACTIVITY;
			var propro = getActivityParents(actis);
			rVisits[i].VISIT_PROPRO = propro;
		}
		
		// console.log(rVisits);
		
		
		filteredResultVisits = [];
		filteredResultVisitsGot = [];
		filteredResultVisitsGiven = [];
		
		
		// SUBTIPO PROGRAMA: PROGRAMA, ACTIVIDADES
		if(document.getElementById("G_TYPE").value == "Programas")
		{
			var filterPicks = getPickedIds("PROGRAMS_PICKER")
			for(var i=0; i<filterPicks.length; i++)
			{
				var pick = filterPicks[i];
				// console.log(pick);
				
				for(var c=0; c<rVisits.length; c++)
				{
					var visProPro = rVisits[c].VISIT_PROPRO;
					// console.log(visProPro);

					// ACTIVATE FOR REAL
					if(visProPro.includes(pick))
					{
						if(!filteredResultVisits.includes(rVisits[c]))
						{filteredResultVisits.push(rVisits[c]);}
					}
				}
				
			}
		}
		// SUBTIPO PROGRAMA: PROGRAMA, ACTIVIDADES
		else if(document.getElementById("G_TYPE").value == "Proyectos")
		{
			var filterPicks = getPickedIds("PROJECT_PICKER")
			for(var i=0; i<filterPicks.length; i++)
			{
				var pick = filterPicks[i];
				// console.log(pick);
				
				for(var c=0; c<rVisits.length; c++)
				{
					var visProPro = rVisits[c].VISIT_PROPRO;
					// console.log(visProPro);

					// ACTIVATE FOR REAL
					if(visProPro.includes(pick))
					{
						if(!filteredResultVisits.includes(rVisits[c]))
						{filteredResultVisits.push(rVisits[c]);}
					}
				}
				
			}
		}
		// SUBTIPO CONTRATISTA: CONTRATISTA, ACTIVIDADES (VISITADO O VISITADOR)
		else if(document.getElementById("G_TYPE").value == "Contratistas")
		{
			var filterPicks = getPickedIds("CONTRATISTS_PICKER")
			console.log(filterPicks);

			for(var i=0; i<filterPicks.length; i++)
			{
				var pick = filterPicks[i];
				
				for(var c=0; c<rVisits.length; c++)
				{
					var visitor = rVisits[c].VISIT_OWNER;
					var visitedContract = rVisits[c].VISIT_CONTRACT;
					var visitedCode = getUserCodeFromContract(visitedContract);

					if(visitor.includes(pick))
					{
						if(!filteredResultVisits.includes(rVisits[c]))
						{filteredResultVisits.push(rVisits[c]);}
						
						if(!filteredResultVisitsGiven.includes(rVisits[c]))
						{filteredResultVisitsGiven.push(rVisits[c]);}
					}
					if(visitedCode.includes(pick))
					{
						
						if(!filteredResultVisits.includes(rVisits[c]))
						{filteredResultVisits.push(rVisits[c]);}
						
						if(!filteredResultVisitsGot.includes(rVisits[c]))
						{filteredResultVisitsGot.push(rVisits[c]);}
					}
				}
			}
			
			
			
			
			
			
			
		}
		// SUBTIPO CONTRATOS: CONTRATO, ACTIVIDADES
		else if(document.getElementById("G_TYPE").value == "Contratos")
		{
			var filterPicks = getPickedIds("CONTRACT_PICKER")
			console.log(filterPicks);

			for(var i=0; i<filterPicks.length; i++)
			{
				var pick = filterPicks[i];
				
				for(var c=0; c<rVisits.length; c++)
				{
					var visitorContract = rVisits[c].VISIT_CONTRACT_CODE;
					var visitedContract = rVisits[c].VISIT_CONTRACT;
					

					if(visitorContract.includes(pick) || visitedContract.includes(pick))
					{
						if(!filteredResultVisits.includes(rVisits[c]))
						{filteredResultVisits.push(rVisits[c]);}
					}
				}
			}
		}
		
		
		// ADD EVENTS FOR ACTIVITY
		var filterPicks = getPickedIds("ACTIVITY_PICKER")
		for(var i=0; i<filterPicks.length; i++)
		{
			var pick = filterPicks[i];
			
			for(var e=0; e<rVisits.length; e++)
			{
				var visitActi = rVisits[e].VISIT_ACTIVITY;
				
				if(visitActi.includes(pick))
				{
					if(!filteredResultVisits.includes(rVisits[e]))
					{filteredResultVisits.push(rVisits[e]);}
				}
			}
		}
		
		// console.log(filteredResultVisits);
		// console.log(filteredResultVisitsGiven);
		// console.log(filteredResultVisitsGot);

		
		// GET GRAPHIC VALUES
		
		assistValues = [];
		groupValues = [];
		coverageValues = [];
		classValues = [];
		hoursValues = [];
		eventsValues = [];
		givenVisitsValues = [];
		gotVisitsValues = [];
		
		// console.log(actualMonths);
		
		groupsTotal1 = 0;
		groupsTotal2 = 0;
		
		coverTotal1 = 0;
		coverTotal2 = 0;

		classTotal1 = 0;
		classTotal2 = 0;
		
		hoursTotal1 = 0;
		hoursTotal2 = 0;
		
		eventsTotal1 = 0;
		eventsTotal2 = 0;
		
		gotVisTotal1 = 0;
		gotVisTotal2 = 0;
		
		givenVisTotal1 = 0;
		givenVisTotal2 = 0;
		
		totalDictatedClasses = 0;
		totalAssistedClasses = 0;
		
		visitsAssisTotal = 0;
		visitsNoAssisTotal = 0;
		
		
		for(var i=0; i<actualMonths.length; i++)
		{
			var month = actualMonths[i];
			var monthValues = getMonthValues(month);
			var assistMonthValue = monthValues.assist;
			var groupMonthValue = monthValues.groups;
			var coverageMonthValue = monthValues.coverage;
			var classMonthValue = monthValues.classes;
			var hourMonthValue = monthValues.hours;
			var eventMonthValue = monthValues.events;
			var givenVisitsMonthValues = monthValues.givenVisits;
			var gotVisitsMonthValues = monthValues.gotVisits;
						
			if(isNaN(assistMonthValue)){assistMonthValue = 0;}
			if(isNaN(groupMonthValue)){groupMonthValue = 0;}
			if(isNaN(coverageMonthValue)){coverageMonthValue = 0;}
			if(isNaN(classMonthValue)){classMonthValue = 0;}
			if(isNaN(hourMonthValue)){hourMonthValue = 0;}
			if(isNaN(eventMonthValue)){eventMonthValue = 0;}
			if(isNaN(givenVisitsMonthValues)){givenVisitsMonthValues = 0;}
			if(isNaN(gotVisitsMonthValues)){gotVisitsMonthValues = 0;}
			
			
			assistValues.push(assistMonthValue)
			groupValues.push(groupMonthValue)
			coverageValues.push(coverageMonthValue)
			classValues.push(classMonthValue)
			hoursValues.push(hourMonthValue)
			eventsValues.push(eventMonthValue)
			givenVisitsValues.push(givenVisitsMonthValues)
			gotVisitsValues.push(gotVisitsMonthValues)
			
		}
		refreshChart("GENERAL_CHART");
		
		fillIndicators();

	}
}

function fillIndicators()
{
	
	var indexes = [];
	
	// USUARIOS PROMEDIO POR GRUPO: sumatoria de combinaciones únicas documento-grupo dentro / sumatoria de grupos únicos dentro del data set
	
	var line = {};
	line.F1 = "<b>USUARIOS PROMEDIO POR GRUPO</b>";
	
	var thisValueX1 = round(uniqueDocGroupLinks.length/uniqueGroups.length,1);
	if(isNaN(thisValueX1)){thisValueX1 = 0;}
	line.F2 = thisValueX1
	// console.log(uniqueDocGroupLinks);
	// console.log(uniqueGroups);
	
	
	// ASISTENCIA PROMEDIO USUARIOS : sumatoria del total clases asistidas / sumatoria clases dictadas de todo el corte. (porcentage)
	var thisValueX2 = round((totalAssistedClasses/totalDictatedClasses)*100,1);
	if(isNaN(thisValueX2)){thisValueX2 = 0;}
	line.F3 = "<b>ASISTENCIA PROMEDIO</b>";
	line.F4 = encry(thisValueX2+"%");
	indexes.push(line)
	
	
	// USUARIOS PROMEDIO POR CLASE: USUARIOS PROMEDIO POR GRUPO * ASISTENCIA PROMEDIO USUARIOS
	var thisValue = round((thisValueX1*thisValueX2)/100,1);
	if(isNaN(thisValue)){thisValue = 0;}
	var line = {};
	line.F1 = "<b>USUARIOS PROMEDIO POR CLASE</b>";
	line.F2 = thisValue;
	
	// ASISTENCIA VISITAS: sumatoria de asistentes a visitas / sumatoria de asitentes + ausentes (porcentaje)
	var thisValue = round((visitsAssisTotal/(visitsAssisTotal+visitsNoAssisTotal))*100,1);
	if(isNaN(thisValue)){thisValue = 0;}
	line.F3 = "<b>ASISTENCIA VISITAS</b>";
	line.F4 = encry(thisValue+"%");
	indexes.push(line)
	
	var line = {};
	line.F1 = "";
	line.F2 = "";
	line.F3 = "";
	line.F4 = "";
	indexes.push(line)
	
	var line = {};
	line.F1 = "";
	line.F2 = "<b>REGISTRADO</b>";
	line.F3 = "<b>META</b>";
	line.F4 = "<b>LOGRO</b>";
	indexes.push(line)
	
	// GRUPOS OFERTA: cantidad de grupos asignados y con contracto activo al momento de generar el reporte de los grupos del filtro.
	// DE LOS GRUPOS UNICOS REVISAR CONTRATO Y VER CUALES ESTAN ACTIVOS EN ESTE MOMENTO - uniqueGroups
	
	var thisValue = getActiveGroups(uniqueGroups);
	if(isNaN(thisValue)){thisValue = 0;}
	var line = {};
	line.F1 = "<b>GRUPOS OFERTA</b>";
	line.F2 = thisValue;
	line.F3 = "";
	line.F4 = "";
	indexes.push(line)
	
	var thisValue = groupsTotal1/groupsTotal2
	if(isNaN(thisValue)){thisValue = 0;}
	
	var line = {};
	line.F1 = "<b>GRUPOS</b>";
	line.F2 = groupsTotal1;
	line.F3 = groupsTotal2;
	line.F4 = round((thisValue)*100,1)+"&#37;";
	indexes.push(line)
	
	var thisValue = coverTotal1/coverTotal2;
	if(isNaN(thisValue)){thisValue = 0;}
	var line = {};
	line.F1 = "<b>COBERTURA</b>";
	line.F2 = coverTotal1;
	line.F3 = coverTotal2;
	line.F4 = round((thisValue)*100,1)+"&#37;";
	indexes.push(line)
	
	var thisValue = classTotal1/classTotal2;
	if(isNaN(thisValue)){thisValue = 0;}
	var line = {};
	line.F1 = "<b>CLASES</b>";
	line.F2 = classTotal1;
	line.F3 = classTotal2;
	line.F4 = round((thisValue)*100,1)+"&#37;";
	indexes.push(line)
	
	var thisValue = hoursTotal1/hoursTotal2;
	if(isNaN(thisValue)){thisValue = 0;}
	var line = {};
	line.F1 = "<b>HORAS</b>";
	line.F2 = hoursTotal1;
	line.F3 = hoursTotal2;
	line.F4 = round((thisValue)*100,1)+"&#37;";
	indexes.push(line)
	
	var thisValue = eventsTotal1/eventsTotal2;
	if(isNaN(thisValue)){thisValue = 0;}
	var line = {};
	line.F1 = "<b>EVENTOS</b>";
	line.F2 = eventsTotal1;
	line.F3 = eventsTotal2;
	line.F4 = round((thisValue)*100,1)+"&#37;";
	indexes.push(line)
	
	var line = {};
	line.F1 = "";
	line.F2 = "";
	line.F3 = "";
	line.F4 = "";
	indexes.push(line)
	
	var line = {};
	line.F1 = "";
	line.F2 = "<b>CORRECTAMENTE REGISTRADO</b>";
	line.F3 = "<b>TOTAL REVISADO</b>";
	line.F4 = "<b>VERACIDAD</b>";
	indexes.push(line)
	
	
	var thisValue = gotVisTotal1/gotVisTotal2;
	if(isNaN(thisValue)){thisValue = 0;}
	
	var line = {};
	line.F1 = "<b>VISITAS RECIBIDAS</b>";
	line.F2 = gotVisTotal1;
	line.F3 = gotVisTotal2;
	line.F4 = round((thisValue)*100,1)+"&#37;";
	indexes.push(line)
	
	
	var thisValue = givenVisTotal1/givenVisTotal2;
	if(isNaN(thisValue)){thisValue = 0;}
	var line = {};
	line.F1 = "<b>VISITAS REALIZADAS</b>";
	line.F2 = givenVisTotal1;
	line.F3 = givenVisTotal2;
	line.F4 = round((thisValue)*100,1)+"&#37;";
	indexes.push(line)
		
	tableCreator("wp_report_indicators", indexes);
	
	
	
	fillTotalAssistTable();
	
	
}

function fillTotalAssistTable()
{
	// GET FILTERED CONTRATITS LIST
	// console.log(actualDB.contratists);
	// console.log(contratistsClasses);
	
	var codes = Object.keys(contratistsClasses);
	
	var tAssistList = [];
	
	for(var i=0; i<codes.length; i++)
	{
		var line = {};
		var code = codes[i];
		line.USER_CODE = code;
		
		for(var c=0; c<actualDB.contratists.length; c++)
		{
			var guy = actualDB.contratists[c];
			if(code == guy.USER_CODE){line.CONTRATIST_NAME = guy.USER_FULL_NAME;break;}
		}
		
		var classes = contratistsClasses[code];
		var type1 = 0;
		var type2 = 0;
		var type3 = 0;
		
		// console.log(classes);
		
		for(var c=0; c<classes.length; c++)
		{
			var item = classes[c];
			
			if(item == "Dictada"){type1++;}
			if(item == "Abierta"){type2++;}
			if(item == "No dictada"){type3++;}
			
		}
		
		line.COUNT1 = type1;
		line.COUNT2 = type2;
		line.COUNT3 = type3;
		
		
		// GET EVENTS FOR USER ADD TO LIST
		
		// GET OWNED
		var owned = 0;
		var internal = 0
		var external = 0
		var supported = 0;
		var services = 0;
		
		for(var e=0; e<closedEvents.length; e++)
		{
			
			var ev = closedEvents[e];
			var evDate = ev.EVENT_DATE_END.split(" ")[0];
			var iniDate = document.getElementById("INIDATE_PICKER").value;
			var endDate = document.getElementById("ENDDATE_PICKER").value;
			if(evDate < iniDate || evDate > endDate){continue;}
			
			if(ev.EVENT_OWNER == code)
			{
				owned++;
				if(ev.EVENT_TYPE == "0"){internal++;}
				if(ev.EVENT_TYPE == "1"){external++;}
				
				var evAssist = ev.EVENT_ASSIST;
				evAssist = evAssist.replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;');
				evAssist = JSON.parse(evAssist);
			
				for(var t=0; t<evAssist.length; t++)
				{
					var item = evAssist[t];
					if(item.ASSIST_DESC == "MASCULINO" || item.ASSIST_DESC == "FEMENINO")
					{services = services+parseInt(item.ASSIST_VALUE);}
				}
				
			}
			else
			{
				// EVENT_SUPPORT_TEAM
				var team = ev.EVENT_SUPPORT_TEAM;
				team = team.replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;');
				team = JSON.parse(team);
				if(team.length > 0)
				{
					for(var a=0; a<team.length; a++)
					{
						var cnum = team[a].SUPPORT_CONTRACT_NUMBER;
						var dueno = getContractOwner(cnum);
						if(dueno == code && dueno != "")
						{
							supported++;
							
							var evAssist = ev.EVENT_ASSIST;
							evAssist = evAssist.replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;');
							evAssist = JSON.parse(evAssist);
						
							for(var t=0; t<evAssist.length; t++)
							{
								var item = evAssist[t];
								if(item.ASSIST_DESC == "MASCULINO" || item.ASSIST_DESC == "FEMENINO")
								{services = services+parseInt(item.ASSIST_VALUE);}
							}
							
						}
					}
				}
			}
			
			
			
			
		}
		
		
		line.EVOWNED = owned;
		line.INTERNAL = internal;
		line.EXTERNAL = external;
		line.SUPPORTED = supported;
		line.SERVICES = services;
		
		
		tAssistList.push(line)
		
	}
	console.log(closedEvents);
	console.log(tAssistList);
	
	tableCreator("wp_report_Assist_Detail", tAssistList);
	tableCreator("wp_report_Events_Detail", tAssistList);
	
	
	
	
	
}

function getContractOwner(num)
{
	
	var owner = "";
	
	for(var x=0; x<rContract.length; x++)
	{
		var contract = rContract[x];
		if(contract.CONTRACT_NUMBER == num)
		{owner = contract.CONTRACT_OWNER;break;}
	}
	
	return owner;
}

function getActiveGroups(list)
{
	var count = 0;
	var fullGrs = [];
	for(var i=0; i<list.length; i++)
	{
		var code = list[i];
		for(var g=0; g<rGroups.length; g++)
		{
			var gr = rGroups[g];
			if(gr.GROUP_CODE == code){fullGrs.push(gr);}
		}
	}
	
	// GET CONTRACTS
	for(var n=0; n<fullGrs.length; n++)
	{
		var contract = fullGrs[n].GROUP_CONTRACT;
		if(contract != null && contract != "null" && contract != "")
		{if(contractIsAlive(contract)){count++;}}
	}
	
	return count;
}

function contractIsAlive(code)
{
	
	for(var i=0; i<rContract.length; i++)
	{
		var ccode = rContract[i].CONTRACT_CODE;
		
		if(code == ccode)
		{
			var thisContract = rContract[i];
			var inidate = thisContract.CONTRACT_INIDATE;
			var enddate = thisContract.CONTRACT_ENDATE;
			var today = getNow().split(" ")[0];
			if(today >= inidate && today <= enddate){var isAlive = true;}
			else{var isAlive = false;}
			break;
		}

	}
	return isAlive;
}

function getUserCodeFromContract(contract)
{
	var code= "";
	
	for(var c=0; c<actualDB.contracts.length; c++)
	{
		var ct = actualDB.contracts[c];
		// console.log(contract);
		
		if(ct.CONTRACT_CODE == contract)
		{
			// console.log("found");
			// console.log(ct);
			var code = ct.CONTRACT_OWNER;break
		}
	}
	
	return code;
	
}

function getContractFromCode(code)
{
		
	for(var c=0; c<actualDB.contracts.length; c++)
	{
		var contract = actualDB.contracts[c];
		if(contract.CONTRACT_CODE == code)
		{var cnumber = contract.CONTRACT_NUMBER;break;}
	}
	
	return cnumber;
	
}

function getActivityParents(acty)
{
	// console.log(acty);
	// console.log(activities);
	// GET PROGRAM

	
	for(var x=0; x<activities.length; x++)
	{
		var act = activities[x];
		if(act.ACTIVITY_CODE == acty)
		{var project = act.ACTIVITY_PROJECT;break}
	}
	// console.log(project);
	
	for(var x=0; x<projects.length; x++)
	{
		var pro = projects[x];
		if(pro.PROJECT_CODE == project)
		{var program = pro.PROJECT_PROGRAM;break}
	}
	// console.log(project);
	// console.log(program);
	
	// GET PROYECT
	
	var parents = project+" - "+program+" - ";
	
	return parents;
	
	
}

function getMonthValues(month)
{
	// GET END MONTH DATEfunction 
	
	var date = new Date(month+"-01");
	
	var firstDay = month+"-01";
	var lastDay = new Date(date.getFullYear(), date.getMonth() + 2, 0);
	lastDay = getNowFormat(lastDay, "end").split(" ")[0];
	
	// GET MONTHLY VALUES FOR ACTUAL PICKED
	
	var totalDictated = 0;
	var totalAssisted = 0;
	var contractLinks = {};
	var totalCombi = 0;
	var totalCombiGoal = 0;
	
	var coverageProms = {};
	
	console.log(filteredResult);
	
	for(var i=0; i<filteredResult.length; i++)
	{
		var assistLine = filteredResult[i];
		
		
		// FILTER BY MONTH
		if(assistLine.CLASS_DATE < firstDay || assistLine.CLASS_DATE > lastDay){continue;}
		
		// GET ASSIST POINT -----------****
		var regAssist = getAssistAssistData(assistLine["CLASS_IDNUM"], assistLine["CLASS_GROUP"], firstDay, lastDay);
		var dictated = regAssist.TOTAL_CLASSES;
		var assisted = regAssist.TOTAL_ASSISTED_CLASSES;
		
		totalDictated = totalDictated+dictated;
		totalAssisted = totalAssisted+assisted;
			
		// GET GROUP POINT ------------****
		var contractCode = assistLine.CLASS_CONTRACT_CODE;
		var contractGroup = assistLine.CLASS_GROUP;
		var combi = contractCode+"-"+contractGroup;
		var goal = getContractGoals(assistLine.CLASS_CONTRACT_CODE).grGoals;
	
		if(contractLinks.hasOwnProperty(contractCode))
		{
			var combis = contractLinks[contractCode];
			if(!combis.includes(combi))
			{contractLinks[contractCode].push(combi);totalCombi++;}
			contractLinks[contractCode]["GOAL"] = goal;
		}
		else
		{
			contractLinks[contractCode] = [];
			contractLinks[contractCode].push(combi);
			totalCombi++;
			contractLinks[contractCode]["GOAL"] = goal;
			totalCombiGoal = totalCombiGoal+parseInt(goal);
		}
		var classCode = assistLine.CLASS_CODE;
		var ctrGrCombi = assistLine.CLASS_DATE+"-x-"+assistLine.CLASS_CONTRACT_CODE+"-"+assistLine.CLASS_GROUP+"-"+classCode;
		
		// GET VALUE 2 FOR COVERAGE POINT FOR GROUPS -----****
		if(coverageProms.hasOwnProperty(ctrGrCombi))
		{
			// GET PEOPLE GOAL FOR THIS CTRGR
			var peopleGoal = parseInt(assistLine.CLASS_PEOPLE_GOAL);
			coverageProms[ctrGrCombi]["COUNT"]++;
			coverageProms[ctrGrCombi]["PEOPLE"] = peopleGoal;
		}
		else
		{
			var peopleGoal = assistLine.CLASS_PEOPLE_GOAL;
			coverageProms[ctrGrCombi] = {};
			coverageProms[ctrGrCombi]["CCODE"] = classCode;
			coverageProms[ctrGrCombi]["COUNT"] = 1;
			coverageProms[ctrGrCombi]["PEOPLE"] = parseInt(peopleGoal);
		}
	}
	
	// console.log(totalDictated);
	// console.log(totalAssisted);
	
	
	// GET COVERAGE POINT ---------****
	var contrCount = 0;
	var monthUniqueContracts = [];
	var coverSum = 0;
	
	for(var c=0; c<unContrCtzenLnks.length; c++)
	{
		var contr = unContrCtzenLnks[c];
		var date = contr.split("-x-")[0];
		var ccode = contr.split("-x-")[1].split("-")[0];
		
		// FILTER BY MONTH
		if(date < firstDay || date > lastDay){continue;}
		
		// GET SUM FOR UNIQUE CONTRACT PEOPLE GOALS
		if(!monthUniqueContracts.includes(ccode))
		{
			monthUniqueContracts.push(ccode);
			var peopleGoals = getContractGoals(ccode).peGoals;
			
			if(isNaN(peopleGoals)){peopleGoals = 0;}
			
			
			// console.log(peopleGoals);
			coverSum = coverSum+peopleGoals;
		}
		// UNIQUE CONTRACT CITIZEN IN DATE RANGE COUNT
		contrCount++;
	}
	
	
	// console.log(coverSum);
	
	// GET CLASSES POINT ---------****
	
	var uniqueCtrGrClGoals = {};
	var uniqueCtrGrClTimeGoals = {};

	var monthUniqueClases = [];
	var totalClassHours = 0;
	
	var totalClassesDuration = 0;
	
	for(var u=0; u<uniqueClases.length; u++)
	{
		var cls = uniqueClases[u];
		var date = cls.split("-x-")[0];
		if(date < firstDay || date > lastDay){continue;}
		monthUniqueClases.push(cls);
		
		var ccode = cls.split("-x-")[1];
		// console.log(ccode);
		
		// GET CLASS DATA
		
		for(var c=0; c<actualClasses.length; c++)
		{
			var cl = actualClasses[c];
			
			if(cl.CLASS_CODE == ccode)
			{
				
				// console.log(cl);
				
				var clCtr = cl.CLASS_CONTRACT_CODE;
				var clGr = cl.CLASS_GROUP;
				var classesGoal = cl.CLASS_CLASSES_GOAL;
				var hoursGoal = cl.CLASS_TIMES_GOAL;
				
				// GET CLASS DURATION IN HOURS
				var clHours = JSON.parse(cl.CLASS_HOUR);
				var iniHour = clHours.GROUP_TIME_INI;
				var endHour = clHours.GROUP_TIME_END;
				var timeStart = new Date("01/01/2000 " + iniHour).getTime();
				var timeEnd = new Date("01/01/2000 " + endHour).getTime();
				var hourDiff = (timeEnd - timeStart)/1000/60/60;  
				totalClassesDuration = totalClassesDuration+hourDiff;
				
				var combi = clCtr+"-x-"+clGr;
				
				if(!uniqueCtrGrClGoals.hasOwnProperty(combi))
				{uniqueCtrGrClGoals[combi] = classesGoal;}
				else
				{uniqueCtrGrClGoals[combi] = uniqueCtrGrClGoals[combi]+parseFloat(classesGoal);}
			
				if(!uniqueCtrGrClTimeGoals.hasOwnProperty(combi))
				{uniqueCtrGrClTimeGoals[combi] = hoursGoal;}
				else
				{uniqueCtrGrClTimeGoals[combi] = uniqueCtrGrClTimeGoals[combi]+parseFloat(hoursGoal);}
	
			}
			
		}
		
	}
	
	var classClassesGoals = 0;
	var classHoursGoals = 0;
	
	// console.log(uniqueClases);
	// console.log(totalClassesDuration);
	
	var keys = Object.keys(uniqueCtrGrClGoals);
	for(var k=0; k<keys.length; k++)
	{
		var key = keys[k];
		classClassesGoals = classClassesGoals+parseInt(uniqueCtrGrClGoals[key]);
	}
	
	var keys = Object.keys(uniqueCtrGrClTimeGoals);
	for(var k=0; k<keys.length; k++)
	{
		var key = keys[k];
		classHoursGoals = classHoursGoals+parseInt(uniqueCtrGrClTimeGoals[key]);
	}
	
	// console.log(monthUniqueClases);
	// console.log(uniqueCtrGrClGoals);
	// console.log(uniqueCtrGrClTimeGoals);
	// console.log(classClassesGoals);
	
	// VALOR 1: CANTIDAD DE CLASES UNICAS DEL DATASET
	var uniqueClasesCount = monthUniqueClases.length;
	var value4ForClassPoint = 0;
	var value4ForHoursPoint = 0;
	for(var c=0; c<monthUniqueContracts.length; c++)
	{
		var ccode = monthUniqueContracts[c];
		
		for(var co=0; co<rContract.length; co++)
		{
			if(ccode == rContract[co].CONTRACT_CODE)
			{var contract = rContract[co]; break;}
		}
		
		// GET VALUE 2 AND 3
		var contractInidate = contract.CONTRACT_INIDATE;
		var contractEnddate = contract.CONTRACT_ENDATE;
		var filterInidate = document.getElementById("INIDATE_PICKER").value;
		var filterEnddate = document.getElementById("ENDDATE_PICKER").value;
		
		// GET MINOR INI DATE
		if(contractInidate <= filterInidate){var firstDate = filterInidate;}
		else{var firstDate = contractInidate;}
		
		// GET MINOR END DATE
		if(contractEnddate >= filterEnddate){var lastDate = filterEnddate;}
		else{var lastDate = contractEnddate;}
		var diffDays = getdDiff(firstDate, lastDate);
		
		
		var classGoals = getContractGoals(ccode).clGoals;
		var hoursGoals = getContractGoals(ccode).cCTGoals;
				
		// contract.CONTRACT_FIRSTDATE = firstDate;
		// contract.CONTRACT_LASTDATE = lastDate;
		// contract.CONTRACT_GOTTEN_CLASSGOALS = classGoals;
		
		var value2and3diff = parseInt(diffDays+1/30*classGoals);
		var value2and3diffHours = parseInt(diffDays+1/30*hoursGoals);
		
		if(isNaN(value2and3diff)){value2and3diff = 0;}
		
		// console.log(value2and3diff);
		
		value4ForClassPoint = value4ForClassPoint+value2and3diff;
		
		
		if(isNaN(value2and3diffHours)){value2and3diffHours = 0;}
		
		value4ForHoursPoint = value4ForHoursPoint+value2and3diffHours;
		
	}
	
	// console.log(uniqueClasesCount);
	// console.log(value4ForClassPoint);
	// console.log(value4ForHoursPoint);
	
	
	// ------------------------------------EVENTOS
	// ------------------------------------EVENTOS
	// ------------------------------------EVENTOS

	// console.log("Eventos filtrados");
	// console.log(value4ForClassPoint);
	
		
	// PARA EVENTOS FILTROS A APLICAR: 
	
	// VALOR 1: CANTIDAD DE EVENTOS CERRADOS, COMPARO FECHA CIERRE
	
	var monthEvents = [];
	var uniqueEvContracts = [];
	
	for(var i=0; i<filteredResultEvents.length; i++)
	{
		var ev = filteredResultEvents[i];
		var date = ev.EVENT_DATE_END.split(" ")[0];
		// console.log(ev);
		// FILTER BY MONTH
		if(date < firstDay || date > lastDay){continue;}
		else{monthEvents.push(ev);}
		
		var contractCode = ev.EVENT_CONTRACT_CODE;
		// console.log(contractCode);
		if(!uniqueEvContracts.includes(contractCode))
		{uniqueEvContracts.push(contractCode)}
		
	}
	var eventVal1 = monthEvents.length;
	
	// VALOR 2: PARA CADA CONTRATO UNICO, DIFERENCIA FECHAS BASADO EN LOGICA DE CLASES+1/30 
	var eventVal2 = 0;
	// VALOR 3: SUMATORIA DE TODAS LAS METAS DE EVENTOS (DIRIGIDOS + APOYADOS);
	var eventVal3 = 0;
	
	for(var i=0; i<uniqueEvContracts.length; i++)
	{
		var ccode = uniqueEvContracts[i];
		
		for(var co=0; co<rContract.length; co++)
		{
			if(ccode == rContract[co].CONTRACT_CODE)
			{var contract = rContract[co]; break;}
		}
		
		// console.log(contract);
		
		// GET VALUE 2 AND 3
		var contractInidate = contract.CONTRACT_INIDATE;
		var contractEnddate = contract.CONTRACT_ENDATE;
		var filterInidate = document.getElementById("INIDATE_PICKER").value;
		var filterEnddate = document.getElementById("ENDDATE_PICKER").value;
		
		// GET MINOR INI DATE
		if(contractInidate <= filterInidate){var firstDate = filterInidate;}
		else{var firstDate = contractInidate;}
		
		// GET MINOR END DATE
		if(contractEnddate >= filterEnddate){var lastDate = filterEnddate;}
		else{var lastDate = contractEnddate;}
		var diffDays = getdDiff(firstDate, lastDate);
		
		var eventGoalsD = getEventContractGoals(ccode).evGoalsD;
		var eventGoalsS = getEventContractGoals(ccode).evGoalsS;
		
		var tmpDiff1 = parseInt(diffDays+1/30);
		
		if(isNaN(tmpDiff1)){tmpDiff1 = 0;}
		
		eventVal2 = eventVal2 + tmpDiff1;
		eventVal3 = eventVal3 + eventGoalsD + eventGoalsS;
	}
	
	// console.log(eventVal2);
	// console.log(eventVal3);
	
	// VALOR 4: VALOR 2 * VALOR 3, SACO PARTE ENTERA = VALOR CONTRATO UNICO (SUMATORIA DE ESTE VALOR PARA TODOS LOS CONTRATOR)
	var eventVal4 = eventVal2*eventVal3;
	// console.log(eventVal4);
	
	// PUNTO EVENTOS = VALOR 1/VALOR 4 
	var eventPoint = (eventVal1/eventVal4)*100;
	
	// console.log(eventPoint);
	
	// SUBTIPO GRUPOS Y CIUDADANOS: 0 POR DEFECTO
	
	
	// ------------------------------------VISITAS HECHAS---------------------------------
	// ------------------------------------VISITAS HECHAS---------------------------------
	// ------------------------------------VISITAS HECHAS---------------------------------
	
	if(document.getElementById("G_TYPE").value == "Contratistas")
	{var visitPoolGiven = filteredResultVisitsGiven;}
	else{var visitPoolGiven = filteredResultVisits;}
	
	
	// FILTRAR POR FECHA
	
	var monthGivenVis = [];
	
	for(var i=0; i<visitPoolGiven.length; i++)
	{
		var vis = visitPoolGiven[i];
		var date = vis.VISIT_CLASS_DATE;
		// FILTER BY MONTH
		if(date < firstDay || date > lastDay){continue;}
		else{monthGivenVis.push(vis);}
	}
	
	// console.log(monthGivenVis);
	
	
	
	var vDoneVal2 = monthGivenVis.length;
	
	
	
	// VALOR 1: CANTIDAD VISITAS, QUE COINCIDAN LO DICHO EN LA VISITA CON LA REALIDAD DE LA CLASE, QUE APAREZCAN COMO REALIZADAS "SI" Y QUE LA CLASE TENGA ASISTENCIA O QUE APAREZCAN COMO NO REALIZADA Y LA CLASE NO TENGA ASISTENCIA.

	// VALOR 2: MISMO DE ARRIBA PERO SIN EVALUAR COINCIDENCIA

	// PUNTO GRAFICO = V1 / V2
	
	var givenCoincident = [];
	
	for(var i=0; i<monthGivenVis.length; i++)
	{
		var vis = monthGivenVis[i];
		
		var classDone = vis.VISIT_DONE.split(" ")[0];
		// console.log(classDone);
		var vClassCode = vis.VISIT_CLASS;
		var thaClass = "";
		for(var j=0; j<actualClasses.length; j++)
		{
			var cl = actualClasses[j];
			if(cl.CLASS_CODE == vClassCode){var thaClass = cl;break;}
		}
		
		if(thaClass != "")
		{
			var clAssist = thaClass.CLASS_ASSIST_QTY;
			// console.log(clAssist);
			if(classDone == "Si" && parseInt(clAssist) > 0){givenCoincident.push(vis);}
			if(classDone == "No" && parseInt(clAssist) == 0){givenCoincident.push(vis);}
			
		}
	}
	
	var vDoneVal1 = givenCoincident.length;
	
	// console.log(givenCoincident);
	if(givenCoincident.length > 0)
	{
		for(var i=0; i<givenCoincident.length; i++)
		{
			var visit = givenCoincident[i];
			visitsAssisTotal = visitsAssisTotal+parseInt(visit.VISIT_ASSISTQTY);
			visitsNoAssisTotal = visitsNoAssisTotal+parseInt(visit.VISIT_NOASSISTQTY);
		}
	}

	
	
	// console.log(vDoneVal1);
	// console.log(vDoneVal2);
	
	var givenVisitsPoint = (vDoneVal1/vDoneVal2)*100;
	
	
	
	// ------------------------------------VISITAS RECIBIDAS---------------------------------
	// ------------------------------------VISITAS RECIBIDAS---------------------------------
	// ------------------------------------VISITAS RECIBIDAS---------------------------------
	
	if(document.getElementById("G_TYPE").value == "Contratistas")
	{var visitPoolGot = filteredResultVisitsGot;}
	else{var visitPoolGot = filteredResultVisits;}
	
	// console.log(visitPoolGot);
	
	// FILTRAR POR FECHA
	
	var monthGotVis = [];
	
	for(var i=0; i<visitPoolGot.length; i++)
	{
		var vis = visitPoolGot[i];
		var date = vis.VISIT_CLASS_DATE;
		// FILTER BY MONTH
		if(date < firstDay || date > lastDay){continue;}
		else{monthGotVis.push(vis);}
	}
	
	// console.log(monthGotVis);
	
	
	var vGotVal2 = monthGotVis.length;
	
	
	
	// VALOR 1: CANTIDAD VISITAS, QUE COINCIDAN LO DICHO EN LA VISITA CON LA REALIDAD DE LA CLASE, QUE APAREZCAN COMO REALIZADAS "SI" Y QUE LA CLASE TENGA ASISTENCIA O QUE APAREZCAN COMO NO REALIZADA Y LA CLASE NO TENGA ASISTENCIA.

	// VALOR 2: MISMO DE ARRIBA PERO SIN EVALUAR COINCIDENCIA

	// PUNTO GRAFICO = V1 / V2
	
	var gotCoincident = [];
	
	for(var i=0; i<monthGotVis.length; i++)
	{
		var vis = monthGotVis[i];
		
		var classDone = vis.VISIT_DONE.split(" ")[0];
		// console.log(classDone);
		var vClassCode = vis.VISIT_CLASS;
		var thaClass = "";
		for(var j=0; j<actualClasses.length; j++)
		{
			var cl = actualClasses[j];
			if(cl.CLASS_CODE == vClassCode){var thaClass = cl;break;}
		}
		
		if(thaClass != "")
		{
			var clAssist = thaClass.CLASS_ASSIST_QTY;
			// console.log(clAssist);
			if(classDone == "Si" && parseInt(clAssist) > 0){gotCoincident.push(vis);}
			if(classDone == "No" && parseInt(clAssist) == 0){gotCoincident.push(vis);}
			
		}
	}
	
	// console.log(gotCoincident);
	
	if(gotCoincident.length > 0)
	{
		for(var i=0; i<gotCoincident.length; i++)
		{
			var visit = gotCoincident[i];
			visitsAssisTotal = visitsAssisTotal+parseInt(visit.VISIT_ASSISTQTY);
			visitsNoAssisTotal = visitsNoAssisTotal+parseInt(visit.VISIT_NOASSISTQTY);
		}
	}
	
	
	console.log(visitsAssisTotal);
	console.log(visitsNoAssisTotal);
	
	var vGotVal1 = gotCoincident.length;
	var gotVisitsPoint = (vGotVal1/vGotVal2)*100;


	var result = {};
	result.assist = round(((totalAssisted/totalDictated)*100),1);
	result.groups = round(((totalCombi/totalCombiGoal)*100),1);
	result.coverage = round(((contrCount/coverSum)*100),1);
	result.classes = round((uniqueClasesCount/value4ForClassPoint*100), 1);
	result.hours = round((totalClassesDuration/value4ForHoursPoint*100), 1);
	result.events = round(eventPoint, 1);
	result.givenVisits = round(givenVisitsPoint, 1);
	result.gotVisits = round(gotVisitsPoint, 1);
	
	
	// ACUMULATE FOR TOTALS BOX ---------------------------------
	// ACUMULATE FOR TOTALS BOX ---------------------------------
	// ACUMULATE FOR TOTALS BOX ---------------------------------
	// ACUMULATE FOR TOTALS BOX ---------------------------------
	
	groupsTotal1 = groupsTotal1+totalCombi;
	groupsTotal2 = groupsTotal2+totalCombiGoal;
	
	
	coverTotal1 = coverTotal1+contrCount;
	coverTotal2 = coverTotal2+coverSum;
	
	
	classTotal1 = classTotal1+uniqueClasesCount;
	classTotal2 = classTotal2+value4ForClassPoint;
	
	
	hoursTotal1 = hoursTotal1+totalClassesDuration;
	hoursTotal2 = hoursTotal2+value4ForHoursPoint;
	
	
	eventsTotal1 = eventsTotal1+eventVal1;
	eventsTotal2 = eventsTotal2+eventVal4;
	
	gotVisTotal1 = gotVisTotal1+vGotVal1;
	gotVisTotal2 = gotVisTotal2+vGotVal2;

	givenVisTotal1 = givenVisTotal1+vDoneVal1;
	givenVisTotal2 = givenVisTotal2+vDoneVal2;
	
	totalAssistedClasses = totalAssistedClasses+totalAssisted;
	totalDictatedClasses = totalDictatedClasses+totalDictated;
	
	
	if(document.getElementById("G_TYPE").value == "Grupos")
	{
		result.groups = 100;
		// PUNTO, COBERTURA PARA GRUPOS: RELACIONES UNICAS CONTRATO-GRUPO-CLASE, PROMEDIO POR GRUPO-CONTRATO, SE SUMAN TODOS LOS PROMEDIOS Y REEMPLAZAN AL VALOR 2.
		
		var keys = Object.keys(coverageProms);
		var coverGroupsPeople = 0;
		for(var x=0; x<keys.length; x++)
		{
			var qty = coverageProms[keys[x]].PEOPLE;
			coverGroupsPeople = coverGroupsPeople+qty;
		}
		var value2 = coverGroupsPeople;

		var coverageGrouPoint = round(((contrCount/value2)*100));
		result.coverage = coverageGrouPoint;
		result.classes = round((uniqueClasesCount/classClassesGoals*100),1);
		result.hours = round((totalClassesDuration/classHoursGoals*100),1);
		result.events = 0;
		
	}
	if(document.getElementById("G_TYPE").value == "Ciudadano")
	{
		result.groups = 100;
		result.coverage = 100;
		result.classes = round((uniqueClasesCount/classClassesGoals*100));
		result.hours = round((totalClassesDuration/classHoursGoals*100),1);
		result.events = 0;
	}
		
	console.log(result);
	return result;
}

function round(value, precision) 
{
    var multiplier = Math.pow(10, precision || 0);
    return Math.round(value * multiplier) / multiplier;
}

function refreshChart(chartCode)
{
	if(chartCode == "GENERAL_CHART")
	{
		// console.log(chartCode);
		// console.log(actualMonths);
		// console.log(filteredResult);
		
		
		var pickedGF = getPickedIds("GFILTERS_PICKER");
		// console.log(pickedGF);
		
		//filtered
		
		// ASSIST DATASET
		
		var dataSets = [];
			
		// console.log(assistValues);
		
		var assist = {};
		assist.label = "% Asistencia";
		assist.backgroundColor = 'rgb(255, 99, 132)';
		assist.borderColor = 'rgb(255, 99, 132, 0.40)';
		assist.borderWidth = '5';
		assist.tension = 0.1;
		assist.data = assistValues;
		
		var group = {};
		group.label = "% Grupos";
		group.backgroundColor = 'rgb(160, 99, 132)';
		group.borderColor = 'rgb(160, 99, 132, 0.40)';
		group.borderWidth = '5';
		group.tension = 0.1;
		group.data = groupValues;
		
		
		var coverage = {};
		coverage.label = "% Cobertura";
		coverage.backgroundColor = 'rgb(31, 158, 16)';
		coverage.borderColor = 'rgb(31, 158, 16, 0.40)';
		coverage.borderWidth = '5';
		coverage.tension = 0.1;
		coverage.data = coverageValues;
		
		var classes = {};
		classes.label = "% Clases";
		classes.backgroundColor = 'rgb(81, 58, 116)';
		classes.borderColor = 'rgb(81, 58, 116, 0.40)';
		classes.borderWidth = '5';
		classes.tension = 0.1;
		classes.data = classValues;
		
		var hours = {};
		hours.label = "% Horas";
		hours.backgroundColor = 'rgb(181, 128, 16)';
		hours.borderColor = 'rgb(181, 128, 16, 0.40)';
		hours.borderWidth = '5';
		hours.tension = 0.1;
		hours.data = hoursValues;
		
		var events = {};
		events.label = "% Eventos";
		events.backgroundColor = 'rgb(11, 28, 160)';
		events.borderColor = 'rgb(11, 28, 160, 0.40)';
		events.borderWidth = '5';
		events.tension = 0.1;
		events.data = eventsValues;
		
		var gVisits = {};
		gVisits.label = "% Visitas realizadas";
		gVisits.backgroundColor = 'rgb(51, 78, 60)';
		gVisits.borderColor = 'rgb(51, 78, 60, 0.40)';
		gVisits.borderWidth = '5';
		gVisits.tension = 0.1;
		gVisits.data = givenVisitsValues;
		
		var gottenVisits = {};
		gottenVisits.label = "% Visitas recibidas";
		gottenVisits.backgroundColor = 'rgb(151, 158, 120)';
		gottenVisits.borderColor = 'rgb(151, 158, 120, 0.40)';
		gottenVisits.borderWidth = '5';
		gottenVisits.tension = 0.1;
		gottenVisits.data = gotVisitsValues;
		
		
		
		// PUSH SELECTED ON LINES CONTROL
		if(pickedGF.includes("Asistencia")){dataSets.push(assist);}
		if(pickedGF.includes("Grupos")){dataSets.push(group);}
		if(pickedGF.includes("Cobertura")){dataSets.push(coverage);}
		if(pickedGF.includes("Clases")){dataSets.push(classes);}
		if(pickedGF.includes("Horas")){dataSets.push(hours);}
		if(pickedGF.includes("Eventos")){dataSets.push(events);}
		if(pickedGF.includes("Visitas realizadas")){dataSets.push(gVisits);}
		if(pickedGF.includes("Visitas recibidas")){dataSets.push(gottenVisits);}
		
				
		
		var chartBox = document.getElementById(chartCode);
		chartBox.innerHTML = "";
		// console.log(chartBox);
		
		var chart = document.createElement("canvas");
		chart.id = "GENERAL_CHART_CANVAS";
		chart.className = "chartBasic";
		
		chartBox.appendChild(chart);
		
		var labels = actualMonths;
		
		var data = 
		{
		  labels: labels,
		  datasets: dataSets
		};
		
		var config = 
		{
		  type: 'line',
		  data,
		  options: 
		  {
			  scales: 
				{
				  y: {beginAtZero: true}
				},
			suggestedMin: 0,
			suggestedMax: 100
		  }
		};
		
		
		var draw = new Chart(document.getElementById('GENERAL_CHART_CANVAS'),  config);
	}

	
	
}

function getContractGoals(code)
{
	var cGgoals = 0;
	var cPgoals = 0;
	var cCTgoals = 0;
	var cCgoals = 0;
	
	// GET TIMEGOALS IN HOURS
	// GET TIMEGOALS IN HOURS
	// GET TIMEGOALS IN HOURS
	// GET TIMEGOALS IN HOURS
	
	for(var i=0; i<rContract.length; i++)
	{
		var contract = rContract[i];
		if(contract.CONTRACT_CODE == code)
		{
			var goals = JSON.parse(contract.CONTRACT_OTHER_GOALS);
			
			for(var g=0; g<goals.length; g++)
			{
				var goal = goals[g];
				// console.log(goal);
				cPgoals = cPgoals+ parseInt(goal.V3);
				cCgoals = cCgoals+ parseInt(goal.V1);
				cCTgoals = cCTgoals+parseInt(goal.V2);
			}
			
			cGgoals = goals.length;	
			break;
		}
	}
	
	
	
	var ans = {};
	ans.grGoals = cGgoals;
	ans.peGoals = cPgoals;
	ans.clGoals = cCgoals;
	ans.cCTGoals = cCTgoals;
	
	// console.log(ans);
	
	return ans;
}

function getEventContractGoals(code)
{
	var evGoalsD = 0;
	var evGoalsS = 0;


	// console.log(actualDB.contracts);
	// console.log(code);

	for(var i=0; i<actualDB.contracts.length; i++)
	{
		var contract = actualDB.contracts[i];
		if(contract.CONTRACT_CODE == code)
		{
			var evGoals = JSON.parse(contract.CONTRACT_EVENT_GOALS);
			// console.log(evGoals);
			
			for(var g=0; g<evGoals.length; g++)
			{
				var goal = evGoals[g];
				// console.log(goal);
				evGoalsD = evGoalsD+parseInt(goal.V1);
				evGoalsS = evGoalsS+parseInt(goal.V2);

			}
			
			// cGgoals = goals.length;	
			// break;
		}
	}
	
	
	
	var ans = {};
	ans.evGoalsD = evGoalsD;
	ans.evGoalsS = evGoalsS;
	
	// console.log(ans);
	
	return ans;
}

function getResults(filters)
{
	// console.log(filters);
	// console.log(assistLines);
	
	var result = [];
	
	var iniDate = document.getElementById("INIDATE_PICKER").value;
	var endDate = document.getElementById("ENDDATE_PICKER").value;
	
	fPrograms = [];
	fContratists = [];
	fContract = [];
	fProjects = [];
	fActivities = [];
	fGenders = [];
	fEtnia = [];
	fInstcom = [];
	fPrevir = [];
	fZones = [];
	fHoods = [];
	fGroups = [];
	fCitizens = [];
	fUrbral = [];
	fEtaries = [];
	fConditions = [];
	
	// -----------------********************
	
	// FOR INDICATORS MAIN TABLE
	uniqueDocGroupLinks = [];
	uniqueGroups = [];
	
	
	// -----------------********************
	
	
	// GET MONTHS FOR CONTINUITY
	actualMonths = getMonthsBetween(iniDate, endDate);
	
	for(var i=0; i<assistLines.length; i++)
	{
		var assistLine = assistLines[i];
		
		// console.log(assistLine);
		if(assistLine["CLASS_ASSISTED"] == "0"){continue;}
		
		
		// GET ASSIST FOR LINE
		var assistData = getAssistAssistData(assistLine["CLASS_IDNUM"], assistLine["CLASS_GROUP"]);
		assistLine.CLASS_GROUP_TOTAL_CLASSES = assistData.TOTAL_CLASSES;
		assistLine.CLASS_GROUP_ASSISTED_CLASSES = assistData.TOTAL_ASSISTED_CLASSES;
		assistLine.CLASS_CONTINUITY = assistData.CONTINUITY;
		assistLine.ASSIST_PERCENT = parseFloat(assistData.TOTAL_ASSISTED_CLASSES)/parseFloat(assistData.TOTAL_CLASSES)*100;

		if(document.getElementById("PERCENT_PICKER"))
		{
			var percent = document.getElementById("PERCENT_PICKER").value;
			// if(assistLine.ASSIST_PERCENT < percent){console.log(assistLine);}
			if(assistLine.ASSIST_PERCENT < percent){continue;}
		}
		
		if(document.getElementById("MONTHS_PICKER"))
		{
			var continuity = document.getElementById("MONTHS_PICKER").value;
			// if(assistLine.ASSIST_PERCENT < percent){console.log(assistLine);}
			if(assistLine.CLASS_CONTINUITY < continuity){continue;}
		}
		
		
		
		
		// APPLY FILTERS
		if(assistLine["CLASS_DATE"] < iniDate || assistLine["CLASS_DATE"] > endDate){continue;}
		if("PROGRAMS_PICKER" in filters){if(!filters["PROGRAMS_PICKER"].includes(assistLine["CLASS_PROGRAM"])){continue;}}
		if("ACTIVITY_PICKER" in filters){if(!filters["ACTIVITY_PICKER"].includes(assistLine["CLASS_ACTIVITY"])){continue;}}
		if("ETARIES_PICKER" in filters){if(!filters["ETARIES_PICKER"].includes(assistLine["CLASS_ETARIE"])){continue;}}
		if("CONDITIONS_PICKER" in filters){var valid = checkArrayCross(filters["CONDITIONS_PICKER"],assistLine["CLASS_CONDITIONS"]);if(valid != 1){continue;}}
		if("GENDER_PICKER" in filters){if(!filters["GENDER_PICKER"].includes(assistLine["CLASS_GENDER"])){continue;}}
		if("ETNIA_PICKER" in filters){if(!filters["ETNIA_PICKER"].includes(assistLine["CLASS_ETNIA"])){continue;}}
		if("INSTCOM_PICKER" in filters){if(!filters["INSTCOM_PICKER"].includes(assistLine["CLASS_INSTYPE"])){continue;}}
		if("PREVIR_PICKER" in filters){if(!filters["PREVIR_PICKER"].includes(assistLine["CLASS_PREVIR"])){continue;}}
		if("URBRAL_PICKER" in filters){if(!filters["URBRAL_PICKER"].includes(assistLine["CLASS_URBRAL"])){continue;}}
		if("ZONE_PICKER" in filters){if(!filters["ZONE_PICKER"].includes(assistLine["CLASS_ZONE"])){continue;}}
		if("HOOD_PICKER" in filters){if(!filters["HOOD_PICKER"].includes(assistLine["CLASS_HOOD"])){continue;}}
		if("PROJECT_PICKER" in filters){if(!filters["PROJECT_PICKER"].includes(assistLine["CLASS_PROJECT"])){continue;}}
		if("CONTRATISTS_PICKER" in filters){if(!filters["CONTRATISTS_PICKER"].includes(assistLine["CLASS_TUTOR"])){continue;}}
		if("CONTRACT_PICKER" in filters){if(!filters["CONTRACT_PICKER"].includes(assistLine["CLASS_CONTRACT_CODE"])){continue;}}
		if("GROUP_PICKER" in filters){if(!filters["GROUP_PICKER"].includes(assistLine["CLASS_GROUP"])){continue;}}
		if("CITIZEN_PICKER" in filters){if(!filters["CITIZEN_PICKER"].includes(assistLine["CLASS_IDNUM"])){continue;}}

		
		// BUILD UNIQUE RESULTS FOR THE ONES GOT HERE
		if(!fPrograms.includes(assistLine["CLASS_PROGRAM"])){fPrograms.push(assistLine["CLASS_PROGRAM"]);}
		if(!fContratists.includes(assistLine["CLASS_TUTOR"])){fContratists.push(assistLine["CLASS_TUTOR"]);}
		if(!fContract.includes(assistLine["CLASS_CONTRACT_CODE"])){fContract.push(assistLine["CLASS_CONTRACT_CODE"]);}
		if(!fProjects.includes(assistLine["CLASS_PROJECT"])){fProjects.push(assistLine["CLASS_PROJECT"]);}
		if(!fActivities.includes(assistLine["CLASS_ACTIVITY"])){fActivities.push(assistLine["CLASS_ACTIVITY"]);}
		if(!fGenders.includes(assistLine["CLASS_GENDER"])){fGenders.push(assistLine["CLASS_GENDER"]);}
		if(!fEtnia.includes(assistLine["CLASS_ETNIA"])){fEtnia.push(assistLine["CLASS_ETNIA"]);}
		if(!fInstcom.includes(assistLine["CLASS_INSTYPE"])){fInstcom.push(assistLine["CLASS_INSTYPE"]);}
		if(!fPrevir.includes(assistLine["CLASS_PREVIR"])){fPrevir.push(assistLine["CLASS_PREVIR"]);}
		if(!fZones.includes(assistLine["CLASS_ZONE"])){fZones.push(assistLine["CLASS_ZONE"]);}
		if(!fHoods.includes(assistLine["CLASS_HOOD"])){fHoods.push(assistLine["CLASS_HOOD"]);}
		if(!fGroups.includes(assistLine["CLASS_GROUP"])){fGroups.push(assistLine["CLASS_GROUP"]);}
		if(!fCitizens.includes(assistLine["CLASS_IDNUM"])){fCitizens.push(assistLine["CLASS_IDNUM"]);}
		if(!fUrbral.includes(assistLine["CLASS_URBRAL"])){fUrbral.push(assistLine["CLASS_URBRAL"]);}
		if(!fEtaries.includes(assistLine["CLASS_ETARIE"])){fEtaries.push(assistLine["CLASS_ETARIE"]);}
		
		addToConditionsF(assistLine["CLASS_CONDITIONS"]);
		
		var docGroup = assistLine.CLASS_IDNUM+"-"+assistLine.CLASS_GROUP;
		var justGroup = assistLine.CLASS_GROUP;
		
		
		if(!uniqueDocGroupLinks.includes(docGroup)){uniqueDocGroupLinks.push(docGroup);}
		if(!uniqueGroups.includes(justGroup)){uniqueGroups.push(justGroup);}
		

		result.push(assistLine);

	}
	
	// console.log(uniqueDocGroupLinks);
	// console.log(uniqueGroups);


	loadManager(0);
	return result;
	
}

function getMonthsBetween(start, end)
{
	var date1 = new Date(start);
	date1.setDate(date1.getDate() + 1);
	var firstDay = new Date(date1.getFullYear(), date1.getMonth(), 1);
	
	var date2 = new Date(end);
	date2.setDate(date2.getDate() + 1);
	var lastDay = new Date(date2.getFullYear(), date2.getMonth() + 1, 0);

	var months = [];
	var i = 0;
	
	while (firstDay <= lastDay) 
	{
	  var firstDay = new Date(date1.getFullYear(), date1.getMonth()+i , 1);  i++;
	  if(firstDay >= lastDay){break;} 
	  var day = getNowFormat(firstDay, "ini");
	  var month = day.split("-")[0]+"-"+day.split("-")[1];
	  if(!months.includes(month)){months.push(month)}
	}
	return months;
}

function getAssistAssistData(idNum, group, date1, date2)
{
	// console.log(dictatedClases);
	
	var result = {};
	
	if(date1 != null && date2 != null)
	{
		var iniDate = date1;
		var endDate = date2;
	}
	else
	{
		var iniDate = document.getElementById("INIDATE_PICKER").value;
		var endDate = document.getElementById("ENDDATE_PICKER").value;
	}
	
	
	var groupClases = [];
	
	// OBTENER CUANTAS Y CUALES CLASES TUVO ESTE GRUPO
	for(var i=0; i<dictatedClases.length; i++)
	{
		var dictated = dictatedClases[i];
		if(dictated["CLASS_DATE"] < iniDate || dictated["CLASS_DATE"] > endDate){continue;}
		if(dictated.CLASS_GROUP == group)
		{
			// VERIFY IF THE USER WAS SUPPOSED TO BE THERE
			var classCitizens = dictated.CLASS_CITIZENS;
			classCitizens = classCitizens.replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;');
			
			// IF USER WAS NOT IN THE LIST DONT COUNT
			if(classCitizens.includes(idNum)){groupClases.push(dictated);}
		}
	}
	
	// console.log(groupClases);
	
	// OBTENER A CUANTAS DE ESAS FUE ESTE USUARIO
	var assistedCitizen = 0;
	for(var i=0; i<groupClases.length; i++)
	{
		var classCitizens = groupClases[i].CLASS_CITIZENS;
		classCitizens = classCitizens.replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;');
		classCitizens = JSON.parse(classCitizens);
		
		for(var c=0; c<classCitizens.length; c++)
		{
			var citizen = classCitizens[c];
			if(citizen.CITIZEN_IDNUM == idNum && citizen.CITIZEN_ASSIST == "1")
			{assistedCitizen++;}
		}
	}
	
	// GET COMPARE CONTINUITY
	
	var continuity = 0;
	var maxCon = 0;
	// console.log(actualMonths);
	// console.log(citizenMonthsAssisted);
	
	var linkedMissed = 0;
	
	var assistedMonths = citizenMonthsAssisted[idNum];
	
	for(var i=0; i<actualMonths.length; i++)
	{
		var month = actualMonths[i];
		if(assistedMonths.includes(month))
		{
			continuity++;
			if(maxCon <= continuity){maxCon = continuity;}
			linkedMissed = 0;
		}
		else
		{
			linkedMissed++;
			if(linkedMissed > 1){continuity = 0;linkedMissed = 0;}
		}
	}
	
	// console.log("final: "+continuity);
	// console.log("max: "+maxCon);
	
	result.TOTAL_CLASSES = groupClases.length;
	result.TOTAL_ASSISTED_CLASSES = assistedCitizen;
	result.CONTINUITY = maxCon;
	return result;
	
}

function checkArrayCross(list1, list2)
{
	var match = 0;
	for(var i=0; i<list1.length; i++)
	{
		var item = String(list1[i]);
		if(list2 == null || list2 == ""){continue;}
		if(list2.includes(item)){match = 1;}
	}
	return match;
}

function reportStart()
{
	var info = {};
	info.ENTITY = userData.USER_ENTITY;
	info.ADMIN = userData.USER_TYPE;
	console.log(info);
	
	loadManager(1);
	
	sendAjax("users","reportStart",info,function(response)
	{
		actualDB = response.message;
		console.log(actualDB);
		
		loadManager(0);
		
		// TESTING ONLY
		// TESTING ONLY
		// TESTING ONLY
		document.getElementById("REPORT_PICKER").value = "General";
		document.getElementById("INIDATE_PICKER").value = "2021-06-18";
		document.getElementById("ENDDATE_PICKER").value = "2021-06-18";
		
		// document.getElementById("INIDATE_PICKER").value = "2021-07-08";
		// document.getElementById("ENDDATE_PICKER").value = "2021-07-08";
		
		loadReport();
		
	});
}

function filteredDB(mode, classes)
{
	if(mode == "General")
	{
		totalAssist = 0;
		
		iPrograms = [];
		iContratists = [];
		iContract = [];
		iProjects = [];
		iActivities = [];
		iGenders = [];
		iEtnia = [];
		iInstcom = [];
		iPrevir = [];
		iZones = [];
		iHoods = [];
		iGroups = [];
		iCitizens = [];
		iUrbral = [];
		iEtaries = [];
		iConditions = [];
		
		dictatedClases = [];
		citizenMonthsAssisted = {};
		assistLines = [];
		unContrCtzenLnks = [];
		unContrGrClss = [];
		uniqueContracts = [];
		uniqueClases = [];
		
		contratistsClasses = {};
		
		for(var i=0; i<classes.length; i++)
		{
			var cla = classes[i];
			var citizens = [];
			cla.CLASS_CITIZENS = cla.CLASS_CITIZENS.replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;');
			if(cla.CLASS_CITIZENS != null && cla.CLASS_CITIZENS != "" && cla.CLASS_CITIZENS != "null")
			{
				var citizens = JSON.parse(cla.CLASS_CITIZENS);
				cla["CLASS_LIST_QTY"] = citizens.length;
				
				// GET ASSISTANTS TO CLASS
				var came = 0;
				for(var a=0; a<citizens.length; a++)
				{if(citizens[a].CITIZEN_ASSIST == "1"){came++;}}
				cla["CLASS_ASSIST_QTY"] = came;
				
				// GET CLASS STATE
				if(came == 0)
				{
					cla["CLASS_STATE"] = "Abierta";
					if(actualExcused.includes(cla.CLASS_CODE)){cla["CLASS_STATE"] = "No dictada";}
				}
				else
				{
					cla["CLASS_STATE"] = "Dictada";
					dictatedClases.push(cla);
				}
				
				
				// GET CONTRATISTS CLASES
				// console.log(cla);
				var tutor = cla["CLASS_TUTOR"]
				
				if(contratistsClasses.hasOwnProperty(tutor))
				{
					contratistsClasses[tutor].push(cla["CLASS_STATE"]);
				}
				else
				{
					contratistsClasses[tutor] = [];
					contratistsClasses[tutor].push(cla["CLASS_STATE"]);
				}
				
				
				
				// GET CLASS PROYECT
				cla["CLASS_PROJECT"] = getRegFromKey(rActivities, "ACTIVITY_CODE", cla["CLASS_ACTIVITY"]).ACTIVITY_PROJECT;
				
				// GET CLASS PROGRAM
				cla["CLASS_PROGRAM"] = getRegFromKey(rProjects, "PROJECT_CODE", cla["CLASS_PROJECT"]).PROJECT_PROGRAM;

				// GET CLASS PREVIR
				cla["CLASS_PREVIR"] = getRegFromKey(rGroups, "GROUP_CODE", cla["CLASS_GROUP"]).GROUP_PREVIR;
				
				// GET CLASS INSTYPE
				cla["CLASS_INSTYPE"] = getRegFromKey(rGroups, "GROUP_CODE", cla["CLASS_GROUP"]).GROUP_INSTYPE;
				
				// GET CLASS HOOD
				cla["CLASS_HOOD"] = getRegFromKey(rGroups, "GROUP_CODE", cla["CLASS_GROUP"]).GROUP_HOOD;
				
				// GET CLASS ZONE
				cla["CLASS_ZONE"] = getRegFromKey(rHoods, "HOOD_CODE", cla["CLASS_HOOD"]).HOOD_ZONE;
				
				// GET CLASS URBRAL
				var urbral = getRegFromKey(rZones, "ZONE_CODE", cla["CLASS_ZONE"]).ZONE_TYPE;
				if(urbral == "Comuna"){cla["CLASS_URBRAL"] = "Urbano";}
				else{cla["CLASS_URBRAL"] = "Rural";}
				
				
				// TOTAL ASSISTANTS TO CLASS
				totalAssist = totalAssist+came;
				
			}
			
			
			
			for(var c=0; c<citizens.length; c++)
			{
				var citizen = citizens[c];
				var citizenData = getRegFromKey(rCitizens, "CITIZEN_IDNUM", citizen["CITIZEN_IDNUM"]);
				
				// ONLY ASSISTED RECORDS
				// ONLY ASSISTED RECORDS
				// ONLY ASSISTED RECORDS
				if(citizen.CITIZEN_ASSIST == "0"){continue;}
				
				
				// FILL CITIZENS MONTH ASSISTED
				var idNum = citizenData.CITIZEN_IDNUM;
				var classMonth = cla.CLASS_DATE.split("-")[0]+"-"+cla.CLASS_DATE.split("-")[1];
				if(citizenMonthsAssisted.hasOwnProperty(idNum))
				{
					var months = citizenMonthsAssisted[idNum];
					if(!months.includes(classMonth)){citizenMonthsAssisted[idNum].push(classMonth);}
				}
				else
				{
					citizenMonthsAssisted[idNum] = [];
					citizenMonthsAssisted[idNum].push(classMonth);
				}
				
				// SELECT UNIQUE CITIZEN-CONTRACT RELATIONS
				var uniqueCntrCznKey = cla.CLASS_DATE+"-x-"+cla.CLASS_CONTRACT_CODE+"-"+citizenData.CITIZEN_IDNUM;
				if(!unContrCtzenLnks.includes(uniqueCntrCznKey))
				{unContrCtzenLnks.push(uniqueCntrCznKey);}
			
				// SELECT UNIQUE CONTRACT-GROUP-CLASS RELATIONS
				var uniqueCntrGrClKey = cla.CLASS_DATE+"-x-"+cla.CLASS_CONTRACT_CODE+"-"+cla.CLASS_GROUP+"-"+cla.CLASS_CODE;
				if(!unContrGrClss.includes(uniqueCntrGrClKey))
				{unContrGrClss.push(uniqueCntrGrClKey);}
			
				// SELECT UNIQUE CONTRACTS
				var uniqueCntr = cla.CLASS_DATE+"-x-"+cla.CLASS_CONTRACT_CODE;
				if(!uniqueContracts.includes(uniqueCntr))
				{uniqueContracts.push(uniqueCntr);}
			
				// SELECT UNIQUE CLASES
				var uniqueClass = cla.CLASS_DATE+"-x-"+cla.CLASS_CODE;
				if(!uniqueClases.includes(uniqueClass))
				{uniqueClases.push(uniqueClass);}
				
				var assistLine = {};
				
				assistLine["CLASS_CODE"] = cla.CLASS_CODE;
				assistLine["CLASS_ACTIVITY"] = cla.CLASS_ACTIVITY;
				assistLine["CLASS_CONTRACT_CODE"] = cla.CLASS_CONTRACT_CODE;
				assistLine["CLASS_CONTRACT_NUMBER"] = cla.CLASS_CONTRACT_NUMBER;
				assistLine["CLASS_DATE"] = cla.CLASS_DATE;
				assistLine["CLASS_ENTITY"] = cla.CLASS_ENTITY;
				assistLine["CLASS_GROUP"] = cla.CLASS_GROUP;
				assistLine["CLASS_HOUR"] = cla.CLASS_HOUR;
				assistLine["CLASS_ACTIVITY_GOALS"] = cla.CLASS_ACTIVITY_GOALS;
				assistLine["CLASS_GROUP_GOAL"] = cla.CLASS_GROUP_GOAL;
				assistLine["CLASS_CLASSES_GOAL"] = cla.CLASS_CLASSES_GOAL;
				assistLine["CLASS_PEOPLE_GOAL"] = cla.CLASS_PEOPLE_GOAL;
				assistLine["CLASS_TIMES_GOAL"] = cla.CLASS_TIMES_GOAL;
				assistLine["CLASS_TUTOR"] = cla.CLASS_TUTOR;
				assistLine["CLASS_LIST_QTY"] = cla.CLASS_LIST_QTY;
				assistLine["CLASS_ASSIST_QTY"] = cla.CLASS_ASSIST_QTY;
				assistLine["CLASS_STATE"] = cla.CLASS_STATE;
				assistLine["CLASS_PROJECT"] = cla.CLASS_PROJECT;
				assistLine["CLASS_PROGRAM"] = cla.CLASS_PROGRAM;
				assistLine["CLASS_PREVIR"] = cla.CLASS_PREVIR;
				assistLine["CLASS_INSTYPE"] = cla.CLASS_INSTYPE;
				assistLine["CLASS_HOOD"] = cla.CLASS_HOOD;
				assistLine["CLASS_ZONE"] = cla.CLASS_ZONE;
				assistLine["CLASS_URBRAL"] = cla.CLASS_URBRAL;
				
				// -----------FROM CITIZEN------------
				
				assistLine["CLASS_ASSISTED"] = citizen.CITIZEN_ASSIST;
				assistLine["CLASS_AGE"] = citizen.CITIZEN_AGE;
				assistLine["CLASS_ETARIE"] = getEtarieFromAge(assistLine["CLASS_AGE"]);
				assistLine["CLASS_IDNUM"] = citizenData.CITIZEN_IDNUM;
				assistLine["CLASS_BDAY"] = citizenData.CITIZEN_BDAY;
				assistLine["CLASS_GENDER"] = citizenData.CITIZEN_GENDER;
				assistLine["CLASS_ETNIA"] = citizenData.CITIZEN_ETNIA;
				assistLine["CLASS_CONDITIONS"] = citizenData.CITIZEN_CONDITION;

				assistLines.push(assistLine);
				
				
				
				// SELECT UNIQUE INCLUDED CODES
				if(!iPrograms.includes(assistLine["CLASS_PROGRAM"])){iPrograms.push(assistLine["CLASS_PROGRAM"]);}
				if(!iContratists.includes(assistLine["CLASS_TUTOR"])){iContratists.push(assistLine["CLASS_TUTOR"]);}
				if(!iContract.includes(assistLine["CLASS_CONTRACT_CODE"])){iContract.push(assistLine["CLASS_CONTRACT_CODE"]);}
				if(!iProjects.includes(assistLine["CLASS_PROJECT"])){iProjects.push(assistLine["CLASS_PROJECT"]);}
				if(!iActivities.includes(assistLine["CLASS_ACTIVITY"])){iActivities.push(assistLine["CLASS_ACTIVITY"]);}
				if(!iGenders.includes(assistLine["CLASS_GENDER"])){iGenders.push(assistLine["CLASS_GENDER"]);}
				if(!iEtnia.includes(assistLine["CLASS_ETNIA"])){iEtnia.push(assistLine["CLASS_ETNIA"]);}
				if(!iInstcom.includes(assistLine["CLASS_INSTYPE"])){iInstcom.push(assistLine["CLASS_INSTYPE"]);}
				if(!iPrevir.includes(assistLine["CLASS_PREVIR"])){iPrevir.push(assistLine["CLASS_PREVIR"]);}
				if(!iZones.includes(assistLine["CLASS_ZONE"])){iZones.push(assistLine["CLASS_ZONE"]);}
				if(!iHoods.includes(assistLine["CLASS_HOOD"])){iHoods.push(assistLine["CLASS_HOOD"]);}
				if(!iGroups.includes(assistLine["CLASS_GROUP"])){iGroups.push(assistLine["CLASS_GROUP"]);}
				if(!iCitizens.includes(assistLine["CLASS_IDNUM"])){iCitizens.push(assistLine["CLASS_IDNUM"]);}
				if(!iUrbral.includes(assistLine["CLASS_URBRAL"])){iUrbral.push(assistLine["CLASS_URBRAL"]);}
				if(!iEtaries.includes(assistLine["CLASS_ETARIE"])){iEtaries.push(assistLine["CLASS_ETARIE"]);}
				
				addToConditions(assistLine["CLASS_CONDITIONS"]);
				
				
				
			}
		}
		
		console.log(assistLines);
		
		
		// FILTER FILTERS
		rPrograms = getIncluded(iPrograms, "PROGRAM_CODE", rPrograms);
		rContratists = getIncluded(iContratists, "USER_CODE", rContratists);
		rContract = getIncluded(iContract, "CONTRACT_CODE", rContract);
		rProjects = getIncluded(iProjects, "PROJECT_CODE", rProjects);
		rActivities = getIncluded(iActivities, "ACTIVITY_CODE", rActivities);
		rGenders = getIncluded(iGenders, "GENDER_CODE", rGenders);
		rEtnia = getIncluded(iEtnia, "ETNIA_CODE", rEtnia);
		rInstcom = getIncluded(iInstcom, "INSTCOM_CODE", rInstcom);
		rPrevir = getIncluded(iPrevir, "PREVIR_CODE", rPrevir);
		rZones = getIncluded(iZones, "ZONE_CODE", rZones);
		rHoods = getIncluded(iHoods, "HOOD_CODE", rHoods);
		rGroups = getIncluded(iGroups, "GROUP_CODE", rGroups);
		rCitizens = getIncluded(iCitizens, "CITIZEN_IDNUM", rCitizens);
		rUrbral = getIncluded(iUrbral, "URBRAL_CODE", rUrbral);
		rEtaries = getIncluded(iEtaries, "ETARIE_CODE", rEtaries);
		rConditions = getIncluded(iConditions, "CONDITION_CODE", rConditions);
		
	
		// console.log(assistLines);
		// console.log(citizenMonthsAssisted);
	
	}
	
	
	// console.log(contratistsClasses);
	
	
}

function addToConditions(list)
{
	if(list != null && list != "")
	{var conds = JSON.parse(list);}
	else
	{var conds = [];}
	for(var i=0; i<conds.length; i++){if(!iConditions.includes(conds[i])){iConditions.push(conds[i]);}}
}

function addToConditionsF(list)
{
	if(list != null && list != "")
	{var conds = JSON.parse(list);}
	else
	{var conds = [];}
	for(var i=0; i<conds.length; i++){if(!fConditions.includes(conds[i])){fConditions.push(conds[i]);}}
}

function getEtarieFromAge(age)
{
	
	var range = "";
	for(var i=0; i<rEtaries.length; i++)
	{
		var etarie = rEtaries[i];
		var etIni = etarie.ETARIE_FROM;
		var etEnd = etarie.ETARIE_TO;
		if(age >= etIni &&  age <= etEnd){range = etarie.ETARIE_CODE;break;}
	}
		
	return range;
}

function getIncluded(picked, field, all)
{
	var selected = [];
	for(var n=0; n<all.length; n++)
	{
		var code = all[n][field];
		var reg = all[n];
		
		for(var m=0; m<picked.length; m++)
		{
			var item = picked[m];
			if(item == code)
			{
				selected.push(reg);
			}
		}
	}
	return selected;
}

function arrayFixer(list, key1, key2)
{
	var fixed = [];
	
	for(var i=0; i<list.length; i++)
	{
		var item = list[i];
		var pos = {};
		pos[key1] = item;
		pos[key2] = item;
		fixed.push(pos);
	}
	
	return fixed;
}

// GET CLASS AVAILABLE GROUPS
function getClassGroups()
{
	var info = {};
	sendAjax("users","getClassGroups",info,function(response)
	{
		var ans = response.message;
		actualClassGroups = ans;
		loadForm("class");
	});
}

// GET ASSIGN CONTRACTS
function getAssignContracts(mode)
{
	var info = {};
	info.USER_CTYPE_F = userData.USER_CTYPE;
	info.USER_ACTIVITIES_F = userData.USER_ACTIVITIES;
	info.USER_ENTITY_F = userData.USER_ENTITY;
	info.MODE = mode;
	
	// console.log(info)
	
	sendAjax("users","getAssignContracts",info,function(response)
	{
		var ans = response.message;
		actualAssignContracts = ans;
		

		if(info.MODE == "0")
		{loadForm("assign");}
		else
		{
			// CHECK IF CONTRACT AVAILABLE
			var found = 0;
			for(var i=0; i<actualAssignContracts.length; i++)
			{
				var item = actualAssignContracts[i];
				if(item.CONTRACT_CODE == actualEditData.GROUP_CONTRACT)
				{found = 1;}
			}
			if(found == 0)
			{
				fastPop("El contrato al que esta asignado este grupo ya no esta vigente.", 3000);
				PUM.close(1515);
				return;
			}
			
			editDataForm("assign");
		}		
	});
}


// CHECK EVENT GOALS AND LOAF FORM
function checkEventGoals()
{
	var myEventGoals = JSON.parse(userData.USER_EVENT_GOALS);
	
	able = 0;
	
	for(var i=0; i<myEventGoals.length; i++)
	{
		var item = myEventGoals[i];
		if(parseInt(item.V1) > 0)
		{var able = 1; break;}
	}
	
	var utype = userData.USER_CTYPE;
	
	
	
	
	actualEventActivities = [];
	
	for(var i=0; i<myEventGoals.length; i++)
	{
		var item = myEventGoals[i];
		var act = {};
		act.ACTIVITY_CODE = item.ID;
		act.DIRECT_GOAL = item.V1;
		act.SUPPORT_GOAL = item.V2;
		
		// GET ACTIVITY NAME
		var thearray = JSON.stringify([act.ACTIVITY_CODE]);
		var activity = getFriendDescs(thearray,"activities");
	
		act.ACTIVITY_NAME = activity;
		if(parseInt(item.V1) > 0)
		{actualEventActivities.push(act);}
	}
	
	// GET AVAILABLE EVENT SUPPORT
	var info = {};
	
	if(userData.USER_CTYPE != "Superior")
	{info.ENTITY = userData.USER_ENTITY;}
	else{info.ENTITY = "";}
	
	
	sendAjax("users","getSupportContracts",info,function(response)
	{
		var ans = response.message;
		console.log(ans);
		avaEventContracts = ans.avaEvent;
		avaRequestContracts = ans.avaReq
		
		
		
		if(viewMode == "1")
		{loadForm("detailView");return;}
	
	
		if(able == 0 && utype != "Superior" && utype != "Principal1" && utype != "Principal2" && utype != "Principal3" && utype != "Director")
		{fastPop("No hay metas para eventos activas en su contrato", 3000); return;}
		
		console.log("Eventsmode: "+eventsMode+" Origin: "+citizenOrigin)
		
		if(eventsMode == 0 && citizenOrigin == "ev"){loadForm("event");}
		if(eventsMode == 1 && citizenOrigin == "eve"){editDataForm("event");}
		if(eventsMode == 0 && citizenOrigin == "evr"){loadForm("eventR");}
		if(eventsMode == 1 && citizenOrigin == "evre"){editDataForm("eventR");}
		
	});
	
}


function getRemActiContracts()
{
	var info = {};
	
	sendAjax("users","getRemActiContracts",info,function(response)
	{
		var ans = response.message;
		// console.log(ans);
		var contracts = ans.active;
		remContratists = ans.contratists;
		
		var remActivities = [];
		
		for(var i=0; i<contracts.length; i++)
		{
			var contract = contracts[i];
			var actis = contract
			
			if(contract.CONTRACT_ACTIVITIES != null && contract.CONTRACT_ACTIVITIES != "")
			{
				actis = JSON.parse(contract.CONTRACT_ACTIVITIES);
				
				for(var a=0; a<actis.length; a++)
				{
					var acti = actis[a];
					if(!remActivities.includes(acti)){remActivities.push(acti);}
				}
			}
		}
		
		fixedActis = [];
		
		for(var i=0; i<remActivities.length; i++)
		{
			
			var fullActi = {};
			var thearray = JSON.stringify([remActivities[i]]);
			var acti = getFriendDescs(thearray,"activities");
			fullActi.ACTIVITY_CODE = remActivities[i];
			fullActi.ACTIVITY_DETAIL = acti;
			if(fullActi.ACTIVITY_DETAIL != ""){fixedActis.push(fullActi)}
		}
		
	});
	
	
	
}

// LOADFORMS-----------------
function loadForm(type)
{
	var formTitle = document.getElementById("popFormTitle");
	var popFormFieldBox = document.getElementById("popFormFieldBox");
	popFormFieldBox.innerHTML = "";
	var saveButton = document.getElementById("popFormSaveButton");
	var closeButton = document.getElementById("popFormExitButton");
	closeButton.onclick = function (){PUM.close(1515);}
	
	imfoo = type;
	console.log(lockRequest)
	console.log(imfoo)
	
	if(type == "profile")
	{

		var USER_PIC = fieldCreator([12,12,12,12], "Foto", "picture", "selector", "USER_PIC");
		var USER_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "USER_ENTITY");
		var USER_NAME = fieldCreator([12,4,4,6], "Nombres", "input", "text", "USER_NAME");
		var USER_LASTNAME = fieldCreator([12,4,4,6], "Apellidos", "input", "text", "USER_LASTNAME");
		var USER_IDTYPE = fieldCreator([12,4,4,6], "Tipo documento", "select", "select", "USER_IDTYPE");
		var USER_IDNUM = fieldCreator([12,4,4,6], "Número documento", "input", "text", "USER_IDNUM");
		var USER_BDAY = fieldCreator([12,4,4,6], "Fecha nacimiento", "input", "text", "USER_BDAY");
		var USER_PHONE = fieldCreator([12,4,4,6], "Teléfono", "input", "text", "USER_PHONE");
		var USER_EMAIL = fieldCreator([12,4,4,6], "Email", "input", "text", "USER_EMAIL");
		var USER_PASS = fieldCreator([12,4,4,6], "Contraseña", "input", "text", "USER_PASS");
		var USER_PASS2 = fieldCreator([12,4,4,6], "Confirmación contraseña", "input", "text", "USER_PASS2");
		
		var CONSENT = document.createElement("span");
		CONSENT.className = "consentLink";
		CONSENT.innerHTML = "Autorizo el tratamiento de la información de conformidad a lo establecido en la ley estatutaria 1581 de 2012.</b> <input type='checkbox' id='condCheck'/>";
		
		popFormFieldBox.appendChild(USER_PIC);
		popFormFieldBox.appendChild(USER_ENTITY);
		popFormFieldBox.appendChild(USER_NAME);
		popFormFieldBox.appendChild(USER_LASTNAME);
		popFormFieldBox.appendChild(USER_IDTYPE);
		popFormFieldBox.appendChild(USER_IDNUM);
		popFormFieldBox.appendChild(USER_BDAY);
		popFormFieldBox.appendChild(USER_PHONE);
		popFormFieldBox.appendChild(USER_EMAIL);
		
		
		addCallerFields();
		
		popFormFieldBox.appendChild(USER_PASS);
		popFormFieldBox.appendChild(USER_PASS2);
		
		var cLinkBox = document.createElement("div");
		cLinkBox.id = "cLinkBox";
		cLinkBox.className = "cLinkBox ";
		cLinkBox.appendChild(CONSENT);
		popFormFieldBox.appendChild(cLinkBox);
		
		
		
		// FILL ENTITIES
		selectFiller("USER_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// FILL DOCTYPES
		var options = ["TI", "CC", "CE", "NIT", "PASS", "RC", "NN"];
		selectFiller("USER_IDTYPE", "Seleccione tipo", options);
		
		// SET DATE FIELDS
		setDateField("USER_BDAY");
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Perfil de usuario";
		saveButton.onclick = function (){saveUdata('0');}

		PUM.open(1515);
		

	}
	
	if(type == "contract")
	{
		
		if(lockRequest == "1")
		{
			fastPop("Usted tiene una solicitud de contrato pendiente o un contrato activo  actualmente, no podrá hacer nuevas solicitudes", 6000);
			return;
		}
		
		contractEdit = 0;
		
		var FORMHEADERLINE = document.createElement("span");
		FORMHEADERLINE.className = "formHeaderLine";
		FORMHEADERLINE.id = "formHeaderLine";
		
		var CONTRACT_REQTYPE = fieldCreator([12,4,4,3], "Tipo de solicitud", "select", "select", "CONTRACT_REQTYPE");
		var CONTRACT_NUMBER = fieldCreator([12,4,4,3], "# Contrato", "input", "text", "CONTRACT_NUMBER");
		var CONTRACT_INIDATE = fieldCreator([12,4,4,3], "Fecha inicial", "input", "text", "CONTRACT_INIDATE");
		var CONTRACT_ENDATE = fieldCreator([12,4,4,3], "Fecha final", "input", "text", "CONTRACT_ENDATE");
		var CONTRACT_USERTYPE = fieldCreator([12,4,4,12], "Tipo usuario", "select", "select", "CONTRACT_USERTYPE");
		var CONTRACT_PROGRAM = fieldCreator([12,4,4,12], "Programas", "multiselect", "select", "CONTRACT_PROGRAM");
		var CONTRACT_ACTIVITIES = fieldCreator([12,4,4,12], "Actividades", "multiselect", "select", "CONTRACT_ACTIVITIES");
		var CONTRACT_ZONES = fieldCreator([12,4,4,12], "Comuna o corregimiento", "multiselect", "select", "CONTRACT_ZONES");
		
		popFormFieldBox.appendChild(FORMHEADERLINE);
		popFormFieldBox.appendChild(CONTRACT_REQTYPE);
		popFormFieldBox.appendChild(CONTRACT_NUMBER);
		popFormFieldBox.appendChild(CONTRACT_INIDATE);
		popFormFieldBox.appendChild(CONTRACT_ENDATE);
		popFormFieldBox.appendChild(CONTRACT_USERTYPE);
		popFormFieldBox.appendChild(CONTRACT_PROGRAM);
		popFormFieldBox.appendChild(CONTRACT_ACTIVITIES);
		popFormFieldBox.appendChild(CONTRACT_ZONES);
		
		// GOALS BOX ADD
		var goalsBox = document.createElement("div");
		goalsBox.id = "goalsBox";
		goalsBox.className = "blockBox";
		popFormFieldBox.appendChild(goalsBox);

		// FILL REQTYPES
		var options = ["Contrato nuevo", "Contrato por cesión"];
		selectFiller("CONTRACT_REQTYPE", "Seleccione tipo", options);
		
		// FILL USERTYPES
		var options = ["Cogestor", "Coordinador", "Director", "Instructor", "Reportes", "Visitador"];
		selectFiller("CONTRACT_USERTYPE", "Seleccione tipo", options);
		
		// SET DATE FIELDS
		setDateField("CONTRACT_INIDATE");
		setDateField("CONTRACT_ENDATE");
		
		var locked = "0";
		
		// HIDE DINAMYC FIELDS
		jQuery("#CONTRACT_PROGRAM_BOX").hide();
		jQuery("#CONTRACT_ACTIVITIES_BOX").hide();
		jQuery("#CONTRACT_ZONES_BOX").hide();
		
		// SET TYPEPICKER ONCHANGE
		document.getElementById("CONTRACT_REQTYPE").onchange = function ()
		{cleaRequest(this.value);}
		
		// SET UTYPE LISTENER
		document.getElementById("CONTRACT_USERTYPE").onchange = function ()
		{
			var type = this.value;
			var allActivities = activities;
			var clistA = [];
			var singlePicker = "1"
			var locked = "0";
			
			if(type == "")
			{
				jQuery("#CONTRACT_PROGRAM_BOX").hide();
				jQuery("#CONTRACT_ACTIVITIES_BOX").hide();
				jQuery("#CONTRACT_ZONES_BOX").hide();
			}
			else if(type == "Cogestor")
			{
				jQuery("#CONTRACT_PROGRAM_BOX").hide();
				jQuery("#CONTRACT_ACTIVITIES_BOX").show();
				jQuery("#CONTRACT_ZONES_BOX").show();
				
				var myActis = [];
				
				// SHOW ONLY COG SELECTED
				for(var i=0; i<activities.length; i++)
				{
					var item = activities[i];
					if(item.ACTIVITY_COG == "1")
					{myActis.push(item);}
				}
				
				// ALLOW ALL ACTIVITIES FOR COGESTOR
				// allActivities = myActis;
				
				singlePicker = "1";
			}
			else if(type == "Director")
			{
				jQuery("#CONTRACT_PROGRAM_BOX").show();
				jQuery("#CONTRACT_ACTIVITIES_BOX").hide();
				jQuery("#CONTRACT_ZONES_BOX").hide();
			}
			else if(type == "Coordinador")
			{
				jQuery("#CONTRACT_PROGRAM_BOX").hide();
				jQuery("#CONTRACT_ACTIVITIES_BOX").show();
				jQuery("#CONTRACT_ZONES_BOX").hide();
			}
			else if(type == "Instructor")
			{
				jQuery("#CONTRACT_PROGRAM_BOX").hide();
				jQuery("#CONTRACT_ACTIVITIES_BOX").show();
				jQuery("#CONTRACT_ZONES_BOX").hide();
				
				singlePicker = "1";
			}
			else
			{
				jQuery("#CONTRACT_PROGRAM_BOX").hide();
				jQuery("#CONTRACT_ACTIVITIES_BOX").hide();
				jQuery("#CONTRACT_ZONES_BOX").hide();
			}
			
			// SET CONTRACT ACTIVITIES
			multiSelectFillerDicF("CONTRACT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_NAME", allActivities, clistA, singlePicker,locked);
			
			
			var clistZ = [];
			// SET MULTIPICKER ZONES
			multiSelectFillerDic("CONTRACT_ZONES", "ZONE_CODE", "ZONE_NAME", zones, clistZ, "1",locked);
			
			var clistP = [];
			// SET MULTIPICKER PROGRAM
			multiSelectFillerDic("CONTRACT_PROGRAM", "PROGRAM_CODE", "PROGRAM_NAME", programs, clistP,"1",locked);

		}
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Solicitud de contrato";
		saveButton.onclick = function (){saveContract('0');}
		saveButton.innerHTML = "Enviar";
		
		PUM.open(1515);
	}
	
	if(type == "user")
	{

		var USER_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "USER_ENTITY");
		var USER_TYPE = fieldCreator([12,4,4,6], "Tipo de usuario", "select", "select", "USER_TYPE");
		var USER_NAME = fieldCreator([12,4,4,6], "Nombres", "input", "text", "USER_NAME");
		var USER_LASTNAME = fieldCreator([12,4,4,6], "Apellidos", "input", "text", "USER_LASTNAME");
		var USER_IDTYPE = fieldCreator([12,4,4,6], "Tipo documento", "select", "select", "USER_IDTYPE");
		var USER_IDNUM = fieldCreator([12,4,4,6], "Número documento", "input", "text", "USER_IDNUM");
		var USER_PHONE = fieldCreator([12,4,4,6], "Teléfono", "input", "text", "USER_PHONE");
		var USER_EMAIL = fieldCreator([12,4,4,6], "Email o nombre de usuario", "input", "text", "USER_EMAIL");
		var USER_PASS = fieldCreator([12,4,4,6], "Contraseña", "input", "text", "USER_PASS");
		var USER_PASS2 = fieldCreator([12,4,4,6], "Confirmación contraseña", "input", "text", "USER_PASS2");

		popFormFieldBox.appendChild(USER_ENTITY);
		popFormFieldBox.appendChild(USER_TYPE);
		popFormFieldBox.appendChild(USER_NAME);
		popFormFieldBox.appendChild(USER_LASTNAME);
		popFormFieldBox.appendChild(USER_IDTYPE);
		popFormFieldBox.appendChild(USER_IDNUM);
		popFormFieldBox.appendChild(USER_PHONE);
		popFormFieldBox.appendChild(USER_EMAIL);
		
		addCallerFields();
		
		popFormFieldBox.appendChild(USER_PASS);
		popFormFieldBox.appendChild(USER_PASS2);
		
		// FILL ENTITIES
		selectFiller("USER_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// FILL SPECIAL TYPES
		var options = [{"TYPE":"Principal1", "DESC": "Secretario"}, {"TYPE":"Principal2", "DESC": "Jefe de oficina"}, {"TYPE":"Principal3", "DESC": "Fortalecimiento"}];
		selectFiller("USER_TYPE", "Seleccione tipo", options, "TYPE", "DESC");
		
		// FILL DOCTYPES
		var options = ["TI", "CC", "CE", "NIT", "PASS", "RC", "NN"];
		selectFiller("USER_IDTYPE", "Seleccione tipo", options);
		
		// SET DATE FIELDS
		setDateField("USER_BDAY");
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Perfil de usuario especial";
		saveButton.onclick = function (){saveUdata('0');}

		PUM.open(1515);
		
		
		
	}
	
	if(type == "citizen")
	{
		
		console.log(citizenOrigin)
		
		var CITIZEN_NAME = fieldCreator([12,4,4,6], "Nombres", "input", "text", "CITIZEN_NAME");
		var CITIZEN_LASTNAME = fieldCreator([12,4,4,6], "Apellidos", "input", "text", "CITIZEN_LASTNAME");
		var CITIZEN_IDTYPE = fieldCreator([12,4,4,6], "Tipo documento", "select", "select", "CITIZEN_IDTYPE");
		var CITIZEN_IDNUM = fieldCreator([12,4,4,6], "Número documento", "input", "text", "CITIZEN_IDNUM");
		var CITIZEN_BDAY = fieldCreator([12,4,4,6], "Fecha nacimiento", "input", "text", "CITIZEN_BDAY");
		var CITIZEN_PHONE = fieldCreator([12,4,4,6], "Teléfono", "input", "text", "CITIZEN_PHONE");
		var CITIZEN_EMAIL = fieldCreator([12,4,4,6], "Email", "input", "text", "CITIZEN_EMAIL");
		
		var CITIZEN_CITY = fieldCreator([12,4,4,6], "Ciudad", "dropdown", "dropdown", "CITIZEN_CITY");
		var CITIZEN_ZONE = fieldCreator([12,4,4,6], "Comuna/Corregimiento", "dropdown", "dropdown", "CITIZEN_ZONE");
		var CITIZEN_HOOD = fieldCreator([12,4,4,6], "Barrio/Vereda", "dropdown", "dropdown", "CITIZEN_HOOD");
		var CITIZEN_LEVEL = fieldCreator([12,4,4,6], "Estrato", "input", "number", "CITIZEN_LEVEL");
		
		var CITIZEN_ADDRESS = fieldCreator([12,4,4,6], "Dirección", "input", "text", "CITIZEN_ADDRESS");
		var CITIZEN_GENDER = fieldCreator([12,4,4,6], "Género", "select", "select", "CITIZEN_GENDER");
		var CITIZEN_ETNIA = fieldCreator([12,4,4,6], "Etnia", "select", "select", "CITIZEN_ETNIA");
		var CITIZEN_ETNIA_IND = fieldCreator([12,4,4,6], "Tipo de indígena", "dropdown", "dropdown", "CITIZEN_ETNIA_IND");
		var CITIZEN_CONDITION = fieldCreator([12,4,4,12], "Condición", "multiselect", "select", "CITIZEN_CONDITION");
		
		popFormFieldBox.appendChild(CITIZEN_IDNUM);
		popFormFieldBox.appendChild(CITIZEN_IDTYPE);
		popFormFieldBox.appendChild(CITIZEN_NAME);
		popFormFieldBox.appendChild(CITIZEN_LASTNAME);
		popFormFieldBox.appendChild(CITIZEN_BDAY);
		popFormFieldBox.appendChild(CITIZEN_PHONE);
		popFormFieldBox.appendChild(CITIZEN_EMAIL);
		
		popFormFieldBox.appendChild(CITIZEN_CITY);
		popFormFieldBox.appendChild(CITIZEN_ZONE);
		popFormFieldBox.appendChild(CITIZEN_HOOD);
		popFormFieldBox.appendChild(CITIZEN_LEVEL);
		
		popFormFieldBox.appendChild(CITIZEN_ADDRESS);
		popFormFieldBox.appendChild(CITIZEN_GENDER);
		popFormFieldBox.appendChild(CITIZEN_ETNIA);
		popFormFieldBox.appendChild(CITIZEN_ETNIA_IND);
		popFormFieldBox.appendChild(CITIZEN_CONDITION);
		
		
		// NEW FIELDS --------------------------------
		// NEW FIELDS --------------------------------
		// NEW FIELDS --------------------------------
		
		var sectionFieldsMig = ["CITIZEN_ORIGIN_COUNTRY", "CITIZEN_DESTINY_COUNTRY", "CITIZEN_STAY_REASON", "CITIZEN_MIGREXP", "CITIZEN_INDATE", "CITIZEN_OUTDATE", "CITIZEN_RETURN_REASON", "CITIZEN_SITAC"];
		
		var formSectionerMig = formSectioner(sectionFieldsMig, "Migrante");
		var hrMigration = document.createElement("hr");
		hrMigration.className = "formBar";
		popFormFieldBox.appendChild(formSectionerMig);
		popFormFieldBox.appendChild(hrMigration);
		
		var CITIZEN_ORIGIN_COUNTRY = fieldCreator([12,4,4,6], "País de orígen", "dropdown", "dropdown", "CITIZEN_ORIGIN_COUNTRY");
		
		var CITIZEN_DESTINY_COUNTRY = fieldCreator([12,4,4,6], "País destino", "dropdown", "dropdown", "CITIZEN_DESTINY_COUNTRY");
		
		var CITIZEN_STAY_REASON = fieldCreator([12,4,4,6], "Razón migración", "select", "select", "CITIZEN_STAY_REASON");
		
		var CITIZEN_MIGREXP = fieldCreator([12,4,4,6], "Experiencia migratoria", "input", "text", "CITIZEN_MIGREXP");
		
		var CITIZEN_INDATE = fieldCreator([12,4,4,6], "Fecha ingreso Colombia", "input", "text", "CITIZEN_INDATE");
		
		var CITIZEN_OUTDATE = fieldCreator([12,4,4,6], "Fecha salida Colombia", "input", "text", "CITIZEN_OUTDATE");
		
		var CITIZEN_RETURN_REASON = fieldCreator([12,4,4,6], "Motivo retorno", "input", "text", "CITIZEN_RETURN_REASON");
		
		var CITIZEN_SITAC = fieldCreator([12,4,4,6], "Registro SITAC", "select", "select", "CITIZEN_SITAC");
		
		popFormFieldBox.appendChild(CITIZEN_ORIGIN_COUNTRY);
		popFormFieldBox.appendChild(CITIZEN_DESTINY_COUNTRY);
		popFormFieldBox.appendChild(CITIZEN_STAY_REASON);
		popFormFieldBox.appendChild(CITIZEN_MIGREXP);
		popFormFieldBox.appendChild(CITIZEN_INDATE);
		popFormFieldBox.appendChild(CITIZEN_OUTDATE);
		popFormFieldBox.appendChild(CITIZEN_RETURN_REASON);
		popFormFieldBox.appendChild(CITIZEN_SITAC);
		
		var sectionFieldsSoc = ["CITIZEN_ACUDIENT", "CITIZEN_BIRTH_CITY", "CITIZEN_SISCORE", "CITIZEN_CONVAC", "CITIZEN_TIPOCO", "CITIZEN_TIPOVI", "CITIZEN_HANDICAP", "CITIZEN_ETGROUP"];
		var formSectionerMig = formSectioner(sectionFieldsSoc, "Social");
		var hrMigration = document.createElement("hr");
		hrMigration.className = "formBar";
		popFormFieldBox.appendChild(formSectionerMig);
		popFormFieldBox.appendChild(hrMigration);
		
		var CITIZEN_ACUDIENT = fieldCreator([12,4,4,6], "Documento de acudiente o responsable", "input", "text", "CITIZEN_ACUDIENT");
		
		var CITIZEN_BIRTH_CITY = fieldCreator([12,4,4,6], "Ciudad de nacimiento", "dropdown", "dropdown", "CITIZEN_BIRTH_CITY");
		
		var CITIZEN_SISCORE = fieldCreator([12,4,4,6], "Puntaje Sisbén", "input", "number", "CITIZEN_SISCORE");
		
		var CITIZEN_CONVAC = fieldCreator([12,4,4,6], "Convivencia actual", "select", "select", "CITIZEN_CONVAC");
		
		var CITIZEN_TIPOCO = fieldCreator([12,4,4,6], "Consumo", "select", "select", "CITIZEN_TIPOCO");
		
		var CITIZEN_TIPOVI = fieldCreator([12,4,4,6], "Violencia manifestada", "select", "select", "CITIZEN_TIPOVI");
		
		var CITIZEN_HANDICAP = fieldCreator([12,4,4,6], "Indicador discapacidad", "input", "text", "CITIZEN_HANDICAP");

		var CITIZEN_ETGROUP = fieldCreator([12,4,4,6], "Indicador grupo étnico", "input", "text", "CITIZEN_ETGROUP");
		
		popFormFieldBox.appendChild(CITIZEN_ACUDIENT);
		popFormFieldBox.appendChild(CITIZEN_BIRTH_CITY);
		popFormFieldBox.appendChild(CITIZEN_SISCORE);
		popFormFieldBox.appendChild(CITIZEN_CONVAC);
		popFormFieldBox.appendChild(CITIZEN_TIPOCO);
		popFormFieldBox.appendChild(CITIZEN_TIPOVI);
		popFormFieldBox.appendChild(CITIZEN_HANDICAP);
		popFormFieldBox.appendChild(CITIZEN_ETGROUP);
		
		
		var sectionFieldsHea = ["CITIZEN_SECURITY", "CITIZEN_EPS", "CITIZEN_PATOEN", "CITIZEN_TRASDES", "CITIZEN_RISKFA", "CITIZEN_PREVFA", "CITIZEN_WEIGHT", "CITIZEN_HEIGHT", "CITIZEN_IMC", "CITIZEN_IMC_RATE"];
		var formSectionerMig = formSectioner(sectionFieldsHea, "Salud");
		var hrMigration = document.createElement("hr");
		hrMigration.className = "formBar";
		popFormFieldBox.appendChild(formSectionerMig);
		popFormFieldBox.appendChild(hrMigration);
		
		
		var CITIZEN_SECURITY = fieldCreator([12,4,4,6], "Seguridad en salud", "select", "select", "CITIZEN_SECURITY");
		
		var CITIZEN_EPS = fieldCreator([12,4,4,6], "EPS", "dropdown", "dropdown", "CITIZEN_EPS");
		
		var CITIZEN_PATOEN = fieldCreator([12,4,4,6], "Patologías", "dropdown", "dropdown", "CITIZEN_PATOEN");
		
		var CITIZEN_TRASDES = fieldCreator([12,4,4,6], "Trastornos desarrollo", "select", "select", "CITIZEN_TRASDES");
		
		var CITIZEN_RISKFA = fieldCreator([12,4,4,6], "Factores de riesgo", "multiselect", "select", "CITIZEN_RISKFA");

		var CITIZEN_PREVFA = fieldCreator([12,4,4,6], "Factores preventivos", "multiselect", "select", "CITIZEN_PREVFA");
		
		var CITIZEN_WEIGHT = fieldCreator([12,4,4,6], "Peso (Kg)", "input", "text", "CITIZEN_WEIGHT");
		
		var CITIZEN_HEIGHT = fieldCreator([12,4,4,6], "Talla (Mts)", "input", "text", "CITIZEN_HEIGHT");
		
		var CITIZEN_IMC = fieldCreator([12,4,4,6], "IMC", "input", "text", "CITIZEN_IMC");
		
		var CITIZEN_IMC_RATE = fieldCreator([12,4,4,6], "Clasificación IMC", "select", "select", "CITIZEN_IMC_RATE");
		
		popFormFieldBox.appendChild(CITIZEN_SECURITY);
		popFormFieldBox.appendChild(CITIZEN_EPS);
		popFormFieldBox.appendChild(CITIZEN_PATOEN);
		popFormFieldBox.appendChild(CITIZEN_TRASDES);
		popFormFieldBox.appendChild(CITIZEN_RISKFA);
		popFormFieldBox.appendChild(CITIZEN_PREVFA);
		popFormFieldBox.appendChild(CITIZEN_WEIGHT);
		popFormFieldBox.appendChild(CITIZEN_HEIGHT);
		popFormFieldBox.appendChild(CITIZEN_IMC);
		popFormFieldBox.appendChild(CITIZEN_IMC_RATE);
		
		var sectionFieldsEd = ["CITIZEN_EDLEVEL", "CITIZEN_INSTITUTE"];
		var formSectionerMig = formSectioner(sectionFieldsEd, "Información académica");
		var hrMigration = document.createElement("hr");
		hrMigration.className = "formBar";
		popFormFieldBox.appendChild(formSectionerMig);
		popFormFieldBox.appendChild(hrMigration);
		
		var CITIZEN_EDLEVEL = fieldCreator([12,4,4,6], "Nivel educativo", "select", "select", "CITIZEN_EDLEVEL");
		
		var CITIZEN_INSTITUTE = fieldCreator([12,4,4,6], "Institución", "dropdown", "dropdown", "CITIZEN_INSTITUTE");
		
		popFormFieldBox.appendChild(CITIZEN_EDLEVEL);
		popFormFieldBox.appendChild(CITIZEN_INSTITUTE);
		
		
		var sectionFieldsOc = ["CITIZEN_COURSES", "CITIZEN_OCUCOND", "CITIZEN_INGREC"];
		var formSectionerMig = formSectioner(sectionFieldsOc, "Información ocupacional o laboral");
		var hrMigration = document.createElement("hr");
		hrMigration.className = "formBar";
		popFormFieldBox.appendChild(formSectionerMig);
		popFormFieldBox.appendChild(hrMigration);
		
		
		var CITIZEN_COURSES = fieldCreator([12,4,4,6], "Formación", "select", "select", "CITIZEN_COURSES");
		
		var CITIZEN_OCUCOND = fieldCreator([12,4,4,6], "Condición ocupacional", "select", "select", "CITIZEN_OCUCOND");
		
		var CITIZEN_INGREC = fieldCreator([12,4,4,6], "Ingresos económicos", "select", "select", "CITIZEN_INGREC");
		
		
		popFormFieldBox.appendChild(CITIZEN_COURSES);
		popFormFieldBox.appendChild(CITIZEN_OCUCOND);
		popFormFieldBox.appendChild(CITIZEN_INGREC);
		
		var CONSENT = document.createElement("span");
		CONSENT.className = "consentLink";
		CONSENT.innerHTML = "Autorizo el tratamiento de la información de conformidad a lo establecido en la ley estatutaria 1581 de 2012.</b> <input type='checkbox' id='condCheck'/>";
		
		
		
		// NEW MASTERS FILLERS
		// NEW MASTERS FILLERS
		
		hideFields(sectionFieldsMig);
		hideFields(sectionFieldsSoc);
		hideFields(sectionFieldsHea);
		hideFields(sectionFieldsEd);
		hideFields(sectionFieldsOc);
		
		searchListFiller("CITIZEN_ETNIA_IND", tipoin, "TIPOIN_NAME", "TIPOIN_CODE", "Seleccione tipo de indígena");
		
		var countries = setCountries();
		// console.log(countries);
		
		searchListFiller("CITIZEN_ORIGIN_COUNTRY", countries, "COUNTRY", "COUNTRY", "Seleccione pais de orígen");
		
		searchListFiller("CITIZEN_DESTINY_COUNTRY", countries, "COUNTRY", "COUNTRY", "Seleccione pais destino");
		
		selectFiller("CITIZEN_STAY_REASON", "Seleccione razón de migración", migrea, "MIGREA_CODE", "MIGREA_NAME");
		
		setDateField("CITIZEN_INDATE");
		setDateField("CITIZEN_OUTDATE");
		
		var options = ["Si", "No"];
		selectFiller("CITIZEN_SITAC", "Tiene registro SITAC", options);
		
		setLocationsSearch("CITIZEN_CITY");
		setLocationsSearch("CITIZEN_BIRTH_CITY");
		
		selectFiller("CITIZEN_CONVAC", "Seleccione convivencia actual", convac, "CONVAC_CODE", "CONVAC_NAME");

		selectFiller("CITIZEN_TIPOCO", "Seleccione consumo", tipoco, "TIPOCO_CODE", "TIPOCO_NAME");
		
		selectFiller("CITIZEN_TIPOVI", "Seleccione tipo violencia", tipovi, "TIPOVI_CODE", "TIPOVI_NAME");
		
		var options = ["Régimen contributivo", "Régimen subsidiado", "Población vinculada"];
		selectFiller("CITIZEN_SECURITY", "Seleccione opción", options);
		
		searchListFiller("CITIZEN_EPS", eps, "EPS_NAME", "EPS_CODE", "Seleccione EPS");
		
		searchListFiller("CITIZEN_PATOEN", patoen, "PATOEN_NAME", "PATOEN_CODE", "Seleccione patología");
		
		selectFiller("CITIZEN_TRASDES", "Seleccione consumo", trasdes, "TRASDES_CODE", "TRASDES_NAME");
		
		var clistC = [];
		multiSelectFillerDic("CITIZEN_RISKFA", "RISKFA_CODE", "RISKFA_NAME", riskfa, clistC, "1","0");
		
		var clistC = [];
		multiSelectFillerDic("CITIZEN_PREVFA", "PREVFA_CODE", "PREVFA_NAME", prevfa, clistC, "1","0");
		
		selectFiller("CITIZEN_EDLEVEL", "Seleccione nivel académico", edlevel, "EDLEVEL_CODE", "EDLEVEL_NAME");
		
		searchListFiller("CITIZEN_INSTITUTE", institutes, "INSTITUTE_NAME", "INSTITUTE_CODE",  "Seleccione institución");
		
		selectFiller("CITIZEN_COURSES", "Seleccione formación", courses, "COURSES_CODE", "COURSES_NAME");
		
		selectFiller("CITIZEN_OCUCOND", "Seleccione condición", ocucond, "OCUCOND_CODE", "OCUCOND_NAME");
		
		selectFiller("CITIZEN_INGREC", "Seleccione condición", ingrec, "INGREC_CODE", "INGREC_NAME");
		
		var options = ["Bajo peso", "Normal", "Sobrepeso", "Obesidad I", "Obesidad II", "Obesidad III", "Obesidad IV"];
		selectFiller("CITIZEN_IMC_RATE", "", options);
		
		// NEW FIELDS --------------------------------
		// NEW FIELDS --------------------------------
		// NEW FIELDS --------------------------------
		
		
		
		
		document.getElementById("CITIZEN_IDNUM").lastvalue = "";
		document.getElementById("CITIZEN_IDNUM").onblur = function ()
		{
			
			// IGNORE IF SAME AS EDITED
			
			console.log(citizenOrigin);
			
			if(this.value == actualEditData.CITIZEN_IDNUM && citizenOrigin != "g" && citizenOrigin != "loadCitRem" && citizenOrigin != "rem" && citizenOrigin != "loadReqRem"){console.log("Ignore");return;}

			var info = {};
			
			// CHECK ONLY LETTERS AND NUMBERS
			 var letterNumber = /^[0-9a-zA-Z]+$/;
			 if(this.value.match(letterNumber) && this.value != "")
			 {
				console.log("OK")
			 }
			 else
			 {
				 // RESTORE AFTER DEV
				 
				 fastPop("Este campo no debe contener simbolos, puntos o espacios, solo letras o números.", 3000);
				 this.value = "";
				 console.log("NOT OK")
				 return;
			 }
			
			if(this.value == this.lastvalue || this.value == ""){return;}
			this.lastvalue = this.value;
			
			info.CITIZEN_IDNUM = this.value;
			if(info.CITIZEN_IDNUM == ""){return;}
			
			document.getElementById("coverloader").style.display = "block";
			
			console.log("no age check");
			
			loadManager(1, "popFormSaveButton");
			sendAjax("users","getCitizenMain",info,function(response)
			{
				loadManager(0, "popFormSaveButton");
				var ans = response.message;
				console.log(ans)
				document.getElementById("coverloader").style.display = "none";
				if(ans.length > 0)
				{
					invoquedCitizenData = ans[0];
					// GO BACK IF PICKED EXISTENT AND FROM EVENT
					if(citizenOrigin == "ev")
					{
						loadForm("event");
						document.getElementById("EVENT_COOPERATOR").lastvalue = 
						invoquedCitizenData.CITIZEN_IDNUM;
						var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
						
						document.getElementById("EVENT_COOPERATOR").lastvalue = newValue;
						document.getElementById("EVENT_COOPERATOR").value = newValue;
						return;
					}
					// GO BACK IF PICKED EXISTENT AND FROM EVENT EDIT
					if(citizenOrigin == "eve")
					{
						editDataForm("event");
						document.getElementById("EVENT_COOPERATOR").lastvalue = invoquedCitizenData.CITIZEN_IDNUM;
						var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
						
						document.getElementById("EVENT_COOPERATOR").lastvalue = newValue;
						document.getElementById("EVENT_COOPERATOR").value = newValue;
						return;
					}
					// GO BACK IF PICKED EXISTENT AND FROM EVENT
					if(citizenOrigin == "evr")
					{
						loadForm("eventR");
						document.getElementById("EVENT_REQUESTER").lastvalue = 
						invoquedCitizenData.CITIZEN_IDNUM;
						var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
						
						document.getElementById("EVENT_REQUESTER").lastvalue = newValue;
						document.getElementById("EVENT_REQUESTER").value = newValue;
						return;
					}
					// GO BACK IF PICKED EXISTENT AND FROM EVENT EDIT
					if(citizenOrigin == "evre")
					{
						editDataForm("eventR");
						
						var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
						
						if(requestState == "4")
						{
							document.getElementById("EVENT_COOPERATOR").lastvalue = invoquedCitizenData.CITIZEN_IDNUM;
							
							document.getElementById("EVENT_COOPERATOR").lastvalue =
							newValue;
							document.getElementById("EVENT_COOPERATOR").value = newValue;
						}
						else
						{
							document.getElementById("EVENT_REQUESTER").lastvalue = invoquedCitizenData.CITIZEN_IDNUM;
							
							document.getElementById("EVENT_REQUESTER").lastvalue = newValue;
							document.getElementById("EVENT_REQUESTER").value = newValue;
						}
						
						
						return;
					}
					// GO BACK IF PICKED EXISTENT AND FROM GROUP
					if(citizenOrigin == "gr")
					{
						loadForm("group");
						document.getElementById("GROUP_COPERATOR").lastvalue = invoquedCitizenData.CITIZEN_IDNUM;
						var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
						
						document.getElementById("GROUP_COPERATOR").lastvalue = newValue;
						document.getElementById("GROUP_COPERATOR").value = newValue;
						return;
					}
					// GO BACK IF PICKED EXISTENT AND FROM GROUP EDIT
					if(citizenOrigin == "gre")
					{
						editDataForm("group");
						document.getElementById("GROUP_COPERATOR").lastvalue = invoquedCitizenData.CITIZEN_IDNUM;
						var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
						
						document.getElementById("GROUP_COPERATOR").lastvalue = newValue;
						document.getElementById("GROUP_COPERATOR").value = newValue;
						return;
					}
					
					actualEditData = ans[0];
					editDataForm("citizen");
					document.getElementById("CITIZEN_IDNUM").lastvalue = actualEditData.CITIZEN_IDNUM;
					document.getElementById("CITIZEN_IDNUM").value = actualEditData.CITIZEN_IDNUM;
				}
				else
				{
					loadForm("citizen");
					document.getElementById("CITIZEN_IDNUM").lastvalue = info.CITIZEN_IDNUM;
					document.getElementById("CITIZEN_IDNUM").value = info.CITIZEN_IDNUM;
				}
				
				
			});
		}

		// setLocations("CITIZEN_CITY");
		
		
		
		// var cityPicker = document.getElementById("CITIZEN_CITY");
		// cityPicker.onchange = function ()
		// {
			
			// console.log("lalala");
			
			// return;
			// var pick = this.value;
			// var zonePicker = document.getElementById("CITIZEN_ZONE");
			// zonePicker.innerHTML = "";
			
			// searchListFiller("CITIZEN_HOOD", [], "HOOD_NAME", "HOOD_CODE", "Seleccione Barrio/Vereda");

			// var option = document.createElement("option");
			// option.innerHTML = "Seleccione Comuna/Corregimiento";
			// option.value = "";
			// zonePicker.appendChild(option);
			
			// console.log(allZones);
			

			// for(var i=0; i<allZones.length; i++)
			// {
				// var item = allZones[i];
				// if(item.ZONE_CITY == pick)
				// {
					// var option = document.createElement("option");
					// option.innerHTML = item.ZONE_NAME;
					// option.value = item.ZONE_CODE;
					// zonePicker.appendChild(option);
				// }
			// }
		// }
		
		
		
		
		// var zonePicker = document.getElementById("CITIZEN_ZONE");
		// zonePicker.onchange = function ()
		// {
			// console.log("lolol");
			
			

		// }
		
		
		// FILL DOCTYPES
		var options = ["TI", "CC", "CE", "NIT", "PASS", "RC", "NN"];
		selectFiller("CITIZEN_IDTYPE", "Seleccione tipo", options);
		
		// FILL GENDERS

		selectFiller("CITIZEN_GENDER", "Seleccione Género", genres, "GENRE_CODE", "GENRE_NAME");
		
		// FILL ETNIAS
		selectFiller("CITIZEN_ETNIA", "Seleccione etnia", etnias, "ETNIA_CODE", "ETNIA_NAME");
		
		// FILL CONDITIONS
		selectFiller("CITIZEN_CONDITION", "Seleccione Condición", conditions, "CONDITION_CODE", "CONDITION_NAME");
		
		// SET MULTIPICKER CONDITIONS
		var clistC = [];
		multiSelectFillerDic("CITIZEN_CONDITION", "CONDITION_CODE", "CONDITION_NAME", conditions, clistC, "1",locked);
		
		// SET DATE FIELDS
		setDateField("CITIZEN_BDAY");
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		
		
		
		
		if(citizenOrigin == "g")
		{
			
			var cLinkBox = document.createElement("div");
			cLinkBox.id = "cLinkBox";
			cLinkBox.className = "cLinkBox ";
			cLinkBox.appendChild(CONSENT);
			popFormFieldBox.appendChild(cLinkBox);
			
			// actualEditData = "";
			formTitle.innerHTML = "Agregar ciudadano a grupo";
			saveButton.innerHTML = "Agregar";
			saveButton.style.display = "initial";
		}
		else if(citizenOrigin == "cl")
		{
			formTitle.innerHTML = "Agregar ciudadano a clase";
			saveButton.innerHTML = "Agregar";
			saveButton.style.display = "initial";
		}
		else if(citizenOrigin == "ev" || citizenOrigin == "eve")
		{
			
			var cLinkBox = document.createElement("div");
			cLinkBox.id = "cLinkBox";
			cLinkBox.className = "cLinkBox ";
			cLinkBox.appendChild(CONSENT);
			popFormFieldBox.appendChild(cLinkBox);
			
			formTitle.innerHTML = "Agregar cooperador a evento";
			saveButton.innerHTML = "Agregar";
			saveButton.style.display = "initial";
			
		}
		else if(citizenOrigin == "evr" || citizenOrigin == "evre")
		{
			var cLinkBox = document.createElement("div");
			cLinkBox.id = "cLinkBox";
			cLinkBox.className = "cLinkBox ";
			cLinkBox.appendChild(CONSENT);
			popFormFieldBox.appendChild(cLinkBox);
			
			if(requestState == "4")
			{formTitle.innerHTML = "Agregar cooperador a evento";}
			else
			{formTitle.innerHTML = "Agregar solicitante a evento";}

			saveButton.innerHTML = "Agregar";
			saveButton.style.display = "initial";
		}
		else if(citizenOrigin == "gr" || citizenOrigin == "gre")
		{
			var cLinkBox = document.createElement("div");
			cLinkBox.id = "cLinkBox";
			cLinkBox.className = "cLinkBox ";
			cLinkBox.appendChild(CONSENT);
			popFormFieldBox.appendChild(cLinkBox);
			
			formTitle.innerHTML = "Agregar cooperador a grupo";
			saveButton.innerHTML = "Agregar";
			saveButton.style.display = "initial";
		}
		else if(citizenOrigin == "rem")
		{
			var cLinkBox = document.createElement("div");
			cLinkBox.id = "cLinkBox";
			cLinkBox.className = "cLinkBox ";
			cLinkBox.appendChild(CONSENT);
			popFormFieldBox.appendChild(cLinkBox);
			
			formTitle.innerHTML = "Atender ciudadano nuevo";
			saveButton.innerHTML = "Atender";
			saveButton.style.display = "initial";
		}
		else if(citizenOrigin == "remC")
		{
			formTitle.innerHTML = "Agregar solicitante a atención";
			saveButton.innerHTML = "Agregar";
			saveButton.style.display = "initial";
		}
		else
		{
			
			var cLinkBox = document.createElement("div");
			cLinkBox.id = "cLinkBox";
			cLinkBox.className = "cLinkBox ";
			cLinkBox.appendChild(CONSENT);
			popFormFieldBox.appendChild(cLinkBox);
			
			formTitle.innerHTML = "Crear ciudadano";
			saveButton.innerHTML = "Guardar";
			saveButton.style.display = "initial";
		}
		
		saveButton.onclick = function (){saveCitizen('0');}
		
		
		
		document.getElementById("CITIZEN_ACUDIENT").onblur = function ()
		{

			if(this.value == this.lastvalue || this.value == ""){return;}
			this.lastvalue = this.value;
			
			// IGNORE IF SAME AS EDITED
			if(this.value == actualEditData.GROUP_COPERATOR){console.log("Ignore");return;}
			
			var info = {};
			info.CITIZEN_IDNUM = this.value.split("-")[0];
			if(info.CITIZEN_IDNUM == ""){return;}
			
			console.log("age check");
			
			loadManager(1, "popFormSaveButton");
			sendAjax("users","getCitizen",info,function(response)
			{
				loadManager(0, "popFormSaveButton");
				var ans = response.message;
				console.log(ans);
				
				if(ans == "toYoung")
				{
					fastPop("Este ciudadano no es mayor de edad, solo puede ingresar mayores de edad en este campo", 3000);
					document.getElementById("CITIZEN_ACUDIENT").lastvalue = "";
					document.getElementById("CITIZEN_ACUDIENT").value = "";
					return;
				}

				if(ans.length > 0)
				{
					invoquedCitizenData = ans[0];
					
					var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
					document.getElementById("CITIZEN_ACUDIENT").lastvalue = newValue;
					document.getElementById("CITIZEN_ACUDIENT").value = newValue;
				}
				else
				{
					document.getElementById("CITIZEN_ACUDIENT").lastvalue = "";
					document.getElementById("CITIZEN_ACUDIENT").value = "";
					
					setTimeout(function()
					{
						
						var params = [info.CITIZEN_IDNUM];
						confirmBox(language["confirm"], "El id no se encuentra registrado, para crearlo abandonará el formulario actual para crear al nuevo ciudadano acudiente. ¿desea crear al acudiente ahora?",createCitizenPop, params);
						
					}, 500);

				}
			});
		}
		
		
		
		document.getElementById("CITIZEN_WEIGHT").onblur = function (){updateIMC();}
		document.getElementById("CITIZEN_HEIGHT").onblur = function (){updateIMC();}
		document.getElementById("CITIZEN_IMC").disabled = true;
		document.getElementById("CITIZEN_IMC_RATE").disabled = true;
		
		document.getElementById("CITIZEN_ETNIA").onchange = function ()
		{
			var pick = this.value;
			if(pick != "9476af2d71124ca97477c0cc83cff83c")
			{document.getElementById("CITIZEN_ETNIA_IND_BOX").style.display = "none";}
			else{document.getElementById("CITIZEN_ETNIA_IND_BOX").style.display = "initial";}
		}
	
		document.getElementById("CITIZEN_ETNIA_IND_BOX").style.display = "none";
		
		
		

		PUM.open(1515);

	}
	
	if(type == "userCaller")
	{
		
		var USER_CALLER_GOAL = fieldCreator([12,4,4,6], "Número de llamadas a realizar por mes ", "input", "number", "USER_CALLER_GOAL");
		var USER_CALLER_ENDATE = fieldCreator([12,4,4,6], "Fecha vencimiento", "input", "text", "USER_CALLER_ENDATE");
		
		popFormFieldBox.appendChild(USER_CALLER_GOAL);
		popFormFieldBox.appendChild(USER_CALLER_ENDATE);
		
		
		// SET DATE FIELDS
		setDateField("USER_CALLER_ENDATE");
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Convertir a usuario de llamadas";
		saveButton.onclick = function ()
		{
			
			var goal = document.getElementById("USER_CALLER_GOAL").value;
			var date = document.getElementById("USER_CALLER_ENDATE").value;
			
			if(goal == ""){fastPop("Debe escribir el numero de llamadas.", 2000);return;}
			if(date == ""){fastPop("Debe seleccionar la fecha de vencimiento.", 2000);return;}
			
			
			stateChanger("wp_trusers","USER_CALLER", "USER_CODE", actualEditData.USER_CODE, actualEditData.USER_CALLER);
			
			PUM.close(1515);
			
		}

		PUM.open(1515);
		
		
	}
	
	if(type == "program")
	{
		
		var PROGRAM_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "PROGRAM_ENTITY");
		var PROGRAM_NAME = fieldCreator([12,4,4,6], "Nombre del programa", "input", "text", "PROGRAM_NAME");
		
		popFormFieldBox.appendChild(PROGRAM_ENTITY);
		popFormFieldBox.appendChild(PROGRAM_NAME);
		
		// FILL ENTITIES
		selectFiller("PROGRAM_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		document.getElementById("PROGRAM_ENTITY").value = userData.USER_ENTITY;
		if(userData.USER_CTYPE != "Superior")
		{document.getElementById("PROGRAM_ENTITY").disabled = true;}
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear programa";
		saveButton.onclick = function (){saveProgram('0');}

		PUM.open(1515);
		
		
	}
	
	if(type == "project")
	{
		
		var PROJECT_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "PROJECT_ENTITY");
		var PROJECT_PROGRAM = fieldCreator([12,4,4,6], "Programa", "select", "select", "PROJECT_PROGRAM");
		var PROJECT_NAME = fieldCreator([12,4,4,6], "Nombre del proyecto", "input",
		"text", "PROJECT_NAME");
	
		
		popFormFieldBox.appendChild(PROJECT_ENTITY);
		popFormFieldBox.appendChild(PROJECT_PROGRAM);
		popFormFieldBox.appendChild(PROJECT_NAME);
		
		
		// FILL ENTITIES
		selectFiller("PROJECT_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		
		
		if(userData.USER_CTYPE != "Superior")
		{
			document.getElementById("PROJECT_ENTITY").value = userData.USER_ENTITY;
			document.getElementById("PROJECT_ENTITY").disabled = true;
		}
		
		// FILL PROGRAMS AS ENTITY PICKED
		// FILL PROGRAMS AS ENTITY PICKED
		// FILL PROGRAMS AS ENTITY PICKED
		// FILL PROGRAMS AS ENTITY PICKED
		// FILL PROGRAMS AS ENTITY PICKED
		
		document.getElementById("PROJECT_ENTITY").onchange = function ()
		{
			
			var picked = this.value;
			console.log(picked);
			
			var filtered = [];
			
			for(var i=0; i<programs.length; i++)
			{
				var item = programs[i];
				if(item.PROGRAM_ENTITY == picked){filtered.push(item);}
			}
			
			// FILL PROGRAMS
			selectFiller("PROJECT_PROGRAM", "Seleccione programa", filtered, "PROGRAM_CODE", "PROGRAM_NAME");
		}
		
		
		
		
		
		
		
		
		
		
		
		
		document.getElementById("PROJECT_ENTITY").onchange();
		
		
		

		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear proyecto";
		saveButton.onclick = function (){saveProject('0');}

		PUM.open(1515);
		
		
	}
	
	if(type == "activity")
	{
		
		var ACTIVITY_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "ACTIVITY_ENTITY");
		var ACTIVITY_PROJECT = fieldCreator([12,4,4,6], "Proyecto", "select", "select", "ACTIVITY_PROJECT");
		var ACTIVITY_NAME = fieldCreator([12,4,4,6], "Nombre de la actividad", "input",
		"text", "ACTIVITY_NAME");
		var ACTIVITY_COG = fieldCreator([12,4,4,6], "Actividad para atención de eventos por solicitud", "select", "select", "ACTIVITY_COG");
		
		popFormFieldBox.appendChild(ACTIVITY_ENTITY);
		popFormFieldBox.appendChild(ACTIVITY_PROJECT);
		popFormFieldBox.appendChild(ACTIVITY_NAME);
		popFormFieldBox.appendChild(ACTIVITY_COG);
		
		
		// FILL ENTITIES
		selectFiller("ACTIVITY_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		document.getElementById("ACTIVITY_ENTITY").value = userData.USER_ENTITY;
		if(userData.USER_CTYPE != "Superior")
		{document.getElementById("ACTIVITY_ENTITY").disabled = true;}
	
	
		document.getElementById("ACTIVITY_ENTITY").onchange = function ()
		{
			
			var picked = this.value;
			console.log(picked);
			
			var filtered = [];
			
			for(var i=0; i<projects.length; i++)
			{
				var item = projects[i];
				if(item.PROJECT_ENTITY == picked){filtered.push(item);}
			}

			// FILL PROJECTS
			selectFiller("ACTIVITY_PROJECT", "Seleccione proyecto", filtered, "PROJECT_CODE", "PROJECT_NAME");
		}
		
		document.getElementById("ACTIVITY_ENTITY").onchange();
		
		// FILL COG
		
		var pickerCog = document.getElementById("ACTIVITY_COG");
		
		var option = document.createElement("option");
		option.value = "0";
		option.innerHTML = "No";
		pickerCog.appendChild(option);
		
		var option = document.createElement("option");
		option.value = "1";
		option.innerHTML = "Si";
		pickerCog.appendChild(option);
		
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear Actividad";
		saveButton.onclick = function (){saveActivity('0');}
		saveButton.style.display = "initial";

		PUM.open(1515);
		
		
	}
	
	if(type == "entity")
	{
		
		var ENTITY_CITY = fieldCreator([12,4,4,12], "Ciudad", "select", "select", "ENTITY_CITY");
		var ENTITY_NAME = fieldCreator([12,4,4,6], "Nombre entidad", "input", "text", "ENTITY_NAME");
		var ENTITY_VUNTIL = fieldCreator([12,4,4,6], "Activa hasta", "input", "text", "ENTITY_VUNTIL");
		
		popFormFieldBox.appendChild(ENTITY_CITY);
		popFormFieldBox.appendChild(ENTITY_NAME);
		popFormFieldBox.appendChild(ENTITY_VUNTIL);
		
		setLocations("ENTITY_CITY");
		
		setDateField("ENTITY_VUNTIL");
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear Entidad";
		saveButton.onclick = function (){saveEntity('0');}

		PUM.open(1515);
		
		
	}
	
	if(type == "zone")
	{

		var ZONE_CITY = fieldCreator([12,4,4,6], "Ciudad", "select", "select", "ZONE_CITY");
		var ZONE_TYPE = fieldCreator([12,4,4,6], "Tipo", "select", "select", "ZONE_TYPE");
		var ZONE_NAME = fieldCreator([12,4,4,6], "Nombre de la comuna o corregimiento", "input", "text", "ZONE_NAME");
		

		popFormFieldBox.appendChild(ZONE_CITY);
		popFormFieldBox.appendChild(ZONE_TYPE);
		popFormFieldBox.appendChild(ZONE_NAME);
		
		setLocations("ZONE_CITY");
		
		// FILL ZONE TYPE
		
		var pickerZone = document.getElementById("ZONE_TYPE");
		
		var option = document.createElement("option");
		option.value = "Comuna";
		option.innerHTML = "Comuna";
		pickerZone.appendChild(option);
		
		var option = document.createElement("option");
		option.value = "Corregimiento";
		option.innerHTML = "Corregimiento";
		pickerZone.appendChild(option);
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear comuna o corregimiento";
		saveButton.onclick = function (){saveZone('0');}

		PUM.open(1515);
		
		
	}
	
	if(type == "hood")
	{
		
		var HOOD_ZONE = fieldCreator([12,4,4,6], "Comuna o corregimiento", "select", "select", "HOOD_ZONE");
		var HOOD_TYPE = fieldCreator([12,4,4,6], "Tipo", "select", "select", "HOOD_TYPE");
		var HOOD_NAME = fieldCreator([12,4,4,6], "Nombre del barrio o vereda", "input", "text", "HOOD_NAME");
		
		popFormFieldBox.appendChild(HOOD_ZONE);
		popFormFieldBox.appendChild(HOOD_TYPE);
		popFormFieldBox.appendChild(HOOD_NAME);
		
		// FILL ZONES
		selectFiller("HOOD_ZONE", "Seleccione comuna o corregimiento", zones, "ZONE_CODE", "ZONE_NAME");

		// GET HOOD CITY
		document.getElementById("HOOD_ZONE").onchange = function ()
		{
			var pick = this.value;
			for(var i=0; i<zones.length; i++)
			{
				var item = zones[i];
				if(pick == item.ZONE_CODE)
				{tmpHoodCity = item.ZONE_CITY;break;}
			}
		}

		// FILL ZONE TYPE
		var pickerZone = document.getElementById("HOOD_TYPE");
		
		var option = document.createElement("option");
		option.value = "Barrio";
		option.innerHTML = "Barrio";
		pickerZone.appendChild(option);
		
		var option = document.createElement("option");
		option.value = "Vereda";
		option.innerHTML = "Vereda";
		pickerZone.appendChild(option);
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear Barrio o vereda";
		saveButton.onclick = function (){saveHood('0');}

		PUM.open(1515);
		
		
	}
	
	if(type == "condition")
	{
		
		// var CONDITION_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "CONDITION_ENTITY");
		var CONDITION_NAME = fieldCreator([12,12,12,12], "Nombre de la Condición", "input", "text", "CONDITION_NAME");
		
		// popFormFieldBox.appendChild(CONDITION_ENTITY);
		popFormFieldBox.appendChild(CONDITION_NAME);
		
		// FILL ENTITIES
		// selectFiller("CONDITION_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// document.getElementById("CONDITION_ENTITY").value = userData.USER_ENTITY;
		// if(userData.USER_CTYPE != "Superior")
		// {document.getElementById("CONDITION_ENTITY").disabled = true;}
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear Condición";
		saveButton.onclick = function (){saveCondition('0');}

		PUM.open(1515);
		
		
	}
	
	if(type == "etnia")
	{
		
		// var ETNIA_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "ETNIA_ENTITY");
		var ETNIA_NAME = fieldCreator([12,12,12,12], "Nombre de la etnia", "input", "text", "ETNIA_NAME");
		
		// popFormFieldBox.appendChild(ETNIA_ENTITY);
		popFormFieldBox.appendChild(ETNIA_NAME);
		
		// FILL ENTITIES
		// selectFiller("ETNIA_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// document.getElementById("ETNIA_ENTITY").value = userData.USER_ENTITY;
		// if(userData.USER_CTYPE != "Superior")
		// {document.getElementById("ETNIA_ENTITY").disabled = true;}
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear etnia";
		saveButton.onclick = function (){saveEtnia('0');}

		PUM.open(1515);
		
		
	}
	
	if(type == "group")
	{
		
		var GROUP_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "GROUP_ENTITY");
		var GROUP_NAME = fieldCreator([12,4,4,6], "Nombre de grupo", "input", "text", "GROUP_NAME");
		
		
		
		var GROUP_PROGRAM = fieldCreator([12,4,4,6], "Programa", "dropdown", "dropdown", "GROUP_PROGRAM");
		var GROUP_PROJECT = fieldCreator([12,4,4,6], "Projecto", "dropdown", "dropdown", "GROUP_PROJECT");
		
		
		
		var GROUP_ACTIVITY = fieldCreator([12,4,4,6], "Actividad principal", "dropdown", "dropdown", "GROUP_ACTIVITY");
		
		var GROUP_HOOD = fieldCreator([12,4,4,6], "Barrio o vereda", "dropdown", "dropdown", "GROUP_HOOD");
		var GROUP_INSTYPE = fieldCreator([12,4,4,6], "Institucional/Comunitario", "select", "select", "GROUP_INSTYPE");
		var GROUP_SERVPLACE = fieldCreator([12,4,4,6], "Lugar guardado", "select", "select", "GROUP_SERVPLACE");
		
		var GROUP_INSTITUTE = fieldCreator([12,4,4,6], "Lugares de servicio", "dropdown", "dropdown", "GROUP_INSTITUTE");
		
		
		var GROUP_PREVIR = fieldCreator([12,4,4,6], "Presencial/Virtual", "select", "select", "GROUP_PREVIR");
		var GROUP_ADDRESS = fieldCreator([12,4,4,6], "Dirección o nombre de lugar", "input", "text", "GROUP_ADDRESS");
		var GROUP_COORDS = fieldCreator([12,4,4,6], "Coordenadas", "input", "text", "GROUP_COORDS");
		var GROUP_COPERATOR = fieldCreator([12,4,4,6], "Id. cooperador", "input", "text", "GROUP_COPERATOR");
		
		var GROUP_PROCESS = fieldCreator([12,4,4,6], "Proceso continuo", "select", "select", "GROUP_PROCESS");

		popFormFieldBox.appendChild(GROUP_ENTITY);
		popFormFieldBox.appendChild(GROUP_COPERATOR);
		popFormFieldBox.appendChild(GROUP_NAME);
		
		popFormFieldBox.appendChild(GROUP_PROGRAM);
		popFormFieldBox.appendChild(GROUP_PROJECT);
		popFormFieldBox.appendChild(GROUP_ACTIVITY);
		
		popFormFieldBox.appendChild(GROUP_INSTYPE);
		popFormFieldBox.appendChild(GROUP_SERVPLACE);
		popFormFieldBox.appendChild(GROUP_INSTITUTE);
		popFormFieldBox.appendChild(GROUP_PREVIR);
		popFormFieldBox.appendChild(GROUP_HOOD);
		popFormFieldBox.appendChild(GROUP_ADDRESS);
		popFormFieldBox.appendChild(GROUP_COORDS);
		popFormFieldBox.appendChild(GROUP_PROCESS);
		
		

		document.getElementById("GROUP_COPERATOR").lastvalue = "";
		document.getElementById("GROUP_COPERATOR").onblur = function ()
		{

			if(this.value == this.lastvalue || this.value == ""){return;}
			this.lastvalue = this.value;
			
			// IGNORE IF SAME AS EDITED
			if(this.value == actualEditData.GROUP_COPERATOR){console.log("Ignore");return;}
			
			var info = {};
			info.CITIZEN_IDNUM = this.value.split("-")[0];
			if(info.CITIZEN_IDNUM == ""){return;}
			
			console.log("age check");
			
			loadManager(1, "popFormSaveButton");
			sendAjax("users","getCitizen",info,function(response)
			{
				loadManager(0, "popFormSaveButton");
				var ans = response.message;
				console.log(ans);
				
				if(ans == "toYoung")
				{
					fastPop("Este ciudadano no es mayor de edad, solo puede ingresar mayores de edad en este campo", 3000);
					document.getElementById("GROUP_COPERATOR").lastvalue = "";
					document.getElementById("GROUP_COPERATOR").value = "";
					return;
				}

				if(ans.length > 0)
				{
					invoquedCitizenData = ans[0];
					
					var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
					document.getElementById("GROUP_COPERATOR").lastvalue = newValue;
					document.getElementById("GROUP_COPERATOR").value = newValue;
				}
				else
				{
					document.getElementById("GROUP_COPERATOR").lastvalue = "";
					document.getElementById("GROUP_COPERATOR").value = "";
					
					setTimeout(function()
					{
						var params = [info.CITIZEN_IDNUM];
						confirmBox(language["confirm"], "El id no se encuentra registrado, ¿desea crear al cooperador ahora?",createCitizenPop, params);
						
					}, 500);

				}
			});
		}
		
		// COORDS CHECKER
		document.getElementById("GROUP_COORDS").onblur = function (){checkCoords(this);}
		
		// HIDE DINAMYC FIELDS
		jQuery("#GROUP_ADDRESS_BOX").hide();
		jQuery("#GROUP_COORDS_BOX").hide();
		jQuery("#GROUP_INSTITUTE_BOX").hide();
		

		
		// FILL ENTITIES
		selectFiller("GROUP_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		document.getElementById("GROUP_ENTITY").value = userData.USER_ENTITY;
		if(userData.USER_CTYPE != "Superior")
		{document.getElementById("GROUP_ENTITY").disabled = true;}
		
		
		// PREFILTER ACTIVITIES AS USER
		
		var utype = userData.USER_CTYPE;
		
		// console.log(activities);
		
		if(utype == "Superior" || utype == "Principal3")
		{
			var myActis = activities;
		}
		else if(utype == "Director")
		{
			var tmp = [];
			var myActis = JSON.parse(getActisFromPrograms(userData.USER_PROGRAMS));
			
			for(var i=0; i<myActis.length; i++)
			{
				var item = getRegFromKey(activities, "ACTIVITY_CODE", myActis[i])
				tmp.push(item);
			}
			
			myActis = tmp;
		}
		else if(utype == "Coordinador")
		{
			// FILTER ONLY USER CONTRACT ACTIS
			var tmp = [];
			var myActis = JSON.parse(userData.USER_ACTIVITIES);
			
			for(var i=0; i<myActis.length; i++)
			{
				var item = getRegFromKey(activities, "ACTIVITY_CODE", myActis[i])
				tmp.push(item);
			}
			myActis = tmp;
		}
		else
		{
			var myActis = activities;
		}
		
		// FILL PROGRAM
		
		fixedActis = myActis;
		// console.log(fixedActis);
		// console.log("1");
		setActParents();
		// console.log("3");
		// console.log(validPrograms);
		// console.log(programVlist);
		
		
		searchListFiller("GROUP_PROGRAM", validPrograms, "PROGRAM_NAME", "PROGRAM_CODE", "Seleccione programa");
		
		
		
		
		
		// FILL HOOD
		searchListFiller("GROUP_HOOD", hoods, "HOOD_NAME", "HOOD_CODE", "Seleccione Barrio/Vereda");
		
		// FILL INSTYPE
		var options = ["Institucional", "Comunitario"];
		selectFiller("GROUP_INSTYPE", "Seleccione tipo", options);
		
		// FILL SAVED PLACE
		var options = ["Si", "No"];
		selectFiller("GROUP_SERVPLACE", "Seleccione tipo", options);
		
		// FILL PREVIR
		var options = ["Presencial", "Virtual", "Presencial/Virtual"];
		selectFiller("GROUP_PREVIR", "Seleccione tipo", options);
		
		// HIDE SHOW PREVIR
		document.getElementById("GROUP_PREVIR").onchange = function ()
		{
			var pick = this.value;
			if(pick == "Presencial" || pick == "Presencial/Virtual")
			{
				jQuery("#GROUP_ADDRESS_BOX").show();
				jQuery("#GROUP_COORDS_BOX").show();
			}
			else
			{
				jQuery("#GROUP_ADDRESS_BOX").hide();
				jQuery("#GROUP_COORDS_BOX").hide();
			}
		}
		
		
		// FILL HOOD
		searchListFiller("GROUP_INSTITUTE", institutes, "INSTITUTE_NAME", "INSTITUTE_CODE", "Seleccione lugar de servicio");
		
		
		// NEW BEHAVIOR BLOCK ----------------------------------
		// NEW BEHAVIOR BLOCK ----------------------------------
		// NEW BEHAVIOR BLOCK ----------------------------------
		
		// FILL SAVED PLACE
		var options = ["Si", "No"];
		selectFiller("GROUP_SERVPLACE", "Seleccione tipo", options);
		
		// HIDE SHOW INSTTYPE
		document.getElementById("GROUP_SERVPLACE").onchange = function ()
		{
			var pick = this.value;
			if(pick == "Si")
			{
				jQuery("#GROUP_INSTITUTE_BOX").show();
				document.getElementById("SEARCH_BUTTON_GROUP_HOOD").disabled = true;
				document.getElementById("GROUP_ADDRESS").disabled = true;
				document.getElementById("GROUP_COORDS").disabled = true;
			}
			else
			{
				jQuery("#GROUP_INSTITUTE_BOX").hide();
				
				
				document.getElementById("SEARCH_BUTTON_GROUP_INSTITUTE").innerHTML = "";
				document.getElementById("SEARCH_BUTTON_GROUP_INSTITUTE").pickedCode = "";
				
				
				searchListFiller("GROUP_HOOD", [], "HOOD_NAME", "HOOD_CODE", "Seleccione Barrio/Vereda");
				searchListFiller("GROUP_HOOD", hoods, "HOOD_NAME", "HOOD_CODE", "Seleccione Barrio/Vereda");
				
				
				
				
				document.getElementById("GROUP_ADDRESS").value = "";
				document.getElementById("GROUP_COORDS").value = "";
				
				document.getElementById("SEARCH_BUTTON_GROUP_HOOD").disabled = false;
				document.getElementById("GROUP_ADDRESS").disabled = false;
				document.getElementById("GROUP_COORDS").disabled = false;
			}
		}
		
		// NEW BEHAVIOR BLOCK ----------------------------------
		// NEW BEHAVIOR BLOCK ----------------------------------
		// NEW BEHAVIOR BLOCK ----------------------------------
		
		// FILL PROCESS
		var options = ["Si", "No"];
		selectFiller("GROUP_PROCESS", "Seleccione tipo", options);

		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear grupo";
		saveButton.onclick = function (){saveGroup('0');}
		saveButton.innerHTML = "Crear";
		saveButton.style.display = "initial";
		PUM.open(1515);
		
		
	}
	
	if(type == "assign")
	{
		
		var CONTRACT_LIST = fieldCreator([12,4,4,12], "Contratos disponibles", "select", "select", "CONTRACT_LIST");

		popFormFieldBox.appendChild(CONTRACT_LIST);
		
		// GOALS BOX ADD
		var goalsBox = document.createElement("div");
		goalsBox.id = "goalsBox";
		goalsBox.className = "blockBox";
		popFormFieldBox.appendChild(goalsBox);
		
		// CONTRACTS FILLER
		
		var validContracts = [];
		
		for(var i=0; i<actualAssignContracts.length; i++)
		{
			var con = actualAssignContracts[i];
			var conactis = con.CONTRACT_ACTIVITIES;
			
			if(conactis.includes(actualGacty))
			{
				validContracts.push(con);
			}
		}
		
		
		selectFillerContractAssign("CONTRACT_LIST", "Seleccione contrato", validContracts, "CONTRACT_CODE", "CONTRACT_USERTYPE");
		
		document.getElementById("CONTRACT_LIST").onchange = function ()
		{
			var pick = this.value;
			
			for(var i=0; i<actualAssignContracts.length; i++)
			{
				var item = actualAssignContracts[i];
				if(item.CONTRACT_CODE == pick)
				{
					actualContractData = item;

					if(item.CONTRACT_OTHER_GOALS != null && item.CONTRACT_OTHER_GOALS != "")
					{
						contractGroupsData = JSON.parse(item.CONTRACT_OTHER_GOALS);
						console.log(contractGroupsData)
						break;
					}
					else
					{contractGroupsData = []; break;}
					
				}
			}
			
			addGroupsBlock();
		}

		// DEFINE ACTION
		actualMT = "1";

		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Asignar grupo a contrato";
		saveButton.onclick = function (){saveAssignation('0');}
		saveButton.style.display = "initial";
		saveButton.innerHTML = "Asignar";

		PUM.open(1515);
		
	}

	if(type == "time")
	{
		
		var GROUP_TIME_DAY = fieldCreator([12,4,4,3], "Día", "select", "select", "GROUP_TIME_DAY");
		var GROUP_TIME_INI = fieldCreator([12,4,4,3], "Hora inicio", "select", "select", "GROUP_TIME_INI");
		var GROUP_TIME_END = fieldCreator([12,4,4,3], "Hora fin", "select", "select", "GROUP_TIME_END");
		var GROUP_ADDRANGE = buttonCreator([12,4,4,3], "Agregar horario", function()
		{
			var line = {};
			
			line.GROUP_TIME_CODE = ((Math.random()+actualGroupHours.length)*13);
			line.GROUP_TIME_DAY = document.getElementById("GROUP_TIME_DAY").value;
			line.GROUP_TIME_INI = document.getElementById("GROUP_TIME_INI").value;
			line.GROUP_TIME_END = document.getElementById("GROUP_TIME_END").value;
			line.GROUP_TIME_LST = getNow();
			
			
			if(line.GROUP_TIME_DAY == ""){fastPop("Debe seleccionar el Día.", 2000);return;}
			if(line.GROUP_TIME_INI == ""){fastPop("Debe seleccionar hora inicio.", 2000);return;}
			if(line.GROUP_TIME_END == ""){fastPop("Debe seleccionar hora fin.", 2000);return;}
			
			// CHECK COMPARE HOURS
			var time1 = line.GROUP_TIME_INI;
			var time2 = line.GROUP_TIME_END;
			var time1Date= new Date("01/01/2000 "+time1);
			var time2Date= new Date("01/01/2000 "+time2);
			if(time1Date >= time2Date )
			{fastPop("La hora inicial no puede ser posterior o igual a la final", 2000);return;}
			
			// CHECK IF DAY INI OR END HOUR IN DAY RANGE
			for(var i=0; i<actualGroupHours.length; i++)
			{
				var item = actualGroupHours[i];
				
				if(item.GROUP_TIME_DAY == line.GROUP_TIME_DAY)
				{
					var initialHour = new Date("01/01/2000 "+line.GROUP_TIME_INI);
					var finalHour = new Date("01/01/2000 "+line.GROUP_TIME_END);
					var itemIniHour = new Date("01/01/2000 "+item.GROUP_TIME_INI);
					var itemEndHour = new Date("01/01/2000 "+item.GROUP_TIME_END);
					
					if(initialHour >= itemIniHour && initialHour <= itemEndHour)
					{fastPop("La hora de inicio se encuentra dentro de otro rango para este mismo Día.", 2000);return;}
					
					if(finalHour <= itemEndHour && finalHour >= itemIniHour)
					{fastPop("La hora final se encuentra dentro de otro rango para este mismo Día.", 2000);return;}
				}
			}
			

			actualGroupHours.push(line);
			
			// ORDER ASCENDING BY HOUR
			// ORDER ASCENDING BY HOUR
			// ORDER ASCENDING BY HOUR
			
			console.log(actualGroupHours);
			
			tableCreator("wp_groups_hours", actualGroupHours);
			
			document.getElementById("GROUP_TIME_DAY").value = "";
			document.getElementById("GROUP_TIME_INI").value = "";
			document.getElementById("GROUP_TIME_END").value = "";
			
		});
		
		popFormFieldBox.appendChild(GROUP_TIME_DAY);
		popFormFieldBox.appendChild(GROUP_TIME_INI);
		popFormFieldBox.appendChild(GROUP_TIME_END);
		popFormFieldBox.appendChild(GROUP_ADDRANGE);
		
		// GOALS BOX ADD
		var hoursBox = document.createElement("div");
		hoursBox.id = "hoursBox";
		hoursBox.className = "blockBox";
		popFormFieldBox.appendChild(hoursBox);

		// FILL DAYS
		selectFiller("GROUP_TIME_DAY", "Seleccione Día", weekDays);
		// FILL HOURS
		selectFiller("GROUP_TIME_INI", "Seleccione hora", timeOptions);
		selectFiller("GROUP_TIME_END", "Seleccione hora", timeOptions);

		// SET INITIAL HOUR RANGES
		if(actualEditData.GROUP_HOURS == null || actualEditData.GROUP_HOURS == "")
		{actualGroupHours = [];}
		else
		{actualGroupHours = JSON.parse(actualEditData.GROUP_HOURS);}
		
		addHoursBlock();

		// DEFINE ACTION
		actualMT = "1";

		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Asignar horarios a clases";
		saveButton.onclick = function (){saveGroupHours();}
		saveButton.style.display = "initial";
		saveButton.innerHTML = "Guardar";

		PUM.open(1515);
		
	}

	if(type == "citizensList")
	{
		// GOALS BOX ADD
		var citizensBox = document.createElement("div");
		citizensBox.id = "citizensBox";
		citizensBox.className = "blockBox";
		popFormFieldBox.appendChild(citizensBox);

		addCitizensBlock();

		// DEFINE ACTION
		actualMT = "1";

		// SET TITLE AND SAVE FUNCTION
		
		if(classOrigin == "c")
		{
			formTitle.innerHTML = "Asistencia de clase";
			
			saveButton.onclick = function (){saveCitizenAssist();}
			saveButton.style.display = "initial";
			saveButton.innerHTML = "Guardar";
			
			PUM.open(1515);
		}
		else
		{
			formTitle.innerHTML = "Ciudadanos del grupo";
		
			saveButton.onclick = function (){return;}
			saveButton.style.display = "none";
			saveButton.innerHTML = "-";

			PUM.open(1515);
		}
		
	}
	
	if(type == "excuse")
	{
		
		var EXCUSE_REASON = fieldCreator([12,4,4,12], "Causas de cancelación", "select", "select", "EXCUSE_REASON");
		var EXCUSE_COMMENTS = fieldCreator([12,4,4,12], "Comentarios", "textarea", "textarea", "EXCUSE_COMMENTS");

		// FILE BOX
		var fileBox = document.createElement("div");
		fileBox.className = "blockBox";
		var loadFile = document.createElement("span");
		loadFile.id = "loadExcuseLink";
		loadFile.className = "loadFileLink";
		loadFile.innerHTML = "Cargar foto o pdf";
		loadFile.onclick = function ()
		{
			actualFileOrigin = "excuse";
			document.getElementById("fileSelectorfile").click();
		}
		
		fileBox.appendChild(loadFile);
		
		popFormFieldBox.appendChild(EXCUSE_REASON);
		popFormFieldBox.appendChild(EXCUSE_COMMENTS);
		popFormFieldBox.appendChild(fileBox);
		
		var causes = ["Calamidad doméstica", "Calamidad pública", "Día festivo", "Dificultad personal", "Lluvia", "No llego ningún usuario", "Otra ¿cuál?"]
		// CONTRACTS FILLER
		selectFiller("EXCUSE_REASON", "Seleccione causa", causes);

		// LOAD EXCUSE DATA IF EXISTS
		if(actualEditData != "")
		{
			document.getElementById("EXCUSE_REASON").value = actualEditData.EXCUSE_REASON;
			document.getElementById("EXCUSE_COMMENTS").value = actualEditData.EXCUSE_COMMENTS;
			if(actualEditData.EXCUSE_FILE != "")
			{
				document.getElementById("loadExcuseLink").innerHTML = "Reemplazar archivo";
				actualLoadedFile = actualEditData.EXCUSE_FILE;
				actualLoadedFileFormat = actualEditData.EXCUSE_FORMAT;
			}
		}
		else
		{
			document.getElementById("EXCUSE_REASON").value = "";
			document.getElementById("EXCUSE_COMMENTS").value = "";
			actualLoadedFile = "";
			actualLoadedFileFormat = "";
		}

		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Excusa de clase no dictada";
		saveButton.onclick = function (){saveExcuse('0');}
		
		
		saveButton.innerHTML = "Guardar";
		
		var utype = userData.USER_CTYPE;
		
		if(utype == "Principal3")
		{
			saveButton.style.display = "none";
		}
		else
		{
			saveButton.style.display = "initial";
		}
		

		PUM.open(1515);
		
	}
	
	if(type == "class")
	{
		
		var CLASS_ENTITY = fieldCreator([12,12,12,12], "Entidad", "select", "select", "CLASS_ENTITY");
		var CLASS_GROUP = fieldCreator([12,12,12,12], "Grupo", "dropdown", "dropdown", "CLASS_GROUP");
		var CLASS_GROUP_ACTIVITY = fieldCreator([12,12,12,12], "Actividad", "dropdown", "dropdown", "CLASS_GROUP_ACTIVITY");
		var CLASS_DATE = fieldCreator([12,4,4,4], "Fecha", "input",	"text", "CLASS_DATE");
		var GROUP_TIME_INI = fieldCreator([12,4,4,4], "Hora inicio", "select", "select", "GROUP_TIME_INI");
		var GROUP_TIME_END = fieldCreator([12,4,4,4], "Hora fin", "select", "select", "GROUP_TIME_END");
		
		popFormFieldBox.appendChild(CLASS_ENTITY);
		popFormFieldBox.appendChild(CLASS_GROUP);
		popFormFieldBox.appendChild(CLASS_GROUP_ACTIVITY);
		popFormFieldBox.appendChild(CLASS_DATE);
		popFormFieldBox.appendChild(GROUP_TIME_INI);
		popFormFieldBox.appendChild(GROUP_TIME_END);
		
		// FILL ENTITIES
		selectFiller("CLASS_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		document.getElementById("CLASS_ENTITY").value = userData.USER_ENTITY;
		if(userData.USER_CTYPE != "Superior")
		{document.getElementById("CLASS_ENTITY").disabled = true;}
		
		console.log(actualClassGroups);
		
		// userData.USER_CTYPE = "Director";

		// GROUPS PICKER INSTRUCTOR AND COGESTOR
		if(userData.USER_CTYPE == "Instructor" || userData.USER_CTYPE == "Cogestor")
		{
			if(userData.USER_GROUPS != null && userData.USER_GROUPS != "")
			{
				var uGroups = JSON.parse(userData.USER_GROUPS);
				var myGcodes = [];
				for(var i=0; i<uGroups.length; i++)
				{
					var item = uGroups[i];
					if(item.V4){myGcodes.push(item.V4)}
				}
			}
			var myGroups = [];
			for(var i=0; i<actualClassGroups.length; i++)
			{
				var item = actualClassGroups[i];
				if(myGcodes.includes(item.GROUP_CODE))
				{
					if(item.GROUP_PROCESS == "No"){myGroups.push(item);}
					
				}
			}
			
			actualClassGroups = myGroups;
		}
		// GROUPS PICKER DIRECTOR AND COORDINADOR
		if(userData.USER_CTYPE == "Director" || userData.USER_CTYPE == "Coordinador")
		{
			var myGroups = [];
			
			console.log(actualClassGroups);
			console.log(userData)
			
			for(var i=0; i<actualClassGroups.length; i++)
			{
				var item = actualClassGroups[i];
				var itemActy = item.GROUP_ACTIVITY;

				if(!userData.USER_ACTIVITIES.includes(itemActy)){continue;}
				
				if(item.GROUP_PROCESS == "No" && item.GROUP_CONTRACT == userData.USER_CONTRACT){myGroups.push(item);}
				
				if(item.GROUP_TUTOR_TYPE == "Instructor" || item.GROUP_TUTOR_TYPE == "Cogestor")
				{
					myGroups.push(item);
					// if(item.GROUP_PROCESS == "No"){}
				}
				
				if(userData.USER_CTYPE == "Director" && item.GROUP_TUTOR_TYPE == "Coordinador")
				{
					myGroups.push(item);
					// if(item.GROUP_PROCESS == "No"){}				
				}
				
				if(userData.USER_CTYPE == "Coordinador" && item.GROUP_TUTOR_TYPE == "Director")
				{
					myGroups.push(item);
					// if(item.GROUP_PROCESS == "No"){}				
				}
					
			}
			
			actualClassGroups = myGroups;
		}
		
		// FILTER GROUPS BY SUPERIOR
		var pickedGroups = [];
		var myEntity = userData.USER_ENTITY;
		if(userData.USER_CTYPE != "Superior")
		{
			for(var i=0; i<actualClassGroups.length; i++)
			{
				var gr = actualClassGroups[i];
				var grEnt = actualClassGroups[i]["GROUP_ENTITY"];
				if(grEnt == myEntity)
				{pickedGroups.push(gr);}
			}
			actualClassGroups = pickedGroups;
		}
		
		// ADD FULL DESC TO ARRAY
		for(var i=0; i<actualClassGroups.length; i++)
		{
			var item = actualClassGroups[i];
			var desc = "Número contrato : "+item["GROUP_CONTRACT_NUMBER"]+
							" - Nombre grupo: "+item["GROUP_NAME"]+
							" - Asignado a: "+item["GROUP_TUTOR_NAME"]+
							" - Tipo: "+item["GROUP_TUTOR_TYPE"];
			item.GROUP_FULL_DESC = desc; 
		}

		console.log(actualClassGroups);
		
		// FILL GROUPS
		searchListFiller("CLASS_GROUP", actualClassGroups, "GROUP_FULL_DESC", "GROUP_CODE", "Seleccione Grupo");


		// FILL HOURS
		selectFiller("GROUP_TIME_INI", "Seleccione hora", timeOptions);
		selectFiller("GROUP_TIME_END", "Seleccione hora", timeOptions);
		
		// SET DATE FIELDS
		setDateField("CLASS_DATE");
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear clase";
		saveButton.onclick = function (){saveClass('0');}
		saveButton.innerHTML = "Crear";
		saveButton.style.display = "initial";
		
		
		// document.getElementById("CLASS_DATE").value = "2022-03-11";
		// document.getElementById("GROUP_TIME_INI").value = "01:00";
		// document.getElementById("GROUP_TIME_END").value = "01:15";

		PUM.open(1515);

	}
	
	if(type == "classEdit")
	{
		
		var CLASS_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "CLASS_ENTITY");
		var CLASS_GROUP = fieldCreator([12,4,4,6], "Grupo", "select", "select", "CLASS_GROUP");
		var CLASS_DATE = fieldCreator([12,4,4,6], "Fecha", "input",
		"text", "CLASS_DATE");
		var GROUP_TIME_INI = fieldCreator([12,4,4,6], "Hora inicio", "select", "select", "GROUP_TIME_INI");
		var GROUP_TIME_END = fieldCreator([12,4,4,6], "Hora fin", "select", "select", "GROUP_TIME_END");
		
		popFormFieldBox.appendChild(CLASS_ENTITY);
		popFormFieldBox.appendChild(CLASS_GROUP);
		popFormFieldBox.appendChild(CLASS_DATE);
		popFormFieldBox.appendChild(GROUP_TIME_INI);
		popFormFieldBox.appendChild(GROUP_TIME_END);
		
		// FILL ENTITIES
		selectFiller("CLASS_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		document.getElementById("CLASS_ENTITY").value = userData.USER_ENTITY;
		if(userData.USER_CTYPE != "Superior")
		{document.getElementById("CLASS_ENTITY").disabled = true;}
		
		
		// GROUPS FILLER
		var goption  = document.createElement("option");
		goption.value = actualEditData.CLASS_GROUP;
		goption.innerHTML = "Número contrato: "+actualEditData.CLASS_CONTRACT_NUMBER+" - "+"Nombre grupo: "+actualEditData.CLASS_GROUP_NAME+" - "+"Asignado a: "+actualEditData.CLASS_TUTOR_NAME;
		document.getElementById("CLASS_GROUP").appendChild(goption);
		
		// FILL HOURS
		selectFiller("GROUP_TIME_INI", "Seleccione hora", timeOptions);
		selectFiller("GROUP_TIME_END", "Seleccione hora", timeOptions);
		
		// SET DATE FIELDS
		setDateField("CLASS_DATE");
		
		
		// DATA LOAD
		document.getElementById("CLASS_DATE").value = actualEditData.CLASS_DATE.split(" ")[0];
		var hour = JSON.parse(actualEditData.CLASS_HOUR);
		document.getElementById("GROUP_TIME_INI").value = hour.GROUP_TIME_INI;
		document.getElementById("GROUP_TIME_END").value = hour.GROUP_TIME_END;
		
		console.log(actualEditData)
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Editar clase";
		saveButton.onclick = function (){saveClass('1');}
		saveButton.innerHTML = "Guardar";
		saveButton.style.display = "initial";

		PUM.open(1515);

	}
	
	if(type == "remComment")
	{
		
		var REMCOM_COMMENT_DATE = fieldCreator([12,12,12,12], "Fecha motivo", "input", "text", "REMCOM_COMMENT_DATE");
		var REMCOM_COMMENT = fieldCreator([12,12,12,12], "Motivo", "textarea", "textarea", "REMCOM_COMMENT");
		var REMCOM_SPECIAL = fieldCreator([12,12,12,12], "Motivo especial", "select", "select", "REMCOM_SPECIAL");

		if(actualComment == "remClose")
		{

			var REMCOM_COMMENT = fieldCreator([12,12,12,12], "Motivo de atención", "textarea", "textarea", "REMCOM_COMMENT");
			var REMCOM_SPECIAL = fieldCreator([12,12,12,12], "Motivo especial de atención", "select", "select", "REMCOM_SPECIAL");
			
			var REMCOM_ACTIVITY = fieldCreator([12,4,4,6], "Actividad", "dropdown", "dropdown", "REMCOM_ACTIVITY");
			var REMCOM_CONTRATIST = fieldCreator([12,12,12,6], "Contratista", "dropdown", "dropdown","REMCOM_CONTRATIST");
			
			
			
			popFormFieldBox.appendChild(REMCOM_COMMENT);
			popFormFieldBox.appendChild(REMCOM_COMMENT_DATE);
			popFormFieldBox.appendChild(REMCOM_SPECIAL);
			popFormFieldBox.appendChild(REMCOM_ACTIVITY);
			popFormFieldBox.appendChild(REMCOM_CONTRATIST);
			
			
			searchListFiller("REMCOM_ACTIVITY", fixedActis, "ACTIVITY_DETAIL", "ACTIVITY_CODE",  "Seleccione actividad");
			
			// FILE BOX
			var fileBox = document.createElement("div");
			fileBox.className = "blockBox";
			var loadFile = document.createElement("span");
			loadFile.id = "loadCommentLink";
			// loadFile.className = "loadFileLink";
			loadFile.className = "loadFileLink";
			loadFile.innerHTML = "Cargar pdf de atención";
			loadFile.onclick = function ()
			{
				actualFileOrigin = "comment";
				document.getElementById("fileSelectorfile").click();
			}
			fileBox.appendChild(loadFile);
		}
		else
		{
			
			// FILE BOX
			var fileBox = document.createElement("div");
			fileBox.className = "blockBox";
			var loadFile = document.createElement("span");
			loadFile.id = "loadCommentLink";
			// loadFile.className = "loadFileLink";
			loadFile.className = "loadFileLink";
			loadFile.innerHTML = "Cargar pdf";
			loadFile.onclick = function ()
			{
				actualFileOrigin = "comment";
				document.getElementById("fileSelectorfile").click();
			}
			fileBox.appendChild(loadFile);
			
			
			
			popFormFieldBox.appendChild(REMCOM_COMMENT);
			popFormFieldBox.appendChild(REMCOM_COMMENT_DATE);
			popFormFieldBox.appendChild(REMCOM_SPECIAL);
		}
		
		var options = ["Si", "No"];
		selectFiller("REMCOM_SPECIAL", "Seleccione opción", options);
		
		if(actualComment == "addGroup" || actualComment == "quitGroup")
		{
			var REMCOM_GROUP = fieldCreator([12,12,12,12], "Grupo", "dropdown", "dropdown", "REMCOM_GROUP");
			popFormFieldBox.appendChild(REMCOM_GROUP);
		}
		
		if(actualComment == "remit")
		{
			
			
			var REMCOM_PROGRAM = fieldCreator([12,4,4,6], "Programa", "dropdown", "dropdown", "REMCOM_PROGRAM");
			var REMCOM_PROJECT = fieldCreator([12,4,4,6], "Projecto", "dropdown", "dropdown", "REMCOM_PROJECT");
			
			
			var REMCOM_ACTIVITY = fieldCreator([12,4,4,6], "Actividad", "dropdown", "dropdown", "REMCOM_ACTIVITY");
			var REMCOM_CONTRATIST = fieldCreator([12,12,12,6], "Contratista", "dropdown", "dropdown","REMCOM_CONTRATIST");
			
			
			
			
			
			// BUILD PREFILTER PROGRAM AND PROYECT
			// BUILD PREFILTER PROGRAM AND PROYECT
			// BUILD PREFILTER PROGRAM AND PROYECT
			

			popFormFieldBox.appendChild(REMCOM_PROGRAM);
			popFormFieldBox.appendChild(REMCOM_PROJECT);
			popFormFieldBox.appendChild(REMCOM_ACTIVITY);
			popFormFieldBox.appendChild(REMCOM_CONTRATIST);
			
			setActParents();
			
			searchListFiller("REMCOM_PROGRAM", validPrograms, "PROGRAM_NAME", "PROGRAM_CODE",  "Seleccione programa");
			
		}
		
		
		if(actualComment == "date")
		{
			var REMCOM_DATE_DATE = fieldCreator([12,4,4,6],"Fecha de la cita", "input", "text", "REMCOM_DATE_DATE");
			var REMCOM_DATE_INI = fieldCreator([12,4,4,6],"Hora inicial cita", "select", "select","REMCOM_DATE_INI");
			var REMCOM_DATE_END = fieldCreator([12,4,4,6],"Hora final cita", "select", "select","REMCOM_DATE_END");
			var REMCOM_DATE_PLACE = fieldCreator([12,4,4,6],"Lugar de la cita", "input", "text","REMCOM_DATE_PLACE");
			popFormFieldBox.appendChild(REMCOM_DATE_DATE);
			popFormFieldBox.appendChild(REMCOM_DATE_INI);
			popFormFieldBox.appendChild(REMCOM_DATE_END);
			popFormFieldBox.appendChild(REMCOM_DATE_PLACE);
			
			// SET DATE FIELDS
			setDateField("REMCOM_DATE_DATE");
			document.getElementById("REMCOM_DATE_DATE").onkeyup=function(){this.value = "";}
			
			// FILL HOURS
			selectFiller("REMCOM_DATE_INI", "Seleccione hora", timeOptions);
			selectFiller("REMCOM_DATE_END", "Seleccione hora", timeOptions);
			
			// document.getElementById("REMCOM_COMMENT").value = "test de sobrepisado citas";
			// document.getElementById("REMCOM_SPECIAL").value = "No";
			// document.getElementById("REMCOM_DATE_DATE").value = "2022-03-09";
			// document.getElementById("REMCOM_DATE_INI").value = "18:00";
			// document.getElementById("REMCOM_DATE_END").value = "18:30";
			// document.getElementById("REMCOM_DATE_PLACE").value = "anywhere";
			
			
			
			
		}
		
		if(actualComment == "decition")
		{
			var REMCOM_COMPONENT = fieldCreator([12,12,12,12],"Componente", "dropdown", "dropdown", "REMCOM_COMPONENT");
			var REMCOM_SCOMPONENT = fieldCreator([12,12,12,12],"Sub Componente", "dropdown", "dropdown", "REMCOM_SCOMPONENT");
			
			popFormFieldBox.appendChild(REMCOM_COMPONENT);
			popFormFieldBox.appendChild(REMCOM_SCOMPONENT);
			
			var myActis = JSON.parse(userData.USER_ACTIVITIES);
			
			var pickedComps = [];
			
			for(var i=0; i<components.length; i++)
			{
				var comp = components[i];
				var compActis = JSON.parse(comp.COMPONENT_ACTIVITIES);
				console.log(compActis);
				
				for(var a=0; a<compActis.length; a++)
				{
					var acty = compActis[a];
					if(myActis.includes(acty))
					{if(!pickedComps.includes(comp)){pickedComps.push(comp); break;}}
				}
				
				
			}
			
			console.log(pickedComps);
			
			searchListFiller("REMCOM_COMPONENT", pickedComps, "COMPONENT_NAME", "COMPONENT_CODE",  "Seleccione componente");
			
			
			console.log(userData);
			
			
			
			
			
		}
		
		popFormFieldBox.appendChild(fileBox);

		if(actualComment == "remClose")
		{
			
			var REMCOM_COMMENT_CLOSE = fieldCreator([12,12,12,12], "Comentario de cierre", "textarea", "textarea", "REMCOM_COMMENT_CLOSE");
			var REMCOM_SPECIAL_CLOSE = fieldCreator([12,12,12,12], "Comentario especial de cierre", "select", "select", "REMCOM_SPECIAL_CLOSE");
			
			popFormFieldBox.appendChild(REMCOM_COMMENT_CLOSE);
			popFormFieldBox.appendChild(REMCOM_SPECIAL_CLOSE);
			
			// FILE BOX
			var fileBox = document.createElement("div");
			fileBox.className = "blockBox";
			var loadFile = document.createElement("span");
			loadFile.id = "loadCommentCloseLink";
			loadFile.className = "loadFileLink";
			loadFile.innerHTML = "Cargar pdf de cierre";
			loadFile.onclick = function ()
			{
				actualFileOrigin = "commentClose";
				document.getElementById("fileSelectorfile").click();
			}
			fileBox.appendChild(loadFile);
			
			popFormFieldBox.appendChild(fileBox);
			
			
			var options = ["Si", "No"];
			selectFiller("REMCOM_SPECIAL_CLOSE", "Seleccione opción", options);
			
			console.log(actualRemitionData);
			
			// SET AND FIX ACTIVITY
			
			var thearray = JSON.stringify([actualRemitionData.REM_ACTIVITY]);
			var activity = getFriendDescs(thearray,"activities");
			document.getElementById("SEARCH_BUTTON_REMCOM_ACTIVITY").innerHTML = activity;
			document.getElementById("SEARCH_BUTTON_REMCOM_ACTIVITY").pickedCode = actualRemitionData.REM_ACTIVITY;
			document.getElementById("SEARCH_BUTTON_REMCOM_ACTIVITY").disabled = true;
			// ACTIVATE PICKER OPTION
			var theSpan = document.getElementById("span-"+actualRemitionData.REM_ACTIVITY)
			theSpan.onclick();
			theSpan.onclick();
			
		}

		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		
		if(actualComment == "normalComment")
		{
			formTitle.innerHTML = "Añadir comentario";
		}
		if(actualComment == "addGroup")
		{
			formTitle.innerHTML = "Agregar ciudadano a grupo";
			// CHECK IF CITIZEN ON GROUP
			var pickedG = [];
			
						
			var userActis = JSON.parse(userData.USER_ACTIVITIES);
			var vPrograms = [];
			for(var i=0; i<userActis.length; i++)
			{
				var acti = userActis[i];
				var program = getProgramFromActi(acti);
				if(!vPrograms.includes(program)){vPrograms.push(program);}
			}

			for(var i=0; i<groups.length; i++)
			{
				var g = groups[i];
				if(g.GROUP_CITIZENS == "" || g.GROUP_CITIZENS == null || g.GROUP_CITIZENS == "null"){g.GROUP_CITIZENS = "[]";}
				var czns = JSON.parse(g.GROUP_CITIZENS);
				var pickG = 1;
				
				// console.log(czns);
				
				for(var c=0; c<czns.length; c++)
				{
					var guyId = czns[c].CITIZEN_IDNUM;
					if(guyId == actualRemitionData.REM_CITIZEN)	{pickG = 0;	break;}
				}
				if(pickG == 1)
				{
					var gActi = g.GROUP_ACTIVITY;
					var gProgram = getProgramFromActi(gActi)
					if(vPrograms.includes(gProgram)){pickedG.push(g);}
				}
			}
			
			
			searchListFiller("REMCOM_GROUP", pickedG, "GROUP_NAME", "GROUP_CODE", "Seleccione grupo");
			
		}
		if(actualComment == "quitGroup")
		{
			formTitle.innerHTML = "Sacar ciudadano de grupo";
			// CHECK IF CITIZEN NOT ON GROUP
			
			var userActis = JSON.parse(userData.USER_ACTIVITIES);
			var vPrograms = [];
			for(var i=0; i<userActis.length; i++)
			{
				var acti = userActis[i];
				var program = getProgramFromActi(acti);
				if(!vPrograms.includes(program)){vPrograms.push(program);}
			}
			
			
			var pickedG = [];
			for(var i=0; i<groups.length; i++)
			{
				var g = groups[i];
				if(g.GROUP_CITIZENS == "" || g.GROUP_CITIZENS == null || g.GROUP_CITIZENS == "null"){continue;}
				var czns = JSON.parse(g.GROUP_CITIZENS);
				for(var c=0; c<czns.length; c++)
				{
					var guyId = czns[c].CITIZEN_IDNUM;
					if(guyId == actualRemitionData.REM_CITIZEN)
					{
						
						var gActi = g.GROUP_ACTIVITY;
						var gProgram = getProgramFromActi(gActi)
						if(vPrograms.includes(gProgram)){pickedG.push(g);}
					}
				}
			}
			
			searchListFiller("REMCOM_GROUP", pickedG, "GROUP_NAME", "GROUP_CODE", "Seleccione grupo");
		}
		if(actualComment == "remit")
		{
			formTitle.innerHTML = "Remitir a contratista";
		}
		if(actualComment == "date")
		{
			formTitle.innerHTML = "Generar cita";
		}
		if(actualComment == "close")
		{
			formTitle.innerHTML = "Cerrar";
		}
		if(actualComment == "reopen")
		{
			formTitle.innerHTML = "Re abrir";
		}
		if(actualComment == "remClose")
		{
			formTitle.innerHTML = "Remitir y cerrar";
		}
		if(actualComment == "decition")
		{
			formTitle.innerHTML = "Comentario de decisión";
		}
		
		
		setDateField("REMCOM_COMMENT_DATE", "time");
		
		
		saveButton.onclick = function (){saveComment(actualComment);}
		saveButton.style.display = "initial";
		saveButton.innerHTML  = "Guardar";
		
		
		

		PUM.open(1515);
		
		
	}
	
	if(type == "institute")
	{
		
		var INSTITUTE_NAME = fieldCreator([12,4,4,6], "Nombre", "input", "text", "INSTITUTE_NAME");
		var INSTITUTE_CITY = fieldCreator([12,4,4,6], "Ciudad", "select", "select", "INSTITUTE_CITY");
		var INSTITUTE_ZONE = fieldCreator([12,4,4,6], "Comuna/Corregimiento", "select", "select", "INSTITUTE_ZONE");
		var INSTITUTE_HOOD = fieldCreator([12,4,4,6], "Barrio/Vereda", "dropdown", "dropdown", "INSTITUTE_HOOD");
		var INSTITUTE_ADDRESS = fieldCreator([12,4,4,6], "Dirección o nombre del lugar", "input", "text", "INSTITUTE_ADDRESS");
		var INSTITUTE_COORDS = fieldCreator([12,4,4,6], "Coordenadas", "input", "text", "INSTITUTE_COORDS");
		var INSTITUTE_EDU = fieldCreator([12,4,4,6], "Institución educativa", "select", "select", "INSTITUTE_EDU");
		
		popFormFieldBox.appendChild(INSTITUTE_NAME);
		popFormFieldBox.appendChild(INSTITUTE_CITY);
		popFormFieldBox.appendChild(INSTITUTE_ZONE);
		popFormFieldBox.appendChild(INSTITUTE_HOOD);
		popFormFieldBox.appendChild(INSTITUTE_ADDRESS);
		popFormFieldBox.appendChild(INSTITUTE_COORDS);
		popFormFieldBox.appendChild(INSTITUTE_EDU);

		setLocations("INSTITUTE_CITY");
		
		var cityPicker = document.getElementById("INSTITUTE_CITY");
		cityPicker.onchange = function ()
		{
			var pick = this.value;
			var zonePicker = document.getElementById("INSTITUTE_ZONE");
			zonePicker.innerHTML = "";
			
			searchListFiller("INSTITUTE_HOOD", [], "HOOD_NAME", "HOOD_CODE", "Seleccione Barrio/Vereda");

			var option = document.createElement("option");
			option.innerHTML = "Seleccione Comuna/Corregimiento";
			option.value = "";
			zonePicker.appendChild(option);

			for(var i=0; i<zones.length; i++)
			{
				var item = zones[i];
				if(item.ZONE_CITY == pick)
				{
					var option = document.createElement("option");
					option.innerHTML = item.ZONE_NAME;
					option.value = item.ZONE_CODE;
					zonePicker.appendChild(option);
				}
			}
		}
		
		var zonePicker = document.getElementById("INSTITUTE_ZONE");
		zonePicker.onchange = function ()
		{
			var pick = this.value;
			var pickedList = [];
			// PREPARE LIST
			for(var i=0; i<hoods.length; i++)
			{
				var item = hoods[i];
				if(item.HOOD_ZONE == pick)
				{pickedList.push(item);}
			}
			
			console.log(pickedList)
			
			searchListFiller("INSTITUTE_HOOD", pickedList, "HOOD_NAME", "HOOD_CODE", "Seleccione Barrio/Vereda");
			
		}
		
		// COORDS CHECKER
		document.getElementById("INSTITUTE_COORDS").onblur = function (){checkCoords(this);}
		

		var options = ["Si", "No"];
		selectFiller("INSTITUTE_EDU", "Seleccione", options);
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear lugar de servicio";
		saveButton.onclick = function (){saveInstitute('0');}
		saveButton.style.display = "initial";

		PUM.open(1515);
	
	}
	
	if(type == "event")
	{
		
		var EVENT_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "EVENT_ENTITY");
		var EVENT_DATE_INI = fieldCreator([12,4,4,6], "Fecha/hora inicio", "input", "text", "EVENT_DATE_INI");
		var EVENT_DATE_END = fieldCreator([12,4,4,6], "Fecha/hora fin", "input","text", "EVENT_DATE_END");
		var EVENT_COOPTYPE = fieldCreator([12,4,4,6], "Tipo de cooperador", "select", "select", "EVENT_COOPTYPE");
		var EVENT_COOPERATOR = fieldCreator([12,4,4,6], "Id. cooperador", "input", "text", "EVENT_COOPERATOR");
		var EVENT_HOOD = fieldCreator([12,4,4,6], "Barrio o vereda", "dropdown", "dropdown", "EVENT_HOOD");
		// OTHER FIELDS
		var EVENT_SERVPLACE = fieldCreator([12,4,4,6], "Lugar guardado", "select", "select", "EVENT_SERVPLACE");
		var EVENT_INSTYPE = fieldCreator([12,4,4,6], "Institucional/Comunitario", "select", "select", "EVENT_INSTYPE");
		
		var EVENT_INSTITUTE = fieldCreator([12,4,4,6], "Institución", "dropdown", "dropdown", "EVENT_INSTITUTE");
		
		var EVENT_PREVIR = fieldCreator([12,4,4,6], "Presencial/Virtual", "select", "select", "EVENT_PREVIR");
		var EVENT_ADDRESS = fieldCreator([12,4,4,6], "Dirección o nombre de lugar", "input", "text", "EVENT_ADDRESS");
		var EVENT_COORDS = fieldCreator([12,4,4,6], "Coordenadas", "input", "text", "EVENT_COORDS");
		var EVENT_ACTIVITIES = fieldCreator([12,4,6,12], "Actividades director de evento", "multiselect", "select", "EVENT_ACTIVITIES");
		var EVENT_NAME = fieldCreator([12,4,4,6], "Nombre o propósito del evento", "input", "text", "EVENT_NAME");
		
		
		popFormFieldBox.appendChild(EVENT_ENTITY);
		popFormFieldBox.appendChild(EVENT_COOPERATOR);
		popFormFieldBox.appendChild(EVENT_NAME);
		popFormFieldBox.appendChild(EVENT_COOPTYPE);
		popFormFieldBox.appendChild(EVENT_DATE_INI);
		popFormFieldBox.appendChild(EVENT_DATE_END);
		popFormFieldBox.appendChild(EVENT_INSTYPE);
		
		popFormFieldBox.appendChild(EVENT_SERVPLACE);
		popFormFieldBox.appendChild(EVENT_INSTITUTE);
		popFormFieldBox.appendChild(EVENT_PREVIR);
		popFormFieldBox.appendChild(EVENT_HOOD);
		popFormFieldBox.appendChild(EVENT_ADDRESS);
		popFormFieldBox.appendChild(EVENT_COORDS);
		popFormFieldBox.appendChild(EVENT_ACTIVITIES);
		
		document.getElementById("EVENT_COOPERATOR").lastvalue = "";
		document.getElementById("EVENT_COOPERATOR").onblur = function ()
		{

			if(this.value == this.lastvalue || this.value == ""){return;}
			this.lastvalue = this.value;
			
			// IGNORE IF SAME AS EDITED
			if(this.value == actualEditData.EVENT_COOPERATOR){console.log("Ignore");return;}
			
			var info = {};
			info.CITIZEN_IDNUM = this.value.split("-")[0];
			if(info.CITIZEN_IDNUM == ""){return;}
			
			console.log("age check");
			
			loadManager(1, "popFormSaveButton");
			sendAjax("users","getCitizen",info,function(response)
			{
				loadManager(0, "popFormSaveButton");
				
				var ans = response.message;
				console.log(ans);
				
				if(ans == "toYoung")
				{
					fastPop("Este ciudadano no es mayor de edad, solo puede ingresar mayores de edad en este campo", 3000);
					document.getElementById("EVENT_COOPERATOR").lastvalue = "";
					document.getElementById("EVENT_COOPERATOR").value = "";
					return;
				}

				if(ans.length > 0)
				{
					invoquedCitizenData = ans[0];
					
					var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
					document.getElementById("EVENT_COOPERATOR").lastvalue = newValue;
					document.getElementById("EVENT_COOPERATOR").value = newValue;
				}
				else
				{
					
					document.getElementById("EVENT_COOPERATOR").lastvalue = "";
					document.getElementById("EVENT_COOPERATOR").value = "";
					
					setTimeout(function()
					{
						var params = [info.CITIZEN_IDNUM];
						confirmBox(language["confirm"], "El id no se encuentra registrado, ¿desea crear al cooperador ahora?",createCitizenPop, params);
						
					}, 500);

				}
			});
		}
	
		// HIDE DINAMYC FIELDS
		jQuery("#EVENT_ADDRESS_BOX").hide();
		jQuery("#EVENT_COORDS_BOX").hide();
		
		// FILL ENTITIES
		selectFiller("EVENT_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		document.getElementById("EVENT_ENTITY").value = userData.USER_ENTITY;
		if(userData.USER_CTYPE != "Superior")
		{document.getElementById("EVENT_ENTITY").disabled = true;}
		
		// SET DATE FIELDS
		setDateField("EVENT_DATE_INI", "time");
		setDateField("EVENT_DATE_END", "time");
		document.getElementById("EVENT_DATE_INI").onkeyup=function(){this.value = "";}
		document.getElementById("EVENT_DATE_END").onkeyup=function(){this.value = "";}
		
		// FILL HOOD
		
		// IF COGESTOR FILTER HOODS
		var utype = userData.USER_CTYPE;
		if(utype == "Cogestor")
		{
			var theHoods = [];
			var userHoods = JSON.parse(getHoodsFromZones(userData.USER_ZONES));
			// console.log(theHoods)
			// console.log(userHoods)
			
			for(var i=0; i<hoods.length; i++)
			{
				var hoodCode = hoods[i].HOOD_CODE;
				if(userHoods.includes(hoodCode))
				{
					theHoods.push(hoods[i]);
				}
			}
		}
		else
		{
			var theHoods = hoods;
		}
		// selectFiller("EVENT_HOOD", "Seleccione barrio o vereda", theHoods, "HOOD_CODE", "HOOD_NAME_FULL");
		
		// FILL PREVIR
		var options = ["Presencial", "Virtual", "Presencial/Virtual"];
		selectFiller("EVENT_PREVIR", "Seleccione tipo", options);
		
		document.getElementById("EVENT_PREVIR").onchange = function ()
		{
			var pick = this.value;
			if(pick == "Presencial" || pick == "Presencial/Virtual")
			{
				jQuery("#EVENT_ADDRESS_BOX").show();
				jQuery("#EVENT_COORDS_BOX").show();
			}
			else
			{
				jQuery("#EVENT_ADDRESS_BOX").hide();
				jQuery("#EVENT_COORDS_BOX").hide();
			}
		}
		
		
		// COORDS CHECKER
		document.getElementById("EVENT_COORDS").onblur = function (){checkCoords(this);}
		
		// FILL ACTIVITIES
		var clistA = [];
		var singlePicker = "1";
		var locked = "0";
		multiSelectFillerDic("EVENT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_NAME", actualEventActivities,clistA,singlePicker,locked);
		
		var EVENT_SUPPORT_PICKER = fieldCreator([12,4,6,12], "Seleccionar usuarios de apoyo", "dropdown", "dropdown", "EVENT_SUPPORT_PICKER");

		var EVENT_SUPPORT_ACTIVITIES = fieldCreator([12,4,6,6], "Actividades del usuario de apoyo", "multiselect", "select", "EVENT_SUPPORT_ACTIVITIES");
		
		actualSupportList = [];
		
		var EVENT_SUPPORT_ADDER = buttonCreator([12,4,4,6], "Agregar apoyo", function()
		{
			if(actualContractData == "")
			{fastPop("Debe seleccionar un usuario de soporte.", 2000);return;}
			
			var support = {};
			support.SUPPORT_CONTRACT = actualContractData.CONTRACT_CODE;
			support.SUPPORT_CONTRACT_NUMBER = actualContractData.CONTRACT_NUMBER;
			support.SUPPORT_OWNER_NAME = actualContractData.CONTRACT_OWNER_NAME;
			support.SUPPORT_USERTYPE = actualContractData.CONTRACT_USERTYPE;
			support.SUPPORT_ACTIVITIES = JSON.parse(getMultiCheckValue("EVENT_SUPPORT_ACTIVITIES"));
			
			
			// CHECK IF ACTI PICKED
			if(support.SUPPORT_ACTIVITIES == 0)
			{
				fastPop("Debe seleccionar por lo menos una actividad de usuario de apoyo.", 2000);return;
			}
			
			// CHECK IF SUPPORT ADDED
			for(var i=0; i<actualSupportList.length; i++)
			{
				var item = actualSupportList[i];
				if(item.SUPPORT_CONTRACT == support.SUPPORT_CONTRACT)
				{fastPop("Este usuario ya se encuentra en la lista de apoyo", 2000);return;}
			}
			
			actualSupportList.push(support);
			console.log(actualSupportList);
			
			tableCreator("wp_events_support", actualSupportList);
			
			document.getElementById("EVENT_SUPPORT_PICKER").value = "";
			document.getElementById("EVENT_SUPPORT_ACTIVITIES").innerHTML = "";

		});
		
		popFormFieldBox.appendChild(EVENT_SUPPORT_PICKER);
		popFormFieldBox.appendChild(EVENT_SUPPORT_ACTIVITIES);
		popFormFieldBox.appendChild(EVENT_SUPPORT_ADDER);
		
		// FILL SUPPORT PICKER
		
		// ---------------------------------------------------
		// CREATE DESC FIELD
		for(var i=0; i<avaEventContracts.length; i++)
		{
			var contract = avaEventContracts[i];
			var desc = contract.CONTRACT_OWNER_NAME+" Contrato: "+contract.CONTRACT_NUMBER+" Tipo: "+contract.CONTRACT_USERTYPE;
			avaEventContracts[i]["FULL_DESC"] = desc;
		}
		
		// INDEX BY NAME
		var indexed = sortByKey(avaEventContracts, "FULL_DESC");
		console.log(indexed);
		
		searchListFiller("EVENT_SUPPORT_PICKER", indexed, "FULL_DESC", "CONTRACT_CODE", "Seleccione usuario de apoyo");
		// ---------------------------------------------------



		
		// SUPPORT BOX ADD
		var supportBox = document.createElement("div");
		supportBox.id = "supportBox";
		supportBox.className = "blockBox";
		popFormFieldBox.appendChild(supportBox);
		addSupportBlock();
		

		// HIDE DINAMYC FIELDS
		jQuery("#EVENT_INSTITUTE_BOX").hide();
		
		
		// FILL HOOD
		searchListFiller("EVENT_INSTITUTE", institutes, "INSTITUTE_NAME", "INSTITUTE_CODE", "Seleccione institución");
		
		// FILL INSTYPE
		var options = ["Institucional", "Comunitario"];
		selectFiller("EVENT_INSTYPE", "Seleccione tipo", options);
		
		// FILL COOPTYPE
		var options = ["Lider comunitario", "Ciudadano", "Profesor", "Beneficiario del grupo", "Padre de familia"];
		selectFiller("EVENT_COOPTYPE", "Seleccione tipo", options);
		
		// FILL HOOD
		searchListFiller("EVENT_HOOD", theHoods, "HOOD_NAME", "HOOD_CODE", "Seleccione Barrio/Vereda");
		
		// ASSIST BOX ADD
		var assistBox = document.createElement("div");
		assistBox.id = "assistBox";
		assistBox.className = "blockBox";
		popFormFieldBox.appendChild(assistBox);
		addAssistBlock();
		
		// BUILD DEFAULT ASSIST ARRAY
		loadDefaultAssist();
		
		var EVENT_RESUME = fieldCreator([12,4,4,12], "Resumen atención dada", "textarea", "textarea", "EVENT_RESUME");
		
		popFormFieldBox.appendChild(EVENT_RESUME);
		
		// FILE BOX FORMAT
		var fileBox = document.createElement("div");
		fileBox.className = "blockBox col-xs-12 col-sm-4 col-md-6 col-lg-6";
		var loadFile = document.createElement("span");
		loadFile.id = "loadAssistFormatLink";
		loadFile.className = "loadFileLink";
		loadFile.innerHTML = "Cargar formato de conteo, jpg o pdf";
		loadFile.onclick = function ()
		{
			actualFileOrigin = "assist";
			document.getElementById("fileSelectorfile").click();
		}
		fileBox.appendChild(loadFile);
		popFormFieldBox.appendChild(fileBox);
		
		// FILE BOX PICTURE
		var fileBox = document.createElement("div");
		fileBox.className = "blockBox col-xs-12 col-sm-4 col-md-6 col-lg-6";
		var loadFile = document.createElement("span");
		loadFile.id = "loadEventPicLink";
		loadFile.className = "loadFileLink";
		loadFile.innerHTML = "Cargar foto del evento, jpg";
		loadFile.onclick = function ()
		{
			actualFileOrigin = "event";
			document.getElementById("fileSelectorfile").click();
		}
		fileBox.appendChild(loadFile);
		popFormFieldBox.appendChild(fileBox);
		
		// NEW BEHAVIOR BLOCK ----------------------------------
		// NEW BEHAVIOR BLOCK ----------------------------------
		// NEW BEHAVIOR BLOCK ----------------------------------
		
		// FILL SAVED PLACE
		var options = ["Si", "No"];
		selectFiller("EVENT_SERVPLACE", "Seleccione tipo", options);
		
		// HIDE SHOW INSTTYPE
		document.getElementById("EVENT_SERVPLACE").onchange = function ()
		{
			var pick = this.value;
			if(pick == "Si")
			{
				jQuery("#EVENT_INSTITUTE_BOX").show();
				document.getElementById("SEARCH_BUTTON_EVENT_HOOD").disabled = true;
				document.getElementById("EVENT_ADDRESS").disabled = true;
				document.getElementById("EVENT_COORDS").disabled = true;
			}
			else
			{
				jQuery("#EVENT_INSTITUTE_BOX").hide();
				
				searchListFiller("EVENT_HOOD", hoods, "HOOD_NAME", "HOOD_CODE", "Seleccione Barrio/Vereda");
				
				// document.getElementById("EVENT_ADDRESS").value = "";
				// document.getElementById("EVENT_COORDS").value = "";
				document.getElementById("SEARCH_BUTTON_EVENT_HOOD").disabled = false;
				document.getElementById("EVENT_ADDRESS").disabled = false;
				document.getElementById("EVENT_COORDS").disabled = false;
			}
		}
		
		// NEW BEHAVIOR BLOCK ----------------------------------
		// NEW BEHAVIOR BLOCK ----------------------------------
		// NEW BEHAVIOR BLOCK ----------------------------------
		
		
		
		
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear evento";
		saveButton.onclick = function (){saveEvent('0');}
		saveButton.style.display = "initial";

		PUM.open(1515);

	}
	
	if(type == "eventR")
	{
		// console.log("viewMode = "+viewMode);
		
		ownerPicked = "";
		
		// REQUEST FIELDS
		var EVENT_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "EVENT_ENTITY");
		var EVENT_REQUESTER = fieldCreator([12,4,4,6], "Id. solicitante", "input", "text", "EVENT_REQUESTER");
		var EVENT_ORIGIN = fieldCreator([12,4,4,6], "Procedencia de la solicitud", "select", "select", "EVENT_ORIGIN");
		var EVENT_RADICATE = fieldCreator([12,4,4,6], "Radicado", "input", "text", "EVENT_RADICATE");
		var EVENT_REQUEST_DATE = fieldCreator([12,4,4,6], "Fecha de la solicitud", "input", "text", "EVENT_REQUEST_DATE");
		var EVENT_REQUEST_TYPE = fieldCreator([12,4,4,6], "Tipo de solicitud", "select", "select", "EVENT_REQUEST_TYPE");
		var EVENT_INSTYPE = fieldCreator([12,4,4,6], "Tipo solicitante", "select", "select", "EVENT_INSTYPE");
		var EVENT_SERVPLACE = fieldCreator([12,4,4,6], "Lugar guardado", "select", "select", "EVENT_SERVPLACE");
		
		var EVENT_INSTITUTE = fieldCreator([12,4,4,6], "Institución", "dropdown", "dropdown", "EVENT_INSTITUTE");
		
		var EVENT_REQUEST_ACTIVITY = fieldCreator([12,4,4,6], "Actividad relacionada", "select", "select", "EVENT_REQUEST_ACTIVITY");
		var EVENT_NAME = fieldCreator([12,4,4,6], "Nombre o propósito del evento", "input", "text", "EVENT_NAME");
		var EVENT_EXPECTED = fieldCreator([12,4,4,6], "Número personas esperadas", "input", "number", "EVENT_EXPECTED");
		var EVENT_HOOD = fieldCreator([12,4,4,6], "Barrio o vereda", "dropdown", "dropdown", "EVENT_HOOD");
		var EVENT_PREVIR = fieldCreator([12,4,4,6], "Presencial/Virtual", "select", "select", "EVENT_PREVIR");
		var EVENT_ADDRESS = fieldCreator([12,4,4,6], "Dirección o nombre de lugar", "input", "text", "EVENT_ADDRESS");
		var EVENT_COORDS = fieldCreator([12,4,4,6], "Coordenadas", "input", "text", "EVENT_COORDS");
		var EVENT_DATE_INIR = fieldCreator([12,4,4,6], "Fecha/hora inicio solicitud", "input", "text", "EVENT_DATE_INIR");
		var EVENT_DATE_ENDR = fieldCreator([12,4,4,6], "Fecha/hora fin solicitud", "input","text", "EVENT_DATE_ENDR");
		var EVENT_DATE_INI = fieldCreator([12,4,4,6], "Fecha/hora inicio ejecución", "input", "text", "EVENT_DATE_INI");
		var EVENT_DATE_END = fieldCreator([12,4,4,6], "Fecha/hora fin ejecución", "input","text", "EVENT_DATE_END");
		var EVENT_DESCRIPTION = fieldCreator([12,4,4,12], "Descripción del evento", "textarea", "textarea", "EVENT_DESCRIPTION");
		// ASSIGN FIELDS
		var EVENT_COOPERATOR = fieldCreator([12,4,4,6], "Id. cooperador", "input", "text", "EVENT_COOPERATOR");
		var EVENT_COOPTYPE = fieldCreator([12,4,4,6], "Tipo de cooperador", "select", "select", "EVENT_COOPTYPE");

		
		popFormFieldBox.appendChild(EVENT_ENTITY);
		popFormFieldBox.appendChild(EVENT_REQUESTER);
		popFormFieldBox.appendChild(EVENT_ORIGIN);
		popFormFieldBox.appendChild(EVENT_RADICATE);
		popFormFieldBox.appendChild(EVENT_REQUEST_DATE);
		popFormFieldBox.appendChild(EVENT_REQUEST_TYPE);
		popFormFieldBox.appendChild(EVENT_REQUEST_ACTIVITY);
		popFormFieldBox.appendChild(EVENT_INSTYPE);
		popFormFieldBox.appendChild(EVENT_SERVPLACE);
		popFormFieldBox.appendChild(EVENT_PREVIR);
		popFormFieldBox.appendChild(EVENT_INSTITUTE);
		popFormFieldBox.appendChild(EVENT_HOOD);
		popFormFieldBox.appendChild(EVENT_ADDRESS);
		popFormFieldBox.appendChild(EVENT_COORDS);
		popFormFieldBox.appendChild(EVENT_NAME);
		popFormFieldBox.appendChild(EVENT_EXPECTED);
		popFormFieldBox.appendChild(EVENT_DATE_INIR);
		popFormFieldBox.appendChild(EVENT_DATE_ENDR);
		
		// NEW BEHAVIOR BLOCK ----------------------------------
		// NEW BEHAVIOR BLOCK ----------------------------------
		// NEW BEHAVIOR BLOCK ----------------------------------
		
		// FILL SAVED PLACE
		var options = ["Si", "No"];
		selectFiller("EVENT_SERVPLACE", "Seleccione tipo", options);
		
		// HIDE SHOW INSTTYPE
		document.getElementById("EVENT_SERVPLACE").onchange = function ()
		{
			var pick = this.value;
			if(pick == "Si")
			{
				jQuery("#EVENT_INSTITUTE_BOX").show();
				
				document.getElementById("SEARCH_BUTTON_EVENT_HOOD").disabled = true;
				document.getElementById("EVENT_ADDRESS").disabled = true;
				document.getElementById("EVENT_COORDS").disabled = true;
			}
			else
			{
				jQuery("#EVENT_INSTITUTE_BOX").hide();
				
				searchListFiller("EVENT_HOOD", hoods, "HOOD_NAME", "HOOD_CODE", "Seleccione Barrio/Vereda");
				
				// document.getElementById("EVENT_ADDRESS").value = "";
				// document.getElementById("EVENT_COORDS").value = "";
				document.getElementById("SEARCH_BUTTON_EVENT_HOOD").disabled = false;
				document.getElementById("EVENT_ADDRESS").disabled = false;
				document.getElementById("EVENT_COORDS").disabled = false;
			}
		}
		// NEW BEHAVIOR BLOCK ----------------------------------
		// NEW BEHAVIOR BLOCK ----------------------------------
		// NEW BEHAVIOR BLOCK ----------------------------------
		
		
		// NEEDS BOX ADD
		var programmedBox = document.createElement("div");
		programmedBox.id = "programmedBox";
		programmedBox.className = "blockBox";
		popFormFieldBox.appendChild(programmedBox);
		
		addProgramedBlock();
		
		jQuery("#EVENT_PROGRAMMED_TABLE_BOX").hide();
		
		popFormFieldBox.appendChild(EVENT_DATE_INI);
		popFormFieldBox.appendChild(EVENT_DATE_END);
		popFormFieldBox.appendChild(EVENT_DESCRIPTION);
		
		// NEEDS BOX ADD
		var needsBox = document.createElement("div");
		needsBox.id = "needsBox";
		needsBox.className = "blockBox";
		popFormFieldBox.appendChild(needsBox);
		
		addNeedsBlock();
		// BUILD DEFAULT ASSIST ARRAY
		loadDefaultNeeds();
		
		// FILE BOX REQUEST
		var fileBox = document.createElement("div");
		fileBox.className = "blockBox col-xs-12 col-sm-6 col-md-6 col-lg-12";
		var loadFile = document.createElement("span");
		loadFile.id = "loadRequestFileLink";
		loadFile.className = "loadFileLink";
		loadFile.innerHTML = "Archivo de soporte, jpg o pdf";
		loadFile.onclick = function ()
		{
			actualFileOrigin = "request";
			document.getElementById("fileSelectorfile").click();
		}
		fileBox.appendChild(loadFile);
		if(requestState == "0")
		{popFormFieldBox.appendChild(fileBox);}
		
		// Result = actualRequestFile <<<<<

		
		// -------------------FIELDS LOAD AND BEHJAVIORS------------------
		// -------------------FIELDS LOAD AND BEHJAVIORS------------------
		// -------------------FIELDS LOAD AND BEHJAVIORS------------------
		
		// FILL ENTITIES
		selectFiller("EVENT_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		document.getElementById("EVENT_ENTITY").value = userData.USER_ENTITY;
		if(userData.USER_CTYPE != "Superior")
		{document.getElementById("EVENT_ENTITY").disabled = true;}
		
		// SET DATE FIELDS
		setDateField("EVENT_REQUEST_DATE");
		setDateField("EVENT_DATE_INI", "time");
		setDateField("EVENT_DATE_END", "time");
		setDateField("EVENT_DATE_INIR", "time");
		setDateField("EVENT_DATE_ENDR", "time");
		
		// REQUESTER GET CITIZEN
		document.getElementById("EVENT_REQUESTER").lastvalue = "";
		document.getElementById("EVENT_REQUESTER").onblur = function ()
		{

			if(this.value == this.lastvalue || this.value == ""){return;}
			this.lastvalue = this.value;
			
			var info = {};
			info.CITIZEN_IDNUM = this.value.split("-")[0];
			if(info.CITIZEN_IDNUM == ""){return;}
			
			console.log("age check");
			
			loadManager(1, "popFormSaveButton");
			sendAjax("users","getCitizen",info,function(response)
			{
				loadManager(0, "popFormSaveButton");
				
				var ans = response.message;
				console.log(ans);
				
				if(ans == "toYoung")
				{
					fastPop("Este ciudadano no es mayor de edad, solo puede ingresar mayores de edad en este campo", 3000);
					document.getElementById("EVENT_REQUESTER").lastvalue = "";
					document.getElementById("EVENT_REQUESTER").value = "";
					return;
				}

				if(ans.length > 0)
				{
					invoquedCitizenData = ans[0];
					
					var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
					document.getElementById("EVENT_REQUESTER").lastvalue = newValue;
					document.getElementById("EVENT_REQUESTER").value = newValue;
				}
				else
				{
					
					document.getElementById("EVENT_REQUESTER").lastvalue = "";
					document.getElementById("EVENT_REQUESTER").value = "";
					
					setTimeout(function()
					{
						var params = [info.CITIZEN_IDNUM];
						confirmBox(language["confirm"], "El id no se encuentra registrado, ¿desea crear al solicitante ahora?",createCitizenPop, params);
						
					}, 500);

				}
			});
		}
		
		// FILL EVENT ORIGIN
		var options = ["Verbal presencial", "Verbal telefónica", "Documento físico", "De forma virtual"];
		selectFiller("EVENT_ORIGIN", "Seleccione tipo", options);
		
		// FILL EVENT REQUEST TYPE
		var options = ["Interna", "Externa"];
		selectFiller("EVENT_REQUEST_TYPE", "Seleccione tipo", options);
		
		// FILL INSTYPE
		var options = ["Institucional", "Comunitario"];
		selectFiller("EVENT_INSTYPE", "Seleccione tipo", options);
		document.getElementById("EVENT_INSTYPE").onchange = function ()
		{
			// var pick = this.value;
			// if(pick == "Institucional")
			// {jQuery("#EVENT_INSTITUTE_BOX").show();}
			// else
			// {jQuery("#EVENT_INSTITUTE_BOX").hide();}
		}
		
		// GET EVENT ABLE ACTIVITIES
		var evActivities = getEventActivities();
		// console.log(evActivities)
		selectFillerActiFull("EVENT_REQUEST_ACTIVITY", "Seleccione actividad", evActivities, "ACTIVITY_CODE", "ACTIVITY_NAME");
		
		// FILL HOOD IF COGESTOR FILTER HOODS
		var utype = userData.USER_CTYPE;
		if(utype == "Cogestor")
		{
			var theHoods = [];
			var userHoods = JSON.parse(getHoodsFromZones(userData.USER_ZONES));
			for(var i=0; i<hoods.length; i++)
			{
				var hoodCode = hoods[i].HOOD_CODE;
				if(userHoods.includes(hoodCode))
				{theHoods.push(hoods[i]);}
			}
		}
		else{var theHoods = hoods;}
		// FILL HOOD
		searchListFiller("EVENT_HOOD", theHoods, "HOOD_NAME", "HOOD_CODE", "Seleccione Barrio/Vereda");
		
		// FILL PREVIR
		var options = ["Presencial", "Virtual", "Presencial/Virtual"];
		selectFiller("EVENT_PREVIR", "Seleccione tipo", options);
		document.getElementById("EVENT_PREVIR").onchange = function ()
		{
			var pick = this.value;
			if(pick == "Presencial" || pick == "Presencial/Virtual")
			{
				jQuery("#EVENT_ADDRESS_BOX").show();
				jQuery("#EVENT_COORDS_BOX").show();
			}
			else
			{
				jQuery("#EVENT_ADDRESS_BOX").hide();
				jQuery("#EVENT_COORDS_BOX").hide();
			}
		}
		
		// COORDS CHECKER
		document.getElementById("EVENT_COORDS").onblur = function (){checkCoords(this);}
		
		// FILL HOOD
		searchListFiller("EVENT_INSTITUTE", institutes, "INSTITUTE_NAME", "INSTITUTE_CODE", "Seleccione institución");
		
		document.getElementById("EVENT_DATE_INIR").onblur = function ()
		{
			if(this.value == ""){return;}
			if(document.getElementById("EVENT_REQUEST_DATE").value == "")
			{fastPop("Debe diligenciar la fecha de solicitud", 3000); this.value = "";return;}
			
			var requested = document.getElementById("EVENT_REQUEST_DATE").value.split(" ")[0];
			var sugested = this.value.split(" ")[0];
			
			var time1Date= new Date(requested);
			var time2Date= new Date(sugested);
			if(time1Date >= time2Date )
			{fastPop("La fecha de inicio de solicitud del evento no puede ser anterior a la de solicitud.", 3000);this.value = "";return;}
			
			var diference = getdDiff(requested,sugested)-1;
			if(diference < 8)
			{fastPop(language["8days"], 5000);}
			
			
		}
		
		document.getElementById("EVENT_DATE_INI").onblur = function ()
		{
			if(this.value == ""){return;}
			if(document.getElementById("EVENT_REQUEST_DATE").value == "")
			{fastPop("Debe diligenciar la fecha de solicitud", 3000); this.value = "";return;}
			
			var requested = document.getElementById("EVENT_REQUEST_DATE").value.split(" ")[0];
			var sugested = this.value.split(" ")[0];
			
			var time1Date= new Date(requested);
			var time2Date= new Date(sugested);
			if(time1Date >= time2Date )
			{fastPop("La fecha de inicio de ejecución del evento no puede ser anterior a la de solicitud.", 3000);this.value = "";return;}
			
			var diference = getdDiff(requested,sugested)-1;
			if(diference < 8)
			{fastPop(language["8days"], 5000);}
		}
		

		// -------------GESTION FIELDS --------------
		// -------------GESTION FIELDS --------------
		// -------------GESTION FIELDS --------------
		
		var EVENT_OWNER = fieldCreator([12,6,6,12], "Contratista que coordina", "dropdown", "dropdown", "EVENT_OWNER");
		
		var EVENT_ACTIVITIES = fieldCreator([12,4,6,12], "Actividades director de evento", "multiselect", "select", "EVENT_ACTIVITIES");
		var EVENT_SUPPORT_PICKER = fieldCreator([12,4,6,12], "Seleccionar usuarios de apoyo", "dropdown", "dropdown", "EVENT_SUPPORT_PICKER");
		var EVENT_SUPPORT_ACTIVITIES = fieldCreator([12,4,6,6], "Actividades del usuario de apoyo", "multiselect", "select", "EVENT_SUPPORT_ACTIVITIES");
		
		var EVENT_SUPPORT_ADDER = buttonCreator([12,4,4,6], "Agregar apoyo", function()
		{
			if(actualContractData == "")
			{fastPop("Debe seleccionar un usuario de soporte.", 2000);return;}
			
			var support = {};
			support.SUPPORT_CONTRACT = actualContractData.CONTRACT_CODE;
			support.SUPPORT_CONTRACT_NUMBER = actualContractData.CONTRACT_NUMBER;
			support.SUPPORT_OWNER_NAME = actualContractData.CONTRACT_OWNER_NAME;
			support.SUPPORT_USERTYPE = actualContractData.CONTRACT_USERTYPE;
			support.SUPPORT_ACTIVITIES = JSON.parse(getMultiCheckValue("EVENT_SUPPORT_ACTIVITIES"));
			
			
			// CHECK IF ACTI PICKED
			if(support.SUPPORT_ACTIVITIES == 0)
			{
				fastPop("Debe seleccionar por lo menos una actividad de usuario de apoyo.", 2000);return;
			}
			
			// CHECK IF SUPPORT ADDED
			for(var i=0; i<actualSupportList.length; i++)
			{
				var item = actualSupportList[i];
				if(item.SUPPORT_CONTRACT == support.SUPPORT_CONTRACT)
				{fastPop("Este usuario ya se encuentra en la lista de apoyo", 2000);return;}
			}
			
			actualSupportList.push(support);
			console.log(actualSupportList);
			
			tableCreator("wp_events_support", actualSupportList);
			
			document.getElementById("EVENT_SUPPORT_PICKER").value = "";
			document.getElementById("EVENT_SUPPORT_ACTIVITIES").innerHTML = "";

		});
		var EVENT_RESUME = fieldCreator([12,4,4,12], "Resumen atención dada", "textarea", "textarea", "EVENT_RESUME");

		popFormFieldBox.appendChild(EVENT_OWNER);
		popFormFieldBox.appendChild(EVENT_ACTIVITIES);
		popFormFieldBox.appendChild(EVENT_SUPPORT_PICKER);
		popFormFieldBox.appendChild(EVENT_SUPPORT_ACTIVITIES);
		// ADD IF REQUEST NEW <<<<<<<<<<<<<<<HIDE>>>>>>>>>>>>>
		if(requestState != "0")
		{popFormFieldBox.appendChild(EVENT_SUPPORT_ADDER);}

		
		
		// FILL OWNER PICKER
		// ---------------------------------------------------
		// CREATE DESC FIELD
		for(var i=0; i<avaRequestContracts.length; i++)
		{
			var contract = avaRequestContracts[i];
			var desc = contract.CONTRACT_OWNER_NAME+" Contrato: "+contract.CONTRACT_NUMBER+" Tipo: "+contract.CONTRACT_USERTYPE;
			avaRequestContracts[i]["FULL_DESC"] = desc;
		}
		// INDEX BY NAME
		var indexed = sortByKey(avaRequestContracts, "FULL_DESC");
		searchListFiller("EVENT_OWNER", indexed, "FULL_DESC", "CONTRACT_CODE", "Seleccione director de evento");
		
		


		searchListFiller("EVENT_HOOD", theHoods, "HOOD_NAME", "HOOD_CODE", "Seleccione Barrio/Vereda");
				

		// SUPPORT BOX ADD
		actualSupportList = [];
		var supportBox = document.createElement("div");
		supportBox.id = "supportBox";
		supportBox.className = "blockBox";
		popFormFieldBox.appendChild(supportBox);
		popFormFieldBox.appendChild(EVENT_COOPERATOR);
		
		
		
		// FILL SUPPORT PICKER
		// ---------------------------------------------------
		// CREATE DESC FIELD
		for(var i=0; i<avaEventContracts.length; i++)
		{
			var contract = avaEventContracts[i];
			var desc = contract.CONTRACT_OWNER_NAME+" Contrato: "+contract.CONTRACT_NUMBER+" Tipo: "+contract.CONTRACT_USERTYPE;
			avaEventContracts[i]["FULL_DESC"] = desc;
		}
		// INDEX BY NAME
		var indexed = sortByKey(avaEventContracts, "FULL_DESC");
		searchListFiller("EVENT_SUPPORT_PICKER", indexed, "FULL_DESC", "CONTRACT_CODE", "Seleccione usuario de apoyo");
		
		
		// ---------------------------------------------------
		
		
		document.getElementById("EVENT_COOPERATOR").lastvalue = "";
		document.getElementById("EVENT_COOPERATOR").onblur = function ()
		{

			if(this.value == this.lastvalue || this.value == ""){return;}
			this.lastvalue = this.value;
			
			var info = {};
			info.CITIZEN_IDNUM = this.value.split("-")[0];
			if(info.CITIZEN_IDNUM == ""){return;}
			
			console.log("age check");
			
			loadManager(1, "popFormSaveButton");
			sendAjax("users","getCitizen",info,function(response)
			{
				loadManager(0, "popFormSaveButton");
				
				var ans = response.message;
				console.log(ans);
				
				if(ans == "toYoung")
				{
					fastPop("Este ciudadano no es mayor de edad, solo puede ingresar mayores de edad en este campo", 3000);
					document.getElementById("EVENT_COOPERATOR").lastvalue = "";
					document.getElementById("EVENT_COOPERATOR").value = "";
					return;
				}

				if(ans.length > 0)
				{
					invoquedCitizenData = ans[0];
					
					var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
					document.getElementById("EVENT_COOPERATOR").lastvalue = newValue;
					document.getElementById("EVENT_COOPERATOR").value = newValue;
				}
				else
				{
					
					document.getElementById("EVENT_COOPERATOR").lastvalue = "";
					document.getElementById("EVENT_COOPERATOR").value = "";
					
					setTimeout(function()
					{
						var params = [info.CITIZEN_IDNUM];
						confirmBox(language["confirm"], "El id no se encuentra registrado, ¿desea crear al cooperador ahora?",createCitizenPop, params);
						
					}, 500);

				}
			});
		}
		
		popFormFieldBox.appendChild(EVENT_COOPTYPE);
		// FILL COOPTYPE
		var options = ["Lider comunitario", "Ciudadano", "Profesor", "Beneficiario del grupo", "Padre de familia"];
		selectFiller("EVENT_COOPTYPE", "Seleccione tipo", options);
		
		// ASSIST BOX ADD
		var assistBox = document.createElement("div");
		assistBox.id = "assistBox";
		assistBox.className = "blockBox";
		popFormFieldBox.appendChild(assistBox);
		
		// ADD IF REQUEST NEW <<<<<<<<<<<<<<<HIDE>>>>>>>>>>>>>
		if(requestState != "0")
		{
			addSupportBlock();
			addAssistBlock();
			// BUILD DEFAULT ASSIST ARRAY
			loadDefaultAssist();
		}
		
		popFormFieldBox.appendChild(EVENT_RESUME);

		// FILE BOX FORMAT
		var fileBox = document.createElement("div");
		fileBox.className = "blockBox col-xs-12 col-sm-4 col-md-6 col-lg-6";
		var loadFile = document.createElement("span");
		loadFile.id = "loadAssistFormatLink";
		loadFile.className = "loadFileLink";
		loadFile.innerHTML = "Cargar formato de conteo, jpg o pdf";
		loadFile.onclick = function ()
		{
			actualFileOrigin = "assist";
			document.getElementById("fileSelectorfile").click();
		}
		fileBox.appendChild(loadFile);
		
		// ADD IF REQUEST NEW <<<<<<<<<<<<<<<HIDE>>>>>>>>>>>>>
		if(requestState != "0" && requestState != "1" && requestState != "2")
		{popFormFieldBox.appendChild(fileBox);}
		
		
		// FILE BOX PICTURE
		var fileBox = document.createElement("div");
		fileBox.className = "blockBox col-xs-12 col-sm-4 col-md-6 col-lg-6";
		var loadFile = document.createElement("span");
		loadFile.id = "loadEventPicLink";
		loadFile.className = "loadFileLink";
		loadFile.innerHTML = "Cargar foto del evento, jpg";
		loadFile.onclick = function ()
		{
			actualFileOrigin = "event";
			document.getElementById("fileSelectorfile").click();
		}
		fileBox.appendChild(loadFile);
		
		// ADD IF REQUEST NEW <<<<<<<<<<<<<<<HIDE>>>>>>>>>>>>>
		if(requestState != "0" && requestState != "1" && requestState != "2")
		{popFormFieldBox.appendChild(fileBox);}
		
		// HIDE DINAMYC FIELDS
		jQuery("#EVENT_ADDRESS_BOX").hide();
		jQuery("#EVENT_COORDS_BOX").hide();
		jQuery("#EVENT_INSTITUTE_BOX").hide();
		
		// HIDE SHOW FIELDS ACCORDING REQUEST STATE
		console.log(requestState)
		if(requestState == "0")
		{
			jQuery("#EVENT_OWNER_BOX").hide();
			jQuery("#EVENT_ACTIVITIES_BOX").hide();
			jQuery("#EVENT_SUPPORT_PICKER_BOX").hide();
			jQuery("#EVENT_SUPPORT_ACTIVITIES_BOX").hide();
			jQuery("#EVENT_SUPPORT_ADDER_BOX").hide();
			jQuery("#EVENT_DATE_INI_BOX").hide();
			jQuery("#EVENT_DATE_END_BOX").hide();
			jQuery("#EVENT_RESUME_BOX").hide();
			jQuery("#EVENT_COOPERATOR_BOX").hide();
			jQuery("#EVENT_COOPTYPE_BOX").hide();
		}
		
		if(requestState == "1" || requestState == "2")
		{
			jQuery("#EVENT_ASSIST_TABLE_BOX").hide();
			jQuery("#EVENT_RESUME_BOX").hide();
			jQuery("#EVENT_COOPERATOR_BOX").hide();
			jQuery("#EVENT_COOPTYPE_BOX").hide();
			
			// LOCK GESTION FIELDS
			document.getElementById("EVENT_REQUESTER").disabled = true;
			document.getElementById("EVENT_ORIGIN").disabled = true;
			document.getElementById("EVENT_RADICATE").disabled = true;
			document.getElementById("EVENT_REQUEST_DATE").disabled = true;
			document.getElementById("EVENT_REQUEST_TYPE").disabled = true;
			document.getElementById("EVENT_INSTYPE").disabled = true;
			document.getElementById("EVENT_PREVIR").disabled = true;
			
			document.getElementById("SEARCH_BUTTON_EVENT_INSTITUTE").disabled = true;
			
			document.getElementById("EVENT_REQUEST_ACTIVITY").disabled = true;
			document.getElementById("EVENT_NAME").disabled = true;
			document.getElementById("EVENT_EXPECTED").disabled = true;
			document.getElementById("EVENT_SERVPLACE").disabled = true;
			document.getElementById("EVENT_HOOD").disabled = true;
			document.getElementById("EVENT_DATE_INIR").disabled = true;
			document.getElementById("EVENT_DATE_ENDR").disabled = true;
			document.getElementById("EVENT_DESCRIPTION").disabled = true;
			
		}
		
		if(requestState == "4")
		{
			// LOCK GESTION FIELDS
			document.getElementById("EVENT_REQUESTER").disabled = true;
			document.getElementById("EVENT_ORIGIN").disabled = true;
			document.getElementById("EVENT_RADICATE").disabled = true;
			document.getElementById("EVENT_REQUEST_DATE").disabled = true;
			document.getElementById("EVENT_REQUEST_TYPE").disabled = true;
			document.getElementById("EVENT_SERVPLACE").disabled = true;
			document.getElementById("EVENT_HOOD").disabled = true;
			document.getElementById("EVENT_INSTYPE").disabled = true;
			document.getElementById("EVENT_PREVIR").disabled = true;
			
			
			document.getElementById("SEARCH_BUTTON_EVENT_INSTITUTE").disabled = true;
			
			document.getElementById("EVENT_REQUEST_ACTIVITY").disabled = true;
			document.getElementById("EVENT_NAME").disabled = true;
			document.getElementById("EVENT_EXPECTED").disabled = true;
			document.getElementById("EVENT_DATE_INIR").disabled = true;
			document.getElementById("EVENT_DATE_ENDR").disabled = true;
			document.getElementById("EVENT_DESCRIPTION").disabled = true;
			// LOCK CLOSURE FIELDS
			document.getElementById("EVENT_PREVIR").disabled = true;
			document.getElementById("EVENT_ADDRESS").disabled = true;
			document.getElementById("EVENT_COORDS").disabled = true;
			document.getElementById("EVENT_DATE_INI").disabled = true;
			document.getElementById("EVENT_DATE_END").disabled = true;
			document.getElementById("EVENT_OWNER").disabled = true;
		}
		
		if(viewMode == "1")
		{
			document.getElementById("EVENT_SUPPORT_PICKER").disabled = true;
			document.getElementById("EVENT_COOPERATOR").disabled = true;
			document.getElementById("EVENT_COOPTYPE").disabled = true;
			document.getElementById("EVENT_RESUME").disabled = true;
			saveButton.style.display = "none";
			formTitle.innerHTML = "Visualización de evento";
			
			PUM.open(1515);
			return;
		}
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear solicitud de evento";
		
		// SAVE NEW IF REQUEST = 0
		if(requestState == "0")
		{
			saveButton.innerHTML = "Guardar";
			saveButton.onclick = function (){saveEventR('0');}
		}
		saveButton.style.display = "initial";
		PUM.open(1515);
	}
	
	if(type == "eventTrasfer")
	{
		
		var EVENT_REQUEST_ACTIVITY = fieldCreator([12,6,6,12], "Actividad", "select", "select", "EVENT_REQUEST_ACTIVITY");
		popFormFieldBox.appendChild(EVENT_REQUEST_ACTIVITY);

		// GET EVENT ABLE ACTIVITIES
		var evActivities = getEventActivities();
		selectFillerActiFull("EVENT_REQUEST_ACTIVITY", "Seleccione actividad", evActivities, "ACTIVITY_CODE", "ACTIVITY_NAME");

		var actual = actualEditData.EVENT_REQUEST_ACTIVITY;
		
		document.getElementById("EVENT_REQUEST_ACTIVITY").value = actual;
		

		// DEFINE ACTION
		actualMT = "1";

		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Trasladar evento";
		saveButton.onclick = function (){saveTrasferEvent();}
		saveButton.style.display = "initial";
		saveButton.innerHTML = "Guardar";

		PUM.open(1515);
		
	}
	
	if(type == "eventReject")
	{
		
		var EVENT_REJECT_REASON = fieldCreator([12,6,6,12], "Causa de rechazo", "textarea", "textarea", "EVENT_REJECT_REASON");
		popFormFieldBox.appendChild(EVENT_REJECT_REASON);

		

		// DEFINE ACTION
		actualMT = "1";

		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Causa de rechazo";
		saveButton.onclick = function (){saveReject();}
		saveButton.style.display = "initial";
		saveButton.innerHTML = "Rechazar";

		PUM.open(1515);
		
	}
	
	if(type == "eventRejectReason")
	{
		
		var EVENT_REJECT_REASON = fieldCreator([12,6,6,12], "Causa de rechazo", "textarea", "textarea", "EVENT_REJECT_REASON");
		popFormFieldBox.appendChild(EVENT_REJECT_REASON);

		document.getElementById("EVENT_REJECT_REASON").value = actualEditData.EVENT_REJECT_REASON;
		
		document.getElementById("EVENT_REJECT_REASON").disabled = true;

		// DEFINE ACTION
		actualMT = "1";

		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Causa de rechazo";
		saveButton.onclick = function (){saveReject();}
		saveButton.style.display = "initial";
		saveButton.innerHTML = "Rechazar";
		
		saveButton.style.display = "none";

		PUM.open(1515);
		
	}
	
	if(type == "detailsPop")
	{
		var detailBox = document.createElement("div");
		detailBox.className = "blockBox col-xs-12 col-sm-6 col-md-6 col-lg-12";
		var detailSpan = document.createElement("span");
		detailSpan.innerHTML = actualDetails;
		detailSpan.className = "detailSpan";
		detailBox.appendChild(detailSpan);
		popFormFieldBox.appendChild(detailBox);

		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = actualDetailTitle;
		saveButton.onclick = function (){saveReject();}
		saveButton.style.display = "initial";
		saveButton.innerHTML = "Rechazar";
		saveButton.style.display = "none";

		PUM.open(1515);
		
	}
	
	if(type == "detailView")
	{
		
		actualViewArray = Object.keys(actualViewData);
		var preloadArray = filterView(actualViewArray);

		for(var i=0; i<preloadArray.length; i++)
		{
			var item = preloadArray[i];
			
			// FILE BOX REQUEST
			var fieldNameBox = document.createElement("div");
			fieldNameBox.className = "blockBox col-xs-12 col-sm-12 col-md-6 col-lg-6";
			var fieldName = document.createElement("span");
			fieldName.className = "fieldName";
			fieldName.innerHTML = fiendlyName(item);
			// fieldName.innerHTML = item+" "+fiendlyName(item);
			fieldNameBox.appendChild(fieldName);
			popFormFieldBox.appendChild(fieldNameBox);

			var fieldDetailBox = document.createElement("div");
			fieldDetailBox.className = "blockBox col-xs-12 col-sm-12 col-md-6 col-lg-6";
			var fieldDetail = document.createElement("span");
			fieldDetail.className = "fieldDetail";
			fieldDetail.innerHTML = getActualViewData(item);
			fieldDetailBox.appendChild(fieldDetail);
			popFormFieldBox.appendChild(fieldDetailBox);
			
			var hr = document.createElement("hr");
			hr.className = "hr";
			popFormFieldBox.appendChild(hr);
		
		}

		// DEFINE ACTION
		actualMT = "1";

		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Detalle de registro";
		saveButton.onclick = function (){return;}
		saveButton.style.display = "initial";
		saveButton.innerHTML = "Rechazar";
		
		saveButton.style.display = "none";

		PUM.open(1515);
		
	}
	
	if(type == "visitable")
	{

		var options = { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 };
		navigator.geolocation.getCurrentPosition(success, error, options);

		var data = actualEditData;
		var gData = actualEditData.GROUP_DATA;
		console.log(gData)
		
		// HEADER BUILD
		
		var classDateTime = data.CLASS_DATE+" "+data.GROUP_TIME_DAY+" "+data.GROUP_TIME_INI+" - "+data.GROUP_TIME_END;
		var thearray = JSON.stringify([gData.GROUP_HOOD]);
		var hood = getFriendDescs(thearray,"hoods");
		var zone = getZoneFromHood(gData.GROUP_HOOD);
		
		
		var thearray = JSON.stringify([gData.GROUP_ACTIVITY]);
		var activity = getFriendDescs(thearray,"activities");
		
		var thearray = JSON.stringify([gData.GROUP_INSTITUTE]);
		var institute = getFriendDescs(thearray,"institutes");
		
		
		actualVisitPlanFile = "";
		actualAssistPicFile = "";
		actualClassPicFile = "";
		
		dbc(popFormFieldBox, "Barrio o Vereda", hood, "hood");
		dbc(popFormFieldBox, "Comuna o Corregimiento", zone, "zone");
		
		dbc(popFormFieldBox, "Nombre de la Institución", institute, "-");
		
		dbc(popFormFieldBox, "Dirección o nombre del lugar", gData.GROUP_ADDRESS, "-");
		dbc(popFormFieldBox, "Fecha y hora de la clase", classDateTime, "-");
		dbc(popFormFieldBox, "Nombre del instructor", gData.CONTRACT_REQUESTER_NAME, "-");
		dbc(popFormFieldBox, "Número de identificación del instructor", gData.CONTRACT_REQUESTER_ID, "-");
		dbc(popFormFieldBox, "Teléfono del instructor", gData.CONTRACT_REQUESTER_PHONE, "-");
		dbc(popFormFieldBox, "Correo del instructor", gData.CONTRACT_REQUESTER_EMAIL, "-");
		dbc(popFormFieldBox, "Actividad de la clase", activity, "activity");
		dbc(popFormFieldBox, "Nombre cooperador", gData.COOPERATOR_NAME, "-");
		dbc(popFormFieldBox, "Teléfono del cooperador", gData.COOPERATOR_PHONE, "-");
		dbc(popFormFieldBox, "Correo del cooperador", gData.COOPERATOR_EMAIL, "-");
		dbc(popFormFieldBox, "Modalidad", gData.GROUP_PREVIR, "-");
		dbc(popFormFieldBox, "Coordenada de la clase", fixCoords(gData.GROUP_COORDS), "-");
		dbc(popFormFieldBox, "Coordenada de la visita", "<span id='geoLine'></span>", "-");

		// FORM BUILD
		var VISIT_DONE = fieldCreator([12,4,4,6], "Actividad Realizada", "select", "select", "VISIT_DONE");
		var VISIT_TYPE = fieldCreator([12,4,4,6], "Tipo de visita", "select", "select", "VISIT_TYPE");
		var VISIT_ASSISTQTY = fieldCreator([12,4,4,6], "Número de personas asistentes", "input", "number", "VISIT_ASSISTQTY");
		var VISIT_NOASSISTQTY = fieldCreator([12,4,4,6], "Número de personas ausentes", "input", "number", "VISIT_NOASSISTQTY");
		var VISIT_STONTIME = fieldCreator([12,4,4,6], "Inició a tiempo", "select", "select", "VISIT_STONTIME");
		var VISIT_TOOLS = fieldCreator([12,4,4,6], "Las herramientas o materiales son adecuados para la actividad", "select", "select", "VISIT_TOOLS");
		var VISIT_GOODTIME = fieldCreator([12,4,4,6], "El horario es adecuado", "select", "select", "VISIT_GOODTIME");
		var VISIT_GOODPLACE = fieldCreator([12,4,4,6], "El sitio es adecuado para la actividad", "select", "select", "VISIT_GOODPLACE");
		var VISIT_FORMAT = fieldCreator([12,4,4,12], "La sesión desarrollada se encuentra descrita en un formato de plan clase", "select", "select", "VISIT_FORMAT");
		var VISIT_PDELIVER = fieldCreator([12,4,4,12], "Entrega oportunamente el plan clase", "select", "select", "VISIT_PDELIVER");
		var VISIT_COHERENT = fieldCreator([12,4,4,12], "Existe coherencia entre el plan clase y el plan técnico pedagógico", "select", "select", "VISIT_COHERENT");
		var VISIT_EASY = fieldCreator([12,4,4,12], "El orden y progresión de los ejercicios y/o tareas de la clase facilitan el cumplimiento de los objetivos de la sesión", "select", "select", "VISIT_EASY");
		var VISIT_ORIENT = fieldCreator([12,4,4,12], "El instructor orienta y da indicaciones precisas para el desarrollo de la clase", "select", "select", "VISIT_ORIENT");
		var VISIT_EXPRESSION = fieldCreator([12,4,4,12], "Considera que expresión verbal y corporal del instructor son adecuadas", "select", "select", "VISIT_EXPRESSION");
		var VISIT_PRESENT = fieldCreator([12,4,4,12], "Considera que la presentación personal del instructor es adecuada", "select", "select", "VISIT_PRESENT");
		var VISIT_VERIFIED = fieldCreator([12,4,4,12], "El instructor verifica la asistencia en la clase", "select", "select", "VISIT_VERIFIED");
		var VISIT_ACOMPLISH = fieldCreator([12,4,4,12], "Califique desde su percepción el nivel de cumplimiento de los objetivos de la clase", "select", "select", "VISIT_ACOMPLISH");
		var VISIT_CONTRATIST_SIGN = fieldCreator([12,4,4,12], "Firma del contratista visitado (su contraseña de acceso al aplicativo)", "input", "password", "VISIT_CONTRATIST_SIGN");
		var VISIT_COMMENTS = fieldCreator([12,4,4,12], "Observaciones", "textarea", "textarea", "VISIT_COMMENTS");
		
		
		popFormFieldBox.appendChild(VISIT_DONE);
		popFormFieldBox.appendChild(VISIT_TYPE);
		popFormFieldBox.appendChild(VISIT_ASSISTQTY);
		popFormFieldBox.appendChild(VISIT_NOASSISTQTY);
		popFormFieldBox.appendChild(VISIT_STONTIME);
		popFormFieldBox.appendChild(VISIT_TOOLS);
		popFormFieldBox.appendChild(VISIT_GOODTIME);
		popFormFieldBox.appendChild(VISIT_GOODPLACE);
		popFormFieldBox.appendChild(VISIT_FORMAT);
		popFormFieldBox.appendChild(VISIT_PDELIVER);
		popFormFieldBox.appendChild(VISIT_COHERENT);
		popFormFieldBox.appendChild(VISIT_EASY);
		popFormFieldBox.appendChild(VISIT_ORIENT);
		popFormFieldBox.appendChild(VISIT_EXPRESSION);
		popFormFieldBox.appendChild(VISIT_PRESENT);
		popFormFieldBox.appendChild(VISIT_VERIFIED);
		popFormFieldBox.appendChild(VISIT_ACOMPLISH);
		popFormFieldBox.appendChild(VISIT_CONTRATIST_SIGN);
		popFormFieldBox.appendChild(VISIT_COMMENTS);
		
		// CHECK IF SIGN IS CORRECT
		document.getElementById("VISIT_CONTRATIST_SIGN").onblur = function ()
		{
			var sign = this.value;
			if(sign == ""){return;}
			
			var info = {};
			info.USER_EMAIL = actualEditData.GROUP_DATA.CONTRACT_REQUESTER_EMAIL;
			info.USER_PASS = sign;
			info.USER_ENTITY = userData.USER_ENTITY;
		
			sendAjax("users","checkUserPass",info,function(response)
			{
				var ans = response.message;
				if(ans == "Si")
				{fastPop("La contraseña corresponde al usuario, se ha firmado correctamente", 3000);}
				else
				{fastPop("La contraseña NO corresponde al usuario", 3000);}
				actualSignCheck = ans;
			});
		}
		
		
		// FILE BOX CLASS PLAN
		// var fileBox = document.createElement("div");
		// fileBox.id = "planClassLink_BOX"
		// fileBox.className = "blockBox col-xs-12 col-sm-12 col-md-12 col-lg-12";
		// var loadFile = document.createElement("span");
		// loadFile.id = "planClassLink";
		// loadFile.className = "loadFileLink";
		// loadFile.innerHTML = "Cargar plan de clase";
		// loadFile.onclick = function ()
		// {
			// actualFileOrigin = "planClass";
			// document.getElementById("fileSelectorfile").click();
		// }
		// fileBox.appendChild(loadFile);
		// popFormFieldBox.appendChild(fileBox);
		
		
		// FILE BOX CLASS ASSIST
		var fileBox = document.createElement("div");
		fileBox.id = "assistListLink_BOX"
		fileBox.className = "blockBox col-xs-12 col-sm-12 col-md-12 col-lg-12";
		var loadFile = document.createElement("span");
		loadFile.id = "assistListLink";
		loadFile.className = "loadFileLink";
		loadFile.innerHTML = "Foto listado asistencia";
		loadFile.onclick = function ()
		{
			actualFileOrigin = "assistPic";
			document.getElementById("fileSelectorfile").click();
		}
		fileBox.appendChild(loadFile);
		popFormFieldBox.appendChild(fileBox);
		
		
		// FILE BOX CLASS PIC
		var fileBox = document.createElement("div");
		fileBox.id = "classPicLink_BOX"
		fileBox.className = "blockBox col-xs-12 col-sm-12 col-md-12 col-lg-12";
		var loadFile = document.createElement("span");
		loadFile.id = "classPicLink";
		loadFile.className = "loadFileLink";
		loadFile.innerHTML = "Foto actividad";
		loadFile.onclick = function ()
		{
			actualFileOrigin = "classPic";
			document.getElementById("fileSelectorfile").click();
		}
		fileBox.appendChild(loadFile);
		popFormFieldBox.appendChild(fileBox);
		
		// FILL SELECT
		var options = ["Técnica", "Verificación"];
		selectFiller("VISIT_TYPE", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No porque no llegó el visitado", "No por otra causa"];
		selectFiller("VISIT_DONE", "Seleccione", options);
		
		// FILL SELECT
		var options = ["No aplica","Si", "No", "No sabe / No responde"];
		selectFiller("VISIT_STONTIME", "Seleccione", options);
		
		// FILL SELECT
		var options = ["No aplica","Si son adecuados", "No son adecuados", "Herramientas o materiales insuficientes", "Herramientas o materiales en mal estado"];
		selectFiller("VISIT_TOOLS", "Seleccione", options);

		// FILL SELECT
		var options = ["No aplica","Si", "No", "A veces"];
		selectFiller("VISIT_GOODTIME", "Seleccione", options);
		
		// FILL SELECT
		var options = ["No aplica","Si", "No", "Presenta dificultades"];
		selectFiller("VISIT_GOODPLACE", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_FORMAT", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_PDELIVER", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_COHERENT", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_EASY", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_ORIENT", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_EXPRESSION", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_PRESENT", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_VERIFIED", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Muy bajo", "Bajo", "Medio", "Alto", "Muy alto"];
		selectFiller("VISIT_ACOMPLISH", "Seleccione", options);
		
		// HIDE DINAMYC FIELDS
		// jQuery("#VISIT_ASSISTQTY_BOX").hide();
		// jQuery("#VISIT_NOASSISTQTY_BOX").hide();
		jQuery("#VISIT_STONTIME_BOX").hide();
		jQuery("#VISIT_TOOLS_BOX").hide();
		jQuery("#VISIT_GOODTIME_BOX").hide();
		jQuery("#VISIT_GOODPLACE_BOX").hide();
		jQuery("#VISIT_FORMAT_BOX").hide();
		jQuery("#VISIT_PDELIVER_BOX").hide();
		jQuery("#VISIT_COHERENT_BOX").hide();
		jQuery("#VISIT_EASY_BOX").hide();
		jQuery("#VISIT_ORIENT_BOX").hide();
		jQuery("#VISIT_EXPRESSION_BOX").hide();
		jQuery("#VISIT_PRESENT_BOX").hide();
		jQuery("#VISIT_VERIFIED_BOX").hide();
		jQuery("#VISIT_ACOMPLISH_BOX").hide();
		jQuery("#VISIT_CONTRATIST_SIGN_BOX").hide();
		// jQuery("#VISIT_COMMENTS_BOX").hide();
		// jQuery("#planClassLink_BOX").hide();
		jQuery("#assistListLink_BOX").hide();
		jQuery("#classPicLink_BOX").hide();
		
		// HIDE SHOW DONE
		document.getElementById("VISIT_DONE").onchange = function ()
		{
			var pick = this.value;
			console.log(pick)
			console.log(gData.GROUP_PREVIR)
			if(pick == "Si")
			{
				jQuery("#VISIT_ASSISTQTY_BOX").show();
				jQuery("#VISIT_NOASSISTQTY_BOX").show();
				jQuery("#VISIT_STONTIME_BOX").show();
				jQuery("#VISIT_TOOLS_BOX").show();
				jQuery("#classPicLink_BOX").show();
				
				
				if(gData.GROUP_PREVIR == "Presencial" || gData.GROUP_PREVIR == "Presencial/Virtual")
				{
					jQuery("#VISIT_CONTRATIST_SIGN_BOX").show();
					jQuery("#assistListLink_BOX").show();
				}

				
				
			}
			else if(pick == "No por otra causa")
			{
				
				jQuery("#VISIT_STONTIME_BOX").hide();
				jQuery("#VISIT_TOOLS_BOX").hide();
				jQuery("#VISIT_GOODTIME_BOX").hide();
				jQuery("#VISIT_GOODPLACE_BOX").hide();
				jQuery("#VISIT_FORMAT_BOX").hide();
				jQuery("#VISIT_PDELIVER_BOX").hide();
				jQuery("#VISIT_COHERENT_BOX").hide();
				jQuery("#VISIT_EASY_BOX").hide();
				jQuery("#VISIT_ORIENT_BOX").hide();
				jQuery("#VISIT_EXPRESSION_BOX").hide();
				jQuery("#VISIT_PRESENT_BOX").hide();
				jQuery("#VISIT_VERIFIED_BOX").hide();
				jQuery("#VISIT_ACOMPLISH_BOX").hide();
				if(gData.GROUP_PREVIR == "Presencial" || gData.GROUP_PREVIR == "Presencial/Virtual")
				{
					jQuery("#VISIT_CONTRATIST_SIGN_BOX").show();
				}
				// jQuery("#planClassLink_BOX").hide();
				jQuery("#assistListLink_BOX").show();
				jQuery("#classPicLink_BOX").hide();
			}
			else
			{
				jQuery("#VISIT_STONTIME_BOX").hide();
				jQuery("#VISIT_TOOLS_BOX").hide();
				jQuery("#VISIT_GOODTIME_BOX").hide();
				jQuery("#VISIT_GOODPLACE_BOX").hide();
				jQuery("#VISIT_FORMAT_BOX").hide();
				jQuery("#VISIT_PDELIVER_BOX").hide();
				jQuery("#VISIT_COHERENT_BOX").hide();
				jQuery("#VISIT_EASY_BOX").hide();
				jQuery("#VISIT_ORIENT_BOX").hide();
				jQuery("#VISIT_EXPRESSION_BOX").hide();
				jQuery("#VISIT_PRESENT_BOX").hide();
				jQuery("#VISIT_VERIFIED_BOX").hide();
				jQuery("#VISIT_ACOMPLISH_BOX").hide();
				jQuery("#VISIT_CONTRATIST_SIGN_BOX").hide();
				// jQuery("#planClassLink_BOX").hide();
				jQuery("#assistListLink_BOX").hide();
				jQuery("#classPicLink_BOX").hide();
			}
			
			document.getElementById("VISIT_TYPE").onchange();
		}
		
		
		// HIDE SHOW DONE
		document.getElementById("VISIT_TYPE").onchange = function ()
		{
			var pick = this.value;
			var donePick = document.getElementById("VISIT_DONE").value;
			if(pick == "Verificación" && donePick == "Si")
			{
				jQuery("#VISIT_GOODTIME_BOX").show();
				jQuery("#VISIT_GOODPLACE_BOX").show();
				jQuery("#VISIT_FORMAT_BOX").hide();
				jQuery("#VISIT_PDELIVER_BOX").hide();
				jQuery("#VISIT_COHERENT_BOX").hide();
				jQuery("#VISIT_EASY_BOX").hide();
				jQuery("#VISIT_ORIENT_BOX").hide();
				jQuery("#VISIT_EXPRESSION_BOX").hide();
				jQuery("#VISIT_PRESENT_BOX").hide();
				jQuery("#VISIT_VERIFIED_BOX").hide();
				jQuery("#VISIT_ACOMPLISH_BOX").hide();
				// jQuery("#planClassLink_BOX").hide();
			}
			else if(pick == "Técnica" && donePick == "Si")
			{
				jQuery("#VISIT_GOODTIME_BOX").hide();
				jQuery("#VISIT_GOODPLACE_BOX").hide();
				jQuery("#VISIT_FORMAT_BOX").show();
				jQuery("#VISIT_PDELIVER_BOX").show();
				jQuery("#VISIT_COHERENT_BOX").show();
				jQuery("#VISIT_EASY_BOX").show();
				jQuery("#VISIT_ORIENT_BOX").show();
				jQuery("#VISIT_EXPRESSION_BOX").show();
				jQuery("#VISIT_PRESENT_BOX").show();
				jQuery("#VISIT_VERIFIED_BOX").show();
				jQuery("#VISIT_ACOMPLISH_BOX").show();
				if(gData.GROUP_PREVIR == "Presencial" || gData.GROUP_PREVIR == "Presencial/Virtual")
				{
					jQuery("#VISIT_CONTRATIST_SIGN_BOX").show();
				}
				// jQuery("#planClassLink_BOX").show();
				
			}
			else
			{
				jQuery("#VISIT_GOODTIME_BOX").hide();
				jQuery("#VISIT_GOODPLACE_BOX").hide();
				jQuery("#VISIT_FORMAT_BOX").hide();
				jQuery("#VISIT_PDELIVER_BOX").hide();
				jQuery("#VISIT_COHERENT_BOX").hide();
				jQuery("#VISIT_EASY_BOX").hide();
				jQuery("#VISIT_ORIENT_BOX").hide();
				jQuery("#VISIT_EXPRESSION_BOX").hide();
				jQuery("#VISIT_PRESENT_BOX").hide();
				jQuery("#VISIT_VERIFIED_BOX").hide();
				jQuery("#VISIT_ACOMPLISH_BOX").hide();
				// jQuery("#planClassLink_BOX").hide();
			}
		}

		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Registrar visita";
		saveButton.onclick = function (){saveVisit('0');}
		saveButton.style.display = "initial";
		saveButton.innerHTML = "Guardar";

		PUM.open(1515);
		
		
	}
	
	if(type == "visit")
	{
		
		var data = actualEditData;
		console.log(actualEditData)

		// FORM BUILD
		var VISIT_DONE = fieldCreator([12,4,4,6], "Actividad Realizada", "select", "select", "VISIT_DONE");
		var VISIT_TYPE = fieldCreator([12,4,4,6], "Tipo de visita", "select", "select", "VISIT_TYPE");
		var VISIT_ASSISTQTY = fieldCreator([12,4,4,6], "Número de personas asistentes", "input", "number", "VISIT_ASSISTQTY");
		var VISIT_NOASSISTQTY = fieldCreator([12,4,4,6], "Número de personas ausentes", "input", "number", "VISIT_NOASSISTQTY");
		var VISIT_STONTIME = fieldCreator([12,4,4,6], "Inició a tiempo", "select", "select", "VISIT_STONTIME");
		var VISIT_TOOLS = fieldCreator([12,4,4,6], "Las herramientas o materiales son adecuados para la actividad", "select", "select", "VISIT_TOOLS");
		var VISIT_GOODTIME = fieldCreator([12,4,4,6], "El horario es adecuado", "select", "select", "VISIT_GOODTIME");
		var VISIT_GOODPLACE = fieldCreator([12,4,4,6], "El sitio es adecuado para la actividad", "select", "select", "VISIT_GOODPLACE");
		var VISIT_FORMAT = fieldCreator([12,4,4,12], "La sesión desarrollada se encuentra descrita en un formato de plan clase", "select", "select", "VISIT_FORMAT");
		var VISIT_PDELIVER = fieldCreator([12,4,4,12], "Entrega oportunamente el plan clase", "select", "select", "VISIT_PDELIVER");
		var VISIT_COHERENT = fieldCreator([12,4,4,12], "Existe coherencia entre el plan clase y el plan técnico pedagógico", "select", "select", "VISIT_COHERENT");
		var VISIT_EASY = fieldCreator([12,4,4,12], "El orden y progresión de los ejercicios y/o tareas de la clase facilitan el cumplimiento de los objetivos de la sesión", "select", "select", "VISIT_EASY");
		var VISIT_ORIENT = fieldCreator([12,4,4,12], "El instructor orienta y da indicaciones precisas para el desarrollo de la clase", "select", "select", "VISIT_ORIENT");
		var VISIT_EXPRESSION = fieldCreator([12,4,4,12], "Considera que expresión verbal y corporal del instructor son adecuadas", "select", "select", "VISIT_EXPRESSION");
		var VISIT_PRESENT = fieldCreator([12,4,4,12], "Considera que la presentación personal del instructor es adecuada", "select", "select", "VISIT_PRESENT");
		var VISIT_VERIFIED = fieldCreator([12,4,4,12], "El instructor verifica la asistencia en la clase", "select", "select", "VISIT_VERIFIED");
		var VISIT_ACOMPLISH = fieldCreator([12,4,4,12], "Califique desde su percepción el nivel de cumplimiento de los objetivos de la clase", "select", "select", "VISIT_ACOMPLISH");
		var VISIT_CONTRATIST_SIGN = fieldCreator([12,4,4,12], "Firma del contratista visitado (su contraseña de acceso al aplicativo)", "input", "password", "VISIT_CONTRATIST_SIGN");
		var VISIT_COMMENTS = fieldCreator([12,4,4,12], "Observaciones", "textarea", "textarea", "VISIT_COMMENTS");
		
		
		popFormFieldBox.appendChild(VISIT_DONE);
		popFormFieldBox.appendChild(VISIT_TYPE);
		popFormFieldBox.appendChild(VISIT_ASSISTQTY);
		popFormFieldBox.appendChild(VISIT_NOASSISTQTY);
		popFormFieldBox.appendChild(VISIT_STONTIME);
		popFormFieldBox.appendChild(VISIT_TOOLS);
		popFormFieldBox.appendChild(VISIT_GOODTIME);
		popFormFieldBox.appendChild(VISIT_GOODPLACE);
		popFormFieldBox.appendChild(VISIT_FORMAT);
		popFormFieldBox.appendChild(VISIT_PDELIVER);
		popFormFieldBox.appendChild(VISIT_COHERENT);
		popFormFieldBox.appendChild(VISIT_EASY);
		popFormFieldBox.appendChild(VISIT_ORIENT);
		popFormFieldBox.appendChild(VISIT_EXPRESSION);
		popFormFieldBox.appendChild(VISIT_PRESENT);
		popFormFieldBox.appendChild(VISIT_VERIFIED);
		popFormFieldBox.appendChild(VISIT_ACOMPLISH);
		popFormFieldBox.appendChild(VISIT_CONTRATIST_SIGN);
		popFormFieldBox.appendChild(VISIT_COMMENTS);
		
		
		// FILE BOX CLASS PLAN
		// var fileBox = document.createElement("div");
		// fileBox.id = "planClassLink_BOX"
		// fileBox.className = "blockBox col-xs-12 col-sm-12 col-md-12 col-lg-12";
		// var loadFile = document.createElement("span");
		// loadFile.id = "planClassLink";
		// loadFile.className = "loadFileLink";
		// loadFile.innerHTML = "Cargar plan de clase";
		// loadFile.onclick = function ()
		// {
			// actualFileOrigin = "planClass";
			// document.getElementById("fileSelectorfile").click();
		// }
		// fileBox.appendChild(loadFile);
		// popFormFieldBox.appendChild(fileBox);
		
		
		// FILE BOX CLASS ASSIST
		var fileBox = document.createElement("div");
		fileBox.id = "assistListLink_BOX"
		fileBox.className = "blockBox col-xs-12 col-sm-12 col-md-12 col-lg-12";
		var loadFile = document.createElement("span");
		loadFile.id = "assistListLink";
		loadFile.className = "loadFileLink";
		loadFile.innerHTML = "Foto listado asistencia";
		loadFile.onclick = function ()
		{
			actualFileOrigin = "assistPic";
			document.getElementById("fileSelectorfile").click();
		}
		fileBox.appendChild(loadFile);
		popFormFieldBox.appendChild(fileBox);
		
		
		// FILE BOX CLASS PIC
		var fileBox = document.createElement("div");
		fileBox.id = "classPicLink_BOX"
		fileBox.className = "blockBox col-xs-12 col-sm-12 col-md-12 col-lg-12";
		var loadFile = document.createElement("span");
		loadFile.id = "classPicLink";
		loadFile.className = "loadFileLink";
		loadFile.innerHTML = "Foto actividad";
		loadFile.onclick = function ()
		{
			actualFileOrigin = "classPic";
			document.getElementById("fileSelectorfile").click();
		}
		fileBox.appendChild(loadFile);
		popFormFieldBox.appendChild(fileBox);
		
		// FILL SELECT
		var options = ["Técnica", "Verificación"];
		selectFiller("VISIT_TYPE", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No porque no llegó el visitado", "No por otra causa"];
		selectFiller("VISIT_DONE", "Seleccione", options);
		
		// FILL SELECT
		var options = ["No aplica","Si", "No", "No sabe / No responde"];
		selectFiller("VISIT_STONTIME", "Seleccione", options);
		
		// FILL SELECT
		var options = ["No aplica","Si son adecuados", "No son adecuados", "Herramientas o materiales insuficientes", "Herramientas o materiales en mal estado"];
		selectFiller("VISIT_TOOLS", "Seleccione", options);

		// FILL SELECT
		var options = ["No aplica","Si", "No", "A veces"];
		selectFiller("VISIT_GOODTIME", "Seleccione", options);
		
		// FILL SELECT
		var options = ["No aplica","Si", "No", "Presenta dificultades"];
		selectFiller("VISIT_GOODPLACE", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_FORMAT", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_PDELIVER", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_COHERENT", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_EASY", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_ORIENT", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_EXPRESSION", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_PRESENT", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Si", "No"];
		selectFiller("VISIT_VERIFIED", "Seleccione", options);
		
		// FILL SELECT
		var options = ["Muy bajo", "Bajo", "Medio", "Alto", "Muy alto"];
		selectFiller("VISIT_ACOMPLISH", "Seleccione", options);
		
		// HIDE DINAMYC FIELDS
		// jQuery("#VISIT_ASSISTQTY_BOX").hide();
		// jQuery("#VISIT_NOASSISTQTY_BOX").hide();
		jQuery("#VISIT_STONTIME_BOX").hide();
		jQuery("#VISIT_TOOLS_BOX").hide();
		jQuery("#VISIT_GOODTIME_BOX").hide();
		jQuery("#VISIT_GOODPLACE_BOX").hide();
		jQuery("#VISIT_FORMAT_BOX").hide();
		jQuery("#VISIT_PDELIVER_BOX").hide();
		jQuery("#VISIT_COHERENT_BOX").hide();
		jQuery("#VISIT_EASY_BOX").hide();
		jQuery("#VISIT_ORIENT_BOX").hide();
		jQuery("#VISIT_EXPRESSION_BOX").hide();
		jQuery("#VISIT_PRESENT_BOX").hide();
		jQuery("#VISIT_VERIFIED_BOX").hide();
		jQuery("#VISIT_ACOMPLISH_BOX").hide();
		jQuery("#VISIT_CONTRATIST_SIGN_BOX").hide();
		// jQuery("#VISIT_COMMENTS_BOX").hide();
		// jQuery("#planClassLink_BOX").hide();
		jQuery("#assistListLink_BOX").hide();
		jQuery("#classPicLink_BOX").hide();
		
		// HIDE SHOW DONE
		document.getElementById("VISIT_DONE").onchange = function ()
		{
			var pick = this.value;
			console.log(pick)
			if(pick == "Si")
			{
				jQuery("#VISIT_ASSISTQTY_BOX").show();
				jQuery("#VISIT_NOASSISTQTY_BOX").show();
				jQuery("#VISIT_STONTIME_BOX").show();
				jQuery("#VISIT_TOOLS_BOX").show();
				jQuery("#classPicLink_BOX").show();

				if(actualEditData.VISIT_MODE == "Presencial" || actualEditData.VISIT_MODE == "Presencial/Virtual")
				{
					jQuery("#VISIT_CONTRATIST_SIGN_BOX").show();
					jQuery("#assistListLink_BOX").show();
				}
				else
				{
					jQuery("#VISIT_CONTRATIST_SIGN_BOX").hide();
				}
			}
			else if(pick == "No por otra causa")
			{
				
				jQuery("#VISIT_STONTIME_BOX").hide();
				jQuery("#VISIT_TOOLS_BOX").hide();
				jQuery("#VISIT_GOODTIME_BOX").hide();
				jQuery("#VISIT_GOODPLACE_BOX").hide();
				jQuery("#VISIT_FORMAT_BOX").hide();
				jQuery("#VISIT_PDELIVER_BOX").hide();
				jQuery("#VISIT_COHERENT_BOX").hide();
				jQuery("#VISIT_EASY_BOX").hide();
				jQuery("#VISIT_ORIENT_BOX").hide();
				jQuery("#VISIT_EXPRESSION_BOX").hide();
				jQuery("#VISIT_PRESENT_BOX").hide();
				jQuery("#VISIT_VERIFIED_BOX").hide();
				jQuery("#VISIT_ACOMPLISH_BOX").hide();
				
				
				if(actualEditData.VISIT_MODE == "Presencial" || actualEditData.VISIT_MODE == "Presencial/Virtual")
				{
					jQuery("#VISIT_CONTRATIST_SIGN_BOX").show();
				}
				else
				{
					jQuery("#VISIT_CONTRATIST_SIGN_BOX").hide();
				}
				
				// jQuery("#planClassLink_BOX").hide();
				jQuery("#assistListLink_BOX").show();
				jQuery("#classPicLink_BOX").hide();
			}
			else
			{
				jQuery("#VISIT_STONTIME_BOX").hide();
				jQuery("#VISIT_TOOLS_BOX").hide();
				jQuery("#VISIT_GOODTIME_BOX").hide();
				jQuery("#VISIT_GOODPLACE_BOX").hide();
				jQuery("#VISIT_FORMAT_BOX").hide();
				jQuery("#VISIT_PDELIVER_BOX").hide();
				jQuery("#VISIT_COHERENT_BOX").hide();
				jQuery("#VISIT_EASY_BOX").hide();
				jQuery("#VISIT_ORIENT_BOX").hide();
				jQuery("#VISIT_EXPRESSION_BOX").hide();
				jQuery("#VISIT_PRESENT_BOX").hide();
				jQuery("#VISIT_VERIFIED_BOX").hide();
				jQuery("#VISIT_ACOMPLISH_BOX").hide();
				jQuery("#VISIT_CONTRATIST_SIGN_BOX").hide();
				// jQuery("#planClassLink_BOX").hide();
				jQuery("#assistListLink_BOX").hide();
				jQuery("#classPicLink_BOX").hide();
			}
			
			document.getElementById("VISIT_TYPE").onchange();
		}
		
		
		// HIDE SHOW DONE
		document.getElementById("VISIT_TYPE").onchange = function ()
		{
			var pick = this.value;
			console.log(actualEditData.VISIT_MODE)
			var donePick = document.getElementById("VISIT_DONE").value;
			if(pick == "Verificación" && donePick == "Si")
			{
				jQuery("#VISIT_GOODTIME_BOX").show();
				jQuery("#VISIT_GOODPLACE_BOX").show();
				jQuery("#VISIT_FORMAT_BOX").hide();
				jQuery("#VISIT_PDELIVER_BOX").hide();
				jQuery("#VISIT_COHERENT_BOX").hide();
				jQuery("#VISIT_EASY_BOX").hide();
				jQuery("#VISIT_ORIENT_BOX").hide();
				jQuery("#VISIT_EXPRESSION_BOX").hide();
				jQuery("#VISIT_PRESENT_BOX").hide();
				jQuery("#VISIT_VERIFIED_BOX").hide();
				jQuery("#VISIT_ACOMPLISH_BOX").hide();
				// jQuery("#planClassLink_BOX").hide();
			}
			else if(pick == "Técnica" && donePick == "Si")
			{
				jQuery("#VISIT_GOODTIME_BOX").hide();
				jQuery("#VISIT_GOODPLACE_BOX").hide();
				jQuery("#VISIT_FORMAT_BOX").show();
				jQuery("#VISIT_PDELIVER_BOX").show();
				jQuery("#VISIT_COHERENT_BOX").show();
				jQuery("#VISIT_EASY_BOX").show();
				jQuery("#VISIT_ORIENT_BOX").show();
				jQuery("#VISIT_EXPRESSION_BOX").show();
				jQuery("#VISIT_PRESENT_BOX").show();
				jQuery("#VISIT_VERIFIED_BOX").show();
				jQuery("#VISIT_ACOMPLISH_BOX").show();
				
				if(actualEditData.VISIT_MODE == "Presencial" || actualEditData.VISIT_MODE == "Presencial/Virtual")
				{
					jQuery("#VISIT_CONTRATIST_SIGN_BOX").show();
				}
				else
				{
					jQuery("#VISIT_CONTRATIST_SIGN_BOX").hide();
				}
				
				
				// jQuery("#planClassLink_BOX").show();
				
			}
			else
			{
				jQuery("#VISIT_GOODTIME_BOX").hide();
				jQuery("#VISIT_GOODPLACE_BOX").hide();
				jQuery("#VISIT_FORMAT_BOX").hide();
				jQuery("#VISIT_PDELIVER_BOX").hide();
				jQuery("#VISIT_COHERENT_BOX").hide();
				jQuery("#VISIT_EASY_BOX").hide();
				jQuery("#VISIT_ORIENT_BOX").hide();
				jQuery("#VISIT_EXPRESSION_BOX").hide();
				jQuery("#VISIT_PRESENT_BOX").hide();
				jQuery("#VISIT_VERIFIED_BOX").hide();
				jQuery("#VISIT_ACOMPLISH_BOX").hide();
				// jQuery("#planClassLink_BOX").hide();
			}
		}
		
		
		
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Registrar visita";
		saveButton.onclick = function (){saveVisit('0');}
		saveButton.style.display = "initial";

		PUM.open(1515);
		
		
	}
	
	if(type == "edlevel")
	{

		var EDLEVEL_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "EDLEVEL_ENTITY");
		var EDLEVEL_NAME = fieldCreator([12,12,12,12], "Nivel educativo", "input", "text", "EDLEVEL_NAME");
		
		// popFormFieldBox.appendChild(EDLEVEL_ENTITY);
		popFormFieldBox.appendChild(EDLEVEL_NAME);
		
		// FILL ENTITIES
		// selectFiller("EDLEVEL_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("EDLEVEL_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("EDLEVEL_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear Nivel Educativo";
		saveButton.onclick = function (){saveMaster("edlevel",'0');}

		PUM.open(1515);

	}
	
	if(type == "ocucond")
	{

		var OCUCOND_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "OCUCOND_ENTITY");
		var OCUCOND_NAME = fieldCreator([12,12,12,12], "Condición Ocupacional", "input", "text", "OCUCOND_NAME");
		
		// popFormFieldBox.appendChild(OCUCOND_ENTITY);
		popFormFieldBox.appendChild(OCUCOND_NAME);
		
		// FILL ENTITIES
		// selectFiller("OCUCOND_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("OCUCOND_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("OCUCOND_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear Condición Ocupacional";
		saveButton.onclick = function (){saveMaster("ocucond",'0');}

		PUM.open(1515);

	}
	
	if(type == "trasdes")
	{

		var TRASDES_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "TRASDES_ENTITY");
		var TRASDES_NAME = fieldCreator([12,12,12,12], "Trastorno de desarrollo", "input", "text", "TRASDES_NAME");
		
		// popFormFieldBox.appendChild(TRASDES_ENTITY);
		popFormFieldBox.appendChild(TRASDES_NAME);
		
		// FILL ENTITIES
		// selectFiller("TRASDES_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("TRASDES_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("TRASDES_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear Trastorno de desarrollo";
		saveButton.onclick = function (){saveMaster("trasdes",'0');}

		PUM.open(1515);

	}
	
	if(type == "tipovi")
	{

		var TIPOVI_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "TIPOVI_ENTITY");
		var TIPOVI_NAME = fieldCreator([12,12,12,12], "Tipo de violencia", "input", "text", "TIPOVI_NAME");
		
		// popFormFieldBox.appendChild(TIPOVI_ENTITY);
		popFormFieldBox.appendChild(TIPOVI_NAME);
		
		// FILL ENTITIES
		// selectFiller("TIPOVI_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("TIPOVI_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("TIPOVI_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear tipo de violencia";
		saveButton.onclick = function (){saveMaster("tipovi",'0');}

		PUM.open(1515);

	}
	
	if(type == "genre")
	{

		var GENRE_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "GENRE_ENTITY");
		var GENRE_NAME = fieldCreator([12,12,12,12], "Genero", "input", "text", "GENRE_NAME");
		
		// popFormFieldBox.appendChild(GENRE_ENTITY);
		popFormFieldBox.appendChild(GENRE_NAME);
		
		// FILL ENTITIES
		// selectFiller("GENRE_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("GENRE_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("GENRE_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear género";
		saveButton.onclick = function (){saveMaster("genre",'0');}

		PUM.open(1515);

	}
	
	if(type == "eps")
	{

		var EPS_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "EPS_ENTITY");
		var EPS_NAME = fieldCreator([12,12,12,12], "EPS", "input", "text", "EPS_NAME");
		
		// popFormFieldBox.appendChild(EPS_ENTITY);
		popFormFieldBox.appendChild(EPS_NAME);
		
		// FILL ENTITIES
		// selectFiller("EPS_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("EPS_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("EPS_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear EPS";
		saveButton.onclick = function (){saveMaster("eps",'0');}

		PUM.open(1515);

	}
	
	if(type == "riskfa")
	{

		var RISKFA_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "RISKFA_ENTITY");
		var RISKFA_NAME = fieldCreator([12,12,12,12], "Factor de riesgo", "input", "text", "RISKFA_NAME");
		
		// popFormFieldBox.appendChild(RISKFA_ENTITY);
		popFormFieldBox.appendChild(RISKFA_NAME);
		
		// FILL ENTITIES
		// selectFiller("RISKFA_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("RISKFA_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("RISKFA_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear Factor de Riesgo";
		saveButton.onclick = function (){saveMaster("riskfa",'0');}

		PUM.open(1515);

	}
	
	if(type == "prevfa")
	{

		var PREVFA_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "PREVFA_ENTITY");
		var PREVFA_NAME = fieldCreator([12,12,12,12], "Factor preventivo", "input", "text", "PREVFA_NAME");
		
		// popFormFieldBox.appendChild(PREVFA_ENTITY);
		popFormFieldBox.appendChild(PREVFA_NAME);
		
		// FILL ENTITIES
		// selectFiller("PREVFA_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("PREVFA_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("PREVFA_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear Factor Preventivo";
		saveButton.onclick = function (){saveMaster("prevfa",'0');}

		PUM.open(1515);

	}
	
	if(type == "ingrec")
	{

		var INGREC_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "INGREC_ENTITY");
		var INGREC_NAME = fieldCreator([12,12,12,12], "Ingreso Económico", "input", "text", "INGREC_NAME");
		
		// popFormFieldBox.appendChild(INGREC_ENTITY);
		popFormFieldBox.appendChild(INGREC_NAME);
		
		// FILL ENTITIES
		selectFiller("INGREC_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("INGREC_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("INGREC_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear Ingreso Económico";
		saveButton.onclick = function (){saveMaster("ingrec",'0');}

		PUM.open(1515);

	}
	
	if(type == "convac")
	{

		var CONVAC_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "CONVAC_ENTITY");
		var CONVAC_NAME = fieldCreator([12,12,12,12], "Convivencia actual", "input", "text", "CONVAC_NAME");
		
		// popFormFieldBox.appendChild(CONVAC_ENTITY);
		popFormFieldBox.appendChild(CONVAC_NAME);
		
		// FILL ENTITIES
		// selectFiller("CONVAC_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("CONVAC_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("CONVAC_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear Convivencia actual";
		saveButton.onclick = function (){saveMaster("convac",'0');}

		PUM.open(1515);

	}
	
	if(type == "patoen")
	{

		var PATOEN_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "PATOEN_ENTITY");
		var PATOEN_NAME = fieldCreator([12,12,12,12], "Patología enfermedad", "input", "text", "PATOEN_NAME");
		
		// popFormFieldBox.appendChild(PATOEN_ENTITY);
		popFormFieldBox.appendChild(PATOEN_NAME);
		
		// FILL ENTITIES
		// selectFiller("PATOEN_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("PATOEN_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("PATOEN_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear Patología enfermedad";
		saveButton.onclick = function (){saveMaster("patoen",'0');}

		PUM.open(1515);

	}
	
	if(type == "courses")
	{

		var COURSES_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "COURSES_ENTITY");
		var COURSES_NAME = fieldCreator([12,12,12,12], "Formación", "input", "text", "COURSES_NAME");
		
		// popFormFieldBox.appendChild(COURSES_ENTITY);
		popFormFieldBox.appendChild(COURSES_NAME);
		
		// FILL ENTITIES
		// selectFiller("COURSES_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("COURSES_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("COURSES_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear formación";
		saveButton.onclick = function (){saveMaster("courses",'0');}

		PUM.open(1515);

	}
	
	if(type == "tipoco")
	{

		var TIPOCO_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "TIPOCO_ENTITY");
		var TIPOCO_NAME = fieldCreator([12,12,12,12], "Tipo de consumo", "input", "text", "TIPOCO_NAME");
		
		// popFormFieldBox.appendChild(TIPOCO_ENTITY);
		popFormFieldBox.appendChild(TIPOCO_NAME);
		
		// FILL ENTITIES
		// selectFiller("TIPOCO_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("TIPOCO_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("TIPOCO_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear tipo de consumo";
		saveButton.onclick = function (){saveMaster("tipoco",'0');}

		PUM.open(1515);

	}
	
	if(type == "tiposo")
	{

		var TIPOSO_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "TIPOSO_ENTITY");
		var TIPOSO_NAME = fieldCreator([12,12,12,12], "Tipo de solicitante", "input", "text", "TIPOSO_NAME");
		
		// popFormFieldBox.appendChild(TIPOSO_ENTITY);
		popFormFieldBox.appendChild(TIPOSO_NAME);
		
		// FILL ENTITIES
		// selectFiller("TIPOSO_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("TIPOSO_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("TIPOSO_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear tipo de solicitante";
		saveButton.onclick = function (){saveMaster("tiposo",'0');}

		PUM.open(1515);

	}
	
	if(type == "migrea")
	{

		var MIGREA_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "MIGREA_ENTITY");
		var MIGREA_NAME = fieldCreator([12,12,12,12], "Razones migración", "input", "text", "MIGREA_NAME");
		
		// popFormFieldBox.appendChild(MIGREA_ENTITY);
		popFormFieldBox.appendChild(MIGREA_NAME);
		
		// FILL ENTITIES
		// selectFiller("MIGREA_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		if(userData.USER_CTYPE != "Superior")
		{
			document.getElementById("MIGREA_ENTITY").value = userData.USER_ENTITY;
			document.getElementById("MIGREA_ENTITY").disabled = true;
		}
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear razón migración";
		saveButton.onclick = function (){saveMaster("migrea",'0');}

		PUM.open(1515);

	}
	
	if(type == "tipoin")
	{

		var TIPOIN_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "TIPOIN_ENTITY");
		var TIPOIN_NAME = fieldCreator([12,12,12,12], "Tipo de indígena", "input", "text", "TIPOIN_NAME");
		
		// popFormFieldBox.appendChild(TIPOIN_ENTITY);
		popFormFieldBox.appendChild(TIPOIN_NAME);
		
		// FILL ENTITIES
		// selectFiller("TIPOIN_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		// if(userData.USER_CTYPE != "Superior")
		// {
			// document.getElementById("TIPOIN_ENTITY").value = userData.USER_ENTITY;
			// document.getElementById("TIPOIN_ENTITY").disabled = true;
		// }
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear Tipo de indígena";
		saveButton.onclick = function (){saveMaster("tipoin",'0');}

		PUM.open(1515);

	}
	
	if(type == "component")
	{

		var COMPONENT_NAME = fieldCreator([12,12,12,12], "Nombre Componente", "input", "text", "COMPONENT_NAME");
		var COMPONENT_ACTIVITIES = fieldCreator([12,4,4,12], "Actividades", "multiselect", "select", "COMPONENT_ACTIVITIES");

		popFormFieldBox.appendChild(COMPONENT_NAME);
		popFormFieldBox.appendChild(COMPONENT_ACTIVITIES);
		
		
		var allActivities = activities;
		var clistA = [];
		var singlePicker = "0"
		var locked = "0";
		
		
		
		
		
		
		
		
		for(var i=0; i<allActivities.length; i++)
		{
			var actiCode = allActivities[i].ACTIVITY_CODE;
			
			for(var p=0; p<activities.length; p++)
			{
				if(actiCode == activities[p].ACTIVITY_CODE)
				{
					var project = activities[p].ACTIVITY_PROJECT;
					allActivities[i].ACTIVITY_PROJECT = project;
					for(var n=0; n<projects.length; n++)
					{
						if(project == projects[n].PROJECT_CODE)
						{
							allActivities[i].ACTIVITY_PROJECT_NAME = projects[n].PROJECT_NAME;
							var prjPrg = projects[n].PROJECT_PROGRAM;
							for(var z=0; z<programs.length; z++)
							{
								var pg = programs[z];
								if(prjPrg == pg.PROGRAM_CODE)
								{
									allActivities[i].ACTIVITY_PROGRAM_NAME = programs[z].PROGRAM_NAME; break;
								}
							}
							break;
						}
					}
				}
			}
		}
		
		for(var i=0; i<allActivities.length; i++)
		{
			
			if(allActivities[i].ACTIVITY_DETAIL)
			{var actiDesc = allActivities[i].ACTIVITY_DETAIL;}
			if(allActivities[i].ACTIVITY_NAME)
			{var actiDesc = allActivities[i].ACTIVITY_NAME;}
		
			var projectDesc = allActivities[i].ACTIVITY_PROJECT_NAME;
			var programDesc = allActivities[i].ACTIVITY_PROGRAM_NAME;
			var newDesc = actiDesc+" - "+projectDesc+" - "+programDesc;
			
			allActivities[i].ACTIVITY_FULL_NAME = newDesc;
		}
		
		
		console.log(allActivities);
		
		
		
		// SET ACTIVITIES
		multiSelectFillerDicF("COMPONENT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_FULL_NAME", allActivities, clistA, singlePicker,locked);
		
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear componente";
		saveButton.onclick = function (){saveMaster("component",'0');}

		PUM.open(1515);

	}
	
	
	if(type == "scomponent")
	{

		var SCOMPONENT_NAME = fieldCreator([12,4,4,6], "Nombre Sub Componente", "input", "text", "SCOMPONENT_NAME");
		
		var SCOMPONENT_COMPONENT = fieldCreator([12,4,4,6], "Componente", "dropdown", "dropdown", "SCOMPONENT_COMPONENT");

		popFormFieldBox.appendChild(SCOMPONENT_NAME);
		popFormFieldBox.appendChild(SCOMPONENT_COMPONENT);

		// FILL HOOD
		searchListFiller("SCOMPONENT_COMPONENT", components, "COMPONENT_NAME", "COMPONENT_CODE", "Seleccione componente");
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear Sub componente";
		saveButton.onclick = function (){saveMaster("scomponent",'0');}

		PUM.open(1515);

	}
	
	if(type == "rem")
	{

		// NEW REMITION ONLY
		actualRemitionData = "";
		
		// actualRemCitizen = "10031785";
		
		console.log(actualRemCitizen);
		
		actualEditData = "";
		
		var REM_DATE = fieldCreator([12,4,4,6], "Fecha", "input", "text", "REM_DATE");
		var REM_REQUESTER = fieldCreator([12,4,4,6], "Documento de quien solicita la atención", "input", "text", "REM_REQUESTER");
		var REM_REQUESTER_TYPE = fieldCreator([12,4,4,6], "Tipo de solicitante", "select", "select", "REM_REQUESTER_TYPE");
		var REM_PROGRAM = fieldCreator([12,12,12,12], "Programa", "dropdown", "dropdown", "REM_PROGRAM");
		var REM_PROJECT = fieldCreator([12,12,12,12], "Projecto", "dropdown", "dropdown", "REM_PROJECT");
		var REM_ACTIVITY = fieldCreator([12,12,12,12], "Actividad", "dropdown", "dropdown", "REM_ACTIVITY");
		var REM_CONTRATIST = fieldCreator([12,12,12,12], "Contratista", "dropdown", "dropdown", "REM_CONTRATIST");
		
		
		var REM_COMMENT_DATE = fieldCreator([12,12,12,12], "Fecha motivo", "input", "text", "REM_COMMENT_DATE");
		var REM_COMMENT = fieldCreator([12,12,12,12], "Motivo", "textarea", "textarea", "REM_COMMENT");
		
		popFormFieldBox.appendChild(REM_REQUESTER);
		popFormFieldBox.appendChild(REM_DATE);
		popFormFieldBox.appendChild(REM_REQUESTER_TYPE);
		popFormFieldBox.appendChild(REM_PROGRAM);
		popFormFieldBox.appendChild(REM_PROJECT);
		popFormFieldBox.appendChild(REM_ACTIVITY);
		popFormFieldBox.appendChild(REM_CONTRATIST);
		popFormFieldBox.appendChild(REM_COMMENT);
		popFormFieldBox.appendChild(REM_COMMENT_DATE);
		
		setDateField("REM_DATE");
		
		setDateField("REM_COMMENT_DATE", "time");
		
		document.getElementById("REM_DATE").value = getNow().split(" ")[0];
		document.getElementById("REM_DATE").disabled = true;
		document.getElementById("REM_DATE_BOX").style.display = "none";
		
		selectFiller("REM_REQUESTER_TYPE", "Seleccione tipo solicitante", tiposo, "TIPOSO_CODE", "TIPOSO_NAME");
		
		// BUILD PREFILTER PROGRAM AND PROYECT
		// BUILD PREFILTER PROGRAM AND PROYECT
		// BUILD PREFILTER PROGRAM AND PROYECT
		
		setActParents();
		searchListFiller("REM_PROGRAM", validPrograms, "PROGRAM_NAME", "PROGRAM_CODE",  "Seleccione programa");
		
		// DEFINE ACTION
		actualMT = "1";
		
		console.log(citizenOrigin);
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear atención";
		saveButton.onclick = function (){saveRem('0');}
		
		document.getElementById("REM_REQUESTER").lastvalue = "";
		document.getElementById("REM_REQUESTER").onblur = function ()
		{

			if(this.value == this.lastvalue || this.value == ""){return;}
			this.lastvalue = this.value;
			
			// IGNORE IF SAME AS EDITED
			if(this.value == actualEditData.REM_REQUESTER){console.log("Ignore");return;}
			
			var info = {};
			info.CITIZEN_IDNUM = this.value.split("-")[0];
			if(info.CITIZEN_IDNUM == ""){return;}
			
			console.log("age check");
			
			// loadManager(1, "popFormSaveButton");
			sendAjax("users","getCitizen",info,function(response)
			{
				// loadManager(0, "popFormSaveButton");
				
				var ans = response.message;
				console.log(ans);
				
				if(ans == "toYoung")
				{
					fastPop("Este ciudadano no es mayor de edad, solo puede ingresar mayores de edad en este campo", 3000);
					document.getElementById("REM_REQUESTER").lastvalue = "";
					document.getElementById("REM_REQUESTER").value = "";
					return;
				}

				if(ans.length > 0)
				{
					invoquedCitizenData = ans[0];
					
					var newValue = invoquedCitizenData.CITIZEN_IDNUM+"-"+invoquedCitizenData.CITIZEN_NAME+" "+invoquedCitizenData.CITIZEN_LASTNAME;
					document.getElementById("REM_REQUESTER").lastvalue = newValue;
					document.getElementById("REM_REQUESTER").value = newValue;
				}
				else
				{
					
					document.getElementById("REM_REQUESTER").lastvalue = "";
					document.getElementById("REM_REQUESTER").value = "";
					
					citizenOrigin = "remC";
					
					setTimeout(function()
					{
						var params = [info.CITIZEN_IDNUM];
						confirmBox(language["confirm"], "El id no se encuentra registrado, ¿desea crear al solicitante ahora?",createCitizenPop, params);
						
					}, 500);

				}
			});
		}
		
		PUM.open(1515);

	}
	
	if(type == "etarie")
	{
		
		var ETARIE_ENTITY = fieldCreator([12,4,4,6], "Entidad", "select", "select", "ETARIE_ENTITY");
		var ETARIE_NAME = fieldCreator([12,4,4,6], "Nombre", "input", "text", "ETARIE_NAME");
		var ETARIE_FROM = fieldCreator([12,4,4,6], "Desde", "input",
		"number", "ETARIE_FROM");
		var ETARIE_TO = fieldCreator([12,4,4,6], "Hasta", "input", "number", "ETARIE_TO");
		
		popFormFieldBox.appendChild(ETARIE_ENTITY);
		popFormFieldBox.appendChild(ETARIE_NAME);
		popFormFieldBox.appendChild(ETARIE_FROM);
		popFormFieldBox.appendChild(ETARIE_TO);
		
		
		// FILL ENTITIES
		selectFiller("ETARIE_ENTITY", "Seleccione entidad", entities, "ENTITY_CODE", "ENTITY_NAME");
		
		document.getElementById("ETARIE_ENTITY").value = userData.USER_ENTITY;
		if(userData.USER_CTYPE != "Superior")
		{document.getElementById("ETARIE_ENTITY").disabled = true;}
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear ciclo";
		saveButton.onclick = function (){saveEtarie('0');}
		saveButton.style.display = "initial";

		PUM.open(1515);
		
		
	}
	
	if(type == "citizenChange")
	{
		
		var CITIZEN_IDNUM = fieldCreator([12,4,4,6], "Id. actual", "input", "text", "CITIZEN_IDNUM");
		var CITIZEN_IDNUM_NEW = fieldCreator([12,4,4,6], "Id. nuevo", "input", "text", "CITIZEN_NEW_IDNUM");
		
		
		popFormFieldBox.appendChild(CITIZEN_IDNUM);
		popFormFieldBox.appendChild(CITIZEN_IDNUM_NEW);
		
		
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Cambiar numero de id. ciudadano";
		saveButton.onclick = function (){changeIdGo();}

		PUM.open(1515);
		
		
	}
	
	if(type == "historyView")
	{
		
		// GOALS BOX ADD
		var historyBox = document.createElement("div");
		historyBox.id = "historyBox";
		historyBox.className = "blockBox";
		popFormFieldBox.appendChild(historyBox);

		
		addHistoryBlock();

		// DEFINE ACTION
		actualMT = "1";

		// SET TITLE AND SAVE FUNCTION
		if(actualHistoryMode == "line")
		{
			formTitle.innerHTML = "Historial de línea";
		}
		if(actualHistoryMode == "history")
		{
			formTitle.innerHTML = "Historial de ciudadano";
		}


		saveButton.onclick = function (){return;}
		saveButton.style.display = "none";
		saveButton.innerHTML = "Guardar";

		PUM.open(1515);
		
	}
	
	if(type == "datedit")
	{
		
		var DATE_DATE = fieldCreator([12,4,4,6], "Fecha", "input", "text", "DATE_DATE");
		var DATE_DATE_INI = fieldCreator([12,4,4,6], "Hora inicio", "select", "select", "DATE_DATE_INI");
		var DATE_DATE_END = fieldCreator([12,4,4,6], "Hora fin", "select", "select", "DATE_DATE_END");
		var DATE_PLACE = fieldCreator([12,4,4,6], "Lugar", "input", "text", "DATE_PLACE");
		
		popFormFieldBox.appendChild(DATE_DATE);
		popFormFieldBox.appendChild(DATE_DATE_INI);
		popFormFieldBox.appendChild(DATE_DATE_END);
		popFormFieldBox.appendChild(DATE_PLACE);
		
		
		// FILL HOURS
		selectFiller("DATE_DATE_INI", "Seleccione hora", timeOptions);
		selectFiller("DATE_DATE_END", "Seleccione hora", timeOptions);
		
		// SET DATE FIELDS
		setDateField("DATE_DATE");
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Editar cita";
		saveButton.onclick = function (){editDate();}
		saveButton.style.display = "initial";

		PUM.open(1515);

	}
	
	if(type == "dateClose")
	{
		
		var DATE_CLOSE_COMMENT = fieldCreator([12,4,4,12], "Comentario de cierre", "textarea", "textarea", "DATE_CLOSE_COMMENT");

		popFormFieldBox.appendChild(DATE_CLOSE_COMMENT);
		

		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Cerrar cita";
		saveButton.onclick = function (){dateClose();}
		saveButton.style.display = "initial";

		PUM.open(1515);

	}
	
	
	
	goTopPop();
}

function getProgramFromActi(acti)
{
	
	var program = "-";
	
	for(var i=0; i<activities.length; i++)
	{
		var item = activities[i];
		if(item.ACTIVITY_CODE == acti){var project = item.ACTIVITY_PROJECT;break;}
	}
	
	for(var i=0; i<projects.length; i++)
	{
		var item = projects[i];
		if(item.PROJECT_CODE == project){program = item.PROJECT_PROGRAM;break;}
	}
	
	return program;
}

function setActParents()
{
	
	actualValidProjects = [];
	actualValidPrograms = [];
	
	for(var i=0; i<fixedActis.length; i++)
	{
		var actiCode = fixedActis[i].ACTIVITY_CODE;
		
		for(var p=0; p<activities.length; p++)
		{
			if(actiCode == activities[p].ACTIVITY_CODE)
			{
				var project = activities[p].ACTIVITY_PROJECT;
				fixedActis[i].ACTIVITY_PROJECT = project;
				if(!actualValidProjects.includes(project)){actualValidProjects.push(project);}
				for(var n=0; n<projects.length; n++)
				{
					if(project == projects[n].PROJECT_CODE)
					{
						fixedActis[i].ACTIVITY_PROJECT_NAME = projects[n].PROJECT_NAME;
						var prjPrg = projects[n].PROJECT_PROGRAM;
						for(var z=0; z<programs.length; z++)
						{
							var pg = programs[z];
							if(prjPrg == pg.PROGRAM_CODE)
							{
								fixedActis[i].ACTIVITY_PROGRAM_NAME = programs[z].PROGRAM_NAME; break;
							}
						}
						break;
					}
				}
			}
		}
	}
	
	
	for(var i=0; i<actualValidProjects.length; i++)
	{
		var projectCode = actualValidProjects[i];
		for(var p=0; p<projects.length; p++)
		{
			if(projectCode == projects[p].PROJECT_CODE)
			{
				var program = projects[p].PROJECT_PROGRAM;
				if(!actualValidPrograms.includes(program))
				{actualValidPrograms.push(program); break;}
			}
		}
	}
	
	validProjects = [];
	
	for(var i=0; i<actualValidProjects.length; i++)
	{
		var code = actualValidProjects[i];
		
		for(var p=0; p<projects.length; p++)
		{
			if(code == projects[p].PROJECT_CODE)
			{
				var pj = projects[p];
				if(!validProjects.includes(pj)){validProjects.push(pj);}
			}
		}
	}
	
	validPrograms = [];
	// programVlist = [];
	
	for(var i=0; i<actualValidPrograms.length; i++)
	{
		var code = actualValidPrograms[i];
		
		for(var p=0; p<programs.length; p++)
		{
			if(code == programs[p].PROGRAM_CODE)
			{
				var pg = programs[p];
				if(!validPrograms.includes(pg))
				{
					validPrograms.push(pg);
					// programVlist.push(pg);
					
				}
			}
		}
		
	}

	for(var i=0; i<fixedActis.length; i++)
	{
		
		if(fixedActis[i].ACTIVITY_DETAIL)
		{var actiDesc = fixedActis[i].ACTIVITY_DETAIL;}
		if(fixedActis[i].ACTIVITY_NAME)
		{var actiDesc = fixedActis[i].ACTIVITY_NAME;}
		var projectDesc = fixedActis[i].ACTIVITY_PROJECT_NAME;
		var programDesc = fixedActis[i].ACTIVITY_PROGRAM_NAME;
		// var newDesc = actiDesc+" - "+projectDesc+" - "+programDesc;
		var newDesc = actiDesc;
		
		fixedActis[i].ACTIVITY_FULL_NAME = newDesc;
	}
	
	// console.log("2");
	// console.log(validPrograms);
	// console.log(programVlist);
	
	// console.log(fixedActis);
}

function updateIMC()
{
	var peso = document.getElementById("CITIZEN_WEIGHT").value;
	var talla = document.getElementById("CITIZEN_HEIGHT").value;
	
	if(peso != "" && talla != "")
	{
		peso = parseFloat(peso);
		talla = parseFloat(talla);
		console.log(peso);
		console.log(talla);
		
		var imc = peso/(talla*talla);
		
		document.getElementById("CITIZEN_IMC").value = imc.toFixed(2);
		document.getElementById("CITIZEN_IMC").disabled = true;
		
		var rate = "";
		
		if(imc < 18.5){var rate = "Bajo peso";}
		if(imc >= 18.5){var rate = "Normal";}
		if(imc > 24.9){var rate = "Sobrepeso";}
		if(imc > 29.9){var rate = "Obesidad I";}
		if(imc > 34.9){var rate = "Obesidad II";}
		if(imc > 39.9){var rate = "Obesidad III";}
		if(imc > 49.9){var rate = "Obesidad IV";}
		
		document.getElementById("CITIZEN_IMC_RATE").value = rate;
		
	}
	else
	{
		document.getElementById("CITIZEN_IMC").value = "";
		document.getElementById("CITIZEN_IMC_RATE").value = "";
	}
	
}

function hideFields(list)
{
	// console.log(list);
	for(var i=0; i<list.length; i++)
	{
		var item = document.getElementById(list[i]+"_BOX");
		// console.log(item);
		item.style.display = "none";
	}
}

function formSectioner(fields, title)
{
	var barText = document.createElement("span");
	barText.innerHTML = title;
	barText.className = "barText";
	barText.fields = fields;
	barText.state = "0";
	
	barText.onclick = function ()
	{
		console.log(this.fields);
		var fields = this.fields;
		if(this.state == "0")
		{
			for(var i=0; i<fields.length; i++)
			{
				var field = fields[i];
				document.getElementById(field+"_BOX").style.display = "initial";
			}
			
			this.state = "1";
		}
		else
		{
			for(var i=0; i<fields.length; i++)
			{
				var field = fields[i];
				document.getElementById(field+"_BOX").style.display = "none";
			}
			
			this.state = "0";
		}
	}
	
	
	return barText;

}

function saveMaster(master, mode)
{
	var info = {};
	info.MODE = mode;
	
	
	if(master == "edlevel")
	{
		info.ENTITY_FIELD = "EDLEVEL_ENTITY";
		info.NAME_FIELD = "EDLEVEL_NAME";
		info.CODE_FIELD = "EDLEVEL_CODE";
		info.TABLE = "wp_master_edlevel";
	}
	if(master == "ocucond")
	{
		info.ENTITY_FIELD = "OCUCOND_ENTITY";
		info.NAME_FIELD = "OCUCOND_NAME";
		info.CODE_FIELD = "OCUCOND_CODE";
		info.TABLE = "wp_master_ocucond";
	}
	if(master == "trasdes")
	{
		info.ENTITY_FIELD = "TRASDES_ENTITY";
		info.NAME_FIELD = "TRASDES_NAME";
		info.CODE_FIELD = "TRASDES_CODE";
		info.TABLE = "wp_master_trasdes";
	}
	if(master == "tipovi")
	{
		info.ENTITY_FIELD = "TIPOVI_ENTITY";
		info.NAME_FIELD = "TIPOVI_NAME";
		info.CODE_FIELD = "TIPOVI_CODE";
		info.TABLE = "wp_master_tipovi";
	}
	if(master == "genre")
	{
		info.ENTITY_FIELD = "GENRE_ENTITY";
		info.NAME_FIELD = "GENRE_NAME";
		info.CODE_FIELD = "GENRE_CODE";
		info.TABLE = "wp_master_genre";
	}
	if(master == "eps")
	{
		info.ENTITY_FIELD = "EPS_ENTITY";
		info.NAME_FIELD = "EPS_NAME";
		info.CODE_FIELD = "EPS_CODE";
		info.TABLE = "wp_master_eps";
	}
	if(master == "riskfa")
	{
		info.ENTITY_FIELD = "RISKFA_ENTITY";
		info.NAME_FIELD = "RISKFA_NAME";
		info.CODE_FIELD = "RISKFA_CODE";
		info.TABLE = "wp_master_riskfa";
	}
	if(master == "prevfa")
	{
		info.ENTITY_FIELD = "PREVFA_ENTITY";
		info.NAME_FIELD = "PREVFA_NAME";
		info.CODE_FIELD = "PREVFA_CODE";
		info.TABLE = "wp_master_prevfa";
	}
	if(master == "ingrec")
	{
		info.ENTITY_FIELD = "INGREC_ENTITY";
		info.NAME_FIELD = "INGREC_NAME";
		info.CODE_FIELD = "INGREC_CODE";
		info.TABLE = "wp_master_ingrec";
	}
	if(master == "convac")
	{
		info.ENTITY_FIELD = "CONVAC_ENTITY";
		info.NAME_FIELD = "CONVAC_NAME";
		info.CODE_FIELD = "CONVAC_CODE";
		info.TABLE = "wp_master_convac";
	}
	if(master == "patoen")
	{
		info.ENTITY_FIELD = "PATOEN_ENTITY";
		info.NAME_FIELD = "PATOEN_NAME";
		info.CODE_FIELD = "PATOEN_CODE";
		info.TABLE = "wp_master_patoen";
	}
	if(master == "courses")
	{
		info.ENTITY_FIELD = "COURSES_ENTITY";
		info.NAME_FIELD = "COURSES_NAME";
		info.CODE_FIELD = "COURSES_CODE";
		info.TABLE = "wp_master_courses";
	}
	if(master == "tipoco")
	{
		info.ENTITY_FIELD = "TIPOCO_ENTITY";
		info.NAME_FIELD = "TIPOCO_NAME";
		info.CODE_FIELD = "TIPOCO_CODE";
		info.TABLE = "wp_master_tipoco";
	}
	if(master == "tiposo")
	{
		info.ENTITY_FIELD = "TIPOSO_ENTITY";
		info.NAME_FIELD = "TIPOSO_NAME";
		info.CODE_FIELD = "TIPOSO_CODE";
		info.TABLE = "wp_master_tiposo";
	}
	if(master == "migrea")
	{
		info.ENTITY_FIELD = "MIGREA_ENTITY";
		info.NAME_FIELD = "MIGREA_NAME";
		info.CODE_FIELD = "MIGREA_CODE";
		info.TABLE = "wp_master_migrea";
	}
	if(master == "tipoin")
	{
		info.ENTITY_FIELD = "TIPOIN_ENTITY";
		info.NAME_FIELD = "TIPOIN_NAME";
		info.CODE_FIELD = "TIPOIN_CODE";
		info.TABLE = "wp_master_tipoin";
	}
	if(master == "component")
	{
		info.ENTITY_FIELD = "COMPONENT_ENTITY";
		info.NAME_FIELD = "COMPONENT_NAME";
		info.CODE_FIELD = "COMPONENT_CODE";
		info.TABLE = "wp_master_component";
		
		info.COMPONENT_ACTIVITIES = JSON.stringify(getPickedIds("COMPONENT_ACTIVITIES"));
		
		
		if(info.COMPONENT_ACTIVITIES == "[]"){fastPop("Debe seleccionar por lo menos una actividad.", 2000);return;}
		
	}
	if(master == "scomponent")
	{
		info.ENTITY_FIELD = "SCOMPONENT_ENTITY";
		info.NAME_FIELD = "SCOMPONENT_NAME";
		info.CODE_FIELD = "SCOMPONENT_CODE";
		info.TABLE = "wp_master_scomponent";
		
		var component = document.getElementById("SEARCH_BUTTON_SCOMPONENT_COMPONENT").pickedCode;
		info.SCOMPONENT_COMPONENT = component;
		
		if(info.SCOMPONENT_COMPONENT == ""){fastPop("Debe seleccionar el componente.", 2000);return;}
		
	}
	
	info.ENTITY = "";
	info.NAME = document.getElementById(info.NAME_FIELD).value;
	
	// if(info.ENTITY == ""){fastPop("Debe seleccionar la entidad.", 2000);return;}
	if(info.NAME == ""){fastPop("Debe escribir el nombre del elemento a crear.", 2000);return;}
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE == "1")
	{info.CODE = actualEditData[info.CODE_FIELD];}
	else{info.CODE = "";}
	
	console.log(info);

	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveMaster",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans);
		
		if(ans == "Created")
		{
			fastPop("Se ha creado el registro",3000);
			refreshTable(info.TABLE);
			PUM.close(1515);	
		}
		else if(ans == "exists")
		{
			fastPop("Ya existe un registro con este nombre de elemento",3000);
		}
		else if(ans == "updated")
		{
			fastPop("Registro actualizado",3000);
			refreshTable(info.TABLE);
			PUM.close(1515);	
		}
	});
}

function idChange()
{
	console.log("change id");
	
	actualToChangeId = document.getElementById("CITIZEN_IDNUM").value;
	
	var params = [];
	confirmBox(language["confirm"], language["confirmIdChange"]+" "+actualToChangeId+"<br>Esto afectará todos los registros en las tablas relacionadas: Grupos, Clases, Eventos, Atenciones, Comentarios y Citas", startIdChange, params);
}

function startIdChange()
{
	loadForm("citizenChange");
	
	document.getElementById("CITIZEN_IDNUM").value = actualToChangeId;
	// document.getElementById("CITIZEN_IDNUM").disabled = true;
}

function changeIdGo(params)
{
	var info = {};
		
	info.CITIZEN_IDNUM = document.getElementById("CITIZEN_IDNUM").value;
	info.CITIZEN_NEW_IDNUM = document.getElementById("CITIZEN_NEW_IDNUM").value;
	
	if(info.CITIZEN_NEW_IDNUM == ""){fastPop("Debe escribir el id nuevo del ciudadano", 3000);return;}
	
	console.log(info)		
	
	loadManager(1, "popFormSaveButton");
	sendAjax("users","citizenChange",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans);
		fastPop("Id.actualizado", 2000);
		
		
		
		setTimeout(function()
		{
			PUM.close(1515);
			loadIf("contractsB")
			return
		}, 1000);
		
		
		
		
	});
	

}

function getInstituteData(type, pick)
{
	
	if(pick == "")
	{
		// CLEAR AND UNLOCK AS TYPE
		if(type == "Groups")
		{
			document.getElementById("GROUP_HOOD").value = "";
			document.getElementById("GROUP_ADDRESS").value = "";
			document.getElementById("GROUP_COORDS").value = "";
		}
	}
	else
	{
		var info = {};
		info.INSTITUTE_CODE = pick;
		info.type = type;
		sendAjax("users","getInstituteData",info,function(response)
		{
			var insData = response.message[0];
			console.log(insData)
			var hood = insData.INSTITUTE_HOOD;
			var address = insData.INSTITUTE_ADDRESS;
			var coords = insData.INSTITUTE_COORDS;
			
			if(info.type == "Groups")
			{
				document.getElementById("GROUP_HOOD").value = hood;
				
				
				// GET HOODNAME FROM CODE
				var thearray = JSON.stringify([hood]);
				var hoodT = getFriendDescs(thearray,"hoods");
				document.getElementById("SEARCH_BUTTON_GROUP_HOOD").innerHTML = hoodT;
				document.getElementById("SEARCH_BUTTON_GROUP_HOOD").pickedCode = hood;
				document.getElementById("SEARCH_BUTTON_GROUP_HOOD").disabled = true;

				document.getElementById("GROUP_ADDRESS").value = address;
				document.getElementById("GROUP_COORDS").value = coords;
				
				document.getElementById("GROUP_ADDRESS").disabled = true;
				document.getElementById("GROUP_COORDS").disabled = true;
			}
			if(info.type == "Events")
			{
				document.getElementById("EVENT_HOOD").value = hood;
				
				
				// GET HOODNAME FROM CODE
				var thearray = JSON.stringify([hood]);
				var hoodT = getFriendDescs(thearray,"hoods");
				document.getElementById("SEARCH_BUTTON_EVENT_HOOD").innerHTML = hoodT;
				document.getElementById("SEARCH_BUTTON_EVENT_HOOD").pickedCode = hood;
				document.getElementById("SEARCH_BUTTON_EVENT_HOOD").disabled = true;
				
				document.getElementById("EVENT_ADDRESS").value = address;
				document.getElementById("EVENT_COORDS").value = coords;

				document.getElementById("EVENT_HOOD").disabled = true;
				document.getElementById("EVENT_ADDRESS").disabled = true;
				document.getElementById("EVENT_COORDS").disabled = true;
			}
		});
	}
	
	
}

function getZoneFromHood(code)
{
	var zone = "";
	
	for(var i=0; i<hoods.length; i++)
	{
		var hood = hoods[i];
		
		if(hood.HOOD_CODE == code)
		{
			zone = hood.HOOD_NAME_FULL.split(" - ")[1];
		}

	}
	
	return zone;
}

function getZoneCodeFromHood(code)
{
	var zone = "";
	
	for(var i=0; i<hoods.length; i++)
	{
		var hood = hoods[i];
		
		if(hood.HOOD_CODE == code)
		{
			zone = hood.HOOD_ZONE;
		}

	}
	
	return zone;
}

function dbc(container, title, val, type)
{
	
	var element = document.createElement("div");
	element.className = "blockBox col-xs-12 col-sm-12 col-md-6 col-lg-6";
	var label = document.createElement("span");
	label.className = "fieldName";
	label.innerHTML = title;
	element.appendChild(label);
	container.appendChild(element);
	
	var element = document.createElement("div");
	element.className = "blockBox col-xs-12 col-sm-12 col-md-6 col-lg-6";
	var content = document.createElement("span");
	content.className = "fieldDetail";
	content.innerHTML = val;
	element.appendChild(content);
	container.appendChild(element);

	var hr = document.createElement("hr");
	hr.className = "hr";
	container.appendChild(hr);
}

function filterView(array)
{
	var filtered = [];
	var prefix = array[0].split("_")[0];
	
	if(prefix == "EVENT")
	{
		if(actualEvents == "1")
		{
			filtered.push("EVENT_ENTITY");
			filtered.push("EVENT_STATUS");
			filtered.push("EVENT_REQUESTER_FULL");
			filtered.push("EVENT_ORIGIN");
			filtered.push("EVENT_RADICATE");
			filtered.push("EVENT_REQUEST_DATE");
			filtered.push("EVENT_REQUEST_TYPE");
			filtered.push("EVENT_INSTYPE");
			filtered.push("EVENT_INSTITUTE");
			filtered.push("EVENT_REQUEST_ACTIVITY");
			filtered.push("EVENT_NAME");
			filtered.push("EVENT_EXPECTED");
			filtered.push("EVENT_HOOD");
			filtered.push("EVENT_PREVIR");
			filtered.push("EVENT_ADDRESS");
			filtered.push("EVENT_COORDS");
			filtered.push("EVENT_DATE_INIR");
			filtered.push("EVENT_DATE_ENDR");
			filtered.push("EVENT_DATE_INI");
			filtered.push("EVENT_DATE_END");
			filtered.push("EVENT_DESCRIPTION");
			filtered.push("EVENT_NEEDS");
			filtered.push("EVENT_OWNER_FULL");
			filtered.push("EVENT_ACTIVITIES");
			filtered.push("EVENT_SUPPORT_TEAM");
			filtered.push("EVENT_COOPTYPE");
			filtered.push("EVENT_COOPERATOR_FULL");
			filtered.push("EVENT_ASSIST");
			filtered.push("EVENT_RESUME");
			filtered.push("EVENT_REJECT_REASON");
		}
		else
		{
			filtered.push("EVENT_ENTITY");
			filtered.push("EVENT_COOPTYPE");
			filtered.push("EVENT_COOPERATOR_FULL");
			filtered.push("EVENT_DATE_INI");
			filtered.push("EVENT_DATE_END");
			filtered.push("EVENT_HOOD");
			filtered.push("EVENT_PREVIR");
			filtered.push("EVENT_ADDRESS");
			filtered.push("EVENT_COORDS");
			filtered.push("EVENT_ACTIVITIES");
			filtered.push("EVENT_SUPPORT_TEAM");
			filtered.push("EVENT_INSTYPE");
			filtered.push("EVENT_INSTITUTE");
			filtered.push("EVENT_NAME");
			filtered.push("EVENT_ASSIST");
			filtered.push("EVENT_RESUME");
		}
		
	}
	else if(prefix == "VISIT")
	{
		// filtered = array;
		filtered.push("VISIT_ENTITY");
		filtered.push("VISIT_DATE");
		filtered.push("VISIT_DONE");
		filtered.push("VISIT_TYPE");
		filtered.push("VISIT_ACTIVITY");
		filtered.push("VISIT_CLASS_DATE");
		filtered.push("VISIT_CLASS_INI_TIME");
		filtered.push("VISIT_CLASS_COORD");
		filtered.push("VISIT_COORD");
		filtered.push("VISIT_ASSISTQTY");
		filtered.push("VISIT_NOASSISTQTY");
		filtered.push("VISIT_STONTIME");
		filtered.push("VISIT_TOOLS");
		filtered.push("VISIT_GOODTIME");
		filtered.push("VISIT_GOODPLACE");
		filtered.push("VISIT_FORMAT");
		filtered.push("VISIT_PDELIVER");
		filtered.push("VISIT_COHERENT");
		filtered.push("VISIT_EASY");
		filtered.push("VISIT_ORIENT");
		filtered.push("VISIT_EXPRESSION");
		filtered.push("VISIT_PRESENT");
		filtered.push("VISIT_VERIFIED");
		filtered.push("VISIT_ACOMPLISH");
		filtered.push("VISIT_CONTRATIST");
		filtered.push("VISIT_VISITOR");
		filtered.push("VISIT_GROUP_NAME");
		filtered.push("VISIT_HOOD");
		filtered.push("VISIT_ADDRESS");
		filtered.push("VISIT_MODE");
		filtered.push("VISIT_COMMENTS");
		
	}
	else
	{
		filtered = array;
	}
	
	
	return filtered;
}

function fiendlyName(field)
{
	var name = "-";
	name = field;
	if(field == "EVENT_CREATED"){name = "Fecha creación";}
	else if(field == "EVENT_ENTITY"){name = "Entidad";}
	else if(field == "EVENT_DATE_INI"){name = "Fecha inicio ejecución";}
	else if(field == "EVENT_DATE_END"){name = "Fecha fin ejecución";}
	else if(field == "EVENT_HOOD"){name = "Barrio o vereda";}
	else if(field == "EVENT_PREVIR"){name = "Presencial o virtual";}
	else if(field == "EVENT_ADDRESS"){name = "Dirección";}
	else if(field == "EVENT_COORDS"){name = "Coordenadas";}
	else if(field == "EVENT_ACTIVITIES"){name = "Actividades";}
	else if(field == "EVENT_SUPPORT_TEAM"){name = "Apoyo";}
	else if(field == "EVENT_INSTYPE"){name = "Institucional/Comunitario";}
	else if(field == "EVENT_COOPTYPE"){name = "Tipo cooperador";}
	else if(field == "EVENT_NAME"){name = "Nombre evento";}
	else if(field == "EVENT_INSTITUTE"){name = "Institucion";}
	else if(field == "EVENT_COOPERATOR"){name = "Cooperador";}
	else if(field == "EVENT_COOPERATOR_FULL"){name = "Cooperador";}
	else if(field == "EVENT_ASSIST"){name = "Asistencia";}
	else if(field == "EVENT_TOTAL_PEOPLE"){name = "Total asistentes";}
	else if(field == "EVENT_RESUME"){name = "Resumen de evento";}
	else if(field == "EVENT_STATUS"){name = "Estado de evento";}
	else if(field == "EVENT_REQUESTER"){name = "Solicitante";}
	else if(field == "EVENT_REQUESTER_FULL"){name = "Solicitante";}
	else if(field == "EVENT_ORIGIN"){name = "Origen";}
	else if(field == "EVENT_RADICATE"){name = "Radicado";}
	else if(field == "EVENT_REQUEST_DATE"){name = "Fecha solicitud";}
	else if(field == "EVENT_REQUEST_TYPE"){name = "Tipo de solicitud";}
	else if(field == "EVENT_REQUEST_ACTIVITY"){name = "Actividad solicitud";}
	else if(field == "EVENT_EXPECTED"){name = "Asistencia esperada";}
	else if(field == "EVENT_NEEDS"){name = "Necesidades";}
	else if(field == "EVENT_DESCRIPTION"){name = "Descripción del evento";}
	else if(field == "EVENT_DATE_INIR"){name = "Fecha inicio solicitud";}
	else if(field == "EVENT_DATE_ENDR"){name = "Fecha fin solicitud";}
	else if(field == "EVENT_REJECT_REASON"){name = "Razón de rechazo";}
	else if(field == "EVENT_OWNER"){name = "Director de evento";}
	else if(field == "EVENT_OWNER_FULL"){name = "Director de evento";}
	
	else if(field == "VISIT_ENTITY"){name = "Entidad visita";}
	else if(field == "VISIT_DATE"){name = "Fecha visita";}
	else if(field == "VISIT_DONE"){name = "Visita realizada";}
	else if(field == "VISIT_TYPE"){name = "Tipo de visita";}
	else if(field == "VISIT_ACTIVITY"){name = "Actividad Visita";}
	else if(field == "VISIT_CLASS_DATE"){name = "Fecha de clase";}
	else if(field == "VISIT_CLASS_INI_TIME"){name = "Hora inicio clase";}
	else if(field == "VISIT_CLASS_COORD"){name = "Coordenada clase";}
	else if(field == "VISIT_COORD"){name = "Coordenadas de visita";}
	else if(field == "VISIT_ASSISTQTY"){name = "Asistentes";}
	else if(field == "VISIT_NOASSISTQTY"){name = "Ausentes";}
	else if(field == "VISIT_STONTIME"){name = "Se realiza a tiempo";}
	else if(field == "VISIT_TOOLS"){name = "Las herramientas son adecuadas";}
	else if(field == "VISIT_GOODTIME"){name = "El horario es adecuado";}
	else if(field == "VISIT_GOODPLACE"){name = "El sitio es adecuado";}
	else if(field == "VISIT_FORMAT"){name = "El formato es adecuado";}
	else if(field == "VISIT_PDELIVER"){name = "Entrega de plan de clase";}
	else if(field == "VISIT_COHERENT"){name = "Coherente con el plan";}
	else if(field == "VISIT_EASY"){name = "Facilita el cumplimiento";}
	else if(field == "VISIT_ORIENT"){name = "Buena orientación";}
	else if(field == "VISIT_EXPRESSION"){name = "Buena expresión";}
	else if(field == "VISIT_PRESENT"){name = "Buena presentación";}
	else if(field == "VISIT_VERIFIED"){name = "Verifica asistencia";}
	else if(field == "VISIT_ACOMPLISH"){name = "Cumple objetivos";}
	else if(field == "VISIT_CONTRATIST"){name = "Datos del contratista";}
	else if(field == "VISIT_VISITOR"){name = "Datos del visitante";}
	else if(field == "VISIT_GROUP_NAME"){name = "Nombre de grupo";}
	else if(field == "VISIT_HOOD"){name = "Barrio/Vereda";}
	else if(field == "VISIT_ADDRESS"){name = "Dirección clase";}
	else if(field == "VISIT_MODE"){name = "Modalidad";}
	else if(field == "VISIT_COMMENTS"){name = "Observaciones";}
	
	
	return name;
}

function getActualViewData(field)
{
	var original = actualViewData[field];
	var string = "";
	
	// console.log(original)
	
	if(field == "EVENT_ENTITY")
	{var thearray = JSON.stringify([original]);string = getFriendDescs(thearray,"entities");}
	else if(field == "EVENT_STATUS"){string = reqStatesDictionary["s"+original];}
	else if(field == "EVENT_INSTITUTE" || field == "GROUP_INSTITUTE")
	{var thearray = JSON.stringify([original]);string = getFriendDescs(thearray,"institutes");}
	else if(field == "EVENT_REQUEST_ACTIVITY" && original != "" && original != null)
	{var thearray = JSON.stringify([original]);string = getFriendDescs(thearray,"activities");}
	else if(field == "EVENT_HOOD")
	{
		var thearray = JSON.stringify([original]);
		string = getFriendDescs(thearray,"hoods");
	}
	else if(field == "EVENT_ACTIVITIES" && original != "" && original != null)
	{string = getFriendDescs(original,"activities");}
	
	else if(field == "EVENT_NEEDS" && original != "" && original != null)
	{
		original = original.replaceAll("Animaciu00f3n", "Animación");
		var list = JSON.parse(original);
		var tempString = "";
		for(var i=0; i<list.length; i++)
		{
			var item = list[i];
			if(i != list.length-1)
			{var tempString = tempString+item["NEED_DESC"]+"-> Solicitado: "+item["NEED_NEED"]+" Gestionado: "+item["NEED_GOT"]+"<br>";}
			else
			{var tempString = tempString+item["NEED_DESC"]+"-> Solicitado: "+item["NEED_NEED"]+" Gestionado: "+item["NEED_GOT"];}
		}
		string = tempString;
	}
	else if(field == "EVENT_SUPPORT_TEAM" && original != "" && original != null)
	{
		var list = JSON.parse(original);
		var tempString = "";
		for(var i=0; i<list.length; i++)
		{
			var item = list[i];
			
			
			// GET ACTIVITIES
			if(item["SUPPORT_ACTIVITIES"] != "" && item["SUPPORT_ACTIVITIES"] != null)
			{var tmpActis = getFriendDescs(JSON.stringify(item["SUPPORT_ACTIVITIES"]),"activities");}

			
			if(i != list.length-1)
			{var tempString = tempString+"Nombre: "+item["SUPPORT_OWNER_NAME"]+" Contrato: "+item["SUPPORT_CONTRACT_NUMBER"]+" Tipo: "+item["SUPPORT_USERTYPE"]+"<br> Actividades de apoyo:<br> "+tmpActis+"<br>";}
			else
				{var tempString = tempString+"Nombre: "+item["SUPPORT_OWNER_NAME"]+" Contrato: "+item["SUPPORT_CONTRACT_NUMBER"]+" Tipo: "+item["SUPPORT_USERTYPE"]+"<br> Actividades de apoyo:<br> "+tmpActis;}
		}
		string = tempString;
	}
	else if(field == "EVENT_ASSIST" && original != "" && original != null)
	{
		original = original.replaceAll("INDu00cdGENA", "INDÍGENA");
		var list = JSON.parse(original);
		var tempString = "";
		for(var i=0; i<list.length; i++)
		{
			var item = list[i];
			
			if(i != list.length-1)
			{var tempString = tempString+item["ASSIST_DESC"]+": "+item["ASSIST_VALUE"]+"<br>";}
			else
			{var tempString = tempString+item["ASSIST_DESC"]+": "+item["ASSIST_VALUE"];}
		}
		string = tempString;
	}
	else if(field == "VISIT_ENTITY")
	{var thearray = JSON.stringify([original]);string = getFriendDescs(thearray,"entities");}
	else if(field == "EVENT_STATUS"){string = reqStatesDictionary["s"+original];}
	else if(field == "VISIT_ACTIVITY" && original != "" && original != null)
	{var thearray = JSON.stringify([original]);string = getFriendDescs(thearray,"activities");}
	else if(field == "VISIT_HOOD")
	{
		var thearray = JSON.stringify([original]);
		var hood = getFriendDescs(thearray,"hoods");
		string = hood+" - "+getZoneFromHood(original);
	}
	
	
	
	else{string = original}
	
	return string;
	
}

function addDays(date, days) 
{
  var result = new Date(date);
  result.setDate(result.getDate() + days);
  return result;
}

// GENERAL EDIT METHOD
// GENERAL EDIT METHOD
// GENERAL EDIT METHOD
// GENERAL EDIT METHOD
// GENERAL EDIT METHOD
function editDataForm(type)
{
	var formTitle = document.getElementById("popFormTitle");
	var popFormFieldBox = document.getElementById("popFormFieldBox");
	popFormFieldBox.innerHTML = "";
	var saveButton = document.getElementById("popFormSaveButton");
	saveButton.style.display = "initial";
	
	imfoo = type;
	console.log(imfoo)
	actualMT = "2";
	
	if(type == "profile")
	{
		// LOAD FORM
		loadForm("profile");
		
		userEditing = 1;

		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", userData);
		
		// SET PICTURE
		if(userData.USER_PIC != "")
		{document.getElementById("USER_PIC").src = userData.USER_PIC;}
		actualCroppedPic = userData.USER_PIC;
		
		// SET FAKE PASSWD
		document.getElementById("USER_PASS").value = "******";
		document.getElementById("USER_PASS2").value = "******";
		
		// DISABLE EDIT ENTITY AND EMAIL
		if(userData.USER_CTYPE != "Superior")
		{
			document.getElementById("USER_ENTITY").disabled = true;
			document.getElementById("USER_EMAIL").disabled = true;
		}
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Perfil de usuario";
		saveButton.onclick = function (){saveUdata('1');}
		
		// ADD DIRECT CONTRACT ACCESS IF CONTRAACTIVE
		var utype = userData.USER_CTYPE;
		console.log(utype)
		
		if(utype == "Coordinador" || utype == "Director" || utype == "Cogestor" || utype == "Instructor" || utype == "Reportes" || utype == "Visitador")
		{
			console.log("get my contract");	
			
			getUserContract()
		}
		
		// SET TITLE AND SAVE FUNCTION
		if(userData.USER_CALLER == "1")
		{
			formTitle.innerHTML = "Perfil de usuario llamadas";
			document.getElementById("USER_CALLER_GOAL_BOX").style.display = "initial";
			document.getElementById("USER_CALLER_ENDATE_BOX").style.display = "initial";
			document.getElementById("USER_CALLER_GOAL").disabled = true;
			document.getElementById("USER_CALLER_ENDATE").disabled = true;
			
		}
		else
		{
			formTitle.innerHTML = "Perfil de usuario";
		}
		
		saveButton.onclick = function (){saveUdata('1');}
		

	}
	if(type == "contract")
	{
		var bypass = 0;
		if(lockRequest == "1")
		{ lockRequest = "0"; bypass = 1;}
		
		// LOAD FORM
		loadForm("contract");
		
		if(bypass == 1)
		{lockRequest = "1"}
		
		
		contractEdit = 1;
		
		console.log("Estado contrato: "+actualEditData.CONTRACT_STATE);
		
		// FILL USER DATA HEADER
		var line = document.getElementById("formHeaderLine");
		
		line.innerHTML = 
		"<b>Solicitante:</b> "+actualEditData.CONTRACT_REQUESTER_NAME+"<br>"+
		"<b>Documento de identidad:</b> "+actualEditData.CONTRACT_REQUESTER_ID+"<br>"+
		"<b>Teléfono:</b> "+actualEditData.CONTRACT_REQUESTER_PHONE;
		
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		// FIRE FIELDS PICKER
		document.getElementById("CONTRACT_USERTYPE").onchange();
		
		// LOCK CONTRACT TYPE 
		document.getElementById("CONTRACT_REQTYPE").disabled = true;
		
		var locked = "0";
		
		// LOCK CONTRACT IF FORTALECIMIENTO
		if(actualEditData.CONTRACT_STATE == "4" && userData.USER_CTYPE == "Principal3")
		{
			var locked = "0";
			document.getElementById("CONTRACT_REQTYPE").disabled = true;
			document.getElementById("CONTRACT_USERTYPE").disabled = true;
			
		}
		
		// FILL AND LOCK MULTIPICKERS
		
		var singlePicker = "1";
		var allActivities = activities;
				
		var clistP = JSON.parse(actualEditData.CONTRACT_PROGRAM);
		// SET MULTIPICKER PROGRAM
		multiSelectFillerDic("CONTRACT_PROGRAM", "PROGRAM_CODE", "PROGRAM_NAME", programs, clistP,singlePicker,locked);
		
		var clistZ = JSON.parse(actualEditData.CONTRACT_ZONES);
		// SET MULTIPICKER ZONES
		multiSelectFillerDic("CONTRACT_ZONES", "ZONE_CODE", "ZONE_NAME", zones, clistZ, singlePicker,locked);
		
		if(actualEditData.CONTRACT_USERTYPE == "Cogestor")
		{
			var myActis = [];
		
			// SHOW ONLY COG SELECTED
			for(var i=0; i<activities.length; i++)
			{
				var item = activities[i];
				if(item.ACTIVITY_COG == "1")
				{myActis.push(item);}
			}
			// allActivities = myActis;
			
			singlePicker = "1";
		}

		// SET MULTIPICKER ACTIVITIES
		var clistA = JSON.parse(actualEditData.CONTRACT_ACTIVITIES);
		multiSelectFillerDicF("CONTRACT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_NAME", allActivities, clistA, singlePicker,locked);

		// SET TITLE 

		if(actualEditData.CONTRACT_STATE == "4")
		{formTitle.innerHTML = "Detalle de contrato aprobado";}
		
		// SET SAVE FUNCTION
		saveButton.onclick = function ()
		{saveContract(1);}
		saveButton.innerHTML = "Guardar";
		
		// ADD GOALS BLOCK
		addGoalsBlock();
		
		var CONTRACT_CANREM = fieldCreator([12,4,4,6], "Puede crear atenciones", "select", "select", "CONTRACT_CANREM");
		var CONTRACT_CANREM_GET = fieldCreator([12,4,4,6], "Puede atender", "select", "select", "CONTRACT_CANREM_GET");
		
		var popFormFieldBox = document.getElementById("popFormFieldBox");
		
		popFormFieldBox.appendChild(CONTRACT_CANREM);
		popFormFieldBox.appendChild(CONTRACT_CANREM_GET);
		
		var options = ["Si", "No"];
		selectFiller("CONTRACT_CANREM", "Seleccione", options);
		selectFiller("CONTRACT_CANREM_GET", "Seleccione", options);
		
		
		document.getElementById("CONTRACT_CANREM").onchange = function ()
		{
			var pick = this.value;
			if(pick == "No")
			{
				document.getElementById("CONTRACT_CANREM_GET").value = "No";
				document.getElementById("CONTRACT_CANREM_GET").disabled = true;
			}
			else
			{
				document.getElementById("CONTRACT_CANREM_GET").value = "";
				document.getElementById("CONTRACT_CANREM_GET").disabled = false;
			}
		}
		
		if(document.getElementById("CONTRACT_CANREM"))
		{
			document.getElementById("CONTRACT_CANREM").value = actualEditData.CONTRACT_CANREM;
			document.getElementById("CONTRACT_CANREM").onchange();
			document.getElementById("CONTRACT_CANREM_GET").value = actualEditData.CONTRACT_CANREM_GET;
			
		}
		
		
		// HIDE FOR EDIT
		
		// document.getElementById("CONTRACT_CANREM_BOX").style.display = "none";
		// document.getElementById("CONTRACT_CANREM_GET_BOX").style.display = "none";


	}
	if(type == "user")
	{
		
		// LOAD FORM
		loadForm("user");
		
		userEditing = 0;
		
		if(actualEditData.USER_TYPE == "General")
		{
			// FILL SPECIAL TYPES
			var options = [{"TYPE":"General", "DESC": "General"}];
			selectFiller("USER_TYPE", "Seleccione tipo", options, "TYPE", "DESC");
		}
		if(actualEditData.USER_TYPE == "Superior")
		{
			// FILL SPECIAL TYPES
			var options = [{"TYPE":"Superior", "DESC": "Super Administrador"}];
			selectFiller("USER_TYPE", "Seleccione tipo", options, "TYPE", "DESC");
		}
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		// LOCK ENTITY IF NOT SUPER ADMIN
		if(userData.USER_CTYPE != "Superior")
		{document.getElementById("USER_ENTITY").disabled = true;}
		
		// SET FAKE PASSWD
		document.getElementById("USER_PASS").value = "******";
		document.getElementById("USER_PASS2").value = "******";
		
		// DISABLE EDIT EMAIL
		// document.getElementById("USER_EMAIL").disabled = true;
		
		// SET TITLE AND SAVE FUNCTION
		if(actualEditData.USER_CALLER == "1")
		{
			formTitle.innerHTML = "Perfil de usuario llamadas";
			document.getElementById("USER_CALLER_GOAL_BOX").style.display = "initial";
			document.getElementById("USER_CALLER_ENDATE_BOX").style.display = "initial";
			
			if(userData.USER_CODE == actualEditData.USER_CODE)
			{
				document.getElementById("USER_CALLER_GOAL").disabled = true;
				document.getElementById("USER_CALLER_ENDATE").disabled = true;
			}
		}
		else
		{
			formTitle.innerHTML = "Perfil de usuario";
		}
		
		actualCroppedPic = actualEditData.USER_PIC;
		
		saveButton.onclick = function (){saveUdata('1');}

	}
	if(type == "aprobe")
	{
		var bypass = 0;
		if(lockRequest == "1")
		{ lockRequest = "0"; bypass = 1;}
		
		// LOAD FORM
		loadForm("contract");
		
		if(bypass == 1)
		{lockRequest = "1"}
		
		// FILL USER DATA HEADER
		var line = document.getElementById("formHeaderLine");
		
		line.innerHTML = 
		"<b>Solicitante:</b> "+actualEditData.CONTRACT_REQUESTER_NAME+"<br>"+
		"<b>Documento de identidad:</b> "+actualEditData.CONTRACT_REQUESTER_ID+"<br>"+
		"<b>Teléfono:</b> "+actualEditData.CONTRACT_REQUESTER_PHONE;
		
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		// FIRE FIELDS PICKER
		document.getElementById("CONTRACT_USERTYPE").onchange();
		
		// LOCK TYPE AND USERTYPE
		document.getElementById("CONTRACT_REQTYPE").disabled = true;
		document.getElementById("CONTRACT_USERTYPE").disabled = true;
		
		// LOCK CONTRACT IF CESION
		if(actualEditData.CONTRACT_STATE == "4")
		{
			document.getElementById("CONTRACT_NUMBER").disabled = true;
			document.getElementById("CONTRACT_INIDATE").disabled = true;
			document.getElementById("CONTRACT_ENDATE").disabled = true;
		}
		
		// FILL AND LOCK MULTIPICKERS
		var locked = "1";
		var singlePicker = "1";
		var allActivities = activities;
				
		var clistP = JSON.parse(actualEditData.CONTRACT_PROGRAM);
		// SET MULTIPICKER PROGRAM
		multiSelectFillerDic("CONTRACT_PROGRAM", "PROGRAM_CODE", "PROGRAM_NAME", programs, clistP,singlePicker,locked);
		
		var clistZ = JSON.parse(actualEditData.CONTRACT_ZONES);
		// SET MULTIPICKER ZONES
		multiSelectFillerDic("CONTRACT_ZONES", "ZONE_CODE", "ZONE_NAME", zones, clistZ, singlePicker,locked);
		
		if(actualEditData.CONTRACT_USERTYPE == "Cogestor")
		{
			var myActis = [];
		
			// SHOW ONLY COG SELECTED
			for(var i=0; i<activities.length; i++)
			{
				var item = activities[i];
				if(item.ACTIVITY_COG == "1")
				{myActis.push(item);}
			}
			// allActivities = myActis;
			
			singlePicker = "1";
		}

		// SET MULTIPICKER ACTIVITIES
		var clistA = JSON.parse(actualEditData.CONTRACT_ACTIVITIES);
		multiSelectFillerDicF("CONTRACT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_NAME", allActivities, clistA, singlePicker,locked);

		// SET TITLE 
		if(actualEditData.CONTRACT_STATE == "2")
		{
			formTitle.innerHTML = "Aprobación de contrato";
		}
		if(actualEditData.CONTRACT_CESION_STATE == "2")
		{
			formTitle.innerHTML = "Aprobación cesión de contrato";
		}
		
		// SET SAVE FUNCTION
		saveButton.onclick = function ()
		{
			var params = ["",""];
			
			if(actualEditData.CONTRACT_STATE == "2")
			{
				var question = "¿Desea aprobar el contrato ";
			}
			else
			{
				var question = "¿Desea aprobar la cesión del contrato ";
			}
			
			var contractNumber = document.getElementById("CONTRACT_NUMBER").value;
			confirmBox(language["confirm"], question + contractNumber +"?",aprobeContract, params);
		}
		saveButton.innerHTML = "Aprobar";
		
		var CONTRACT_CANREM = fieldCreator([12,4,4,6], "Puede crear atenciones", "select", "select", "CONTRACT_CANREM");
		var CONTRACT_CANREM_GET = fieldCreator([12,4,4,6], "Puede atender", "select", "select", "CONTRACT_CANREM_GET");
		
		var popFormFieldBox = document.getElementById("popFormFieldBox");
		
		popFormFieldBox.appendChild(CONTRACT_CANREM);
		popFormFieldBox.appendChild(CONTRACT_CANREM_GET);
		
		var options = ["Si", "No"];
		selectFiller("CONTRACT_CANREM", "Seleccione", options);
		selectFiller("CONTRACT_CANREM_GET", "Seleccione", options);
		
		
		document.getElementById("CONTRACT_CANREM").onchange = function ()
		{
			var pick = this.value;
			if(pick == "No")
			{
				document.getElementById("CONTRACT_CANREM_GET").value = "No";
				document.getElementById("CONTRACT_CANREM_GET").disabled = true;
			}
			else
			{
				document.getElementById("CONTRACT_CANREM_GET").value = "";
				document.getElementById("CONTRACT_CANREM_GET").disabled = false;
			}
		}
		
		document.getElementById("CONTRACT_CANREM").value = "No";
		document.getElementById("CONTRACT_CANREM").onchange();
		
		// ADD GOALS BLOCK
		addGoalsBlock();

	}
	if(type == "program")
	{
		// LOAD FORM
		loadForm("program");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveProgram("1");}
		
		formTitle.innerHTML = "Edición de programa";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "project")
	{
		// LOAD FORM
		loadForm("project");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		document.getElementById("PROJECT_ENTITY").onchange();
		formEditFiller("popFormFieldBox", actualEditData);
		
		console.log("proy")
		
		saveButton.onclick = function ()
		{saveProject("1");}
		
		formTitle.innerHTML = "Edición de proyecto";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "activity")
	{
		// LOAD FORM
		loadForm("activity");
		
		
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		document.getElementById("ACTIVITY_ENTITY").onchange();
		formEditFiller("popFormFieldBox", actualEditData);
		
		
		saveButton.onclick = function ()
		{saveActivity("1");}
		formTitle.innerHTML = "Edición de actividad";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "entity")
	{
		// LOAD FORM
		loadForm("entity");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveEntity("1");}
		formTitle.innerHTML = "Edición de entidad";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "zone")
	{
		// LOAD FORM
		loadForm("zone");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveZone("1");}
		formTitle.innerHTML = "Edición de comuna o corregimiento";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "hood")
	{
		// LOAD FORM
		loadForm("hood");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		document.getElementById("HOOD_ZONE").onchange();
		
		saveButton.onclick = function ()
		{saveHood("1");}
		formTitle.innerHTML = "Edición de barrio o vereda";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "condition")
	{
		// LOAD FORM
		loadForm("condition");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveCondition("1");}
		
		formTitle.innerHTML = "Edición de Condición";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "etnia")
	{
		// LOAD FORM
		loadForm("etnia");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveEtnia("1");}
		
		formTitle.innerHTML = "Edición de etnia";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "citizen")
	{
		// LOAD FORM
		loadForm("citizen");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		console.log(actualEditData)
		
		// SET MULTIPICKER CONDITIONS
		var clistC = JSON.parse(actualEditData.CITIZEN_CONDITION);
		multiSelectFillerDic("CITIZEN_CONDITION", "CONDITION_CODE", "CONDITION_NAME", conditions, clistC, "1",locked);
		
		// LOAD CITY, ZONE AND HOOD VALUES
		
		document.getElementById("SEARCH_BUTTON_CITIZEN_CITY").innerHTML = actualEditData.CITIZEN_CITY;
		document.getElementById("SEARCH_BUTTON_CITIZEN_CITY").pickedCode = actualEditData.CITIZEN_CITY;

		var thearray = JSON.stringify([actualEditData.CITIZEN_ETNIA_IND]);
		var tipoin = getFriendDescs(thearray,"tipoin");
		document.getElementById("SEARCH_BUTTON_CITIZEN_ETNIA_IND").innerHTML = tipoin;
		document.getElementById("SEARCH_BUTTON_CITIZEN_ETNIA_IND").pickedCode = actualEditData.CITIZEN_ETNIA_IND;
		
		// RELOAD SEARCH
		
		if(document.getElementById("span-"+actualEditData.CITIZEN_CITY))
		{
			document.getElementById("span-"+actualEditData.CITIZEN_CITY).onclick();
			document.getElementById("span-"+actualEditData.CITIZEN_CITY).onclick();
		}

		var thearray = JSON.stringify([actualEditData.CITIZEN_ZONE]);
		var zone = getFriendDescs(thearray,"zones");
		document.getElementById("SEARCH_BUTTON_CITIZEN_ZONE").innerHTML = zone;
		document.getElementById("SEARCH_BUTTON_CITIZEN_ZONE").pickedCode = actualEditData.CITIZEN_ZONE;
		
		
		if(document.getElementById("span-"+actualEditData.CITIZEN_ZONE))
		{
			document.getElementById("span-"+actualEditData.CITIZEN_ZONE).onclick();
			document.getElementById("span-"+actualEditData.CITIZEN_ZONE).onclick();
		}
		
		
		// GET HOODNAME FROM CODE
		var thearray = JSON.stringify([actualEditData.CITIZEN_HOOD]);
		var hood = getFriendDescs(thearray,"hoods");
		document.getElementById("SEARCH_BUTTON_CITIZEN_HOOD").innerHTML = hood;
		document.getElementById("SEARCH_BUTTON_CITIZEN_HOOD").pickedCode = actualEditData.CITIZEN_HOOD;

		var country = actualEditData.CITIZEN_ORIGIN_COUNTRY;
		document.getElementById("SEARCH_BUTTON_CITIZEN_ORIGIN_COUNTRY").innerHTML = country;
		document.getElementById("SEARCH_BUTTON_CITIZEN_ORIGIN_COUNTRY").pickedCode = country;
		
		var country = actualEditData.CITIZEN_DESTINY_COUNTRY;
		document.getElementById("SEARCH_BUTTON_CITIZEN_DESTINY_COUNTRY").innerHTML = country;
		document.getElementById("SEARCH_BUTTON_CITIZEN_DESTINY_COUNTRY").pickedCode = country;

		var city = actualEditData.CITIZEN_BIRTH_CITY;
		document.getElementById("SEARCH_BUTTON_CITIZEN_BIRTH_CITY").innerHTML = city;
		document.getElementById("SEARCH_BUTTON_CITIZEN_BIRTH_CITY").pickedCode = city;

		var thearray = JSON.stringify([actualEditData.CITIZEN_EPS]);
		var eps = getFriendDescs(thearray,"eps");
		document.getElementById("SEARCH_BUTTON_CITIZEN_EPS").innerHTML = eps;
		document.getElementById("SEARCH_BUTTON_CITIZEN_EPS").pickedCode = actualEditData.CITIZEN_EPS;
		
		console.log(actualEditData);
		
		var thearray = JSON.stringify([actualEditData.CITIZEN_PATOEN]);
		var patoen = getFriendDescs(thearray,"patoen");
		console.log(patoen);
		document.getElementById("SEARCH_BUTTON_CITIZEN_PATOEN").innerHTML = patoen;
		document.getElementById("SEARCH_BUTTON_CITIZEN_PATOEN").pickedCode = actualEditData.CITIZEN_PATOEN;

		// SET MULTIPICKER RISKFA
		var clistC = JSON.parse(actualEditData.CITIZEN_RISKFA);
		multiSelectFillerDic("CITIZEN_RISKFA", "RISKFA_CODE", "RISKFA_NAME", riskfa, clistC, "1",locked);

		// SET MULTIPICKER PREVFA
		var clistC = JSON.parse(actualEditData.CITIZEN_PREVFA);
		multiSelectFillerDic("CITIZEN_PREVFA", "PREVFA_CODE", "PREVFA_NAME", prevfa, clistC, "1",locked);

		var thearray = JSON.stringify([actualEditData.CITIZEN_INSTITUTE]);
		var institute = getFriendDescs(thearray,"institutes");
		document.getElementById("SEARCH_BUTTON_CITIZEN_INSTITUTE").innerHTML = institute;
		document.getElementById("SEARCH_BUTTON_CITIZEN_INSTITUTE").pickedCode = actualEditData.CITIZEN_INSTITUTE;

		
		saveButton.onclick = function ()
		{saveCitizen("1");}
		
		if(citizenOrigin == "g")
		{
			formTitle.innerHTML = "Agregar ciudadano a grupo";
			saveButton.innerHTML = "Agregar";
		}
		else if(citizenOrigin == "cl")
		{
			formTitle.innerHTML = "Agregar ciudadano a clase";
			saveButton.innerHTML = "Agregar";
		}
		else if(citizenOrigin == "rem")
		{
			formTitle.innerHTML = "Atención de ciudadano existente";
			saveButton.innerHTML = "Atender";
		}
		else
		{
			var ctype = userData.USER_CTYPE;
			if(ctype == "Principal1" || ctype == "Principal2" || ctype == "Principal3" || ctype == "Superior")
			{
				formTitle.innerHTML = "Edición de ciudadano "+"<span class='loadCitRem' onclick='idChange()'>Cambiar Id.</span>";
			}
			else
			{
				formTitle.innerHTML = "Edición de ciudadano";
			}
			saveButton.innerHTML = "Guardar";
			
			if(document.getElementById("condCheck"))
			{document.getElementById("condCheck").checked = true;}
			
		}
		
		document.getElementById("CITIZEN_ETNIA").onchange();
		
		if(document.getElementById("condCheck")){document.getElementById("condCheck").checked = true;}
		
		
	}
	if(type == "group")
	{
		// LOAD FORM
		loadForm("group");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		// HIDE/SHOW FIELDS
		document.getElementById("GROUP_PREVIR").onchange();
		document.getElementById("GROUP_SERVPLACE").onchange();
		
		
		// GET INSTITUTE FROM CODE
		var thearray = JSON.stringify([actualEditData.GROUP_INSTITUTE]);
		var institute = getFriendDescs(thearray,"institutes");
		document.getElementById("SEARCH_BUTTON_GROUP_INSTITUTE").innerHTML = institute;
		document.getElementById("SEARCH_BUTTON_GROUP_INSTITUTE").pickedCode = actualEditData.GROUP_INSTITUTE;
		
		document.getElementById("GROUP_ADDRESS").value = actualEditData.GROUP_ADDRESS;
		document.getElementById("GROUP_COORDS").value = actualEditData.GROUP_COORDS;
		
		
		// GET PROJECT FROM ACTI
		
		var actiCode = actualEditData.GROUP_ACTIVITY;
		for(var p=0; p<activities.length; p++)
		{
			if(actiCode == activities[p].ACTIVITY_CODE)
			{var project = activities[p].ACTIVITY_PROJECT; break;}
		}
		
		// GET PROGRAM FROM PROJECT
		
		for(var p=0; p<projects.length; p++)
		{
			if(project == projects[p].PROJECT_CODE)
			{var program = projects[p].PROJECT_PROGRAM; break;}
		}

		var thearray = JSON.stringify([program]);
		var programDesc = getFriendDescs(thearray,"programs");
		document.getElementById("SEARCH_BUTTON_GROUP_PROGRAM").innerHTML = programDesc;
		document.getElementById("SEARCH_BUTTON_GROUP_PROGRAM").pickedCode = program;
		document.getElementById("span-"+program).onclick();
		document.getElementById("span-"+program).onclick();
		
		var thearray = JSON.stringify([project]);
		var projectDesc = getFriendDescs(thearray,"projects");
		document.getElementById("SEARCH_BUTTON_GROUP_PROJECT").innerHTML = projectDesc;
		document.getElementById("SEARCH_BUTTON_GROUP_PROJECT").pickedCode = project;
		document.getElementById("span-"+project).onclick();
		document.getElementById("span-"+project).onclick();
		
		
		// GET ACTY FROM CODE
		var thearray = JSON.stringify([actualEditData.GROUP_ACTIVITY]);
		var activity = getFriendDescs(thearray,"activities");
		document.getElementById("SEARCH_BUTTON_GROUP_ACTIVITY").innerHTML = activity;
		document.getElementById("SEARCH_BUTTON_GROUP_ACTIVITY").pickedCode = actualEditData.GROUP_ACTIVITY;
		
		
		// GET HOODNAME FROM CODE
		var thearray = JSON.stringify([actualEditData.GROUP_HOOD]);
		var hood = getFriendDescs(thearray,"hoods");
		document.getElementById("SEARCH_BUTTON_GROUP_HOOD").innerHTML = hood;
		document.getElementById("SEARCH_BUTTON_GROUP_HOOD").pickedCode = actualEditData.GROUP_HOOD;
		

		
		
		var ctype = userData.USER_CTYPE;
		
		if(ctype != "Principal1" && ctype != "Principal2" && ctype != "Principal3" && ctype != "Superior")
		{
			document.getElementById("GROUP_PROCESS").disabled = true;
		}
		
		
		saveButton.onclick = function ()
		{saveGroup("1");}
		
		formTitle.innerHTML = "Edición de grupo";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "assign")
	{
		// LOAD FORM
		loadForm("assign");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);

		// HIDE/SHOW FIELDS
		document.getElementById("CONTRACT_LIST").value = actualEditData.GROUP_CONTRACT;
		
		document.getElementById("CONTRACT_LIST").onchange();
		document.getElementById("CONTRACT_LIST").disabled = true;
		
		saveButton.onclick = function ()
		{saveAssignation("0");}
		
		formTitle.innerHTML = "Edición de asignación";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "etarie")
	{
		// LOAD FORM
		loadForm("etarie");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
	
		saveButton.onclick = function ()
		{saveEtarie("1");}
		
		formTitle.innerHTML = "Edición de ciclo etario";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "institute")
	{
		// LOAD FORM
		loadForm("institute");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		var cityPicker = document.getElementById("INSTITUTE_CITY");
		cityPicker.onchange();
		
		var zonePicker = document.getElementById("INSTITUTE_ZONE");
		zonePicker.value = actualEditData.INSTITUTE_ZONE;
		zonePicker.onchange();
		

		// GET HOODNAME FROM CODE
		var thearray = JSON.stringify([actualEditData.INSTITUTE_HOOD]);
		var hood = getFriendDescs(thearray,"hoods");
		document.getElementById("SEARCH_BUTTON_INSTITUTE_HOOD").innerHTML = hood;
		document.getElementById("SEARCH_BUTTON_INSTITUTE_HOOD").pickedCode = actualEditData.INSTITUTE_HOOD;
	
		saveButton.onclick = function ()
		{saveInstitute("1");}
		
		formTitle.innerHTML = "Edición de institución";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "event")
	{
		// LOAD FORM
		loadForm("event");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		// PREFILTER USER ACTIVITIES
		// PREFILTER USER ACTIVITIES
		
		var clistA = JSON.parse(actualEditData.EVENT_ACTIVITIES);
		// SET MULTIPICKER ZONES
		
		if(viewMode == "1")
		{var locked = "1";}
		else
		{var locked = "0";}
		
		multiSelectFillerDic("EVENT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_NAME", actualEventActivities, clistA, locked,0);
		
		document.getElementById("EVENT_SERVPLACE").onchange();
		document.getElementById("EVENT_PREVIR").onchange();
		
		
		// GET INSTITUTE FROM CODE
		var thearray = JSON.stringify([actualEditData.EVENT_INSTITUTE]);
		var institute = getFriendDescs(thearray,"institutes");
		document.getElementById("SEARCH_BUTTON_EVENT_INSTITUTE").innerHTML = institute;
		document.getElementById("SEARCH_BUTTON_EVENT_INSTITUTE").pickedCode = actualEditData.EVENT_INSTITUTE;
		
		// GET HOODNAME FROM CODE
		var thearray = JSON.stringify([actualEditData.EVENT_HOOD]);
		var hood = getFriendDescs(thearray,"hoods");
		document.getElementById("SEARCH_BUTTON_EVENT_HOOD").innerHTML = hood;
		document.getElementById("SEARCH_BUTTON_EVENT_HOOD").pickedCode = actualEditData.EVENT_HOOD;
		
		document.getElementById("loadAssistFormatLink").innerHTML = "Reemplazar archivo de conteo";
		document.getElementById("loadEventPicLink").innerHTML = "Reemplazar foto del evento";
		
		actualAssistForm = actualEditData.EVENT_SHEET;
		actualEventPic = actualEditData.EVENT_PIC;
		
		actualSupportList = JSON.parse(actualEditData.EVENT_SUPPORT_TEAM);
		tableCreator("wp_events_support", actualSupportList);
		
		actualAssistList = JSON.parse(actualEditData.EVENT_ASSIST);
		tableCreator("wp_events_assist", actualAssistList);
		
		saveButton.onclick = function (){saveEvent("1");}
		
		formTitle.innerHTML = "Edición de evento";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "eventR")
	{
		// LOAD FORM
		loadForm("eventR");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
				
		// PREFILTER USER ACTIVITIES
		// PREFILTER USER ACTIVITIES
		
		if(actualEditData.EVENT_OWNER == null)
		{
			document.getElementById("EVENT_OWNER").value = "";
			document.getElementById("SEARCH_BUTTON_EVENT_OWNER").innerHTML = "";
			document.getElementById("SEARCH_BUTTON_EVENT_OWNER").pickedCode = "";
			
			
		}
		else
		{
		
			// GET OWNER NAME FROM CODE
			for(var i=0; i<avaRequestContracts.length; i++)
			{
				var item = avaRequestContracts[i];
				if(item.CONTRACT_CODE == actualEditData.EVENT_CONTRACT_CODE)
				{actualContractData = item;}
			}
			
			
			ownerPicked = actualContractData.CONTRACT_OWNER;
			
			var owner = actualContractData.FULL_DESC;
			document.getElementById("SEARCH_BUTTON_EVENT_OWNER").innerHTML = owner;
			document.getElementById("SEARCH_BUTTON_EVENT_OWNER").pickedCode = actualEditData.EVENT_OWNER;
			
			var eventGoals = JSON.parse(actualContractData.CONTRACT_EVENT_GOALS)
			var supportActis = [];
			
			for(var i=0; i<eventGoals.length; i++)
			{
				var item = eventGoals[i];
				var supportValue = item.V1;
				
				if(supportValue > 0)
				{
					var act = {};
					act.ACTIVITY_CODE = item.ID;
					act.DIRECT_GOAL = item.V1;
					act.SUPPORT_GOAL = item.V2;

					var thearray = JSON.stringify([act.ACTIVITY_CODE]);
					var activity = getFriendDescs(thearray,"activities");
					
					act.ACTIVITY_NAME = activity;
					supportActis.push(act)
				}
			}
			
			actualRequestEventActivities = supportActis;
			
			// FILL ACTIVITIES
			var clistA = [];
			var singlePicker = "1";
			
			if(viewMode == "1")
			{var locked = "1";}
			else
			{var locked = "0";}
			
			multiSelectFillerDic("EVENT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_NAME", supportActis,clistA,singlePicker,locked);
			
			// CHECK 
			var actualOwner = actualEditData.EVENT_OWNER;
			var newOwner = this.value;
			
			if(actualOwner != newOwner)
			{
				actualSupportList = [];
				tableCreator("wp_events_support", actualSupportList);
			}

			// FILL SUPPORT PICKER
			// ---------------------------------------------------
			// CREATE DESC FIELD
			for(var i=0; i<avaEventContracts.length; i++)
			{
				var contract = avaEventContracts[i];
				var desc = contract.CONTRACT_OWNER_NAME+" Contrato: "+contract.CONTRACT_NUMBER+" Tipo: "+contract.CONTRACT_USERTYPE;
				avaEventContracts[i]["FULL_DESC"] = desc;
			}
			// INDEX BY NAME
			var indexed = sortByKey(avaEventContracts, "FULL_DESC");
			searchListFiller("EVENT_SUPPORT_PICKER", indexed, "FULL_DESC", "CONTRACT_CODE", "Seleccione usuario de apoyo");
			
			
		}

		if(actualEditData.EVENT_ACTIVITIES != null && actualEditData.EVENT_ACTIVITIES != "")
		{
			var clistA = JSON.parse(actualEditData.EVENT_ACTIVITIES);
			// SET MULTIPICKER ZONES
			
			if(viewMode == "1")
			{var locked = "1";}
			else
			{var locked = "0";}
			
			multiSelectFillerDic("EVENT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_NAME", actualRequestEventActivities, clistA, "1",locked);
		}

		document.getElementById("EVENT_SERVPLACE").onchange();
		document.getElementById("EVENT_PREVIR").onchange();
		
		// GET INSTITUTE FROM CODE
		var thearray = JSON.stringify([actualEditData.EVENT_INSTITUTE]);
		var institute = getFriendDescs(thearray,"institutes");
		document.getElementById("SEARCH_BUTTON_EVENT_INSTITUTE").innerHTML = institute;
		document.getElementById("SEARCH_BUTTON_EVENT_INSTITUTE").pickedCode = actualEditData.EVENT_INSTITUTE;
		
		// GET HOODNAME FROM CODE
		var thearray = JSON.stringify([actualEditData.EVENT_HOOD]);
		var hood = getFriendDescs(thearray,"hoods");
		document.getElementById("SEARCH_BUTTON_EVENT_HOOD").innerHTML = hood;
		document.getElementById("SEARCH_BUTTON_EVENT_HOOD").pickedCode = actualEditData.EVENT_HOOD;
		
		// DISABLE HOOD FOR EVENT REQUEST
		document.getElementById("SEARCH_BUTTON_EVENT_HOOD").disabled = true;
		
		actualAssistForm = actualEditData.EVENT_SHEET;
		actualEventPic = actualEditData.EVENT_PIC;
		
		if(requestState == "1")
		{
			
			if(actualEditData.EVENT_SHEET == null || actualEditData.EVENT_SHEET == ""){actualAssistForm = "";}
			else{actualAssistForm = actualEditData.EVENT_SHEET;} 
			
			if(actualEditData.EVENT_PIC == null || actualEditData.EVENT_PIC == ""){actualEventPic = "";}
			else{actualEventPic = actualEditData.EVENT_PIC;} 
			
			// FILL SUPPORT LIST
			if(actualEditData.EVENT_SUPPORT_TEAM == null || actualEditData.EVENT_SUPPORT_TEAM == "")
			{actualSupportList = [];}
			else
			{actualSupportList = JSON.parse(actualEditData.EVENT_SUPPORT_TEAM);}
			tableCreator("wp_events_support", actualSupportList);
			
			saveButton.onclick = function ()
			{saveEventR("1");}
			formTitle.innerHTML = "Gestion de solicitud de evento";
			saveButton.innerHTML = "Guardar";
			
			var pgrmDate = document.getElementById("EVENT_DATE_INIR").value;
			getProgrammedEvents(pgrmDate);
		}
		if(requestState == "2")
		{
			// SET READY FOR CLOSURE LOCK UNABLE FIELDS
			
			if(actualEditData.EVENT_SHEET == null || actualEditData.EVENT_SHEET == ""){actualAssistForm = "";}
			else{actualAssistForm = actualEditData.EVENT_SHEET;} 
			
			if(actualEditData.EVENT_PIC == null || actualEditData.EVENT_PIC == ""){actualEventPic = "";}
			else{actualEventPic = actualEditData.EVENT_PIC;} 
			
			
			// FILL SUPPORT LIST
			if(actualEditData.EVENT_SUPPORT_TEAM == null || actualEditData.EVENT_SUPPORT_TEAM == "")
			{actualSupportList = [];}
			else
			{actualSupportList = JSON.parse(actualEditData.EVENT_SUPPORT_TEAM);}
			tableCreator("wp_events_support", actualSupportList);
			
			// LLENAR ASISTENCIA DESDE GUARDADO SI EXISTE
			if(actualEditData.EVENT_ASSIST == null || actualEditData.EVENT_ASSIST == "")
			{loadDefaultAssist();}
			else
			{
				actualAssistList = JSON.parse(actualEditData.EVENT_ASSIST);
				tableCreator("wp_events_assist", actualAssistList);
			}
			
			saveButton.onclick = function ()
			{saveEventR("1");}
			formTitle.innerHTML = "Edición de gestión de evento por solicitud";
			saveButton.innerHTML = "Guardar";
			
			var pgrmDate = document.getElementById("EVENT_DATE_INIR").value;
			getProgrammedEvents(pgrmDate);
		}
		if(requestState == "4")
		{
			// SET READY FOR CLOSURE LOCK UNABLE FIELDS
			if(actualEditData.EVENT_SHEET == null || actualEditData.EVENT_SHEET == ""){actualAssistForm = "";}
			else{actualAssistForm = actualEditData.EVENT_SHEET;} 
			
			if(actualEditData.EVENT_PIC == null || actualEditData.EVENT_PIC == ""){actualEventPic = "";}
			else{actualEventPic = actualEditData.EVENT_PIC;} 
			
			// FILL SUPPORT LIST
			if(actualEditData.EVENT_SUPPORT_TEAM == null || actualEditData.EVENT_SUPPORT_TEAM == "")
			{actualSupportList = [];}
			else
			{actualSupportList = JSON.parse(actualEditData.EVENT_SUPPORT_TEAM);}
			tableCreator("wp_events_support", actualSupportList);
			
			// LLENAR ASISTENCIA DESDE GUARDADO SI EXISTE
			if(actualEditData.EVENT_ASSIST == null || actualEditData.EVENT_ASSIST == "")
			{loadDefaultAssist();}
			else
			{
				actualAssistList = JSON.parse(actualEditData.EVENT_ASSIST);
				tableCreator("wp_events_assist", actualAssistList);
			}
			
			var assistFormat = actualEditData.EVENT_SHEET;
			var eventPic = actualEditData.EVENT_PIC;
			
			if(assistFormat != null && assistFormat != "")
			{document.getElementById("loadAssistFormatLink").innerHTML = "Reemplazar archivo de conteo";}
			
			if(eventPic != null && eventPic != "")
			{document.getElementById("loadEventPicLink").innerHTML = "Reemplazar foto del evento";}
			
			saveButton.onclick = function ()
			{saveEventR("1");}
			formTitle.innerHTML = "Cierre de evento";
			saveButton.innerHTML = "Guardar";
		}
		
		if(viewMode == "1")
		{formTitle.innerHTML = "Visualización de evento";}
		
		actualNeedsList = JSON.parse(actualEditData.EVENT_NEEDS);
		// console.log(actualNeedsList)
		tableCreator("wp_events_needs", actualNeedsList);
		
		
		
		
		
		
	}
	if(type == "visit")
	{
		// LOAD FORM
		loadForm("visit");
		
		console.log(actualEditData);
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		document.getElementById("VISIT_DONE").onchange();
		
		console.log(actualEditData);
		
		
		
		if(actualEditData.VISIT_CLASS_PLAN)
		{
			actualVisitPlanFile = actualEditData.VISIT_CLASS_PLAN;
		}
		else
		{
			actualVisitPlanFile = "";
		}
		if(actualEditData.VISIT_ASSIST_LIST)
		{
			actualAssistPicFile = actualEditData.VISIT_ASSIST_LIST;
		}
		else
		{
			actualAssistPicFile = "";
		}
		if(actualEditData.VISIT_CLASSPIC)
		{
			actualClassPicFile = actualEditData.VISIT_CLASSPIC;
		}
		else
		{
			actualClassPicFile = "";
		}
		
		
		actualSignCheck = actualEditData.VISIT_SIGNED;

		saveButton.onclick = function ()
		{saveVisit("1");}
		
		formTitle.innerHTML = "Edición de visita";
		saveButton.innerHTML = "Guardar";
	}
	// APROBED CONTRACT DETAIL VIEW ONLY
	if(type == "aprobeD")
	{
		var bypass = 0;
		if(lockRequest == "1")
		{ lockRequest = "0"; bypass = 1;}
		
		// LOAD FORM
		loadForm("contract");
		
		if(bypass == 1)
		{lockRequest = "1"}
		
		console.log(actualEditData)
		
		// FILL USER DATA HEADER
		var line = document.getElementById("formHeaderLine");
		
		line.innerHTML = 
		"<b>Solicitante:</b> "+actualEditData.CONTRACT_REQUESTER_NAME+"<br>"+
		"<b>Documento de identidad:</b> "+actualEditData.CONTRACT_REQUESTER_ID+"<br>"+
		"<b>Teléfono:</b> "+actualEditData.CONTRACT_REQUESTER_PHONE;
		
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		// FIRE FIELDS PICKER
		document.getElementById("CONTRACT_USERTYPE").onchange();
		
		// LOCK TYPE AND USERTYPE
		document.getElementById("CONTRACT_REQTYPE").disabled = true;
		document.getElementById("CONTRACT_USERTYPE").disabled = true;
		
		// LOCK CONTRACT IF CESION
		if(actualEditData.CONTRACT_STATE == "4")
		{
			document.getElementById("CONTRACT_NUMBER").disabled = true;
			document.getElementById("CONTRACT_INIDATE").disabled = true;
			document.getElementById("CONTRACT_ENDATE").disabled = true;
		}
		
		// FILL AND LOCK MULTIPICKERS
		var locked = "1";
		var singlePicker = "1";
		var allActivities = activities;
				
		var clistP = JSON.parse(actualEditData.CONTRACT_PROGRAM);
		// SET MULTIPICKER PROGRAM
		multiSelectFillerDic("CONTRACT_PROGRAM", "PROGRAM_CODE", "PROGRAM_NAME", programs, clistP,singlePicker,locked);
		
		var clistZ = JSON.parse(actualEditData.CONTRACT_ZONES);
		// SET MULTIPICKER ZONES
		multiSelectFillerDic("CONTRACT_ZONES", "ZONE_CODE", "ZONE_NAME", zones, clistZ, singlePicker,locked);
		
		if(actualEditData.CONTRACT_USERTYPE == "Cogestor")
		{
			var myActis = [];
		
			// SHOW ONLY COG SELECTED
			for(var i=0; i<activities.length; i++)
			{
				var item = activities[i];
				if(item.ACTIVITY_COG == "1")
				{myActis.push(item);}
			}
			allActivities = myActis;
			
			singlePicker = "1";
		}

		// SET MULTIPICKER ACTIVITIES
		var clistA = JSON.parse(actualEditData.CONTRACT_ACTIVITIES);
		multiSelectFillerDic("CONTRACT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_NAME", allActivities, clistA, singlePicker,locked);

		// SET TITLE 
		if(actualEditData.CONTRACT_STATE == "4")
		{
			formTitle.innerHTML = "Detalle de contrato aprobado";
			saveButton.style.display = "none";
		}
		
		// SET SAVE FUNCTION
		saveButton.onclick = function ()
		{
			var params = ["",""];
			
			if(actualEditData.CONTRACT_STATE == "2")
			{
				var question = "¿Desea aprobar el contrato ";
			}
			else
			{
				var question = "¿Desea aprobar la cesión del contrato ";
			}
			
			var contractNumber = document.getElementById("CONTRACT_NUMBER").value;
			confirmBox(language["confirm"], question + contractNumber +"?",aprobeContract, params);
		}
		saveButton.innerHTML = "Aprobar";

		// ADD GOALS BLOCK
		addGoalsBlock();

	}
	
	
	// NEW MASTERS
	if(type == "edlevel")
	{
		// LOAD FORM
		loadForm("edlevel");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("edlevel","1");}
		
		formTitle.innerHTML = "Edición de Nivel Educativo";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "ocucond")
	{
		// LOAD FORM
		loadForm("ocucond");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("ocucond","1");}
		
		formTitle.innerHTML = "Edición de Condición Ocupacional";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "trasdes")
	{
		// LOAD FORM
		loadForm("trasdes");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("trasdes","1");}
		
		formTitle.innerHTML = "Edición de Trastorno de Desarrollo";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "tipovi")
	{
		// LOAD FORM
		loadForm("tipovi");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("tipovi","1");}
		
		formTitle.innerHTML = "Edición de Tipo de violencia";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "genre")
	{
		// LOAD FORM
		loadForm("genre");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("genre","1");}
		
		formTitle.innerHTML = "Edición de género";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "eps")
	{
		// LOAD FORM
		loadForm("eps");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("eps","1");}
		
		formTitle.innerHTML = "Edición de EPS";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "riskfa")
	{
		// LOAD FORM
		loadForm("riskfa");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("riskfa","1");}
		
		formTitle.innerHTML = "Edición de factor de riesgo";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "prevfa")
	{
		// LOAD FORM
		loadForm("prevfa");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("prevfa","1");}
		
		formTitle.innerHTML = "Edición de factor preventivo";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "ingrec")
	{
		// LOAD FORM
		loadForm("ingrec");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("ingrec","1");}
		
		formTitle.innerHTML = "Edición de Ingreso Económico";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "convac")
	{
		// LOAD FORM
		loadForm("convac");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("convac","1");}
		
		formTitle.innerHTML = "Edición de Convivencia actual";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "patoen")
	{
		// LOAD FORM
		loadForm("patoen");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("patoen","1");}
		
		formTitle.innerHTML = "Edición de patología enfermedad";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "courses")
	{
		// LOAD FORM
		loadForm("courses");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("courses","1");}
		
		formTitle.innerHTML = "Edición de formación";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "tipoco")
	{
		// LOAD FORM
		loadForm("tipoco");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("tipoco","1");}
		
		formTitle.innerHTML = "Edición de tipo de consumo";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "tiposo")
	{
		// LOAD FORM
		loadForm("tiposo");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("tiposo","1");}
		
		formTitle.innerHTML = "Edición de tipo de solicitante";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "migrea")
	{
		// LOAD FORM
		loadForm("migrea");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("migrea","1");}
		
		formTitle.innerHTML = "Edición de razones migración";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "tipoin")
	{
		// LOAD FORM
		loadForm("tipoin");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function ()
		{saveMaster("tipoin","1");}
		
		formTitle.innerHTML = "Edición de tipo de indígena";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "datedit")
	{
		// LOAD FORM
		loadForm("datedit");
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		saveButton.onclick = function (){editDate();}
		
		formTitle.innerHTML = "Edición de cita";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "component")
	{
		// LOAD FORM
		loadForm("component");
		
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		

		var singlePicker = "1";
		var allActivities = activities;
		var locked = "0";

		// SET MULTIPICKER ACTIVITIES
		var clistA = JSON.parse(actualEditData.COMPONENT_ACTIVITIES);
		multiSelectFillerDicF("COMPONENT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_FULL_NAME", allActivities, clistA, singlePicker,locked);
		
		saveButton.onclick = function (){saveMaster("component","1");}
		
		formTitle.innerHTML = "Edición de componente";
		saveButton.innerHTML = "Guardar";
	}
	if(type == "scomponent")
	{
		// LOAD FORM
		loadForm("scomponent");
		
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		// GET HOODNAME FROM CODE
		var thearray = JSON.stringify([actualEditData.SCOMPONENT_COMPONENT]);
		var component = getFriendDescs(thearray,"components");
		document.getElementById("SEARCH_BUTTON_SCOMPONENT_COMPONENT").innerHTML = component;
		document.getElementById("SEARCH_BUTTON_SCOMPONENT_COMPONENT").pickedCode = actualEditData.SCOMPONENT_COMPONENT;
		
		
		saveButton.onclick = function (){saveMaster("scomponent","1");}
		
		formTitle.innerHTML = "Edición de sub componente";
		saveButton.innerHTML = "Guardar";
	}
	
}

// TABLE REFRESHER
function refreshTable(table, print)
{
	var info = {};
	
	if(print == null){print = "0";}
	
	if(table == "wp_contracts")
	{
		var filters = getFilters();
		filters.USER_CTYPE_F = userData.USER_CTYPE;
		filters.USER_CODE_F = userData.USER_CODE;
		filters.USER_ENTITY_F = userData.USER_ENTITY;
		filters.USER_ACTIVITIES_F = userData.USER_ACTIVITIES;
		// filters.USER_PROGRAMS_F = userData.USER_PROGRAMS;
		
		var index = "CONTRACT_CODE";
		var order = "CONTRACT_STATE ASC";
	}
	if(table == "wp_log")
	{
		var filters = getFilters();
		// ADD FILTERS IF NECESARY HERE filters.XXX = XXX
		var index = "MC";
		var order = " DATE DESC";
	}
	if(table == "wp_trusers")
	{
		var filters = getFilters();
		// ADD FILTERS IF NECESARY HERE filters.XXX = XXX
		filters.USER_CTYPE_F = userData.USER_CTYPE;
		filters.USER_ENTITY_F = userData.USER_ENTITY;
		var index = " USER_CODE";
		var order = " USER_NAME ASC, USER_TYPE DESC ";
	}
	if(table == "wp_citizens")
	{
		var filters = getFilters();
		// ADD FILTERS IF NECESARY HERE filters.XXX = XXX
		var index = "CITIZEN_CODE";
		var order = "CITIZEN_NAME ASC";
	}
	if(table == "wp_programs")
	{
		var filters = getFilters();
		if(userData.USER_CTYPE != "Superior"){filters.PROGRAM_ENTITY_F = userData.USER_ENTITY;}
		var index = "PROGRAM_CODE";
		var order = "PROGRAM_NAME ASC";
	}
	if(table == "wp_projects")
	{
		var filters = getFilters();
		filters.PROJECT_ENTITY_F = userData.USER_ENTITY;
		var index = "PROJECT_CODE";
		var order = "PROJECT_NAME ASC";
	}
	if(table == "wp_activities")
	{
		var filters = getFilters();
		filters.ACTIVITY_ENTITY_F = userData.USER_ENTITY;
		var index = "ACTIVITY_CODE";
		var order = " ACTIVITY_PROJECT ASC, ACTIVITY_NAME ASC ";
	}
	if(table == "wp_entities")
	{
		var filters = getFilters();
		var index = "ENTITY_CODE";
		var order = "ENTITY_NAME ASC";
	}
	if(table == "wp_zones")
	{
		var filters = getFilters();
		if(userData.USER_CTYPE != "Superior"){filters.ZONE_CITY_F = actualCity;}
		var index = "ZONE_CODE";
		var order = "ZONE_NAME ASC";
	}
	if(table == "wp_hoods")
	{
		var filters = getFilters();
		if(userData.USER_CTYPE != "Superior"){filters.HOOD_CITY_F = actualCity;}
		var index = "HOOD_CODE";
		var order = "HOOD_NAME ASC";
	}
	if(table == "wp_institutes")
	{
		var filters = getFilters();
		if(userData.USER_CTYPE != "Superior"){filters.INSTITUTE_CITY_F = actualCity;}
		var index = "INSTITUTE_CODE";
		var order = "INSTITUTE_NAME ASC";
	}
	if(table == "wp_conditions")
	{
		var filters = getFilters();
		filters.CONDITION_ENTITY_F = userData.USER_ENTITY;
		var index = "CONDITION_CODE";
		var order = "CONDITION_NAME ASC";
	}
	if(table == "wp_etnias")
	{
		var filters = getFilters();
		filters.ETNIA_ENTITY_F = userData.USER_ENTITY;
		var index = "ETNIA_CODE";
		var order = "ETNIA_NAME ASC";
	}
	if(table == "wp_groups")
	{
		var filters = getFilters();
		filters.USER_CTYPE_F = userData.USER_CTYPE;
		filters.GROUP_ENTITY_F = userData.USER_ENTITY;
		filters.USER_ACTIVITIES_F = userData.USER_ACTIVITIES;
		filters.USER_HOODS_F = getHoodsFromZones(userData.USER_ZONES);
		
		if(userData.USER_CTYPE == "Instructor"){filters.USER_CONTRACT_F = userData.USER_CONTRACT;}

		var index = "GROUP_CODE";
		var order = "GROUP_STATUS ASC";
	}
	if(table == "wp_classes")
	{
		var filters = getFilters();
		filters.USER_CTYPE_F = userData.USER_CTYPE;
		filters.CLASS_ENTITY_F = userData.USER_ENTITY;
		filters.CLASS_ACTIVITIES_F = userData.USER_ACTIVITIES;
		if(userData.USER_GROUPS == null || userData.USER_GROUPS == ""){userData.USER_GROUPS = "[]";}
		filters.CLASS_GROUPS_F = JSON.stringify(getUserGroups(userData.USER_GROUPS));
		
		var index = "CLASS_CODE";
		var order = "CLASS_DATE DESC";
	}
	if(table == "wp_events")
	{
		var filters = getFilters();
		filters.USER_CTYPE_F = userData.USER_CTYPE;
		filters.USER_CODE_F = userData.USER_CODE;
		filters.USER_CONTRACT_F = userData.USER_CONTRACT;
		filters.EVENT_ENTITY_F = userData.USER_ENTITY;
		filters.EVENT_ACTIVITIES_F = userData.USER_ACTIVITIES;
		filters.USER_HOODS_F = getHoodsFromZones(userData.USER_ZONES);
		
		
		var index = "EVENT_CODE";
		var order = "EVENT_DATE_INI DESC";
	}
	if(table == "wp_events_r")
	{
		var filters = getFilters();
		filters.USER_CTYPE_F = userData.USER_CTYPE;
		filters.USER_CODE_F = userData.USER_CODE;
		filters.USER_CONTRACT_F = userData.USER_CONTRACT;
		filters.EVENT_ENTITY_F = userData.USER_ENTITY;
		filters.EVENT_ACTIVITIES_F = userData.USER_ACTIVITIES;
		filters.USER_HOODS_F = getHoodsFromZones(userData.USER_ZONES);

		
		var index = "EVENT_CODE";
		var order = "EVENT_CREATED DESC";
	}
	if(table == "wp_etaries")
	{
		var filters = getFilters();
		filters.USER_CTYPE_F = userData.USER_CTYPE;
		if(userData.USER_CTYPE != "Superior"){filters.ETARIE_ENTITY_F = userData.USER_ENTITY;}
		var index = "ETARIE_CODE";
		var order = "ETARIE_FROM ASC ";
	}
	if(table == "wp_visitable")
	{
		var filters = getFilters();
		var index = getNow().split(" ")[0];
		var order = getNow().split(" ")[1];
	}
	if(table == "wp_visits")
	{
		var filters = getFilters();
		filters.USER_CTYPE_F = userData.USER_CTYPE;
		filters.VISIT_ENTITY_F = userData.USER_ENTITY;
		filters.USER_ACTIVITIES_F = userData.USER_ACTIVITIES;
		filters.USER_HOODS_F = getHoodsFromZones(userData.USER_ZONES);
		if(userData.USER_CTYPE == "Visitador" || userData.USER_CTYPE == "Cogestor"){filters.USER_CONTRACT_F = userData.USER_CONTRACT;}
		
		var index = "VISIT_CODE";
		var order = "VISIT_DATE DESC ";
	}
	
	// NEW MASTERS
	
	if(table == "wp_master_edlevel")
	{
		var filters = getFilters();
		filters.EDLEVEL_ENTITY_F = userData.USER_ENTITY;
		var index = "EDLEVEL_CODE";
		var order = "EDLEVEL_NAME ASC";

	}
	
	if(table == "wp_master_ocucond")
	{
		var filters = getFilters();
		filters.OCUCOND_ENTITY_F = userData.USER_ENTITY;
		var index = "OCUCOND_CODE";
		var order = "OCUCOND_NAME ASC";

	}
	
	if(table == "wp_master_trasdes")
	{
		var filters = getFilters();
		filters.TRASDES_ENTITY_F = userData.USER_ENTITY;
		var index = "TRASDES_CODE";
		var order = "TRASDES_NAME ASC";

	}
	
	if(table == "wp_master_tipovi")
	{
		var filters = getFilters();
		filters.TIPOVI_ENTITY_F = userData.USER_ENTITY;
		var index = "TIPOVI_CODE";
		var order = "TIPOVI_NAME ASC";

	}
	
	if(table == "wp_master_genre")
	{
		var filters = getFilters();
		filters.GENRE_ENTITY_F = userData.USER_ENTITY;
		var index = "GENRE_CODE";
		var order = "GENRE_NAME ASC";

	}
	
	if(table == "wp_master_eps")
	{
		var filters = getFilters();
		filters.EPS_ENTITY_F = userData.USER_ENTITY;
		var index = "EPS_CODE";
		var order = "EPS_NAME ASC";

	}
	
	if(table == "wp_master_riskfa")
	{
		var filters = getFilters();
		filters.RISKFA_ENTITY_F = userData.USER_ENTITY;
		var index = "RISKFA_CODE";
		var order = "RISKFA_NAME ASC";

	}
	
	if(table == "wp_master_prevfa")
	{
		var filters = getFilters();
		filters.PREVFA_ENTITY_F = userData.USER_ENTITY;
		var index = "PREVFA_CODE";
		var order = "PREVFA_NAME ASC";

	}
	
	if(table == "wp_master_ingrec")
	{
		var filters = getFilters();
		filters.INGREC_ENTITY_F = userData.USER_ENTITY;
		var index = "INGREC_CODE";
		var order = "INGREC_NAME ASC";

	}
	
	if(table == "wp_master_convac")
	{
		var filters = getFilters();
		filters.CONVAC_ENTITY_F = userData.USER_ENTITY;
		var index = "CONVAC_CODE";
		var order = "CONVAC_NAME ASC";

	}
	
	if(table == "wp_master_patoen")
	{
		var filters = getFilters();
		filters.PATOEN_ENTITY_F = userData.USER_ENTITY;
		var index = "PATOEN_CODE";
		var order = "PATOEN_NAME ASC";

	}
	
	if(table == "wp_master_courses")
	{
		var filters = getFilters();
		filters.COURSES_ENTITY_F = userData.USER_ENTITY;
		var index = "COURSES_CODE";
		var order = "COURSES_NAME ASC";
	}
	
	if(table == "wp_master_tipoco")
	{
		var filters = getFilters();
		filters.TIPOCO_ENTITY_F = userData.USER_ENTITY;
		var index = "TIPOCO_CODE";
		var order = "TIPOCO_NAME ASC";
	}
	
	if(table == "wp_master_tiposo")
	{
		var filters = getFilters();
		filters.TIPOSO_ENTITY_F = userData.USER_ENTITY;
		var index = "TIPOSO_CODE";
		var order = "TIPOSO_NAME ASC";
	}
	
	if(table == "wp_master_migrea")
	{
		var filters = getFilters();
		filters.MIGREA_ENTITY_F = userData.USER_ENTITY;
		
		var index = "MIGREA_CODE";
		var order = "MIGREA_NAME ASC";
	}
	
	if(table == "wp_master_tipoin")
	{
		var filters = getFilters();
		filters.TIPOIN_ENTITY_F = userData.USER_ENTITY;
		var index = "TIPOIN_CODE";
		var order = "TIPOIN_NAME ASC";
	}
	
	if(table == "wp_master_component")
	{
		var filters = getFilters();
		filters.COMPONENT_ENTITY_F = userData.USER_ENTITY;
		var index = "COMPONENT_CODE";
		var order = "COMPONENT_NAME ASC";
	}
	
	if(table == "wp_master_scomponent")
	{
		var filters = getFilters();
		filters.SCOMPONENT_ENTITY_F = userData.USER_ENTITY;
		var index = "SCOMPONENT_CODE";
		var order = "SCOMPONENT_NAME ASC";
	}
	
	// LOCAL REFRESH
	if(table == "wp_groups_citizens")
	{
		tableCreator("wp_groups_citizens", actualGroupCitizens);
		return;
	}
	
	
	if(table == "wp_remitions")
	{
		var filters = getFilters();
		filters.REM_ENTITY_F = userData.USER_ENTITY;
		filters.USER_CTYPE_F = userData.USER_CTYPE;
		var index = "REM_CODE";
		var order = "REM_DATE DESC, REM_LINE DESC, REM_CITIZEN DESC";
	}
	
	if(table == "wp_attend")
	{
		var filters = getFilters();
		filters.REMCOM_ENTITY_F = userData.USER_ENTITY;
		filters.REMCOM_USER_F = userData.USER_CODE;
		filters.REMCOM_CITIZEN_F = actualRemitionData.REM_CITIZEN;
		filters.REMCOM_LINE_F = actualRemitionData.REM_LINE;
		var index = "REMCOM_CODE";
		var order = "REMCOM_DATE DESC";
	}
	
	if(table == "wp_dates")
	{
		var filters = getFilters();
		filters.DATE_ENTITY_F = userData.USER_ENTITY;
		filters.DATE_USER_CODE_F = userData.USER_CODE;
		
		var index = "DATE_CODE";
		var order = "DATE_DATE ASC, DATE_DATE_INI ASC";
	}
	
	
	info.FILTERS = filters;
	info.TABLE = table;
	info.USER_ENTITY = userData.USER_ENTITY;
	info.INDEX = index;
	info.ORDER = order;
	info.UTYPE = userData.USER_CTYPE;
	info.EXPORT = print;

	if(table == "wp_contracts")
	{var exclude = ["USER_CTYPE_F", "USER_CODE_F", "USER_ENTITY_F", "USER_ACTIVITIES_F"];}
	else if(table == "wp_trusers")
	{var exclude = ["USER_CTYPE_F", "USER_ENTITY_F"];}
	else if(table == "wp_projects")
	{var exclude = ["PROJECT_ENTITY_F"];}
	else if(table == "wp_activities")
	{var exclude = ["ACTIVITY_ENTITY_F"];}
	else if(table == "wp_conditions")
	{var exclude = ["CONDITION_ENTITY_F"];}
	else if(table == "wp_etnias")
	{var exclude = ["ETNIA_ENTITY_F"];}
	else if(table == "wp_etaries")
	{var exclude = ["USER_CTYPE_F"];}
	else if(table == "wp_visitable")
	{
		var limit = 100; 
		var exclude = [];
	}
	else if(table == "wp_visits")
	{
		var limit = 100; 
		var exclude = ["USER_ACTIVITIES_F","USER_HOODS_F","USER_CTYPE_F", "VISIT_ENTITY_F"];
	}
	else if(table == "wp_groups")
	{var exclude = ["USER_CTYPE_F", "GROUP_ENTITY_F", "USER_ACTIVITIES_F", "USER_HOODS_F", "USER_CONTRACT_F"];}
	else if(table == "wp_classes")
	{var exclude = ["USER_CTYPE_F", "CLASS_ENTITY_F", "CLASS_ACTIVITIES_F", "CLASS_GROUPS_F"];}
	else if(table == "wp_events")
	{
		var exclude = ["USER_CTYPE_F", "USER_CONTRACT_F", "EVENT_ENTITY_F", "EVENT_ACTIVITIES_F", "USER_HOODS_F", "USER_CODE_F"];
	}
	else if(table == "wp_events_r")
	{var exclude = ["USER_CTYPE_F", "USER_CONTRACT_F", "EVENT_ENTITY_F", "EVENT_ACTIVITIES_F", "USER_HOODS_F", "USER_CODE_F"];}
	else
	{var exclude = [];}
	
	var filterKeys = getKeys(filters);
	var checkThis = [];
	for(var i=0; i<filterKeys.length; i++)
	{
		var key = filterKeys[i];
		if(exclude.includes(key)){continue;}
		else{checkThis.push(key);}
	}
	
	// console.log(table)
	// console.log(filterKeys)
	// console.log(filters)
	// console.log(checkThis)
	
	for(var i=0; i<checkThis.length; i++)
	{
		var itemValue = filters[checkThis[i]];
		// console.log(table);
		// console.log(itemValue);
		if(itemValue != ""){var limit = 100000; break;}
		else{var limit = 100;}
	}
	
	info.LIMIT = limit;
	
	// console.log(table);
	// console.log(print);
	
	if(table == "wp_dates" && print == "dates")
	{
		if(info.FILTERS.DATE_INIDATE_F == "" || info.FILTERS.DATE_ENDATE_F == "")
		{fastPop("Debe seleccionar una fecha de inicio y fecha de fin para esta descarga ", 2000);return;}

	}

	if(table == "wp_classes")
	{
		if((info.FILTERS.CLASS_DATE_INI_F == "" && info.FILTERS.CLASS_DATE_END_F == "") && info.FILTERS.CLASS_CONTRATIST_F != "")
		{fastPop("Debe seleccionar una fecha de inicio y fecha de fin para esta consulta ", 2000);return;}

	}
	
	
	if(table == "wp_events" || table == "wp_events_r")
	{
		var endDateFilter = document.getElementById("EVENT_DATE_END_F").value;
		if(endDateFilter != "" )
		{
			console.log(endDateFilter);
			var laDate = new Date(endDateFilter);
			var laNewDate = laDate.setDate(laDate.getDate() + 2);
			
			var newEnd = getNowFormat(laDate).split(" ")[0];
			console.log(newEnd);
			
			info.FILTERS.EVENT_DATE_END_F = newEnd;
		}
	}
		
	console.log(info);
	
	
	loadManager(1);
	
	sendAjax("users","refreshTable",info,function(response)
	{
		loadManager(0);
		var ans = response.message;
		console.log(ans);

		
		if(info.TABLE == "wp_programs")
		{
			// if(userData.USER_CTYPE != "Superior")
			// {programs = purifyEntity(ans,"PROGRAM_ENTITY");}
			// else{programs = ans;}
		}
		if(info.TABLE == "wp_projects")
		{
			// if(userData.USER_CTYPE != "Superior")
			// {projects = purifyEntity(ans,"PROJECT_ENTITY");}
			// else{projects = ans;}
		}
		if(info.TABLE == "wp_activities")
		{
			// if(userData.USER_CTYPE != "Superior")
			// {activities = purifyEntity(ans,"ACTIVITY_ENTITY");}
			// else{activities = ans;}
			
		}
		if(info.TABLE == "wp_zones")
		{
			if(userData.USER_CTYPE != "Superior")
			{zones = purifyCity(ans,"ZONE_CITY");}
			else{zones = ans;}
		}
		if(info.TABLE == "wp_hoods")
		{
			if(userData.USER_CTYPE != "Superior")
			{
				hoods = purifyCity(ans,"HOOD_CITY");
				hoods = parentAdder("hoods");
			}
			else
			{
				hoods = ans;
				hoods = parentAdder("hoods");
			}
			
		}
		if(info.TABLE == "wp_institutes")
		{
			if(userData.USER_CTYPE != "Superior")
			{institutes = purifyCity(ans,"INSTITUTE_CITY");}
			else{institutes = ans;}
		}
		if(info.TABLE == "wp_conditions")
		{
			if(userData.USER_CTYPE != "Superior")
			{conditions = purifyEntity(ans,"CONDITION_ENTITY");}
			else{conditions = ans;}
		}
		if(info.TABLE == "wp_etnias")
		{
			// if(userData.USER_CTYPE != "Superior")
			// {etnias = purifyEntity(ans,"ETNIA_ENTITY");}
			// else{}
			etnias = ans;
			
		}
		if(info.TABLE == "wp_etaries")
		{
			if(userData.USER_CTYPE != "Superior")
			{etaries = purifyEntity(ans,"ETARIE_ENTITY");}
			else{etaries = ans;}
			
		}
		if(info.TABLE == "wp_groups")
		{
			// console.log("DISABLE HERE");
			// actualEditData = ans[0];
			// loadForm("time");
		}
		if(info.TABLE == "wp_classes")
		{
			actualClassesList = ans;
			
			var data = {};
			
			console.log("launch");
			sendAjax("users","classDaemon",data,function(response)
			{
				var answer = response.message;
				console.log(answer);
				// IF NEW CLASSES, REFRESH LIST
				if(answer != "no news" && answer != "Ignore"){refreshTable("wp_classes");}
			});
			
		}
		if(info.TABLE == "wp_events")
		{
			console.log("regular event")
		}
		if(info.TABLE == "wp_events_r")
		{
			console.log("request event");
		}
		if(info.TABLE == "wp_visitable")
		{
			
			if(response.message.visitsToMakeMonth < 0){response.message.visitsToMakeMonth = 0;}
			if(response.message.visited < 0){response.message.visited = 0;}
			
			
			document.getElementById("visitData").innerHTML = "Visitas a realizar en el Día: "+response.message.dayGoal+"<br> Realizadas este mes: "+response.message.visited+"<br> Total a realizar en el mes: "+response.message.visitsToMakeMonth;
			
			ans = response.message.classList;
			console.log(ans);
			
			var data = {};
			sendAjax("users","classDaemon",data,function(response)
			{
				var answer = response.message;
				console.log(answer);
				// IF NEW CLASSES, REFRESH LIST
				if(answer != "no news" && answer != "Ignore"){refreshTable("wp_visitable");}
			});
			
		}
		

		
		// GET OWN CONTRACTS FOR REGULAR USERS
		if(userData.USER_CTYPE != "Principal1" && userData.USER_CTYPE != "Principal2" && userData.USER_CTYPE != "Principal3" && userData.USER_CTYPE != "Superior")
		{
			
			var forbbidens = [];			
			
			for(var i=0; i<ans.length; i++)
			{
				var item = ans[i];
				if(item.CONTRACT_STATE == "2" || item.CONTRACT_STATE == "4")
				{
					if(item.CONTRACT_REQUESTER == userData.USER_CODE || item.CONTRACT_OWNER == userData.USER_CODE)
					{
						// SI ES SOLICITUD SE INCLYE COMO PROHIBIDO
						if(item.CONTRACT_STATE == "2")
						{
							console.log("bloqueado por solicitud");
							forbbidens.push(item);
						}
						if(item.CONTRACT_STATE == "4")
						{
							//SI ESTA ASIGNADO A MI PERO NO ESTA VENCIDO SE INCLUYE COMO PROHIBIDO
							// console.log(parseInt(getdDiff(getNow(),item.CONTRACT_ENDATE)));
							
							console.log("este es mio");
							console.log(item);
							console.log(parseInt(getdDiff(getNow(),item.CONTRACT_ENDATE)));
							
							if(parseInt(getdDiff(getNow(),item.CONTRACT_ENDATE)) > 0)
							{
								console.log("bloqueado por contrato activo");
								forbbidens.push(item);
							}
						}
					}
				}
			}
			
			console.log(forbbidens);
			
			if(forbbidens.length > 0)
			{lockRequest = "1";}
			else
			{lockRequest = "0";}
		}
		
		tableCreator(info.TABLE, ans);	
		
		if(info.EXPORT != "0")
		{
			console.log(response.path);
			
			var file = response.path;
			var a = document.createElement("a"); //Create <a>
			a.href = "app/reports/"+file+".xls"; 
			a.download = response.path+".xls"; //File name Here
			a.click(); 
			
		}	

		
	});
}

// CHECK IF FIELD IS COORDENATE
function checkCoords(input)
{
	
	var fullInput = input.value;
	console.log(fullInput)
	
	// CHECK 1 MUS HAVE ", "
	var parts = fullInput.split(", ");
	if(parts.length != 2)
	{
		console.log("falla0")
		fastPop(language["wrongCoord"], 6000);
		input.value = "";
		return;
	}
	
	// PART 1 CHECKS
	var lat = parts[0];
	var lon = parts[1];
	
	// PART 1 MUST BE ALL NUMBER
	if(!isNumber(lat))
	{
		console.log("falla1")
		fastPop(language["wrongCoord"], 2000);
		input.value = "";
		return;
	}
	
	// PART 2 MUST BE ALL NUMBER
	if(!isNumber(lon))
	{
		console.log("falla2")
		fastPop(language["wrongCoord"], 2000);
		input.value = "";
		return;
	}
	
	var latParts = lat.split(".");
	if(latParts.length != 2)
	{
		console.log("falla3")
		fastPop(language["wrongCoord"], 2000);
		input.value = "";
		return;
	}
	
	var lonParts = lon.split(".");
	if(lonParts.length != 2)
	{
		console.log("falla4")
		fastPop(language["wrongCoord"], 2000);
		input.value = "";
		return;
	}

	var lat1 = latParts[0];
	var lon1 = lonParts[0];
	
	if(lat1 < -90 || lat1 > 90)
	{
		console.log("falla5")
		fastPop(language["wrongCoord"], 2000);
		input.value = "";
		return;
	}
	
	if(lon1 < -180 || lon1 > 180)
	{
		console.log("falla6")
		fastPop(language["wrongCoord"], 2000);
		input.value = "";
		return;
	}

	var lat2 = latParts[1];
	var lon2 = lonParts[1];
	
	if(lat2.length != 6)
	{
		console.log("falla7")
		fastPop(language["wrongCoord"], 2000);
		input.value = "";
		return;
	}

	if(lon2.length != 6)
	{
		console.log("falla8")
		fastPop(language["wrongCoord"], 2000);
		input.value = "";
		return;
	}
	
	

}

// TABLES
// TABLES
// TABLES
// TABLES
// TABLES
// TABLES
function tableCreator(tableId, list)
{
	var table = document.getElementById(tableId);
	tableClear(tableId);
	
	var tableCount = document.getElementById("tableCount"+"-"+tableId);
	tableCount.innerHTML = list.length+" Registros"
	
	if(tableId == "wp_report_indicators"){tableCount.innerHTML = "";}
	if(tableId == "wp_contracts"){var list = reArrange(list, "wp_contracts");}
	if(tableId == "wp_remitions")
	{

		for(var i=0; i<list.length; i++)
		{
			var item = list[i];
			if(item.REM_AUTOR == userData.USER_CODE){item.IS_MINE = "1";}
			else{item.IS_MINE = "0";}
		}
		var list = reArrange(list, "wp_remitions");
	}
	
	if(tableId == "wp_groups")
	{var list = reArrange(list, "wp_groups");}
	
	// CANTIDAD DE REGISTROS Y MENSAJE DE NO ENCONTRADO
	var qty = list.length+" Registros";
	if(list.length == 1){var qty = list.length+" Registros";}
	if(list.length == 0)
	{
		var nInYet = document.createElement("div");
		nInYet.innerHTML = "Sin resultados";
		nInYet.className = "blankProducts";
		table.appendChild(nInYet);
		return;
	}

	// CONTRATOS
	if(tableId == "wp_contracts")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			// TURN SINGLE INTO ARRAY TO GET DESCRIPTION
			var thearray = JSON.stringify([list[i].CONTRACT_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var ax = cellCreator('Entidad', entity);
			
			var a = cellCreator('Tipo solicitud', list[i].CONTRACT_REQTYPE);
			var b = cellCreator('# contrato', list[i].CONTRACT_NUMBER);
			
			var dateRange = "Desde: "+list[i].CONTRACT_INIDATE+"<br>"+"hasta: "+list[i].CONTRACT_ENDATE;
			
			var c = cellCreator('Rango fechas', dateRange);
			var e = cellCreator('Tipo usuario', list[i].CONTRACT_USERTYPE);
			
			// var programsDesc = getFriendDescs(list[i].CONTRACT_PROGRAM,"programs");
			// var f = cellCreator('Programas', programsDesc);
			
			var activitiesDesc = getFriendDescs(list[i].CONTRACT_ACTIVITIES,"activities");
			var g = cellCreator('Actividades', activitiesDesc);
			
			var zonesDesc = getFriendDescs(list[i].CONTRACT_ZONES,"zones");
			var h = cellCreator('Ubicaciones', zonesDesc);
			
			var cstate = statesDictionary["s"+list[i].CONTRACT_STATE];
			
			if(list[i].CONTRACT_CESION_STATE != "0")
			{
				cstate = statesDictionary["s"+list[i].CONTRACT_STATE]+" - "+cesionStatesDictionary["s"+list[i].CONTRACT_CESION_STATE];
			}
			
			var exhausted = 0;
			
			// MARK IF EXHAUSTED CONTRACT
			if(parseInt(getdDiff(getNow(),list[i].CONTRACT_ENDATE)) < 0)
			{
				var exhausted = 1;
				cstate = "<b style='color: red;'>Vencido</b>";
			}
			
			if(list[i].CONTRACT_STATE == "2")
			{
				cstate = "Solicitud";
			}
			
			
			var j = cellCreator('Estado', cstate);
			
			// console.log(cstate);
			var stateFilter = document.getElementById("CONTRACT_ACTIVE_F").value;
			
			if(stateFilter == "Asignado" && cstate != "Asignado"){continue;}
			if(stateFilter == "Vencido" && cstate != "<b style='color: red;'>Vencido</b>"){continue;}
			
			// console.log(stateFilter)
			// console.log(cstate)
			
			if(stateFilter == "Solicitud" && cstate != "Solicitud"){continue;}
			
			
			
			
			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				console.log(actualEditData);
				editDataForm("contract");
			}
			
			var view = faIcon(list[i],"eye","Detalle","#efc90e");
			view.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("aprobeD");
			}
			
			var k = cellCreator('Solicitante', list[i].CONTRACT_REQUESTER_NAME);
			var l = cellCreator('Contratista', list[i].CONTRACT_OWNER_NAME);
			var m = cellCreator('Aprobado por', list[i].CONTRACT_APROVED_BY);
			
			
			if(list[i].CONTRACT_STATE == "2" || list[i].CONTRACT_CESION_STATE == "2")
			{var aprobeColor = "#d6d0d0";}
			else
			{var aprobeColor = "#65d28c";}
			
			var aprobe = faIcon(list[i],"thumbs-up","Aprobar",aprobeColor);
			aprobe.onclick = function()
			{
				if(this.reg.CONTRACT_STATE == "4" && this.reg.CONTRACT_CESION_STATE != "2")
				{
					fastPop("Este contrato ya esta asignado", 2000);
					return;
				}
				actualEditData = this.reg;
				editDataForm("aprobe")
				
			}
			
			var del = faIcon(list[i],"thumbs-down","Rechazar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_contracts",data];
				confirmBox(language["confirm"], "¿Desea rechazar esta solicitud de contrato?",deleteItem, params);
			}
			
			var delC = faIcon(list[i],"trash-alt","Rechazar cesión","#e83e8c");
			delC.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_contracts",data];
				confirmBox(language["confirm"], "¿Desea rechazar esta solicitud de cesión de contrato?",cancelCesion, params);
			}
			
			if(list[i].CONTRACT_CESION_STATE == "0")
			{
				var cesionColor = "#d6d0d0";
				var iconLabel = "Deshabilitado para cesión";
			}
			else
			{
				var cesionColor = "#ffb86f";
				var iconLabel = "Habilitado para cesión";
			}
			
			var cesion = faIcon(list[i],"sync",iconLabel,cesionColor);
			cesion.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_contracts",data];
				
				stateChanger("wp_contracts","CONTRACT_CESION_STATE", "CONTRACT_CODE", this.reg.CONTRACT_CODE, this.reg.CONTRACT_CESION_STATE);
				
			}
			
			
			var icons = [];
			
			if(userData.USER_CTYPE == "Superior")
			{
				if(list[i].CONTRACT_STATE == "4"){var icons = [aprobe,cesion,edit,del];}
				else{var icons = [aprobe,edit,del];	}
			}
			else if(userData.USER_CTYPE == "Principal1" || userData.USER_CTYPE == "Principal2" || userData.USER_CTYPE == "Principal3" || userData.USER_CTYPE == "Director" || userData.USER_CTYPE == "Coordinador")
			{
				if(list[i].CONTRACT_STATE == "2")
				{
					var icons = [aprobe,del];
				}
				else if(list[i].CONTRACT_STATE == "3")
				{
					var icons = [aprobe];
				}
				else if(list[i].CONTRACT_STATE == "4")
				{
					if(list[i].CONTRACT_CESION_STATE == "2")
					{
						var icons = [aprobe, delC];
					}
					else
					{
						if(exhausted == 1){var icons = [];}
						else{var icons = [cesion];}
					}
				}
				else
				{
					var icons = [];
				}
			}
			
			// ALLOW VIEW IF APROVED
			if(list[i].CONTRACT_STATE == "4")
			{icons.push(view);}


			// USER CANNOT CHANGE ITSELF
			if((list[i].CONTRACT_REQUESTER == userData.USER_CODE || list[i].CONTRACT_OWNER == userData.USER_CODE) && list[i].CONTRACT_STATE == "4")
			{
				
				if(list[i].CONTRACT_CESION_STATE == "2")
				{
					var text = "Esperando aprobación de cesión";
					var x = cellCreator('', "<b class='tableLabelG'>"+text+"</b><br>");
				}
				else
				{
					var text = "Contrato propio";
					var x = cellCreator('', "<b class='tableLabelG'>"+text+"</b><br>");
					if(list[i].CONTRACT_STATE == "4")
					{x.appendChild(view);}

				}

			}
			else
			{
				var x = cellOptionsCreator('', icons)
			}
			
			
			if(userData.USER_CTYPE == "Principal3")
			{x.appendChild(edit);}
			
			
			var cells = [ax,b,c,e,g,h,k,l,m,j,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// LOG
	if(tableId == "wp_log")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var locationLog = locationsDictionary[list[i].IFACE];
			var a = cellCreator('Ubicación', locationLog);
			var b = cellCreator('Usuario', list[i].USER_NAME);
			var c = cellCreator('Fecha/hora', list[i].DATE);
			
			var action = actionsDictionary["a"+list[i].MT];
			var d = cellCreator('Operación', action);
			
			// TURN SINGLE INTO ARRAY TO GET DESCRIPTION
			var thearray = JSON.stringify([list[i].ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var e = cellCreator('Entidad', entity);
			
			var icons = [];

			var x = cellOptionsCreator('', icons)
			var cells = [b,c,a,d,e];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// USERS
	if(tableId == "wp_trusers")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			if(userData.USER_CTYPE != "Superior")
			{
				var utype = list[i].USER_TYPE;
				if(utype == "Principal1" || utype == "Principal2" || utype == "Principal3" || utype == "Superior")
				{continue}
			}
			
			
			var a = cellCreator('Nombre', list[i].USER_NAME+" "+list[i].USER_LASTNAME);
			var b = cellCreator('Usuario', list[i].USER_EMAIL);
			
			var thearray = JSON.stringify([list[i].USER_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var c = cellCreator('Entidad', entity);
			var d = cellCreator('Tipo de id.', list[i].USER_IDTYPE);
			var e = cellCreator('# Id.', list[i].USER_IDNUM);
			var f = cellCreator('Teléfono', list[i].USER_PHONE);
			
			// var utype = utypesDictionary[list[i].USER_CONTRACT_TYPE];
			// var g = cellCreator('Tipo de usuario', utype);
			
			var state = statesDictionary["s"+list[i].USER_STATUS];
			var h = cellCreator('Estado', state);

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("user")
			}
			
			if(list[i].USER_STATUS == "1"){var stateColor = "#28bbdc";}
			else{var stateColor = "#d6d0d0";}
			
			var state = faIcon(list[i],"adn","Cambiar estado activo o inactivo",stateColor);
			state.onclick = function()
			{
				actualEditData = this.reg;
				stateChanger("wp_trusers","USER_STATUS", "USER_CODE", this.reg.USER_CODE, this.reg.USER_STATUS);
			}
			
			if(list[i].USER_CALLER == "1"){var stateColor = "#ff901e";}
			else{var stateColor = "#d6d0d0";}
			
			var caller = faIcon(list[i],"headset","Cambiar usuario llamada o normal",stateColor);
			caller.onclick = function()
			{
				actualEditData = this.reg;
				
				if(actualEditData.USER_CALLER == "0")
				{
					
					loadForm("userCaller");
					return;
				}
				
				stateChanger("wp_trusers","USER_CALLER", "USER_CODE", actualEditData.USER_CODE, actualEditData.USER_CALLER);
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_trusers",data];
				confirmBox(language["confirm"], "¿Desea eliminar este elemento?",deleteItem, params);
			}
			
			
			var icons = [];
			icons.push(edit);
			icons.push(state);
			icons.push(caller);
			
			if(userData.USER_CTYPE == "Superior")
			{
				icons.push(del);
			}
			

			var x = cellOptionsCreator('', icons)
			var cells = [c,d,e,a,b,f,h,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// CITIZENS
	if(tableId == "wp_citizens")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";

			var a = cellCreator('Nombre', list[i].CITIZEN_NAME+" "+list[i].CITIZEN_LASTNAME);
			var b = cellCreator('Tipo de id.', list[i].CITIZEN_IDTYPE);
			var c = cellCreator('# Id.', list[i].CITIZEN_IDNUM);
			var d = cellCreator('Nacimiento', list[i].CITIZEN_BDAY);
			var e = cellCreator('Teléfono', list[i].CITIZEN_PHONE);
			var f = cellCreator('Email', list[i].CITIZEN_EMAIL);
			
			
			var thearray = JSON.stringify([list[i].CITIZEN_GENDER]);
			var gender = getFriendDescs(thearray,"genre");
			if(gender == ""){gender = list[i].CITIZEN_GENDER;}
			
			var g = cellCreator('Género', gender);
			
			var thearray = JSON.stringify([list[i].CITIZEN_ETNIA]);
			var etnia = getFriendDescs(thearray,"etnias");
			var h = cellCreator('Etnia', etnia);
			

			if(list[i].CITIZEN_CONDITION != null)
			{
				var condition = getFriendDescs(list[i].CITIZEN_CONDITION,"conditions");
			}
			else
			{
				var condition = "";
			}
			
			var j = cellCreator('Condición', condition);
			
			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				citizenOrigin = "c";
				actualEditData = this.reg;
				console.log(actualEditData)
				editDataForm("citizen")
			}

			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_citizens",data];
				confirmBox(language["confirm"], "¿Desea eliminar este elemento?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			// ONLY SUPER ADMIN CAN DELETE
			if(userData.USER_CTYPE == "Superior")
			{icons.push(del);}
			
			
			var x = cellOptionsCreator('', icons)
			var cells = [a,b,c,d,e,f,g,h,j,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// PROGRAM
	if(tableId == "wp_programs")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].PROGRAM_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].PROGRAM_NAME);
			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("program")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_programs",data];
				confirmBox(language["confirm"], "¿Desea eliminar este programa?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [a,b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// PROYECTS
	if(tableId == "wp_projects")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].PROJECT_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', encry(list[i].PROJECT_NAME));
			
			
			// TURN SINGLE INTO ARRAY TO GET DESCRIPTION
			var thearray = JSON.stringify([list[i].PROJECT_PROGRAM]);
			var programDesc = getFriendDescs(thearray,"programs");
			
			
			var d = cellCreator('Programa', programDesc);
			
			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("project");
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_projects",data];
				confirmBox(language["confirm"], "¿Desea eliminar este proyecto?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [a,b,d,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// ACTIVITY
	if(tableId == "wp_activities")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].ACTIVITY_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', encry(list[i].ACTIVITY_NAME));
			
			if(list[i].ACTIVITY_COG == "0"){var cog = "No";}
			else{var cog = "Si";}
			
			var c = cellCreator('Disponible atención de eventos', cog);
			
			// TURN SINGLE INTO ARRAY TO GET DESCRIPTION
			var thearray = JSON.stringify([list[i].ACTIVITY_PROJECT]);
			var projectDesc = getFriendDescs(thearray,"projects");
			
			var d = cellCreator('Proyecto', encry(projectDesc));
			
			// TURN SINGLE INTO ARRAY TO GET DESCRIPTION
			var thearray = JSON.stringify([list[i].ACTIVITY_PROGRAM]);
			var programDesc = getFriendDescs(thearray,"programs");
			
			var e = cellCreator('Programa', programDesc);
			
			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("activity");
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_activities",data];
				confirmBox(language["confirm"], "¿Desea eliminar esta actividad?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [a,b,c,d,e,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// ENTITY
	if(tableId == "wp_entities")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a = cellCreator('Ciudad', list[i].ENTITY_CITY);
			var b = cellCreator('Nombre', list[i].ENTITY_NAME);
			var c = cellCreator('Activa hasta', list[i].ENTITY_VUNTIL);
			
			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("entity");
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_entities",data];
				confirmBox(language["confirm"], "¿Desea eliminar esta entidad?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [a,b,c,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// ZONE
	if(tableId == "wp_zones")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a0 = cellCreator('Ciudad', list[i].ZONE_CITY);
			var a = cellCreator('Tipo de comunidad', list[i].ZONE_TYPE);
			var b = cellCreator('Nombre', list[i].ZONE_NAME);
			
			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("zone");
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_zones",data];
				confirmBox(language["confirm"], "¿Desea eliminar esta comuna o corregimiento?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [a0,a,b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// HOOD
	if(tableId == "wp_hoods")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a0 = cellCreator('Ciudad', list[i].HOOD_CITY);
			
			var thearray = JSON.stringify([list[i].HOOD_ZONE]);
			var zone = getFriendDescs(thearray,"zones");
			
			var a = cellCreator('Comuna o corregimiento', zone);
			var b = cellCreator('Tipo de sector', list[i].HOOD_TYPE);
			var c = cellCreator('Nombre', list[i].HOOD_NAME);
			
			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("hood");
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_hoods",data];
				confirmBox(language["confirm"], "¿Desea eliminar este barrio o vereda?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [a0,a,b,c,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// CONDITION
	if(tableId == "wp_conditions")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			// var thearray = JSON.stringify([list[i].CONDITION_ENTITY]);
			// var entity = getFriendDescs(thearray,"entities");
			
			// var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].CONDITION_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("condition")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_conditions",data];
				confirmBox(language["confirm"], "¿Desea eliminar esta Condición?",deleteItem, params);
			}
			
			var icons = [];
			
			
			if(!list[i].CONDITION_NAME.includes("Migrante"))
			{
				icons.push(edit);
				icons.push(del);
			}
				
			

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// ETNIA
	if(tableId == "wp_etnias")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].ETNIA_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			// var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].ETNIA_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("etnia")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_etnias",data];
				confirmBox(language["confirm"], "¿Desea eliminar esta etnia?",deleteItem, params);
			}
			
			var icons = [];

			
			if(!list[i].ETNIA_NAME.includes("Ind"))
			{
				icons.push(edit);
				icons.push(del);
			}

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// GROUPS
	if(tableId == "wp_groups")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			// var thearray = JSON.stringify([list[i].GROUP_ENTITY]);
			// var entity = getFriendDescs(thearray,"entities");
			
			var b = cellCreator('Nombre', list[i].GROUP_NAME);
			
			var thearray = JSON.stringify([list[i].GROUP_ACTIVITY]);
			var activity = getFriendDescs(thearray,"activities");
			var c = cellCreator('Actividad', activity);
			var thearray = JSON.stringify([list[i].GROUP_HOOD]);
			var hood = getFriendDescs(thearray,"hoods");
			var d = cellCreator('Barrio o vereda', hood);
			// THIS BECOMES CONTRATIST
			var e = cellCreator('Contratista', list[i].GROUP_CONTRATIST);
			var f = cellCreator('Presencial/Virtual', list[i].GROUP_PREVIR);
			var incom = cellCreator('Institucional/Comunitario', list[i].GROUP_INSTYPE);
			var g = cellCreator('Dirección o nombre del lugar', list[i].GROUP_ADDRESS);
			var h = cellCreator('Coordenadas', list[i].GROUP_COORDS);
			
			
			var hline = "";
			
			if(list[i].GROUP_HOURS != null && list[i].GROUP_HOURS != "" && list[i].GROUP_HOURS != "null")
			{
				var hoursArray = JSON.parse(list[i].GROUP_HOURS);
				for(var hr=0; hr<hoursArray.length; hr++)
				{
					var hitem = hoursArray[hr];
					var ho = hitem.GROUP_TIME_DAY+":<br> "+hitem.GROUP_TIME_INI+" - "+hitem.GROUP_TIME_END;
					hline = hline+ho+"<br>";
				}
			}
			else
			{
				hline = "-";
			}
			
			var hrs = cellCreator('Horarios', hline);

			// THIS BECOMES PROJECT
			var j = cellCreator('Proyecto', encry(list[i].GROUP_PROJECT));

			var edit = faIcon(list[i],"edit","Editar grupo","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				citizenOrigin = "gre";
				editDataForm("group");
			}
			
			var assign = faIcon(list[i],"link","Asignar grupo a contrato","#d6d0d0");
			assign.onclick = function()
			{
				actualEditData = this.reg;
				actualGacty = actualEditData.GROUP_ACTIVITY;
				console.log(actualGacty);
				getAssignContracts("0");
			}
			
			var assignEdit = faIcon(list[i],"link","Editar asignación de contrato","#39b554");
			assignEdit.onclick = function()
			{
				actualEditData = this.reg;
				actualGacty = actualEditData.GROUP_ACTIVITY;
				console.log(actualGacty);
				getAssignContracts("1");
			}
			
			var assignCancel = faIcon(list[i],"unlink","Eliminar asignación de contrato","#f98838");
			assignCancel.onclick = function()
			{
				actualEditData = this.reg;
				var params = [actualEditData];
				confirmBox(language["confirm"], "¿Desea desasignar este grupo?",deleteAssign, params);
			}
			
			var times = faIcon(list[i],"clock","Horarios de clase","#d67de6");
			times.onclick = function()
			{
				actualEditData = this.reg;
				console.log(actualEditData);
				
				// RM CANT TOUCH
				var contract = userData.USER_CONTRACT;
				if(contract == "" && userData.USER_CTYPE != "Superior")
				{fastPop("Solo el usuario con el contrato vinculado podrá editar esa área del grupo.", 2000);return;}
				
				// CHECK IF GROUP IS MINE
				var utype = userData.USER_CTYPE;
				if(utype != "Principal3" && utype != "Superior")
				{
					var group = this.reg.GROUP_CODE;
					var myGroups = getUserGroups(userData.USER_GROUPS);
					if(!myGroups.includes(group))
					{
						fastPop("Este grupo no se encuentra asignado a tu contrato", 2000);
						return;
					}
				}
				
				loadForm("time");
			}
			
			var citizens = faIcon(list[i],"user-plus","Agregar ciudadano al grupo","#3b5dbf");
			citizens.onclick = function()
			{
				
				
				// RM CANT TOUCH
				// var contract = userData.USER_CONTRACT;
				// if(contract == "" && userData.USER_CTYPE != "Superior")
				// {fastPop("Solo el usuario con el contrato vinculado podrá editar esa área del grupo.", 2000);return;}
				
				// CHECK IF GROUP IS MINE
				var utype = userData.USER_CTYPE;
				if(utype != "Principal3" && utype != "Superior")
				{
					var group = this.reg.GROUP_CODE;
					var myGroups = getUserGroups(userData.USER_GROUPS);
					
					console.log(group)
					console.log(myGroups)
					
					if(!myGroups.includes(group))
					{
						fastPop("Este grupo no se encuentra asignado a tu contrato", 2000);
						return;
					}
				}
				
				citizenOrigin = "g";
				actualGroupCode = this.reg.GROUP_CODE;
				console.log(actualGroupCode);
				loadForm("citizen");
			}

			// SET CITIZENS LIST COLOR
			if(list[i].GROUP_CITIZENS != null && list[i].GROUP_CITIZENS != "")
			{
				var people = JSON.parse(list[i].GROUP_CITIZENS);
				if(people.length > 0)
				{var clistColor = "#ffc107";}
				else
				{var clistColor = "#d6d0d0";}
				var peopleCount = people.length;
			}
			else
			{
				var clistColor = "#d6d0d0";
				var peopleCount = 0;
			}
			
			var gente = cellCreator('Ciudadanos', peopleCount);
			
			var clist = faIcon(list[i],"users","Ciudadanos del grupo",clistColor);
			clist.onclick = function()
			{
				
				// CHECK IF GROUP IS MINE
				var utype = userData.USER_CTYPE;
				// if(utype != "Principal3" && utype != "Superior")
				// {
					// var group = this.reg.GROUP_CODE;
					// var myGroups = getUserGroups(userData.USER_GROUPS);
					// console.log(group)
					// console.log(myGroups)
					
					// if(!myGroups.includes(group))
					// {
						// fastPop("Este grupo no se encuentra asignado a tu contrato", 2000);
						// return;
					// }
				// }
				
				
				actualGroupCode = this.reg.GROUP_CODE;
				actualGroupContract = this.reg.GROUP_CONTRACT;
				// console.log(actualGroupContract);
				// console.log(userData.USER_CONTRACT);
				
				classOrigin = "g";
				getItemList(actualGroupCode, "citizens")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar grupo","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				
				console.log(data);
				
				// ASOCIATED CHECK
				if(data.GROUP_CONTRACT != "" && data.GROUP_CONTRACT != null)
				{
					fastPop("No puede eliminar el grupo mientras se encuentre asociado a un contrato", 4000);
					return;
				}
				
				var params = ["wp_groups",data];
				confirmBox(language["confirm"], "¿Desea eliminar este grupo?",deleteItem, params);
			}
			
			// ICONS IF CONDITION
			var icons = [];
			var utype = userData.USER_CTYPE;
			if(utype == "Principal3" || utype == "Coordinador" || utype == "Superior" || utype == "Director")
			{
				icons.push(edit);
				
				if(list[i].GROUP_STATUS == "1")
				{
					icons.push(assignEdit);
					icons.push(assignCancel);
				}
				else
				{icons.push(assign);}
			
				// icons.push(times);
				// icons.push(citizens);
				// icons.push(clist);
			}
 			
			icons.push(clist);
			
			if(list[i].GROUP_CONTRACT == userData.USER_CONTRACT && (userData.USER_CTYPE == "Instructor" || userData.USER_CTYPE == "Cogestor" || utype == "Director" || utype == "Coordinador"))
			{
				icons.push(edit);
				icons.push(times);
				icons.push(citizens);
			}
			
			// ADD DELETE ICON
			var utype = userData.USER_CTYPE;
			if(utype == "Principal3" || utype == "Director" || utype == "Coordinador" || utype == "Superior")
			{icons.push(del);}
			
			var x = cellOptionsCreator('', icons)
			var cells = [b,e,j,c,f,incom,d,g,h,hrs,gente,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// CLASSES HOURS
	if(tableId == "wp_classes")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].CLASS_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var a2 = cellCreator('Grupo', list[i].CLASS_GROUP_NAME);
			var thearray = JSON.stringify([list[i].CLASS_ACTIVITY]);
			var activity = getFriendDescs(thearray,"activities");
			var b = cellCreator('Actividad', activity);
			var c = cellCreator('Contratista', list[i].CLASS_TUTOR_NAME);
			var instype = cellCreator('Institucional/comunitario', list[i].CLASS_GROUP_INSTYPE);

			var thearray = JSON.stringify([list[i].CLASS_PROJECT]);
			var projectDesc = getFriendDescs(thearray,"projects");

			// var n1 = cellCreator('Proyecto', projectDesc);
			var n2 = cellCreator('Presencial/Virtual', list[i].CLASS_GROUP_PREVIR);
			
			var thearray = JSON.stringify([list[i].CLASS_GROUP_HOOD]);
			var hood = getFriendDescs(thearray,"hoods");
			var n3 = cellCreator('Barrio/Vereda', hood);
			
			var d = cellCreator('Fecha', list[i].CLASS_DATE.split(" ")[0]);
			var hourItem = JSON.parse(list[i].CLASS_HOUR);
			
			var day = hourItem.GROUP_TIME_DAY;
			
			// FIX DAYNAMES
			if(day == "Su00e1bado")
			{day = "Sábado";}
			else if(day == "Miu00e9rcoles")
			{day = "Miércoles";}
			else
			{day = hourItem.GROUP_TIME_DAY;}
			
			var hourText = "Día: "+day+
							"<br>Hora inicio: "+hourItem.GROUP_TIME_INI+
							"<br>Hora Fin: "+hourItem.GROUP_TIME_END;
			
			var e = cellCreator('Horario', hourText);
			
			
			// CHECK CITIZENS, IF NO ASSIST, IS OPEN, OTHERWISE IS DICTATED
			if(list[i].CLASS_CITIZENS != "null" && list[i].CLASS_CITIZENS != "")
			{
				// console.log(list[i].CLASS_CITIZENS)
				// REPLACE TABS
				list[i].CLASS_CITIZENS = list[i].CLASS_CITIZENS.replace(/\t/g, ' ');
				list[i].CLASS_CITIZENS = list[i].CLASS_CITIZENS.replace(/\n/g, " ");
				
				// var precitizens = citizensFixer(list[i].CLASS_CITIZENS);
				
				// console.log(list[i].CLASS_CITIZENS);
				var citizens = JSON.parse(list[i].CLASS_CITIZENS);
				
				var status = "Abierta";
				var clistColor = "#e57979";
				for(var n=0; n<citizens.length; n++)
				{
					var citizen = citizens[n];
					if(citizen.CITIZEN_ASSIST == "1")
					{var status = "Dictada"; clistColor = "#ffc107"; break;}
				}
				var came = getAssistClass(citizens);
				var groupTotal = citizens.length;
			}
			else
			{
				var came = 0;
				var groupTotal = 0;
				var status = "Sin ciudadanos"; clistColor = "#c3e0fb"; 
			}
			
			
			var as = cellCreator('Asistentes', came+"/"+groupTotal);
			
			// SET BEHAVIOR IF EXCUSE
			if(list[i].CLASS_EXCUSE != null && list[i].CLASS_EXCUSE != "")
			{
				// console.log(list[i].CLASS_EXCUSE)
				var excuseColor = "#e83e8c";
				clistColor = "#d6d0d0";
				var status = "No dictada";
				
			}
			else
			{
				var excuseColor = "#d6d0d0";
				var exFormat = "";
			}

			var excuseFile = faIcon(list[i],"exclamation-circle","Descargar archivo de excusa", "#60d3ec");
			excuseFile.exFormat = exFormat;
			excuseFile.onclick = function()
			{
				
				var data = this.reg;
				actualClassCode = data.CLASS_CODE;
				var info = {};
				info.classCode = actualClassCode;
				info.mode = "1";
				
				// GET EXCUSE DATA
				sendAjax("users","getExcuseData",info,function(response)
				{
					var ans = response.message;
					console.log(ans)
					
					

					var format = ans.split(",")[0].split("/")[1].split(";")[0];
					var file = ans;
					var a = document.createElement("a"); //Create <a>
					a.href = file; 
					a.download = "Soporte excusa."+format; //File name Here
					a.click(); 
				
				});
				
				
				
			}
			
			var excuse = faIcon(list[i],"exclamation-circle","Excusa de no presentación",excuseColor);
			excuse.classTate = status;
			excuse.reg = list[i];
			excuse.onclick = function()
			{
				if(this.classTate == "Dictada")
				{
					fastPop("Esta clase se realizó y tiene asistencia, no puede agregar una excusa a una clase dictada.", 4000);
					return;
				}

				var data = this.reg;
				actualClassCode = data.CLASS_CODE;
				var info = {};
				info.classCode = actualClassCode;
				info.mode = "0";
				
				// GET EXCUSE DATA
				sendAjax("users","getExcuseData",info,function(response)
				{
					var ans = response.message;
					ans = ans.replace(/\t/g, ' ');
					
					if(ans != "" && ans != null)
					{actualEditData = JSON.parse(ans);}
					else
					{actualEditData = "";}

					loadForm("excuse");
				});

			}
			
			var excuseCancel = faIcon(list[i],"window-close","Eliminar excusa","#ea8fb1");
			excuseCancel.reg = list[i];
			excuseCancel.onclick = function()
			{
				
				var data = this.reg;
				actualClassCode = data.CLASS_CODE;
				var params = [];
				confirmBox(language["confirm"], "¿Desea eliminar la excusa y devolver la clase a estado abierta?",cancelExcuse, params);
				
			}
			
			var citizens = faIcon(list[i],"user-plus","Agregar ciudadano a clase","#3b5dbf");
			citizens.onclick = function()
			{
				
				
				// RM CANT TOUCH
				var contract = userData.USER_CONTRACT;
				if(contract == "" && userData.USER_CTYPE != "Superior")
				{fastPop("Solo el usuario con el contrato vinculado podrá editar esa área de la clase.", 2000);return;}

				// CHECK IF GROUP IS MINE
				// var utype = userData.USER_CTYPE;
				// if(utype != "Principal3" && utype != "Superior")
				// {
					// var group = this.reg.GROUP_CODE;
					// var myGroups = getUserGroups(userData.USER_GROUPS);
					
					// console.log(group)
					// console.log(myGroups)
					
					// if(!myGroups.includes(group))
					// {
						// fastPop("Este grupo no se encuentra asignado a tu contrato", 2000);
						// return;
					// }
				// }
				
				citizenOrigin = "cl";
				actualClassCode = this.reg.CLASS_CODE;
				actualGroupCode = this.reg.CLASS_GROUP;
				loadForm("citizen");
			}
			
			var clist = faIcon(list[i],"users","Ciudadanos del grupo",clistColor);
			clist.classTate = status;
			clist.onclick = function()
			{
				if(this.classTate == "No dictada")
				{
					fastPop("Esta clase no se realizó, no puede agregar asistencia a una clase no dictada.", 4000);
					return;
				}
				
				// CHECK IF GROUP IS MINE
				// var utype = userData.USER_CTYPE;
				// if(utype != "Principal3" && utype != "Superior")
				// {
					// var group = this.reg.CLASS_GROUP;
					// var myGroups = getUserGroups(userData.USER_GROUPS);
					// if(!myGroups.includes(group))
					// {
						// fastPop("Este grupo no se encuentra asignado a tu contrato", 2000);
						// return;
					// }
				// }
				
				actualClassCode = this.reg.CLASS_CODE;
				
				var hours = JSON.parse(this.reg.CLASS_HOUR);
				actualClassDate = this.reg.CLASS_DATE;
				actualClassIni = hours.GROUP_TIME_INI;
				actualClassEnd = hours.GROUP_TIME_END;
				classOrigin = "c";
				getItemList(actualClassCode, "citizensAssist")
			}
			
			var f = cellCreator('Estado', status);
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.reg = list[i];
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_classes",data];
				confirmBox(language["confirm"], "¿Desea eliminar esta clase?",deleteItem, params);
			}
			
			var edit = faIcon(list[i],"edit","Editar clase","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				loadForm("classEdit");
			}

			var syncGroup = faIcon(list[i],"sync","Sincronizar ciuadanos desde grupo", "#60d3ec");
			syncGroup.exFormat = exFormat;
			syncGroup.onclick = function()
			{
				actualClassCode = this.reg.CLASS_CODE;
				var info = {};
				info.classCode = this.reg.CLASS_CODE;
				info.groupCode = this.reg.CLASS_GROUP;
				sendAjax("users","syncGroup",info,function(response)
				{
					var ans = response.message;
					fastPop("Se ha sincronizado la clase con el grupo, ciudadanos agregados: "+ans, 3000);
					refreshTable("wp_classes");
				});
			}
			
			// ICONS PUSH IF CONDITION
			var icons = [];
			
			// ADD EDIT ICON
			var utype = userData.USER_CTYPE;
			if(utype == "Principal3" || utype == "Superior")
			{
				icons.push(edit);
			}
			
			

			icons.push(citizens);
			icons.push(clist);
			icons.push(excuse);
			if(list[i].CLASS_EXCUSE_FILE == "1")
			{icons.push(excuseFile);}
			
			if(list[i].CLASS_EXCUSE != null && list[i].CLASS_EXCUSE != "")
			{
				if(utype == "Principal3" || utype == "Superior")
				{
					icons.push(excuseCancel);
				}
			}

			// ADD DELETE ICON
			
			if(utype == "Principal3" || utype == "Superior")
			{icons.push(del);}
			
			if(utype == "Principal1" || utype == "Principal2")
			{var icons = [];}
			
			icons.push(syncGroup);

			var x = cellOptionsCreator('', icons)
			var cells = [d,e,a2,c,b,n2,instype,n3,f,as,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// ETARIES
	if(tableId == "wp_etaries")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].ETARIE_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].ETARIE_NAME);
			var c = cellCreator('Desde', list[i].ETARIE_FROM);
			var d = cellCreator('Hasta', list[i].ETARIE_TO);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("etarie")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_etaries",data];
				confirmBox(language["confirm"], "¿Desea eliminar este ciclo etario?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [a,b,c,d,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// INSTITUTES
	if(tableId == "wp_institutes")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			
			var a = cellCreator('Lugar de servicio', list[i].INSTITUTE_NAME);
			var b = cellCreator('Ciudad', list[i].INSTITUTE_CITY);
			
			
			var thearray = JSON.stringify([list[i].INSTITUTE_ZONE]);
			var zones = getFriendDescs(thearray,"zones");
			var c = cellCreator('Comuna/Corregimiento', zones);
			
			
			var thearray = JSON.stringify([list[i].INSTITUTE_HOOD]);
			var hood = getFriendDescs(thearray,"hoods");
			var d = cellCreator('Barrio/Vereda', hood);
			
			var e = cellCreator('Dirección', list[i].INSTITUTE_ADDRESS);
			var f = cellCreator('Coordenada', list[i].INSTITUTE_COORDS);
			
			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("institute")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_institutes",data];
				confirmBox(language["confirm"], "¿Desea eliminar esta institución?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [a,b,c,d,e,f,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// REGULAR EVENTS
	if(tableId == "wp_events")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			if(list[i].EVENT_TYPE == "1")
			{
				continue;
			}
			
			// var thearray = JSON.stringify([list[i].EVENT_ENTITY]);
			// var entity = getFriendDescs(thearray,"entities");
			// var a = cellCreator('Entidad', entity);

			var b = cellCreator('Nombre', list[i].EVENT_NAME);
			var range = "Desde: "+list[i].EVENT_DATE_INI+"<br>Hasta: "+list[i].EVENT_DATE_END;
			var c = cellCreator('Fecha', range);

			// RESPONSABLE AND ACTIVITY

			var activitiesDesc = list[i].EVENT_OWNER_FULL+":<br>"+getFriendDescs(list[i].EVENT_ACTIVITIES,"activities");

			var d = cellCreator('Actividades', activitiesDesc);
			
			var thearray = JSON.stringify([list[i].EVENT_HOOD]);
			var hood = getFriendDescs(thearray,"hoods");
			var e = cellCreator('Barrio o vereda', hood);

			// REPLACE FOR SUPPORT AND ACTIVITIES
			var supporTeam = getFriendlySupport(list[i].EVENT_SUPPORT_TEAM);
			
			var f = cellCreator('Apoyos', supporTeam);
			var n = cellCreator('Presencial/Virtual', list[i].EVENT_PREVIR);
			var instype = cellCreator('Institucional/Comunitario', list[i].EVENT_INSTYPE);
			
			var assisTotal = getAssisTotal(list[i].EVENT_ASSIST);
			var m = cellCreator('Total asistentes', assisTotal);
			
			var edit = faIcon(list[i],"edit","Editar","#007bff");
			
			edit.onclick = function()
			{
				actualEditData = this.reg;
				citizenOrigin = "eve";
				viewMode = "0";
				eventsMode = 1;
				checkEventGoals();
			}
			
			var eventFileSheet = faIcon(list[i],"list-alt","Descargar formato de conteo", "#daa3a3");
			eventFileSheet.reg = list[i];
			eventFileSheet.onclick = function()
			{
				getRegFile("wp_events", "EVENT_SHEET", "EVENT_CODE", this.reg.EVENT_CODE, "Formato de conteo.")
			}
			
			var eventFilePic = faIcon(list[i],"camera","Descargar foto del evento", "#4ddac0");
			eventFilePic.reg = list[i];
			eventFilePic.onclick = function()
			{
				// GET EVENT_SHEET
				getRegFile("wp_events", "EVENT_PIC", "EVENT_CODE", this.reg.EVENT_CODE, "Foto del evento.")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_events",data];
				confirmBox(language["confirm"], "¿Desea eliminar este evento?",deleteItem, params);
			}
			
			var viewEvent = faIcon(list[i],"eye","Visualizar información de evento","#32d67b");
			viewEvent.reg = list[i];
			viewEvent.onclick = function()
			{
				console.log("lololo");
				
				actualEvents = "0";
				actualViewData = this.reg;
				viewMode = "1";
				checkEventGoals();
			}
			
			var owner = list[i].EVENT_OWNER;
			
			var icons = [];
			icons.push(viewEvent);
			icons.push(eventFileSheet);	
			icons.push(eventFilePic);
			
			
			// ONLY CAN TOUCH IF OWNER
			if(userData.USER_CODE == owner || userData.USER_CTYPE == "Superior")
			{
				icons.push(edit);
				
				icons.push(del);
			}
			
			var x = cellOptionsCreator('', icons)
			var cells = [c,b,d,f,n,instype,e,m,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// REQUEST EVENTS
	if(tableId == "wp_events_r")
	{
		for(var i=0; i<list.length; i++)
		{
			
			if(list[i].EVENT_TYPE == "0")
			{
				continue;
			}
			
			var row = document.createElement("div");
			row.className = "rowT";
			
			// var thearray = JSON.stringify([list[i].EVENT_ENTITY]);
			// var entity = getFriendDescs(thearray,"entities");
			// var a = cellCreator('Entidad', entity);

			var b = cellCreator('Radicado', list[i].EVENT_RADICATE);
			
			// REQUEST TYPE
			var requestType = list[i].EVENT_REQUEST_TYPE+"<br>"+list[i].EVENT_INSTYPE+"<br>"+list[i].EVENT_PREVIR;
			
			var c = cellCreator('Tipo', requestType);
			var d = cellCreator('Nombre del evento', list[i].EVENT_NAME);
			var d2 = cellCreator('Nombre creador solicitud', list[i].EVENT_AUTHOR_NAME);
			var d3 = cellCreator('Nombre solicitante', list[i].EVENT_REQUESTER_FULL);
			
			var thearray = JSON.stringify([list[i].EVENT_HOOD]);
			var hood = getFriendDescs(thearray,"hoods");
			var e = cellCreator('Barrio o vereda', hood);
			
			var af = cellCreator('Fecha solicitud', list[i].EVENT_REQUEST_DATE);
			
			// DATE RANGE
			var iniDate = list[i].EVENT_DATE_INIR;
			var endDate = list[i].EVENT_DATE_ENDR;
			if(iniDate == null || iniDate == "")
			{iniDate = "Por definir";}
			if(endDate == null || endDate == "")
			{endDate = "Por definir";}
			var range = "Desde: "+iniDate+"<br>Hasta: "+endDate
			var f = cellCreator('Fecha solicitada', range);
			
			// DATE RANGE
			var iniDate = list[i].EVENT_DATE_INI;
			var endDate = list[i].EVENT_DATE_END;
			if(iniDate == null || iniDate == "")
			{iniDate = "Por definir";}
			if(endDate == null || endDate == "")
			{endDate = "Por definir";}
			var range = "Desde: "+iniDate+"<br>Hasta: "+endDate
			var fa = cellCreator('Fecha ejecución', range);
			
			if(list[i].EVENT_OWNER_FULL != "" && list[i].EVENT_OWNER_FULL != null)
			{
				var activitiesDesc = list[i].EVENT_OWNER_FULL+":<br>"+getFriendDescs(list[i].EVENT_ACTIVITIES,"activities");
			}
			else
			{
				var activitiesDesc = "Sin asignar";
			}
			
			var g = cellCreator('Nombre contratista', activitiesDesc);
			
			// REPLACE FOR SUPPORT AND ACTIVITIES
			var supporTeam = getFriendlySupport(list[i].EVENT_SUPPORT_TEAM);
			
			var ga = cellCreator('Apoyos y sus actividades', supporTeam);
			
			var assisTotal = getAssisTotal(list[i].EVENT_ASSIST);
			var gb = cellCreator('Total asistentes', assisTotal+"/"+list[i].EVENT_EXPECTED);
			
			// SET EVENT STATUS
			if(list[i].EVENT_STATUS == "1")
			{var status = "Solicitud";}
			else if(list[i].EVENT_STATUS == "3")
			{var status = "Rechazado";}
			else if(list[i].EVENT_STATUS == "2")
			{var status = "Asignado";}
			else if(list[i].EVENT_STATUS == "4")
			{var status = "Cerrado";}
			else
			{var status = list[i].EVENT_STATUS;}
			var h = cellCreator('Estado', status);
			
			var editRequest = faIcon(list[i],"file-export","Gestionar solicitud","#007bff");
			editRequest.reg = list[i];
			editRequest.onclick = function()
			{
				
				var myActis = JSON.parse(userData.USER_ACTIVITIES);
				var eventActi = this.reg.EVENT_REQUEST_ACTIVITY;
				
				if(!myActis.includes(eventActi))
				{fastPop("Solo puede gestionar eventos si la actividad de solicitud se encuentra es sus actividades de contrato.", 3000); return;}

				actualEditData = this.reg;
				requestState = this.reg.EVENT_STATUS;
				viewMode = "0";
				citizenOrigin = "evre";
				eventsMode = 1;
				checkEventGoals();
			}
			
			var closeRequest = faIcon(list[i],"window-close","Cerrar evento","#ea9d6f");
			closeRequest.reg = list[i];
			closeRequest.onclick = function()
			{
				// OWNER CHECK
				var myCode = userData.USER_CONTRACT;
				var eventOwner = this.reg.EVENT_OWNER;
				if(myCode != eventOwner)
				{fastPop("Solo quien tiene asignada la dirección del evento puede cerrarlo.", 3000); return;}
				
				// DATE CHECK
				var finishDate = this.reg.EVENT_DATE_END;
				var now = getNow();
				if(finishDate >= now)
				{fastPop("Solo se puede cerrar un evento que ya haya concluido.", 2000);return;}
				

				actualEditData = this.reg;
				requestState = "4";
				viewMode = "0";
				citizenOrigin = "evre";
				eventsMode = 1;
				checkEventGoals();
			}
			
			var transferRequest = faIcon(list[i],"exchange-alt","Trasladar evento","#78d2fd");
			transferRequest.reg = list[i];
			transferRequest.onclick = function()
			{
				
				var myActis = JSON.parse(userData.USER_ACTIVITIES);
				var eventActi = this.reg.EVENT_REQUEST_ACTIVITY;
				// console.log(myActis);
				// console.log(eventActi);
				
				// if(!myActis.includes(eventActi))
				// {fastPop("Solo puede trasladar eventos si la actividad de solicitud se encuentra es sus actividades de contrato.", 3000); return;}
				
				actualEditData = this.reg;
				loadForm("eventTrasfer")
			}
			
			var rejectRequest = faIcon(list[i],"ban","Rechazar evento","#dc1c1c");
			rejectRequest.reg = list[i];
			rejectRequest.onclick = function()
			{
				
				actualEditData = this.reg;
				loadForm("eventReject");
			}
			
			var rejectRequestReason = faIcon(list[i],"info-circle","Trasladar eventos","#dc1c1c");
			rejectRequestReason.reg = list[i];
			rejectRequestReason.onclick = function()
			{
				
				actualEditData = this.reg;
				loadForm("eventRejectReason");
			}
			
			var eventRequestFile = faIcon(list[i],"list-alt","Descargar archivo de solicitud", "#37abb7");
			eventRequestFile.evFile = list[i].EVENT_REQUEST_FILE;
			eventRequestFile.onclick = function()
			{
				getRegFile("wp_events", "EVENT_REQUEST_FILE", "EVENT_CODE", this.reg.EVENT_CODE, "Soporte de solicitud.")
			}
			
			var eventFileSheet = faIcon(list[i],"list-alt","Descargar formato de conteo", "#daa3a3");
			eventFileSheet.reg = list[i];
			eventFileSheet.onclick = function()
			{
				getRegFile("wp_events", "EVENT_SHEET", "EVENT_CODE", this.reg.EVENT_CODE, "Formato de conteo.")
			}
			
			var eventFilePic = faIcon(list[i],"camera","Descargar foto del evento", "#4ddac0");
			eventFilePic.reg = list[i];
			eventFilePic.onclick = function()
			{
				// GET EVENT_SHEET
				getRegFile("wp_events", "EVENT_PIC", "EVENT_CODE", this.reg.EVENT_CODE, "Foto del evento.")
			}
			
			var getRequesterData = faIcon(list[i],"user","Ver información de solicitante", "#2f93ce");
			getRequesterData.reg = list[i];
			getRequesterData.onclick = function()
			{
				var id = this.reg.EVENT_REQUESTER.split("-")[0];
				showCitizenDetail("Información del solicitante",id);
			}
			
			var getCooperatorData = faIcon(list[i],"user","Ver información de cooperador", "#de62be");
			getCooperatorData.reg = list[i];
			getCooperatorData.onclick = function()
			{
				var id = this.reg.EVENT_COOPERATOR.split("-")[0];
				showCitizenDetail("Información del cooperador",id);
			}
			
			var viewEvent = faIcon(list[i],"eye","Visualizar información de evento","#32d67b");
			viewEvent.reg = list[i];
			viewEvent.onclick = function()
			{
				actualEvents = "1";
				actualViewData = this.reg;
				viewMode = "1";
				checkEventGoals();
			}
			
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_events_r",data];
				confirmBox(language["confirm"], "¿Desea eliminar este evento por solicitud?",deleteItem, params);
			}
			
			var author = list[i].EVENT_AUTHOR;
			var thisRequestState = list[i].EVENT_STATUS;
			var requesterData = list[i].EVENT_REQUESTER;
			var cooperatorData = list[i].EVENT_COOPERATOR;

			var icons = [];
			icons.push(viewEvent);
			
			// ONLY CAN TOUCH IF OWNER
			if(userData.USER_CODE == author || userData.USER_CTYPE == "Director" || userData.USER_CTYPE == "Coordinador" || userData.USER_CTYPE == "Instructor" || userData.USER_CTYPE == "Superior" || userData.USER_CTYPE == "Cogestor" || userData.USER_CTYPE == "Principal1" || userData.USER_CTYPE == "Principal2" || userData.USER_CTYPE == "Principal3")
			{
				
				if(thisRequestState == "1")
				{
					
					icons.push(eventRequestFile);
					
					var utype = userData.USER_CTYPE;
					if(utype == "Director" || utype == "Coordinador")
					{
						icons.push(editRequest);
						icons.push(transferRequest);
						icons.push(rejectRequest);
					}
				}
				
				if(thisRequestState == "2")
				{
					
					icons.push(eventRequestFile);
					var utype = userData.USER_CTYPE;
					if(utype == "Director" || utype == "Coordinador")
					{
						icons.push(editRequest);
						icons.push(transferRequest);
					}

					// OWNER CHECK
					var myCode = userData.USER_CONTRACT;
					var eventOwner = list[i].EVENT_OWNER;
					if(myCode == eventOwner){icons.push(closeRequest);}
					
				}
				
				if(thisRequestState == "4")
				{
					icons.push(eventRequestFile);
					if(list[i].EVENT_SHEET != "" && list[i].EVENT_SHEET != null)
					{icons.push(eventFileSheet);}
					if(list[i].EVENT_PIC != "" && list[i].EVENT_PIC != null)
					{icons.push(eventFilePic);}
					
					// OWNER CHECK
					var myCode = userData.USER_CONTRACT;
					var eventOwner = list[i].EVENT_OWNER;
					if(myCode == eventOwner)
					{icons.push(closeRequest);}
					
				}

			}
			
			if(status == "Rechazado")
			{
				icons = [];
				icons.push(viewEvent);
				// icons.push(rejectRequestReason);+
			}
			
			if(userData.USER_CTYPE == "Superior")
			{icons.push(del);}
			
			var x = cellOptionsCreator('', icons)
			var cells = [af,fa,d,d2,d3,g,c,e,f,ga,gb,h,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// PROGRAMMED ON DATE
	if(tableId == "wp_events_programmed")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			if(list[i].EVENT_CODE == actualEditData.EVENT_CODE){continue;}
			
			var a = cellCreator('Nombre evento', list[i].EVENT_NAME);
			var b = cellCreator('Fecha inicial solicitud', list[i].EVENT_DATE_INIR);
			var c = cellCreator('Fecha final solicitud', list[i].EVENT_DATE_ENDR);
			
			// SET EVENT STATUS
			if(list[i].EVENT_STATUS == "1")
			{var status = "Solicitud";}
			else if(list[i].EVENT_STATUS == "3")
			{var status = "Rechazado";}
			else if(list[i].EVENT_STATUS == "2")
			{var status = "Asignado";}
			else if(list[i].EVENT_STATUS == "4")
			{var status = "Cerrado";}
			else
			{var status = list[i].EVENT_STATUS;}

			
			var d = cellCreator('Estado', status);
			var e = cellCreator('Contratista', list[i].OWNER_NAME);

			var cells = [a,b,c,d,e];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// SHEET REPORT GENERAL
	if(tableId == "wp_report_sheet_general")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a = cellCreator('Dato', list[i].NAME, "left");
			var b = cellCreator('Detalle', list[i].DETAIL, "left");
			// var c = cellCreator('Ampliar', "+");
			
			

			var cells = [a,b];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// SHEET REPORT GENERAL INDEXES
	if(tableId == "wp_report_indicators")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a = cellCreator('', list[i].F1);
			var b = cellCreator('', list[i].F2);
			var c = cellCreator('', list[i].F3);
			var d = cellCreator('', list[i].F4);

			var cells = [a,b,c,d];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	
	// SHEET REPORT GENERAL INDEXES
	if(tableId == "wp_report_Assist_Detail")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a = cellCreator('', list[i].CONTRATIST_NAME);
			var b = cellCreator('', list[i].COUNT1);
			var c = cellCreator('', list[i].COUNT2);
			var d = cellCreator('', list[i].COUNT3);

			var cells = [a,b,c,d];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	
	// SHEET REPORT GENERAL INDEXES
	if(tableId == "wp_report_Events_Detail")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var internal = list[i].INTERNAL;
			var external = list[i].EXTERNAL;
			var suported = list[i].SUPPORTED;
			
			
			var a = cellCreator('', list[i].CONTRATIST_NAME);
			var b = cellCreator('', internal+external+suported);
			var c = cellCreator('', internal);
			var d = cellCreator('', external);
			var e = cellCreator('', internal+external);
			var f = cellCreator('', suported);
			var g = cellCreator('', list[i].SERVICES);

			var cells = [a,b,c,d,e,f,g];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// VISITABLE CLASES
	if(tableId == "wp_visitable")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var data = list[i];
			var gData = data.GROUP_DATA;
			
			
			var thearray = JSON.stringify([gData.GROUP_ACTIVITY]);
			var activity = getFriendDescs(thearray,"activities");
			var a = cellCreator('Actividad', activity);			
			
			
			var hourText = "Día: "+data.GROUP_TIME_DAY+
							"<br>Hora inicio: "+data.GROUP_TIME_INI+
							"<br>Hora Fin: "+data.GROUP_TIME_END;
			
			
			
			var b = cellCreator('Rango Fecha', hourText);
			var c = cellCreator('Presencial/virtual', gData.GROUP_PREVIR);
			var c2 = cellCreator('Nombre grupo', gData.GROUP_NAME);
			
			
			// GET ACTIVITY NAME
			var thearray = JSON.stringify([gData.GROUP_INSTITUTE]);
			var institute = getFriendDescs(thearray,"institutes");
			
			var d = cellCreator('Institución', institute);
			var e = cellCreator('Dirección', gData.GROUP_ADDRESS);
			
			var contratistText = gData.CONTRACT_REQUESTER_ID+
							"<br>"+gData.CONTRACT_REQUESTER_NAME+
							"<br>"+gData.CONTRACT_REQUESTER_EMAIL+
							"<br>"+gData.CONTRACT_REQUESTER_PHONE;
			
			
			
			var f = cellCreator('Datos contratista', contratistText);
			
			var cooperatorText = gData.COOPERATOR_ID+
							"<br>"+gData.COOPERATOR_NAME+
							"<br>"+gData.COOPERATOR_EMAIL+
							"<br>"+gData.COOPERATOR_PHONE;
			
			var g = cellCreator('Datos cooperador', cooperatorText);

			var visit = faIcon(list[i],"edit","Visualizar información de evento","#32d67b");
			visit.reg = list[i];
			visit.onclick = function()
			{
				var info = {}
				info.CLASS_GROUP = this.reg.GROUP_DATA.GROUP_CODE;
				info.CLASS_DATE = this.reg.CLASS_DATE;
				info.CLASS_TIME_INI = this.reg.GROUP_TIME_INI;
				
				
				actualEditData = this.reg;
				
				// console.log(info)
				
				
				sendAjax("users","getClassCode",info,function(response)
				{
					var ans = response.message;
					console.log(ans)

					if(ans.length > 0)
					{
						actualVisitClass = ans[0].CLASS_CODE;
						loadForm("visitable");
					}
					else
					{
						fastPop("Aún no se puede registrar visita a esta clase", 2000);
					}
					
				});
				
				
			}
			
			var icons = [];
			icons.push(visit);
			
			var x = cellOptionsCreator('', icons)
			var cells = [b,f,g,a,c,c2,d,e,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// VISITS DONE 
	if(tableId == "wp_visits")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var data = list[i];

			var a = cellCreator('Fecha y ubicación clase', "Fecha: "+data.VISIT_CLASS_DATE+" "+data.VISIT_CLASS_INI_TIME+":00 "+"<br>Coordenada: "+data.VISIT_CLASS_COORD);			
			var b = cellCreator('Fecha y ubicación visita', "Fecha: "+data.VISIT_DATE+"<br>Coordenada: "+data.VISIT_COORD);			
			var c = cellCreator('Tipo visita', data.VISIT_TYPE+" - "+data.VISIT_MODE);			
			var d = cellCreator('Actividad realizada', data.VISIT_DONE);	
			var thearray = JSON.stringify([data.VISIT_HOOD]);
			var hood = getFriendDescs(thearray,"hoods");
			var fullHood = hood+" - "+getZoneFromHood(data.VISIT_HOOD)
			var e = cellCreator('Barrio o Vereda', fullHood);			
			var f = cellCreator('Nombre grupo', data.VISIT_GROUP_NAME);			
			
			var thearray = JSON.stringify([data.VISIT_ACTIVITY]);
			var activity = getFriendDescs(thearray,"activities");
			
			var f2 = cellCreator('Actividad', activity);			
			
			var ass = cellCreator('Asistencia', data.VISIT_ASSISTQTY+" - "+data.VISIT_NOASSISTQTY+" / "+data.VISIT_TOTAL_PEOPLE);			
			
			var g = cellCreator('Dirección', data.VISIT_ADDRESS);			
			var h = cellCreator('Datos contratista', data.VISIT_CONTRATIST);			
			var j = cellCreator('Datos visitador', "CC "+data.VISIT_VISITOR);			

			var visitEdit = faIcon(list[i],"edit","Visualizar información de evento","#32d67b");
			visitEdit.reg = list[i];
			visitEdit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("visit");
			}
			
			var viewVisit = faIcon(list[i],"eye","Visualizar información de visita","#1ab8d2");
			viewVisit.reg = list[i];
			viewVisit.onclick = function()
			{
				actualViewData = this.reg;
				loadForm("detailView");
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_visits",data];
				confirmBox(language["confirm"], "¿Desea eliminar esta visita?",deleteItem, params);
			}
			
			var icons = [];
			
			if(userData.USER_CTYPE == "Superior" || userData.USER_CTYPE == "Principal3")
			{icons.push(visitEdit);}
			icons.push(viewVisit);

			var eventClassPlan = faIcon(list[i],"file-download","Descargar plan de clase", "#da4dc2");
			eventClassPlan.reg = list[i];
			eventClassPlan.onclick = function()
			{
				// GET EVENT CLASS PLAN
				getRegFile("wp_visits", "VISIT_CLASS_PLAN", "VISIT_CODE", this.reg.VISIT_CODE, "Plan de clase.")
			}
	
			
			var eventAssistList = faIcon(list[i],"list-alt","Descargar asistencia clase", "#19d01f");
			eventAssistList.reg = list[i];
			eventAssistList.onclick = function()
			{
				// GET EVENT ASSIST PIC
				getRegFile("wp_visits", "VISIT_ASSIST_LIST", "VISIT_CODE", this.reg.VISIT_CODE, "Foto asistencia.")
			}
			
			var eventClassPic = faIcon(list[i],"camera","Descargar foto clase", "#e29c1b");
			eventClassPic.reg = list[i];
			eventClassPic.onclick = function()
			{
				// GET EVENT ASSIST PIC
				getRegFile("wp_visits", "VISIT_CLASSPIC", "VISIT_CODE", this.reg.VISIT_CODE, "Foto de clase.")
			}

			if(list[i].VISIT_CLASS_PLAN != ""){icons.push(eventClassPlan);}
			if(list[i].VISIT_ASSIST_LIST != ""){icons.push(eventAssistList);}
			if(list[i].VISIT_CLASSPIC != ""){icons.push(eventClassPic);}

			if(userData.USER_CTYPE == "Superior"){icons.push(del);}
						
			var x = cellOptionsCreator('', icons)
			var cells = [a,b,c,h,j,f,f2,e,d,g,ass,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// ED LEVEL
	if(tableId == "wp_master_edlevel")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].EDLEVEL_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].EDLEVEL_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("edlevel")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_edlevel",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [a,b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// OCU COND
	if(tableId == "wp_master_ocucond")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].OCUCOND_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].OCUCOND_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("ocucond")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_ocucond",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// TRAS DES
	if(tableId == "wp_master_trasdes")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].TRASDES_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].TRASDES_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("trasdes")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_trasdes",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// TIPOVI DES
	if(tableId == "wp_master_tipovi")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].TIPOVI_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].TIPOVI_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("tipovi")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_tipovi",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// GENRE
	if(tableId == "wp_master_genre")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].GENRE_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].GENRE_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("genre")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_genre",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// EPS
	if(tableId == "wp_master_eps")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].EPS_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].EPS_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("eps")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_eps",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// RISKFA
	if(tableId == "wp_master_riskfa")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].RISKFA_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].RISKFA_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("riskfa")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_riskfa",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// PREVFA
	if(tableId == "wp_master_prevfa")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].PREVFA_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].PREVFA_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("prevfa")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_prevfa",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// INGREC
	if(tableId == "wp_master_ingrec")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].INGREC_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].INGREC_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("ingrec")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_ingrec",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// CONVAC
	if(tableId == "wp_master_convac")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].CONVAC_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].CONVAC_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("convac")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_convac",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// PATOEN
	if(tableId == "wp_master_patoen")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].PATOEN_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].PATOEN_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("patoen")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_patoen",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// COURSES
	if(tableId == "wp_master_courses")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].COURSES_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].COURSES_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("courses")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_courses",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// TIPOCO
	if(tableId == "wp_master_tipoco")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].TIPOCO_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].TIPOCO_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("tipoco")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_tipoco",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// TIPOSO
	if(tableId == "wp_master_tiposo")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].TIPOSO_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].TIPOSO_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("tiposo")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_tiposo",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// MIGREA
	if(tableId == "wp_master_migrea")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].MIGREA_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].MIGREA_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("migrea")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_migrea",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// TIPOIN
	if(tableId == "wp_master_tipoin")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var thearray = JSON.stringify([list[i].TIPOIN_ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var a = cellCreator('Entidad', entity);
			var b = cellCreator('Nombre', list[i].TIPOIN_NAME);
			

			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("tipoin")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_tipoin",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// REMITIONS
	if(tableId == "wp_remitions")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			
			// SHOW RESTRICTIONS AS USER TYPE
			
			if(userData.USER_CTYPE == "Principal1" || userData.USER_CTYPE == "Principal2" || userData.USER_CTYPE == "Principal3" || userData.USER_CTYPE == "Superior")
			{
				console.log("im special");
			}
			else
			{
				
				if(list[i].REM_AUTOR != userData.USER_CODE && list[i].REM_CONTRATIST != userData.USER_CODE)
				{
					console.log("im not special");
					continue;
				}
				
			}
			
			var a = cellCreator('Fecha', list[i].REM_DATE);
			var b = cellCreator('Línea', list[i].REM_LINE);
			var c = cellCreator('Remisor', list[i].REM_AUTOR_NAME);
			var d = cellCreator('Ciudadano', list[i].REM_CITIZEN_NAME);
			var e = cellCreator('Remitido a', list[i].REM_CONTRATIST_NAME);
			
			var thearray = JSON.stringify([list[i].REM_ACTIVITY]);
			var activity = getFriendDescs(thearray,"activities");
			
			var f = cellCreator('Actividad', activity);
			var g = cellCreator('Estado', list[i].REM_STATE);
			
			
			var attend = faIcon(list[i],"folder-open","Atender","#007bff");
			attend.onclick = function()
			{
				var remData = this.reg;
				actualRemitionData = remData;
				loadIf("attendB");
			}
			
			var historyLine = faIcon(list[i],"external-link","Ver línea de atención","#c66cd7");
			historyLine.onclick = function()
			{
				var remData = this.reg;
				actualRemitionData = remData;
				actualHistoryMode = "line";
				var info = {};
				
				info.REMCOM_LINE = actualRemitionData.REM_LINE;
				info.REMCOM_CITIZEN = actualRemitionData.REM_CITIZEN;
				info.REMCOM_MODE = actualHistoryMode;

				sendAjax("users","getRemHistory",info,function(response)
				{
					var ans = response.message;
					remHistory = ans;
					loadForm("historyView");
				});

			}
			
			var history = faIcon(list[i],"history","Ver historial","#35c167");
			history.onclick = function()
			{
				var remData = this.reg;
				actualRemitionData = remData;
				actualHistoryMode = "history";
				var info = {};
				
				info.REMCOM_LINE = actualRemitionData.REM_LINE;
				info.REMCOM_CITIZEN = actualRemitionData.REM_CITIZEN;
				info.REMCOM_MODE = actualHistoryMode;

				sendAjax("users","getRemHistory",info,function(response)
				{
					var ans = response.message;
					remHistory = ans;
					loadForm("historyView");
				});
			}
			
			var remClose = faIcon(list[i],"window-close","Remitir y cerrar","#fdae4c");
			remClose.onclick = function()
			{

				var remData = this.reg;
				actualRemitionData = remData;
				
				if(actualRemitionData.REM_STATE == "1")
				{fastPop("Esta operación es solo para atenciones abiertas.", 2000);return;}

				var info = {};
			
				sendAjax("users","getRemActiContracts",info,function(response)
				{
					var ans = response.message;
					var contracts = ans.active;
					remContratists = ans.contratists;
					
					var remActivities = [];
					for(var i=0; i<contracts.length; i++)
					{
						var contract = contracts[i];
						var actis = contract
						
						if(contract.CONTRACT_ACTIVITIES != null && contract.CONTRACT_ACTIVITIES != "")
						{
							actis = JSON.parse(contract.CONTRACT_ACTIVITIES);
							for(var a=0; a<actis.length; a++)
							{
								var acti = actis[a];
								if(!remActivities.includes(acti)){remActivities.push(acti);break;}
							}
						}
					}
					
					fixedActis = [];
					
					for(var i=0; i<remActivities.length; i++)
					{
						var fullActi = {};
						var thearray = JSON.stringify([remActivities[i]]);
						var acti = getFriendDescs(thearray,"activities");
						fullActi.ACTIVITY_CODE = remActivities[i];
						fullActi.ACTIVITY_DETAIL = acti;
						if(fullActi.ACTIVITY_DETAIL != ""){fixedActis.push(fullActi)}
					}
					
					setActParents();
					
					actualComment = "remClose";
					loadForm("remComment");
					
				});
						
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_remitions",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			
			var edit = faIcon(list[i],"user","Editar ciudadano","#007bff");
			edit.reg = list[i];
			edit.onclick = function()
			{
				citizenOrigin = "c";
				var remData = this.reg;
				
				var info = {};
				info.CITIZEN_IDNUM = remData.REM_CITIZEN;
				if(info.CITIZEN_IDNUM == ""){return;}
				
				console.log("no age check");
				
				loadManager(1);
				sendAjax("users","getCitizenMain",info,function(response)
				{
					loadManager(0);
					var ans = response.message;
					console.log(ans)
					
					actualEditData = ans[0];
					console.log(actualEditData);
					
					setTimeout(function(){editDataForm("citizen");}, 500);
					
					
				});
				
				
			}
			
			
			var icons = [];
			
			// console.log(userData.USER_CTYPE);
			
			if(list[i].REM_CONTRATIST == userData.USER_CODE){icons.push(attend);}

			icons.push(historyLine);
			icons.push(history);
			
			if(userData.USER_CTYPE == "Principal1" || userData.USER_CTYPE == "Principal2" || userData.USER_CTYPE == "Principal3" || userData.USER_CTYPE == "Superior")
			{if(list[i].REM_ORPHAN == "1"){icons.push(remClose);}}
		
			// icons.push(remClose)
			
			if(list[i].REM_AUTOR == userData.USER_CODE){icons.push(del);}
			
			if(userData.USER_CTYPE == "Principal3"){icons.push(edit);}
				

			
			// EVALUATE VIAVBILITY
			

			var x = cellOptionsCreator('', icons)
			var cells = [a,b,c,d,e,f,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	
	// COMMENTS
	if(tableId == "wp_attend")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a = cellCreator('Línea atención', list[i].REMCOM_LINE);
			var thearray = JSON.stringify([list[i].REMCOM_ACTIVITY]);
			var activity = getFriendDescs(thearray,"activities");
			var b = cellCreator('Actividad', activity);
			var c = cellCreator('Remisor', list[i].REMCOM_AUTOR_NAME);
			var d = cellCreator('Contratista', list[i].REMCOM_CONTRATIST_NAME);
			
			var ctype = "x";
			
			if(list[i].REMCOM_TYPE == "normalComment"){var ctype = "Normal";}
			if(list[i].REMCOM_TYPE == "addGroup"){var ctype = "Agrupación";}
			if(list[i].REMCOM_TYPE == "quitGroup"){var ctype = "Desagrupación";}
			if(list[i].REMCOM_TYPE == "remit"){var ctype = "Atención";}
			if(list[i].REMCOM_TYPE == "date"){var ctype = "Cita";}
			if(list[i].REMCOM_TYPE == "close"){var ctype = "Cierre";}
			if(list[i].REMCOM_TYPE == "reopen"){var ctype = "Re apertura";}
			if(list[i].REMCOM_TYPE == "decition"){var ctype = "Decisión";}
			
			var comment = list[i].REMCOM_DATE+" - Tipo: "+ctype+" - "+list[i].REMCOM_COMMENT;
			
			
			if(list[i].REMCOM_COMPONENT != "")
			{
				var thearray = JSON.stringify([list[i].REMCOM_COMPONENT]);
				var componentDesc = getFriendDescs(thearray,"components");
				
				var thearray = JSON.stringify([list[i].REMCOM_SCOMPONENT]);
				var scomponentDesc = getFriendDescs(thearray,"scomponents");
				
				comment = comment+"<br> Componente: "+componentDesc+" <br> Sub componente: "+scomponentDesc;
			}
			
			
			
			var e = cellCreator('Comentario', encry(comment));
			
			
			var f = cellCreator('Especial', list[i].REMCOM_SPECIAL);
			
			var thearray = JSON.stringify([list[i].REMCOM_GROUP]);
			var newgroup = getFriendDescs(thearray,"inigroups");
			
			var g = cellCreator('Grupo', newgroup);
			
			var h = cellCreator('Remitido a', list[i].REMCOM_NEW_CONTRATIST_NAME);
			
			var thearray = JSON.stringify([list[i].REMCOM_NEW_ACTIVITY]);
			var newactivity = getFriendDescs(thearray,"activities");
			var j = cellCreator('Nueva actividad', newactivity);
			
			
			if(list[i].REMCOM_REMSTATE == "0"){var state = "Abierta";}
			else{var state = "Cerrada";}
			
			var k = cellCreator('Estado actividad', state);
			
			
			var file = faIcon(list[i],"list-alt","Descargar adjunto", "#daa3a3");
			file.reg = list[i];
			file.onclick = function()
			{
				getRegFile("wp_attend", "REMCOM_FILE", "REMCOM_CODE", this.reg.REMCOM_CODE, "Adjunto.")
			}
			
			var icons = [];
			icons.push(file);

			var x = cellOptionsCreator('', icons)
			var cells = [a,b,c,d,e,f,g,h,j,k,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	
	// COMMENTS VIEW
	if(tableId == "wp_remHistory")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a = cellCreator('Línea atención', list[i].REMCOM_LINE);
			var thearray = JSON.stringify([list[i].REMCOM_ACTIVITY]);
			var activity = getFriendDescs(thearray,"activities");
			var b = cellCreator('Actividad', activity);
			var c = cellCreator('Remisor', list[i].REMCOM_AUTOR_NAME);
			var d = cellCreator('Contratista', list[i].REMCOM_CONTRATIST_NAME);
			
			var ctype = "x";
			
			if(list[i].REMCOM_TYPE == "normalComment"){var ctype = "Normal";}
			if(list[i].REMCOM_TYPE == "addGroup"){var ctype = "Agrupación";}
			if(list[i].REMCOM_TYPE == "quitGroup"){var ctype = "Desagrupación";}
			if(list[i].REMCOM_TYPE == "remit"){var ctype = "Atención";}
			if(list[i].REMCOM_TYPE == "date"){var ctype = "Cita";}
			if(list[i].REMCOM_TYPE == "close"){var ctype = "Cierre";}
			if(list[i].REMCOM_TYPE == "reopen"){var ctype = "Re apertura";}
			if(list[i].REMCOM_TYPE == "decition"){var ctype = "Decisión";}
			
			var comment = list[i].REMCOM_DATE+" - Tipo: "+ctype+" - "+list[i].REMCOM_COMMENT;
			
			if(list[i].REMCOM_COMPONENT != "")
			{
				var thearray = JSON.stringify([list[i].REMCOM_COMPONENT]);
				var componentDesc = getFriendDescs(thearray,"components");
				
				var thearray = JSON.stringify([list[i].REMCOM_SCOMPONENT]);
				var scomponentDesc = getFriendDescs(thearray,"scomponents");
				
				comment = comment+"<br> Componente: "+componentDesc+" <br> Sub componente: "+scomponentDesc;
			}
			
			
			var e = cellCreator('Comentario', encry(comment));
			
			
			var f = cellCreator('Especial', list[i].REMCOM_SPECIAL);
			
			var thearray = JSON.stringify([list[i].REMCOM_GROUP]);
			var newgroup = getFriendDescs(thearray,"inigroups");
			
			var g = cellCreator('Grupo', newgroup);
			
			var h = cellCreator('Remitido a', list[i].REMCOM_NEW_CONTRATIST_NAME);
			
			var thearray = JSON.stringify([list[i].REMCOM_NEW_ACTIVITY]);
			var newactivity = getFriendDescs(thearray,"activities");
			var j = cellCreator('Nueva actividad', newactivity);
			
			
			if(list[i].REMCOM_REMSTATE == "0"){var state = "Abierta";}
			else{var state = "Cerrada";}
			
			var k = cellCreator('Estado actividad', state);
			
			
			var file = faIcon(list[i],"list-alt","Descargar adjunto", "#daa3a3");
			file.reg = list[i];
			file.onclick = function()
			{
				getRegFile("wp_attend", "REMCOM_FILE", "REMCOM_CODE", this.reg.REMCOM_CODE, "Adjunto.")
			}
			
			var icons = [];
			icons.push(file);

			var x = cellOptionsCreator('', icons)
			var cells = [a,b,c,d,e,f,g,h,j,k,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	
	// DATES
	if(tableId == "wp_dates")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var today = getNow().split(" ")[0];
			
			var diffDays = getdDiff(today, list[i].DATE_DATE);
			if(diffDays == 0)
			{
				var point = "<span class='ball ballToday'></span>";
				var ahora = getNow().split(" ")[1];
				var horaCita = list[i].DATE_DATE_INI+":00";
				if(ahora > horaCita){var point = "<span class='ball ballPast'></span>";}
			}
			else if(diffDays < 0){var point = "<span class='ball ballPast'></span>";}
			else{var point = "<span class='ball ballFuture'></span>";}
			
			var a0 = cellCreator('Prioridad', point);
			var a = cellCreator('Línea atención', list[i].DATE_LINE);
			var b = cellCreator('Contratista', list[i].DATE_CONTRATIST_NAME);
			var c = cellCreator('Ciudadano', list[i].DATE_CITIZEN_NAME);
			
			var dateTime = "Fecha: "+list[i].DATE_DATE+"<br>Hora: "+list[i].DATE_DATE_INI+" a "+list[i].DATE_DATE_END;
			var d = cellCreator('Fecha/Hora', dateTime);
			
			var e = cellCreator('Lugar', list[i].DATE_PLACE);
			var f = cellCreator('Comentario', list[i].DATE_COMMENT);
			
			var edit = faIcon(list[i],"edit","Editar cita","#007bff");
			edit.reg = list[i];
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("datedit");
			}
			
			var close = faIcon(list[i],"window-close","Cerrar cita","#e3682d");
			close.onclick = function()
			{
				actualEditData = this.reg;
				loadForm("dateClose");
			}
			
			var citizen = faIcon(list[i],"user","Ciudadano","#96d5a9");
			citizen.onclick = function()
			{
				citizenOrigin = "loadCitRem";
				var id = this.reg.DATE_CITIZEN;
				loadForm("citizen");
				document.getElementById("CITIZEN_IDNUM").value = id;
				document.getElementById("CITIZEN_IDNUM").onblur();
			}
			
			var icons = [];
			
			if(userData.USER_CTYPE == "Principal1" || userData.USER_CTYPE == "Principal2" || userData.USER_CTYPE == "Principal3" || userData.USER_CTYPE == "Superior")
			{
				icons.push(citizen);
			}
			else
			{
				icons.push(edit);
				icons.push(close);
				icons.push(citizen);
			}
			
			
			

			var x = cellOptionsCreator('', icons)
			var cells = [a0,a,b,c,d,e,f,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	
	// COMPONENT
	if(tableId == "wp_master_component")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a = cellCreator('Nombre', list[i].COMPONENT_NAME);
			var activitiesDesc = getFriendDescs(list[i].COMPONENT_ACTIVITIES,"activities");
			var b = cellCreator('Actividades', activitiesDesc);
			
			


			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("component")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_component",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [a,b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	
	// SCOMPONENT
	if(tableId == "wp_master_scomponent")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a = cellCreator('Nombre', encry(list[i].SCOMPONENT_NAME));
			
			var thearray = JSON.stringify([list[i].SCOMPONENT_COMPONENT]);
			var componentDesc = getFriendDescs(thearray,"components");
			var b = cellCreator('Componente', componentDesc);


			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("scomponent")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["wp_master_scomponent",data];
				confirmBox(language["confirm"], "¿Desea eliminar este registro?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [a,b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	

	
	
	// -------------- LOCAL TABLES
	
	// VISIT GOALS
	if(tableId == "wp_contracts_visit_goals")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			if(list[i].UTYPE == "Cogestor"){var label1 = "Comuna o corregimiento";}
			else{var label1 = "Actividad";}
			
			var label2 = language["actTit2Cog"];
			var label3 = language["actTit3Cog"];
			
			var a = cellCreator(label1, list[i].FIELD1);
			a.id = "cell-"+list[i].FIELD0;
			
			if(list[i].UTYPE == "Visitador"){var min = 0;}
			else{var min = 0;}
			
			var field = inpuTableNum("FIELD2", min, list[i].FIELD2);
			var b = cellFieldCreator(label2, field);
			
			var field = inpuTableNum("FIELD2", 0, list[i].FIELD3);
			var c = cellFieldCreator(label3, field);
			
			var cells = [a,b];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// EVENT GOALS
	if(tableId == "wp_contracts_event_goals")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			if(list[i].UTYPE == "Cogestor"){var label1 = "Comuna o corregimiento";}
			else{var label1 = "Actividad";}
			
			var label2 = "Eventos dirigidos";
			var label3 = "Eventos apoyados";
			
			var a = cellCreator(label1, list[i].FIELD1);
			a.id = "cell-"+list[i].FIELD0;
			
			if(list[i].UTYPE == "Visitador"){var min = 0;}
			else{var min = 0;}
			
			var field = inpuTableNum("FIELD2", min, list[i].FIELD2);
			var b = cellFieldCreator(label2, field);
			
			var field = inpuTableNum("FIELD2", 0, list[i].FIELD3);
			var c = cellFieldCreator(label3, field);
			
			var cells = [a,b,c];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// OTHER GOALS
	if(tableId == "wp_contracts_other_goals")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a0 = cellCreator("Grupo", "Grupo "+list[i].FIELD0);

			var field = inpuTableNum("FIELD1", 0, list[i].FIELD1);
			var a = cellFieldCreator(language["othTit1"], field);
			
			var field = inpuTableNum("FIEL2", 30, list[i].FIELD2);
			var b = cellFieldCreator(language["othTit2"], field);
			
			var field = inpuTableNum("FIELD3", 0, list[i].FIELD3);
			var c = cellFieldCreator(language["othTit3"], field);
			
			var icon = "lock";
			var color = "#dea914";
			var text = "Ya esta asignado a un grupo";
			
			var gdata = faIcon(list[i],icon,text,color);
			gdata.onclick = function()
			{	
				console.log("Get group resume: "+this.reg.FIELD4)
			}
			
			var d = cellCreator("Asociado", list[i].FIELD4);
			
			
			var icons = [];
			icons.push(gdata);
			var x = cellOptionsCreator('Asociado', icons)
			
			if(list[i].FIELD4 != "")
			{
				var cells = [a0,a,b,c,x];
			}
			else
			{
				var cells = [a0,a,b,c,d];
			}
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// ASSIGN GOALS
	if(tableId == "wp_contracts_other_goals_assign")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";

			var reg = list[i];
			
			// reg.FIELD4 = actualEditData.GROUP_CODE;
			
			var a0 = cellCreator("Grupo", "Grupo "+list[i].FIELD0);
			var a = cellCreator(language["othTit1"], list[i].FIELD1);
			var b = cellCreator(language["othTit2"], list[i].FIELD2);
			var c = cellCreator(language["othTit3"], list[i].FIELD3);
			
			// ACTION ICON AS STATUS
			if(reg.hasOwnProperty("FIELD4"))
			{
				var icon = "lock";
				var color = "#dea914";
				var text = "Ya esta asignado a un grupo";
				var operation = "lock";
				var group = list[i].FIELD4;
				if(list[i].FIELD4 == actualEditData.GROUP_CODE)
				{
					var icon = "check-circle";
					var color = "#39b554";
					var text = "Asignado a este grupo";
					var operation = "unAssign";
				}
			}
			else
			{
				var icon = "circle";
				var color = "#b4d5d8";
				var text = "Asignar a este grupo";
				var operation = "assign";
				var group = "";
			}
			
			var action = faIcon(list[i],icon,text,color);
			action.operation = operation;
			action.group = group;
			action.num = i+1;
			action.onclick = function()
			{
				var op = this.operation;
				if(op == "assign")
				{
					for(var i=0; i<actualAssignGroups.length; i++)
					{
						var item = actualAssignGroups[i];
						if(item.FIELD0 == this.num)
						{actualAssignGroups[i].FIELD4 = actualEditData.GROUP_CODE;}
						else
						{
							if(item.hasOwnProperty("FIELD4"))
							{
								if(item.FIELD4 == actualEditData.GROUP_CODE)
								{delete actualAssignGroups[i]["FIELD4"];}
							}
						}
					}
					tableCreator("wp_contracts_other_goals_assign", actualAssignGroups);
				}
				
			}
			
			// ICONS PUSH IF CONDITION
			var icons = [];
			icons.push(action);
			var x = cellOptionsCreator('', icons)
			
			var cells = [a0,a,b,c,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// GROUP HOURS
	if(tableId == "wp_groups_hours")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";

			var reg = list[i];
			
			var field = inpuTableClass(i+"-GROUP_TIME_DAY", "select", list[i].GROUP_TIME_DAY,weekDays);
			field.reg = list[i];
			var a = cellFieldCreator("Día", field);
			
			var field = inpuTableClass(i+"-GROUP_TIME_INI", "select", list[i].GROUP_TIME_INI,timeOptions);
			field.reg = list[i];
			var b = cellFieldCreator("Hora inicio", field);
			
			var field = inpuTableClass(i+"-GROUP_TIME_END", "select", list[i].GROUP_TIME_END,timeOptions);
			field.reg = list[i];
			var c = cellFieldCreator("Hora fin", field);

			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.reg = list[i];
			del.onclick = function()
			{
				var thisDay = this.reg.GROUP_TIME_DAY;
				// CHECK TODAY AND HOUR CONDITION
				var today = getNow();
				var dayNumber = new Date(today).getDay();
				var dayName = weekDays[dayNumber];
				if(thisDay == dayName)
				{
					var time1 = getNow().split(" ")[1];
					var time2 = this.reg.GROUP_TIME_INI;
					var now = new Date("01/01/2000 "+time1);
					var limit = new Date("01/01/2000 "+time2);
					if(now <= limit){fastPop(language["hourLockWarn"], 4000);return;}
				}
				
				var data = this.reg;
				var params = ["wp_groups_hours",data];
				confirmBox(language["confirm"], "¿Desea eliminar este horario?",deleteItem, params);
			}
			
			// ICONS PUSH IF CONDITION
			var icons = [];
			icons.push(del);
			var x = cellOptionsCreator('', icons)
			
			var cells = [a,b,c,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// GROUP CITIZENS
	if(tableId == "wp_groups_citizens")
	{
		for(var i=0; i<list.length; i++)
		{
			
			var row = document.createElement("div");
			row.className = "rowT";

			var reg = list[i];
			
			var a = cellCreator("# Identificación", list[i].CITIZEN_IDNUM);
			var b = cellCreator("Nombre", list[i].CITIZEN_NAME);
			
			
			// CALCULATE AGE BASED ON BDAY INSTEAD OF 
			
			
			
			var age = cellCreator("Edad", list[i].CITIZEN_AGE);
			
			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.reg = list[i];
			edit.onclick = function()
			{
				citizenOrigin = "c";
				
				// console.log(actualGroupContract);
				// console.log(userData.USER_CONTRACT);
				
				if(actualGroupContract != userData.USER_CONTRACT && userData.USER_CTYPE != "Principal3")
				{fastPop("Solo el usuario con el contrato vinculado podrá editar esa área del grupo.", 2000);return;}
				
				
				var info = {};
				info.CITIZEN_IDNUM = this.reg.CITIZEN_IDNUM;
				if(info.CITIZEN_IDNUM == ""){return;}
				
				console.log("no age check");
				
				loadManager(1, "popFormSaveButton");
				sendAjax("users","getCitizenMain",info,function(response)
				{
					loadManager(0, "popFormSaveButton");
					var ans = response.message;
					console.log(ans)
					
					actualEditData = ans[0];
					console.log(actualEditData);
					editDataForm("citizen");
				});
				
				
			}

			var del = faIcon(list[i],"trash-alt","Eliminar ciudadano del grupo","#e83e8c");
			del.reg = list[i];
			del.onclick = function()
			{
				
				console.log(actualGroupContract);
				console.log(userData.USER_CONTRACT);
				
				// RM CANT TOUCH
				var contract = userData.USER_CONTRACT;
				if(contract == "" && userData.USER_CTYPE != "Superior")
				{fastPop("Solo el usuario con el contrato vinculado podrá editar esa área del grupo.", 2000);return;}
			
				if(actualGroupContract != userData.USER_CONTRACT)
				{fastPop("Solo el usuario con el contrato vinculado podrá editar esa área del grupo.", 2000);return;}
				
				var data = this.reg;
				var params = ["wp_groups_citizens",data];
				confirmBox(language["confirm"], "¿Desea eliminar este ciudadano del grupo?",deleteItem, params);
			}
			
			// SET ASSIST COLOR
			if(list[i].CITIZEN_ASSIST == "1")
			{
				var assistColor = "red";
				var assistIcon = "check-square"
			}
			else
			{
				var assistColor = "#d6d0d0";
				var assistIcon = "square"
			}
			
			var assist = faIcon(list[i],assistIcon,"Asistió a la clase",assistColor);
			assist.reg = list[i];
			assist.onclick = function()
			{
				updateCitizenAssist(this, this.reg.CITIZEN_IDNUM, this.reg.CITIZEN_ASSIST);
			}
			
			// ICONS PUSH IF CONDITION
			var icons = [];
			
			if(classOrigin == "c")
			{icons.push(assist);}
			else
			{
				icons.push(edit);
				icons.push(del);
			}
			
			
			var x = cellOptionsCreator('', icons)
			
			if(classOrigin == "c")
			{
				var cells = [a,b,x];
			}
			else
			{
				var cells = [a,b,x];
			}

			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// SUPPORT ACTIVITIES
	if(tableId == "wp_events_support")
	{
		for(var i=0; i<list.length; i++)
		{
			
			var row = document.createElement("div");
			row.className = "rowT";

			var reg = list[i];
			
			var a = cellCreator("Nombre", list[i].SUPPORT_OWNER_NAME);
			var b = cellCreator("Contrato", list[i].SUPPORT_CONTRACT_NUMBER);
			var c = cellCreator("Tipo", list[i].SUPPORT_USERTYPE);
			
			
			// SHOW ZONES IF COGESTOR
			
			var activitiesDesc = getFriendDescs(JSON.stringify(list[i].SUPPORT_ACTIVITIES),"activities");

			var d = cellCreator('Actividades', activitiesDesc);

			var del = faIcon(list[i],"trash-alt","Eliminar ciudadano del grupo","#e83e8c");
			del.reg = list[i];
			del.onclick = function()
			{
				
				var data = this.reg;
				var params = ["wp_events_support",data];
				confirmBox(language["confirm"], "¿Desea eliminar este usuario de apoyo?",deleteItem, params);
			}
		
			// ICONS PUSH IF CONDITION
			var icons = [];
			icons.push(del)

			var x = cellOptionsCreator('', icons)
			
			var cells = [a,b,c,d,x];

			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// EVENT ASSIST
	if(tableId == "wp_events_assist")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			if(list[i].ASSIST_DESC == "INDu00cdGENA")
			{list[i].ASSIST_DESC = "INDÍGENA";}
			
			var a = cellCreator('Descripción', list[i].ASSIST_DESC);
			
			
			var field = inpuTableAssist(list[i].ASSIST_CODE, 0, list[i].ASSIST_VALUE);
			var b = cellFieldCreator('Cantidad', field);
			var cells = [a,b];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	// EVENT NEEDS
	if(tableId == "wp_events_needs")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			if(list[i].NEED_DESC == "Animaciu00f3n")
			{list[i].NEED_DESC = "Animación";}
			
			
			var code = list[i].NEED_CODE.toString();
			if(code.includes("ADD"))
			{
				var field = inpuTableNeedDesc(list[i].NEED_CODE, 0, list[i].NEED_DESC, "NEED_DESC");
				if(requestState == "1" || requestState == "2"){field.disabled = true;}
				var a = cellFieldCreator('Descripción', field);
				
			}
			else
			{
				var a = cellCreator('Descripción', list[i].NEED_DESC);
			}
			
			var field = inpuTableNeed(list[i].NEED_CODE, 0, list[i].NEED_NEED, "NEED_NEED");
			if(requestState == "1" || requestState == "2"){field.disabled = true;}
			var b = cellFieldCreator('Cantidad', field);
			
			var field = inpuTableNeed(list[i].NEED_CODE, 0, list[i].NEED_GOT, "NEED_GOT");
			var c = cellFieldCreator('Gestionado', field);
			
			if(requestState == "0"){var cells = [a,b];}
			else{var cells = [a,b,c];}
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
}

function getAssistClass(list)
{
	var total = 0;
	for(var i=0; i<list.length; i++)
	{
		var item = list[i];
		if(item.CITIZEN_ASSIST == "1"){total++;}
	}
	return total;
}

function getAssisTotal(assist)
{
	var result = 0;
	if(assist != "" && assist != null)
	{
		assist = assist.replace(/\t/g, ' ');
		assist = JSON.parse(assist);
		for(var i=0; i<assist.length; i++)
		{
			var item = assist[i];
			if(item.ASSIST_TYPE == "SEX")
			{result = result + parseInt(item.ASSIST_VALUE);}
		}
	}
	return result;
}

function getFriendlySupport(team)
{
	var result = "";
	if(team != "" && team != null)
	{
		team = team.replace(/\t/g, ' ');
		team = JSON.parse(team);
		for(var i=0; i<team.length; i++)
		{
			var teamElement = team[i];
			var name = teamElement.SUPPORT_OWNER_NAME+":";
			var actis = JSON.stringify(teamElement.SUPPORT_ACTIVITIES);
			var activitiesDesc = getFriendDescs(actis,"activities");
			var line = name+"<br>"+activitiesDesc;
			result = result+line+"<br><br>";
		}
	}
	return result;
}

function getRegFile(table, fileField, codeField, code, filename)
{
	var info = {}
	info.table = table;
	info.fileField = fileField;
	info.codeField = codeField;
	info.code = code;
	info.filename = filename;
	
	sendAjax("users","getRegFile",info,function(response)
	{
		var ans = response.message;
		// console.log(ans)
		if(ans != "")
		{
			var format = ans.split(",")[0].split("/")[1].split(";")[0];
			var file = ans;
			var a = document.createElement("a"); //Create <a>
			a.href = file; 
			a.download = info.filename+format; //File name Here
			a.click(); 
		}
		else
		{
			fastPop("Este archivo no se ha cargado.", 2000);
		}
	});
	
}

function updateCitizenAssist(icon, id, assist)
{
	
	// SWITCH ASSIST
	if(assist == "0")
	{
		assist = "1";
		icon.className = "fa fa-check-square tableIcon";
		icon.style.color = "red";
	}
	else
	{
		assist = "0";
		icon.className = "fa fa-square tableIcon";
		icon.style.color = "#d6d0d0";
	}
	
	for(var i=0; i<actualGroupCitizens.length; i++)
	{
		var item = actualGroupCitizens[i];
		if(item.CITIZEN_IDNUM == id)
		{actualGroupCitizens[i].CITIZEN_ASSIST = assist;break;}
	}
}

function saveCitizenAssist()
{
	
	// RM CANT TOUCH
	var contract = userData.USER_CONTRACT;
	if(contract == "" && userData.USER_CTYPE != "Superior")
	{fastPop("Solo el usuario con el contrato vinculado podrá editar esta información.", 2000);return;}

	console.log(actualGroupCitizens);
	var info = {};
	
	var assList = [];
	for(var i=0; i<actualGroupCitizens.length; i++)
	{
		var item = actualGroupCitizens[i];
		var newItem = {};
		newItem.CITIZEN_IDNUM = item.CITIZEN_IDNUM;
		newItem.CITIZEN_ASSIST = item.CITIZEN_ASSIST;
		newItem.CITIZEN_SAVED = getNow();
		assList.push(newItem);
	}
	
	info.CLASS_CODE = actualClassCode;
	info.CITIZEN_ASSIST = assList;
	info.CLASS_DATE = actualClassDate;
	info.CLASS_INI = actualClassIni;
	info.CLASS_END = actualClassEnd;
	
	
	console.log(info)
	
	sendAjax("users","saveCitizenAssist",info,function(response)
	{
		var ans = response.message;
		console.log(ans)
		// return;
		if(ans != "allCool")
		{
			fastPop("Uno o más ciudadanos se encontraban registrados en otra clase para este horario y no pudieron ser marcados como asistentes a esta clase.", 5000);
			console.log(ans)
			refreshTable("wp_classes");
			PUM.close(1515);
			return;
		}
		else
		{
			fastPop("Asistencia registrada.", 3000);
			PUM.close(1515);
			refreshTable("wp_classes");
		}
	});
}

// SHOW CITIZEN DETAILS
function showCitizenDetail(title,id)
{
	console.log(id);
	var info = {};
	info.id = id;
	info.title = title;
	
	sendAjax("users","getCitizenDetail",info,function(response)
	{
		var ans = response.message;
		var guy = ans[0];
		
		actualDetailTitle = "<b class='citizenTitle'>"+info.title+"</b>";
		actualDetails = "Nombre: "+guy.CITIZEN_NAME+" "+guy.CITIZEN_LASTNAME+"<br>Teléfono : "+guy.CITIZEN_PHONE+"<br>Email: "+guy.CITIZEN_EMAIL;
		loadForm("detailsPop");
	});
}

// GET EVENT ACTIVITITIES
function getEventActivities()
{
	var picked = [];
	for(var i=0; i<activities.length; i++)
	{
		var item = activities[i];
		if(item.ACTIVITY_COG == "1")
		{picked.push(item);}
	}
	return picked;
}

// ADD CITIZEN CONFIRM
function createCitizenPop(params)
{
	var id = params[0];
	loadForm("citizen");
	document.getElementById("CITIZEN_IDNUM").lastvalue = id;
	document.getElementById("CITIZEN_IDNUM").value = id;
}

// LOAD DEFAUL ASSIST ARRAY
function loadDefaultAssist()
{
	actualAssistList = [];
	
	// ADD GENERES
	var line = {};
	line.ASSIST_CODE = Math.random();
	line.ASSIST_TYPE = "SEX";
	line.ASSIST_DESC = "Masculino".toUpperCase();
	line.ASSIST_VALUE = "0";
	actualAssistList.push(line);
	
	var line = {};
	line.ASSIST_CODE = Math.random();
	line.ASSIST_TYPE = "SEX";
	line.ASSIST_DESC = "Femenino".toUpperCase();
	line.ASSIST_VALUE = "0";
	actualAssistList.push(line);
	
	// ADD ETARIES
	for(var i=0; i<etaries.length; i++)
	{
		var etarie = etaries[i];
		var line = {};
		line.ASSIST_CODE = Math.random();
		line.ASSIST_TYPE = "ETARIE";
		line.ASSIST_DESC = (etarie.ETARIE_NAME+" de "+etarie.ETARIE_FROM+" hasta "+etarie.ETARIE_TO).toUpperCase();
		line.ASSIST_VALUE = "0";
		actualAssistList.push(line);
	}
	
	// ADD ETNIAS
	for(var i=0; i<etnias.length; i++)
	{
		var etnia = etnias[i];
		var line = {};
		line.ASSIST_CODE = Math.random();
		line.ASSIST_TYPE = "ETNIA";
		line.ASSIST_DESC = etnia.ETNIA_NAME.toUpperCase();
		line.ASSIST_VALUE = "0";
		actualAssistList.push(line);
	}
	
	// ADD HANDICAP
	var line = {};
	line.ASSIST_CODE = Math.random();
	line.ASSIST_TYPE = "HANDICAP";
	line.ASSIST_DESC = "Discapacidad".toUpperCase();
	line.ASSIST_VALUE = "0";
	actualAssistList.push(line);
	
	// ADD LGTBI
	var line = {};
	line.ASSIST_CODE = Math.random();
	line.ASSIST_TYPE = "LGTBI";
	line.ASSIST_DESC = "LGTBI";
	line.ASSIST_VALUE = "0";
	actualAssistList.push(line);
	// console.log(actualAssistList)
	tableCreator("wp_events_assist", actualAssistList);
}

// LOAD DEFAUL NEEDS ARRAY
function loadDefaultNeeds()
{
	actualNeedsList = [];

	var needs = ["Recreador", "Transporte", "Animación", "Sonido", "Amplificador", "Tarima", "Carpa","Comunicador"];
	// ADD NEEDS
	for(var i=0; i<needs.length; i++)
	{
		var item = needs[i];
		var line = {};
		line.NEED_CODE = Math.random();
		line.NEED_DESC = item;
		line.NEED_NEED = "0";
		line.NEED_GOT = "0";
		actualNeedsList.push(line);
	}
	
	var line = {};
	line.NEED_CODE = "ADD-"+Math.random();
	line.NEED_DESC = "Adicional";
	line.NEED_NEED = "0";
	line.NEED_GOT = "0";
	actualNeedsList.push(line);
	
	// console.log(actualNeedsList)
	tableCreator("wp_events_needs", actualNeedsList);
}

// PARENT ADDER
function parentAdder(type)
{
	var list = [];
	
	if(type == "hoods")
	{
		for(var i=0; i<hoods.length; i++)
		{
			var hood = hoods[i];
			var hoodZone = hood.HOOD_ZONE;
			
			for(var n=0; n<zones.length; n++)
			{
				var zone = zones[n];
				if(hoodZone == zone.ZONE_CODE)
				{
					var zoneNAme = zone.ZONE_NAME;
					hood.HOOD_NAME_FULL = hood.HOOD_NAME+" - "+zoneNAme;
				}
			}
			
			list.push(hood);
		}
	}
	
	return list;
}

// ADD CALLER FIELDS
function addCallerFields()
{
	// CREATE AND HIDE JUST FOR CALLERS
	// CREATE AND HIDE JUST FOR CALLERS
	// CREATE AND HIDE JUST FOR CALLERS
	var USER_CALLER_GOAL = fieldCreator([12,4,4,6], "Número de llamadas a realizar por mes ", "input", "number", "USER_CALLER_GOAL");
	var USER_CALLER_ENDATE = fieldCreator([12,4,4,6], "Fecha vencimiento", "input", "text", "USER_CALLER_ENDATE");
	
	popFormFieldBox.appendChild(USER_CALLER_GOAL);
	popFormFieldBox.appendChild(USER_CALLER_ENDATE);
	
	// SET DATE FIELDS
	setDateField("USER_CALLER_ENDATE");
	
	document.getElementById("USER_CALLER_GOAL_BOX").style.display = "none";
	document.getElementById("USER_CALLER_ENDATE_BOX").style.display = "none";
	
	// CREATE AND HIDE JUST FOR CALLERS
	// CREATE AND HIDE JUST FOR CALLERS
	// CREATE AND HIDE JUST FOR CALLERS
}

function cancelExcuse(params)
{
	var info = {};
	info.CLASS_CODE = actualClassCode;

	loadManager(1, "popFormSaveButton");
	sendAjax("users","excuseCancel",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans);

		if(ans == "updated")
		{
			setTimeout(function(){fastPop("Excusa eliminada",2000);}, 300);
			refreshTable("wp_classes");
			PUM.close(1515);	
		}
		
	});
}

// GET ITEM LIST FROM CODE
function getItemList(code, type)
{
	var info = {};
	info.code = code;
	if(type == "citizens")
	{
		info.table = "wp_groups";
		info.field = "GROUP_CITIZENS";
	}
	if(type == "citizensAssist")
	{
		info.table = "wp_classes";
		info.field = "CLASS_CITIZENS";
	}
	sendAjax("users","getItemList",info,function(response)
	{
		var ans = response.message;
		console.log(ans)
		if(info.field == "GROUP_CITIZENS")
		{
			actualGroupCitizens = ans;
			if(actualGroupCitizens.length > 0)
			{loadForm("citizensList");}
			else
			{fastPop("No hay ciudadanos asignados a este grupo", 2000);return;}
		}
		if(info.field == "CLASS_CITIZENS")
		{
			actualGroupCitizens = ans;
			if(actualGroupCitizens.length > 0)
			{loadForm("citizensList");}
			else
			{fastPop("No hay ciudadanos asignados a esta clase", 2000);return;}
		}
		
	});
	
	
}

// GET USER GROUPS
function getUserGroups(list)
{
	list = JSON.parse(list);
	var mygroups = [];
	for(var i=0; i<list.length; i++)
	{
		var item = list[i];
		
		if(item.hasOwnProperty("V4"))
		{
			mygroups.push(item.V4);
		}
	}
	return mygroups;
}

// SORT DICTIONARY BY KEY
function sortByKey(array, key) 
{
  return array.sort((a, b) => {
    let x = a[key];
    let y = b[key];
    
    return ((x < y) ? -1 : ((x > y) ? 1 : 0));
  });
}

// SET USER CONTRACT FIRST
function reArrange(list, table)
{
	if(table == "wp_contracts")
	{
		var tempArray = [];
		var pos = 0;
		
		for(var i=0; i<list.length; i++)
		{
			var item = list[i];
			// GET MY OWN ACTIVE CONTRACT
			if((list[i].CONTRACT_REQUESTER == userData.USER_CODE && list[i].CONTRACT_OWNER == userData.USER_CODE) && list[i].CONTRACT_STATE == "4")
			{pos = i; break;}
		}
		if(pos != 0)
		{
			var tempItem = list[pos];
			// REMOVE ITEM FROM ARRAY
			list.splice(pos, 1);
			// ADD ITEM TO ARRAY IN POSITION 0
			list.splice(0, 0, tempItem);
		}
	}
	
	if(table == "wp_groups")
	{
		var tempArray = [];
		var pos = 0;
		
		for(var i=0; i<list.length; i++)
		{
			var item = list[i];
			// GET MY OWN ACTIVE CONTRACT
			if((list[i].GROUP_CONTRACT == userData.USER_CONTRACT))
			{
				// unshift
				tempArray.unshift(item);
			}
			else
			{
				// push
				tempArray.push(item);
			}
		}
		list = tempArray;
	}
	
	if(table == "wp_remitions")
	{
		var list = sortByKey(list, "IS_MINE");
	}
	
	return list;
}

// ADD GOALS BLOCK
function addGoalsBlock()
{
	// GOALS BLOCK -----------
	// GOALS BLOCK -----------
	
	var goalsBox = document.getElementById("goalsBox");
	goalsBox.innerHTML = "";
	
	var CONTRACT_VISIT_GOALS = fieldCreator([12,12,12,12], "Metas en visitas", "tableField", "tableField", "CONTRACT_VISIT_GOALS");
	var CONTRACT_OTHER_GOALS = fieldCreator([12,12,12,12], "Metas en clases, horas y usuarios", "tableField", "tableField", "CONTRACT_OTHER_GOALS");
	var CONTRACT_EVENT_GOALS = fieldCreator([12,12,12,12], "Metas en eventos", "tableField", "tableField", "CONTRACT_EVENT_GOALS");
	
	// DEFINE VISIT GOALS ARRAYS
	var visitGoalsArray = prepareGoalsArray(actualEditData.CONTRACT_USERTYPE,actualEditData.CONTRACT_PROGRAM,actualEditData.CONTRACT_ACTIVITIES, "visit");
	
	// LOAD VISIT VALUES IF EXIST
	if(actualEditData.CONTRACT_VISIT_GOALS != null && actualEditData.CONTRACT_USERTYPE != "Instructor")
	{visitGoalsArray = updateVisitGoals(visitGoalsArray);}


	// DEFINE AND FILL TABLE ELEMENTS
	if(actualEditData.CONTRACT_USERTYPE == "Director" || actualEditData.CONTRACT_USERTYPE == "Coordinador")
	{
		// var table = tableDraw("wp_contracts_visit_goals",["Actividad",language["actTit2Cog"],language["actTit3Cog"]]);
		var table = tableDraw("wp_contracts_visit_goals",["Actividad",language["actTit2Cog"]]);
		
		goalsBox.appendChild(CONTRACT_VISIT_GOALS);
		document.getElementById("CONTRACT_VISIT_GOALS").appendChild(table);
		
		tableCreator("wp_contracts_visit_goals", visitGoalsArray);
		
		// ADDED ON DEMAND
		// ADDED ON DEMAND
		
		var CONTRACT_GQTY = fieldCreator([12,12,6,4], "Número de grupos", "input", "number", "CONTRACT_GQTY");
		
		var table = tableDraw("wp_contracts_other_goals",["Grupo",language["othTit1"],language["othTit2"],language["othTit3"], language["othTit4"]]);
		
		var spacer = document.createElement("hr");
		spacer.className = "fieldSpacer";
		
		goalsBox.appendChild(CONTRACT_OTHER_GOALS);
		document.getElementById("CONTRACT_OTHER_GOALS").appendChild(CONTRACT_GQTY);
		document.getElementById("CONTRACT_OTHER_GOALS").appendChild(spacer);
		document.getElementById("CONTRACT_OTHER_GOALS").appendChild(table);
		
		var groupQtyField = document.getElementById("CONTRACT_GQTY");
		
		if(actualEditData.CONTRACT_OTHER_GOALS != null && actualEditData.CONTRACT_OTHER_GOALS != "")
		{var qty = JSON.parse(actualEditData.CONTRACT_OTHER_GOALS).length;}
		else
		{var qty = 0;}
		
		groupQtyField.value = qty;
		groupQtyField.min = 0;
		groupQtyField.onchange = function ()
		{
			var lines = this.value;
			var list = [];
			for(var i=0; i<lines; i++)
			{
				var regLine = {};
				regLine.FIELD0 = i+1;
				regLine.FIELD1 = "1";
				regLine.FIELD2 = "30";
				regLine.FIELD3 = "1";
				regLine.FIELD4 = "";
				
				list.push(regLine);
			}
			
			if(actualEditData.CONTRACT_OTHER_GOALS != null)
			{
				// CHECK IF DELETING ASOCIATED
				
				var actualGroups = JSON.parse(actualEditData.CONTRACT_OTHER_GOALS); 
				var actualLines = actualGroups.length;
				if(actualLines > lines)
				{
					var lineDif = actualLines - lines;
					for(var i=lines; i<actualGroups.length; i++)
					{
						var item = actualGroups[i];
						if(item.V4)
						{
							if(item.V4 != "")
							{
								fastPop("No puede eliminar grupos con asociación.", 2000);
								this.value = actualLines;
								this.onchange();
								return;
							}
						}
						
					}
					list = updateClassGoals(list);
				}
				else
				{
					list = updateClassGoals(list);
				}
			}

			
			tableCreator("wp_contracts_other_goals", list);
		}
		groupQtyField.onchange();
		
		var utype = userData.USER_CTYPE;
		// LOCK GROUP QTY IF APROVED
		if(actualEditData.CONTRACT_STATE == "4" && utype != "Superior" && utype != "Principal3")
		{groupQtyField.disabled = true;}
		
	}
	else if(actualEditData.CONTRACT_USERTYPE == "Cogestor")
	{
		// var table = tableDraw("wp_contracts_visit_goals",["Comuna",language["actTit2Cog"],language["actTit3Cog"]]);
		var table = tableDraw("wp_contracts_visit_goals",["Comuna",language["actTit2Cog"]]);

		goalsBox.appendChild(CONTRACT_VISIT_GOALS);
		document.getElementById("CONTRACT_VISIT_GOALS").appendChild(table);
		
		tableCreator("wp_contracts_visit_goals", visitGoalsArray);
		
	}
	else if(actualEditData.CONTRACT_USERTYPE == "Visitador")
	{
		// var table = tableDraw("wp_contracts_visit_goals",["Actividad",language["actTit2Cog"],language["actTit3Cog"]]);
		var table = tableDraw("wp_contracts_visit_goals",["Actividad",language["actTit2Cog"]]);
		
		goalsBox.appendChild(CONTRACT_VISIT_GOALS);
		document.getElementById("CONTRACT_VISIT_GOALS").appendChild(table);
		
		tableCreator("wp_contracts_visit_goals", visitGoalsArray);
		
	}
	if(actualEditData.CONTRACT_USERTYPE == "Cogestor" || actualEditData.CONTRACT_USERTYPE == "Instructor")
	{
		var CONTRACT_GQTY = fieldCreator([12,12,6,4], "Número de grupos", "input", "number", "CONTRACT_GQTY");

		var table = tableDraw("wp_contracts_other_goals",["Grupo",language["othTit1"],language["othTit2"],language["othTit3"],language["othTit4"]]);
		
		var spacer = document.createElement("hr");
		spacer.className = "fieldSpacer";
		
		goalsBox.appendChild(CONTRACT_OTHER_GOALS);
		document.getElementById("CONTRACT_OTHER_GOALS").appendChild(CONTRACT_GQTY);
		document.getElementById("CONTRACT_OTHER_GOALS").appendChild(spacer);
		document.getElementById("CONTRACT_OTHER_GOALS").appendChild(table);
		
		var groupQtyField = document.getElementById("CONTRACT_GQTY");

		if(actualEditData.CONTRACT_OTHER_GOALS != null)
		{var qty = JSON.parse(actualEditData.CONTRACT_OTHER_GOALS).length;}
		else
		{var qty = 0;}
		
		groupQtyField.value = qty;
		
		var utype = userData.USER_CTYPE;
		
		// LOCK GROUP QTY IF APROVED
		if(actualEditData.CONTRACT_STATE == "4" && utype != "Superior" && utype != "Principal3")
		{groupQtyField.disabled = true;}
	

		groupQtyField.min = 0;
		
		groupQtyField.onchange = function ()
		{
			var lines = this.value;
			var list = [];
			for(var i=0; i<lines; i++)
			{
				var regLine = {};
				regLine.FIELD0 = i+1;
				regLine.FIELD1 = "1";
				regLine.FIELD2 = "30";
				regLine.FIELD3 = "1";
				regLine.FIELD4 = "";
				
				list.push(regLine);
			}
			
			if(actualEditData.CONTRACT_OTHER_GOALS != null)
			{
				// CHECK IF DELETING ASOCIATED
				
				var actualGroups = JSON.parse(actualEditData.CONTRACT_OTHER_GOALS); 
				var actualLines = actualGroups.length;
				if(actualLines > lines)
				{
					var lineDif = actualLines - lines;
					for(var i=lines; i<actualGroups.length; i++)
					{
						var item = actualGroups[i];
						if(item.V4)
						{
							if(item.V4 != "")
							{
								fastPop("No puede eliminar grupos con asociación.", 2000);
								this.value = actualLines;
								this.onchange();
								return;
							}
						}
						
					}
					list = updateClassGoals(list);
				}
				else
				{
					list = updateClassGoals(list);
				}
			}
			
			tableCreator("wp_contracts_other_goals", list);
		}
		
		groupQtyField.onchange();
		
		// UNLOCK GQTY FIELD IF FORTALECIMIENTO
		var utype = userData.USER_CTYPE;
		if(utype == "Principal3" || utype == "Superior"){groupQtyField.disabled = false;}

	}


	// ADDED EVENT GOALS
	// ADDED EVENT GOALS
	
	// DEFINE EVENT GOALS ARRAY
	var eventGoalsArray = prepareEventsArray(actualEditData.CONTRACT_USERTYPE,actualEditData.CONTRACT_PROGRAM,actualEditData.CONTRACT_ACTIVITIES, "event");
	
	// console.log(actualEditData.CONTRACT_EVENT_GOALS)
	
	// LOAD VISIT VALUES IF EXIST
	if(actualEditData.CONTRACT_EVENT_GOALS != null && actualEditData.CONTRACT_USERTYPE != "")
	{eventGoalsArray = updateEventGoals(eventGoalsArray);}
	
	if(actualEditData.CONTRACT_USERTYPE == "Director" || actualEditData.CONTRACT_USERTYPE == "Coordinador" || actualEditData.CONTRACT_USERTYPE == "Cogestor" || actualEditData.CONTRACT_USERTYPE == "Instructor")
	{
		var table = tableDraw("wp_contracts_event_goals",["Actividad",language["actTit2Eve"],language["actTit3Eve"]]);
		
		goalsBox.appendChild(CONTRACT_EVENT_GOALS);
		document.getElementById("CONTRACT_EVENT_GOALS").appendChild(table);
		
		tableCreator("wp_contracts_event_goals", eventGoalsArray);
		
	}
	
	// ADDED EVENT GOALS
	// ADDED EVENT GOALS
	
	// GOALS BLOCK -----------
	// GOALS BLOCK -----------
}

// ADD GROUPS BLOCK
function addGroupsBlock()
{
	// GOALS BLOCK -----------
	// GOALS BLOCK -----------
	
	var goalsBox = document.getElementById("goalsBox");
	goalsBox.innerHTML = "";
	
	var CONTRACT_OTHER_GOALS = fieldCreator([12,12,12,12], "Grupos del contrato", "tableField", "tableField", "CONTRACT_OTHER_GOALS");

	var table = tableDraw("wp_contracts_other_goals_assign",["Grupo",language["othTit1"],language["othTit2"],language["othTit3"], "Opciones"]);
	
	goalsBox.appendChild(CONTRACT_OTHER_GOALS);
	
	document.getElementById("CONTRACT_OTHER_GOALS").appendChild(table);
	
	// DEFINED BY ACTUAL GGOALS
	
	var qty = contractGroupsData.length;
	
	var lines = qty;
	var list = [];
	
	for(var i=0; i<lines; i++)
	{
		var regLine = {};
		regLine.FIELD0 = i+1;
		regLine.FIELD1 = "1";
		regLine.FIELD2 = "30";
		regLine.FIELD3 = "1";
		
		list.push(regLine);
	}
	
	if(actualContractData.CONTRACT_OTHER_GOALS != null)
	{list = updateClassGoalsAssign(list);}
	
	actualAssignGroups = list;
	
	tableCreator("wp_contracts_other_goals_assign", actualAssignGroups);
	
}

// ADD REM HISTORY BLOCK
function addHistoryBlock()
{
	var historyBox = document.getElementById("historyBox");
	historyBox.innerHTML = "";
	
	var table = tableDraw("wp_remHistory",["Línea de atención", "Actividad","Remisor", "Contratista", "Comentario", "Especial", "Grupo", "Remitido a", "Nueva actividad", "Estado", "Adjunto"]);
	
	historyBox.appendChild(table);
	tableCreator("wp_remHistory", remHistory);
	
}

// ADD GROUPS HOURS BLOCK
function addHoursBlock()
{
	// GOALS BLOCK -----------
	// GOALS BLOCK -----------
	
	var hoursBox = document.getElementById("hoursBox");
	hoursBox.innerHTML = "";
	
	var GROUP_HOURS_TABLE	= fieldCreator([12,12,12,12], "Horarios de clase para el grupo", "tableField", "tableField", "GROUP_HOURS_TABLE");
	

	var table = tableDraw("wp_groups_hours",["Día","Hora inicio", "Hora fin", "Eliminar"]);
	
	hoursBox.appendChild(GROUP_HOURS_TABLE);
	
	document.getElementById("GROUP_HOURS_TABLE").appendChild(table);
	
	// DEFINED BY ACTUAL GHOURS
	
	var qty = actualGroupHours.length;
	
	var lines = qty;
	var list = [];
	
	for(var i=0; i<lines; i++)
	{
		var regLine = {};
		regLine.GROUP_TIME_CODE = actualGroupHours[i].GROUP_TIME_CODE;
		regLine.GROUP_TIME_DAY = actualGroupHours[i].GROUP_TIME_DAY;
		regLine.GROUP_TIME_END = actualGroupHours[i].GROUP_TIME_END;
		regLine.GROUP_TIME_INI = actualGroupHours[i].GROUP_TIME_INI;
		regLine.GROUP_TIME_LST = actualGroupHours[i].GROUP_TIME_LST;
		
		list.push(regLine);
	}
	
	if(actualEditData.GROUP_HOURS != null)
	{list = updateClassHours(list);}
	
	actualGroupHours = list;
	
	tableCreator("wp_groups_hours", actualGroupHours);
	
}

// ADD SUPPORT BLOCK
function addSupportBlock()
{
	var supportBox = document.getElementById("supportBox");
	supportBox.innerHTML = "";

	var EVENT_SUPPORT_TABLE	= fieldCreator([12,12,12,12], "Instructores de apoyo", "tableField", "tableField", "EVENT_SUPPORT_TABLE");
	var table = tableDraw("wp_events_support",["Nombre","Contrato", "Tipo", "Actividades", "Eliminar"]);

	supportBox.appendChild(EVENT_SUPPORT_TABLE);
	document.getElementById("EVENT_SUPPORT_TABLE").appendChild(table);
}

// ADD ASSIST BLOCK
function addAssistBlock()
{
	var assistBox = document.getElementById("assistBox");
	assistBox.innerHTML = "";

	var EVENT_ASSIST_TABLE	= fieldCreator([12,12,12,12], "Cantidad de asistentes al evento por tipo", "tableField", "tableField", "EVENT_ASSIST_TABLE");
	var table = tableDraw("wp_events_assist",["Descripción","Cantidad"]);

	assistBox.appendChild(EVENT_ASSIST_TABLE);
	document.getElementById("EVENT_ASSIST_TABLE").appendChild(table);
}

// ADD NEEDS BLOCK
function addNeedsBlock()
{
	var needsBox = document.getElementById("needsBox");
	needsBox.innerHTML = "";

	var EVENT_NEEDS_TABLE	= fieldCreator([12,12,12,12], "Necesidades", "tableField", "tableField", "EVENT_NEEDS_TABLE");
	
	if(requestState == "0")
	{var table = tableDraw("wp_events_needs",["Descripción","Cantidad"]);}
	else
	{var table = tableDraw("wp_events_needs",["Descripción","Cantidad","Gestionado"]);}
	

	needsBox.appendChild(EVENT_NEEDS_TABLE);
	document.getElementById("EVENT_NEEDS_TABLE").appendChild(table);
}

// ADD NEEDS BLOCK
function addProgramedBlock()
{
	var programmedBox = document.getElementById("programmedBox");
	programmedBox.innerHTML = "";

	var EVENT_PROGRAMMED_TABLE	= fieldCreator([12,12,12,12], "Eventos programados para la fecha de inicio de solicitud", "tableField", "tableField", "EVENT_PROGRAMMED_TABLE");
	
	var table = tableDraw("wp_events_programmed",["Nombre de evento","Fecha inicial","Fecha final", "Estado", "Contratista"]);
	

	programmedBox.appendChild(EVENT_PROGRAMMED_TABLE);
	document.getElementById("EVENT_PROGRAMMED_TABLE").appendChild(table);
}

function getProgrammedEvents(date)
{
	
	// GET EVENTS FOR THE DATE AND SHOW AND FILL LIST IF COINCIDENCE
	
	var info = {};
	info.EVENT_REQUEST_DATE = date.split(" ")[0].replaceAll("/", "-");
	info.EVENT_ENTITY = userData.USER_ENTITY;
	sendAjax("users","getProgrammedEvents",info,function(response)
	{
		var ans = response.message;
		console.log(ans)
		
		if(ans.length > 0)
		{
			jQuery("#EVENT_PROGRAMMED_TABLE_BOX").show();
			tableCreator("wp_events_programmed", ans);
		}
		else
		{
			jQuery("#EVENT_PROGRAMMED_TABLE_BOX").show();
		}

	});
	
	
}

// ADD CITIZENS BLOCK
function addCitizensBlock()
{
	// GOALS BLOCK -----------
	// GOALS BLOCK -----------
	
	var citizensBox = document.getElementById("citizensBox");
	citizensBox.innerHTML = "";
	
	var GROUP_CITIZENS_TABLE	= fieldCreator([12,12,12,12], "", "tableField", "tableField", "GROUP_CITIZENS_TABLE");
	
	if(classOrigin == "c")
	{
		var table = tableDraw("wp_groups_citizens",["Identificación","Nombre", "Acción"]);
	}
	else
	{
		var table = tableDraw("wp_groups_citizens",["Identificación","Nombre","Acción"]);
	}
	
	
	citizensBox.appendChild(GROUP_CITIZENS_TABLE);
	
	document.getElementById("GROUP_CITIZENS_TABLE").appendChild(table);
	
	// DEFINED BY ACTUAL GHOURS
	
	var qty = actualGroupCitizens.length;
	
	var lines = qty;
	var list = [];
	
	for(var i=0; i<lines; i++)
	{
		var regLine = {};
		regLine.CITIZEN_IDNUM = actualGroupCitizens[i].CITIZEN_IDNUM;
		regLine.CITIZEN_NAME = actualGroupCitizens[i].CITIZEN_NAME;
		list.push(regLine);
	}
	
	// if(actualEditData.GROUP_HOURS != null)
	// {list = updateClassHours(list);}
	// actualGroupHours = list;
	
	tableCreator("wp_groups_citizens", actualGroupCitizens);
	
}

// GET USER CONTRACT
function getUserContract()
{
	var cLinkBox = document.getElementById("cLinkBox");
	cLinkBox.innerHTML = "";
	
	var info = {};
	info.CONTRACT_CODE = userData.USER_CONTRACT;
	
	sendAjax("users","getContractData",info,function(response)
	{
		var ans = response.message;
		
		var link = document.createElement("span");
		link.data = ans[0];
		link.innerHTML = "Ver mi contrato actual";
		
		link.onclick = function ()
		{
			actualEditData = this.data;
			
			actualEditData.CONTRACT_REQUESTER_NAME = userData.USER_NAME+" "+userData.USER_LASTNAME;
			actualEditData.CONTRACT_REQUESTER_ID = userData.USER_IDNUM;
			actualEditData.CONTRACT_REQUESTER_PHONE = userData.USER_PHONE;
			
			console.log(actualEditData)
			editDataForm("aprobeD");
		}
		
		// SHOW CONTRACT IF NOT CALLER
		if(userData.USER_CALLER != "1")
		{cLinkBox.appendChild(link);}
	});
}

// CLEAR LOG
function clearLog()
{
	var info = {};
	info.entity = userData.USER_ENTITY;
	
	sendAjax("users","clearLog",info,function(response)
	{
		var ans = response.message;
		fastPop("Se ha limpiado el Log", 2000);
		refreshTable("wp_log");
	});
}

// -------------CORE FUNCTIONS---------------
function getMultiCheckValue(id)
{
	var options = document.getElementById(id).children;
	var picked = [];
	
	for(var i=0; i<options.length; i++)
	{
		var input = options[i].children[0];

		if(input.checked)
		{
			picked.push(input.id.split("-")[1]);
		}
	}
	return JSON.stringify(picked);
}

// SET CITYFIELDS
function setLocations(fieldId)
{
	var list = locations;
	var ready = [];
	
	for(var i=0; i<list.length; i++)
	{
		var depto = list[i].departamento;
		
		var list2 = list[i].ciudades;
		
		for(var j=0; j<list2.length; j++)
		{
			var city = list2[j];
			
			var munip = city+" - "+depto;
			ready.push(munip);
		}
		
	}
	
	
	ready.sort();
	
	var list = ready;
	
	var places = [];

	for(var i=0; i<list.length; i++)
	{
		var pr = list[i];
		var desc = pr;
		
		desc = desc.toLowerCase();
		if(desc[0] == "-"){desc = desc.substring(1);}
		// desc = toPhrase(desc);
		places.push(desc);
	}
	
	// SET AUTOCOMPLETE TYPEAHEAD FROM ARRAY
	// jQuery('#'+fieldId).typeahead('destroy');
	// jQuery('#'+fieldId).typeahead({fitToElement: false,source: places});
	
	// FILL SELECT FIELD
	var picker = document.getElementById(fieldId);
	picker.innerHTML = "";
	
	var option = document.createElement("option");
	option.value = "";
	option.innerHTML = "Seleccione ciudad";
	picker.appendChild(option);
	
	for(var i=0; i<places.length; i++)
	{
		var item = places[i];
		var option = document.createElement("option");
		option.value = item;
		option.innerHTML = item;
		picker.appendChild(option);
	}
	
	

}

// SET CITYFIELDS search
function setLocationsSearch(fieldId)
{
	var list = locations;
	var ready = [];
	
	for(var i=0; i<list.length; i++)
	{
		var depto = list[i].departamento;
		
		var list2 = list[i].ciudades;
		
		for(var j=0; j<list2.length; j++)
		{
			var city = list2[j];
			
			var munip = city+" - "+depto;
			ready.push(munip);
		}
		
	}
	
	
	ready.sort();
	
	var list = ready;
	
	var places = [];

	for(var i=0; i<list.length; i++)
	{
		var pr = list[i];
		var desc = pr;
		
		desc = desc.toLowerCase();
		if(desc[0] == "-"){desc = desc.substring(1);}
		// desc = toPhrase(desc);
		var place = {};
		place.CITY = desc;
		places.push(place);
	}
	
	// console.log(places);
	
	searchListFiller(fieldId, places, "CITY", "CITY", "Seleccione ciudad");
	

}

// SET DATE FIELD ----------
function setDateField(id, time)
{
	if(time != null)
	{
		jQuery('#'+id).datetimepicker({ dateFormat: 'yy-mm-dd' });
	}
	else
	{
		jQuery('#'+id).datetimepicker
		({
			timepicker:false,
			format:'Y-m-d',
		}).on('change', function() {
			jQuery('.xdsoft_datetimepicker').hide();
			var str = jQuery(this).val();
			str = str.split(".");
		});
	}
}

// TABLE DRAWER---------
function tableDraw(id,fields)
{
	var mainTableBox = document.createElement("div");
	
	var tableBox = document.createElement("div");
	tableBox.className = "table";
	tableBox.id = id;
	
	var tableCount = document.createElement("div");
	tableCount.className = "tableCount";
	tableCount.innerHTML = "";
	tableCount.id = "tableCount"+"-"+id;
	
	mainTableBox.appendChild(tableCount)
	
	var tableHead = document.createElement("div");
	tableHead.className = "table-head";

	for(var i=0; i<fields.length; i++)
	{
		var item = fields[i];
		var field = document.createElement("div");
		field.className = "column";
		field.innerHTML = item;
		tableHead.appendChild(field);
	}
	
	mainTableBox.appendChild(tableBox)
	
	tableBox.appendChild(tableHead);
	return mainTableBox;
	
}

// GET HOODS FROM ZONES
function getHoodsFromZones(zones)
{
	var zonesD = JSON.parse(zones);
	
	var hoodsD = [];
	
	// GET PROJECTS FROM PROGRAMS
	for(var i=0; i<zonesD.length; i++)
	{
		var zone = zonesD[i];

		for(var n=0; n<hoods.length; n++)
		{
			var hoodZone = hoods[n]["HOOD_ZONE"];
			if(zone == hoodZone)
			{
				if(!hoodsD.includes(hoods[n]["HOOD_CODE"]))
				{hoodsD.push(hoods[n]["HOOD_CODE"]);}
			}
		}
	}
	
	return JSON.stringify(hoodsD);
}

// GET ACTIS FROM PROGRAMS
function getActisFromPrograms(programs)
{
	var programsD = JSON.parse(programs);
	
	var projectsD = [];
	
	// GET PROJECTS FROM PROGRAMS
	for(var i=0; i<programsD.length; i++)
	{
		var pro1 = programsD[i];
		
		for(var n=0; n<projects.length; n++)
		{
			var pro2 = projects[n]["PROJECT_PROGRAM"];
			if(pro1 == pro2)
			{
				if(!projectsD.includes(projects[n]["PROJECT_CODE"]))
				{projectsD.push(projects[n]["PROJECT_CODE"]);}
			}
		}
	}
	
	var actisD = [];
	
	// GET ACTIVITIES FROM PROJECTS
	for(var i=0; i<projectsD.length; i++)
	{
		var pro1 = projectsD[i];
		
		for(var n=0; n<activities.length; n++)
		{
			var pro2 = activities[n]["ACTIVITY_PROJECT"];
			if(pro1 == pro2)
			{
				if(!actisD.includes(activities[n]["ACTIVITY_CODE"]))
				{actisD.push(activities[n]["ACTIVITY_CODE"]);}
			}
		}
	}

	
	return JSON.stringify(actisD);
}

// GET PLAIN ARRAY FIELD VALUES FROM DICTIONARY
function getListCodes(list, field)
{
	var newList = [];
	for(var i=0; i<list.length; i++)
	{
		var item = list[i];
		newList.push(item[field]);
	}
	return newList;
}

// GET FULL REG USING KEY FROM DICTIONARY
function getRegFromKey(list, keyfield, val)
{
	var res = {};
	for(var n=0; n<list.length; n++)
	{
		var item = list[n];
		if(item[keyfield] == val)
		{res = item;break;}
	}
	return res;
}

// PREPARE GOALS ARRAY
function prepareGoalsArray(utype, progs, actis, gtype)
{
	var list = [];
	
	if(gtype == "visit")
	{
		// GET ACTIVITIES OR ZONES LIST
		if(utype == "Director")
		{var actis = JSON.parse(getActisFromPrograms(actualEditData.CONTRACT_PROGRAM));}
		if(utype == "Coordinador")
		{var actis = JSON.parse(actualEditData.CONTRACT_ACTIVITIES);}	
		if(utype == "Cogestor")
		{var actis = JSON.parse(actualEditData.CONTRACT_ZONES);}	
		if(utype == "Visitador")	
		{var actis = getListCodes(activities,"ACTIVITY_CODE");}			
		
		for(var i=0; i<actis.length; i++)
		{
			var regLine = {};
			
			if(utype == "Cogestor")
			{
				var element = getRegFromKey(zones,"ZONE_CODE",actis[i]);
				var regLine = {};
				regLine.FIELD0 = element.ZONE_CODE;
				regLine.FIELD1 = element.ZONE_NAME;
			}
			else
			{
				var element = getRegFromKey(activities,"ACTIVITY_CODE",actis[i]);
				regLine.FIELD0 = element.ACTIVITY_CODE;
				regLine.FIELD1 = element.ACTIVITY_NAME;
			}
			
			if(utype == "Visitador"){regLine.FIELD2 = "0";}
			else{regLine.FIELD2 = "0";}
			
			regLine.FIELD3 = "0";
			regLine.UTYPE = utype;
			
			list.push(regLine)
		}

	}

	return list;
}

// PREPARE EVENTS ARRAY
function prepareEventsArray(utype, progs, actis, gtype)
{
	var list = [];
	
	if(gtype == "event")
	{
		// GET ACTIVITIES OR ZONES LIST
		if(utype == "Director")
		{var actis = JSON.parse(getActisFromPrograms(actualEditData.CONTRACT_PROGRAM));}
		if(utype == "Coordinador")
		{var actis = JSON.parse(actualEditData.CONTRACT_ACTIVITIES);}	
		if(utype == "Cogestor")
		{var actis = JSON.parse(actualEditData.CONTRACT_ACTIVITIES);}	
		if(utype == "Instructor")	
		{var actis = JSON.parse(actualEditData.CONTRACT_ACTIVITIES);}	
		if(utype == "Visitador")	
		{var actis = getListCodes(activities,"ACTIVITY_CODE");}			
		
		// console.log(actis)
		
		for(var i=0; i<actis.length; i++)
		{
			var regLine = {};
			
			// if(utype == "Cogestor")
			// {
				// var element = getRegFromKey(zones,"ZONE_CODE",actis[i]);
				// var regLine = {};
				// regLine.FIELD0 = element.ZONE_CODE;
				// regLine.FIELD1 = element.ZONE_NAME;
			// }
			// else
			// {
				
			// }
			
			var element = getRegFromKey(activities,"ACTIVITY_CODE",actis[i]);
			regLine.FIELD0 = element.ACTIVITY_CODE;
			regLine.FIELD1 = element.ACTIVITY_NAME;
			
			if(utype == "Visitador"){regLine.FIELD2 = "0";}
			else{regLine.FIELD2 = "0";}
			
			regLine.FIELD3 = "0";
			regLine.UTYPE = utype;
			
			list.push(regLine)
		}

	}

	return list;
}

// UPDATE VISIT GOALS
function updateVisitGoals(original)
{
	if(actualEditData.CONTRACT_VISIT_GOALS == null || actualEditData.CONTRACT_VISIT_GOALS == "")
	{return original;}
	
	
	var sample = JSON.parse(actualEditData.CONTRACT_VISIT_GOALS);
	for(var i=0; i<original.length; i++)
	{
		var actual = original[i];
		var acode = actual.FIELD0;
		for(var j=0; j<sample.length; j++)
		{
			var saved = sample[j];
			var scode = saved.ID;
			if(acode == scode)
			{
				original[i].FIELD2 = sample[j].V1;
				original[i].FIELD3 = sample[j].V2;
				break;
			}
		}
	}
	return original;
}

// UPDATE EVENT GOALS
function updateEventGoals(original)
{
	if(actualEditData.CONTRACT_EVENT_GOALS == null || actualEditData.CONTRACT_EVENT_GOALS == "")
	{return original;}
	
	
	
	
	var sample = JSON.parse(actualEditData.CONTRACT_EVENT_GOALS);
	
	console.log(sample)
	
	for(var i=0; i<original.length; i++)
	{
		var actual = original[i];
		var acode = actual.FIELD0;
		for(var j=0; j<sample.length; j++)
		{
			var saved = sample[j];
			var scode = saved.ID;
			if(acode == scode)
			{
				original[i].FIELD2 = sample[j].V1;
				original[i].FIELD3 = sample[j].V2;
				break;
			}
		}
	}
	return original;
}

// UPDATE CLASS GOALS
function updateClassGoals(original)
{
	if(actualEditData.CONTRACT_OTHER_GOALS == null || actualEditData.CONTRACT_OTHER_GOALS == "")
	{return original;}
	
	var sample = JSON.parse(actualEditData.CONTRACT_OTHER_GOALS);
	for(var i=0; i<original.length; i++)
	{
		var actual = original[i];
		var acode = actual.FIELD0;

		for(var j=0; j<sample.length; j++)
		{
			var saved = sample[j];
			var scode = saved.ID;
			
			if(acode == scode)
			{
				original[i].FIELD1 = sample[j].V1;
				original[i].FIELD2 = sample[j].V2;
				original[i].FIELD3 = sample[j].V3;
				if(sample[j].hasOwnProperty("V4"))
				{original[i].FIELD4 = sample[j].V4}
				break;
			}
		}
	}
	return original;
}

// UPDATE CLASS GOALS ASSIGN
function updateClassGoalsAssign(original)
{
	if(actualContractData.CONTRACT_OTHER_GOALS == null || actualContractData.CONTRACT_OTHER_GOALS == "")
	{return original;}
	
	var sample = JSON.parse(actualContractData.CONTRACT_OTHER_GOALS);
	for(var i=0; i<original.length; i++)
	{
		var actual = original[i];
		var acode = actual.FIELD0;

		for(var j=0; j<sample.length; j++)
		{
			var saved = sample[j];
			var scode = saved.ID;
			
			if(acode == scode)
			{
				original[i].FIELD1 = sample[j].V1;
				original[i].FIELD2 = sample[j].V2;
				original[i].FIELD3 = sample[j].V3;
				
				if(sample[j].hasOwnProperty("V4"))
				{original[i].FIELD4 = sample[j].V4}
				break;
			}
		}
	}
	return original;
}

// UPDATE CLASS HOURS
function updateClassHours(original)
{
	if(actualEditData.GROUP_HOURS == null || actualEditData.GROUP_HOURS == "")
	{return original;}
	
	var sample = JSON.parse(actualEditData.GROUP_HOURS);
	for(var i=0; i<original.length; i++)
	{
		var actual = original[i];
		var acode = actual.GROUP_TIME_CODE;

		for(var j=0; j<sample.length; j++)
		{
			var saved = sample[j];
			var scode = saved.GROUP_TIME_CODE;
			if(acode == scode)
			{
				original[i].GROUP_TIME_CODE = sample[j].GROUP_TIME_CODE;
				original[i].GROUP_TIME_DAY = sample[j].GROUP_TIME_DAY;
				original[i].GROUP_TIME_END = sample[j].GROUP_TIME_END;
				original[i].GROUP_TIME_INI = sample[j].GROUP_TIME_INI;
				break;
			}
		}
	}
	return original;
}

// EDITABLE TABLE FIELDS
function inpuTableClass(id,type,val,fillArray)
{
	var field = document.createElement(type);
	field.id = id;
	field.type = type;
	field.className = "tableFieldSelect";
	for(var i=0; i<fillArray.length; i++)
	{
		var item = fillArray[i];
		var option = document.createElement("option");
		option.value = item;
		option.innerHTML = item;
		field.appendChild(option);
	}
	field.onchange = function ()
	{
		
		var thisDay = this.reg.GROUP_TIME_DAY;
		var thisRegCode = this.reg.GROUP_TIME_CODE;
		// CHECK TODAY AND HOUR CONDITION
		var today = getNow();
		var dayNumber = new Date(today).getDay();
		var dayName = weekDays[dayNumber];
		if(thisDay == dayName)
		{
			var time1 = getNow().split(" ")[1];
			var time2 = this.reg.GROUP_TIME_INI;
			var now = new Date("01/01/2000 "+time1);
			var limit = new Date("01/01/2000 "+time2);

			if(now <= limit)
			{
				var fieldKey = this.id.split("-")[1];
				var field = document.getElementById(this.id);
				field.value = this.reg[fieldKey];
				fastPop(language["hourLockWarn"], 4000);return;
			}
		}

		var fieldKey = this.id.split("-")[1];
		var newValue = this.value;

		// CHECK COMPARE HOURS INI
		if(fieldKey == "GROUP_TIME_INI")
		{
			var time1 = newValue;
			var time2 = this.reg.GROUP_TIME_END;
			var time1Date= new Date("01/01/2000 "+time1);
			var time2Date= new Date("01/01/2000 "+time2);
			if(time1Date >= time2Date )
			{
				var field = document.getElementById(this.id);
				field.value = this.reg[fieldKey];
				fastPop("La hora inicial no puede ser posterior o igual a la final", 2000);return;
			}
			
			console.log(this.reg)
			
			// CHECK IF DAY INI IN DAY RANGE
			for(var i=0; i<actualGroupHours.length; i++)
			{
				var item = actualGroupHours[i];
				
				if(item.GROUP_TIME_DAY == thisDay && item.GROUP_TIME_CODE != thisRegCode) 
				{
					var initialHour = new Date("01/01/2000 "+time1);
					var itemIniHour = new Date("01/01/2000 "+item.GROUP_TIME_INI);
					var itemEndHour = new Date("01/01/2000 "+item.GROUP_TIME_END);
					
					if(initialHour >= itemIniHour && initialHour <= itemEndHour)
					{
						var field = document.getElementById(this.id);
						field.value = this.reg[fieldKey];
						fastPop("La hora de inicio se encuentra dentro de otro rango para este mismo Día.", 2000);
						return;
					}
				}
			}
			
		}
		
		// CHECK COMPARE HOURS END
		if(fieldKey == "GROUP_TIME_END")
		{
			var time1 = this.reg.GROUP_TIME_INI;
			var time2 = newValue;
			var time1Date= new Date("01/01/2000 "+time1);
			var time2Date= new Date("01/01/2000 "+time2);
			if(time1Date >= time2Date )
			{
				var field = document.getElementById(this.id);
				field.value = this.reg[fieldKey];
				fastPop("La hora inicial no puede ser posterior o igual a la final", 2000);return;
			}
			
			// CHECK IF DAY INI OR END HOUR IN DAY RANGE
			for(var i=0; i<actualGroupHours.length; i++)
			{
				var item = actualGroupHours[i];
				
				if(item.GROUP_TIME_DAY == thisDay && item.GROUP_TIME_CODE != thisRegCode)
				{
					
					var finalHour = new Date("01/01/2000 "+time2);
					var itemIniHour = new Date("01/01/2000 "+item.GROUP_TIME_INI);
					var itemEndHour = new Date("01/01/2000 "+item.GROUP_TIME_END);
					
					if(finalHour <= itemEndHour && finalHour >= itemIniHour)
					{
						var field = document.getElementById(this.id);
						field.value = this.reg[fieldKey];
						fastPop("La hora final se encuentra dentro de otro rango para este mismo Día.", 2000);
						return;
					}
				}
			}
		}
		
		// SAVE TO MAIN ARRAY
		for(var i=0; i<actualGroupHours.length; i++)
		{
			var item = actualGroupHours[i];
			if(item.GROUP_TIME_CODE == this.reg.GROUP_TIME_CODE)
			{
				actualGroupHours[i][fieldKey] = newValue;
				actualGroupHours[i]["GROUP_TIME_LST"] = getNow();
			}
		}
		
		tableCreator("wp_groups_hours", actualGroupHours);
	
	}
	
	field.value = val;
	return field;
}
function inpuTableNum(id,min,val)
{
	var field = document.createElement("input");
	field.type = "number";
	field.min = min;
	field.className = "tableFieldInput";
	field.value = val;
	field.onblur = function()
	{
		if(parseInt(this.value) < this.min){this.value = this.min}
	}
	
	// LOCK FIELD IF APROVED
	if(actualEditData.CONTRACT_STATE == "4")
	{
		if(userData.USER_CTYPE != "Superior" && userData.USER_CTYPE != "Principal3")
		{field.disabled = true;}
	}
	return field;
}
function inpuTableAssist(id,min,val)
{
	var field = document.createElement("input");
	field.type = "number";
	field.min = min;
	field.regId = id;
	field.className = "tableFieldInput";
	field.value = val;
	field.onblur = function()
	{
		if(this.value < this.min){this.value = this.min; return;}
		
		var val = this.value;
		var code = this.regId;
		
		for(var i=0; i<actualAssistList.length; i++)
		{
			var item = actualAssistList[i];
			if(item.ASSIST_CODE == code)
			{
				actualAssistList[i].ASSIST_VALUE = val;
			}
		}
		// console.log(actualAssistList);
	}
	
	if(viewMode == "1"){field.disabled = true;}
	
	
	return field;
}
function inpuTableNeed(id,min,val,fieldName)
{
	var field = document.createElement("input");
	field.type = "number";
	field.min = min;
	field.fieldName = fieldName;
	field.regId = id;
	field.className = "tableFieldInput";
	field.value = val;
	field.onblur = function()
	{
		if(this.value < this.min){this.value = this.min; return;}
		
		var val = this.value;
		var code = this.regId;
		
		for(var i=0; i<actualNeedsList.length; i++)
		{
			var item = actualNeedsList[i];
			if(item.NEED_CODE == code)
			{actualNeedsList[i][this.fieldName] = val;}
		}
		console.log(actualNeedsList);
	}
	
	// LOCK FIELD IF APROVED
	if(requestState == "4")
	{field.disabled = true;}
	
	return field;
}
function inpuTableNeedDesc(id,min,val,fieldName)
{
	var field = document.createElement("input");
	field.type = "text";
	field.fieldName = fieldName;
	field.regId = id;
	field.className = "tableFieldInputDesc";
	field.value = val;
	field.onblur = function()
	{
		if(this.value < this.min){this.value = this.min; return;}
		
		var val = this.value;
		var code = this.regId;
		
		for(var i=0; i<actualNeedsList.length; i++)
		{
			var item = actualNeedsList[i];
			console.log(val.replace(/['"]+/g, ''))
			if(item.NEED_CODE == code)
			{actualNeedsList[i][this.fieldName] = val.replace(/['"]+/g, '');}
		}
		console.log(actualNeedsList);
	}
	
	// LOCK FIELD IF APROVED
	if(requestState == "4")
	{field.disabled = true;}
	
	return field;
}

// CESION AND STATES CHANGERS
function cancelCesion(params)
{
	var table = params[0];
	var data = params[1];
	
	var info = {};
	info.table = table;
	info.code = data.CONTRACT_CODE;
	info.CONTRACT_NUMBER = data.CONTRACT_NUMBER;
	info.CONTRACT_OWNER = data.CONTRACT_OWNER;
	
	sendAjax("users","cancelCesion",info,function(response)
	{
		var ans = response.message;
		console.log(ans);
		fastPop("Se ha rechazado la solicitud de cesión del contrato "+info.CONTRACT_NUMBER, 3000);
		refreshTable(info.table);
	});
	
}
function stateChanger(table, field, key, code, actual)
{
	var info = {};
	info.table = table;
	info.field = field;
	info.key = key;
	info.code = code;
	info.actual = actual;
	
	// GET GOALS IF USER CALLER
	if(field == "USER_CALLER")
	{
		if(info.actual == "0")
		{
			info.USER_CALLER_GOAL = document.getElementById("USER_CALLER_GOAL").value; 
			info.USER_CALLER_ENDATE = document.getElementById("USER_CALLER_ENDATE").value; 
		}
	}
	
	
	sendAjax("users","stateChanger",info,function(response)
	{
		var ans = response.message;
		fastPop("Se ha cambiado el estado", 2000);
		refreshTable(info.table);
	});
}
function getFriendDescs(list, master, line)
{
	var items = JSON.parse(list);
	
	if(master == "programs"){var compareList = programs; var field = "PROGRAM_CODE"; var descField = "PROGRAM_NAME";}
	if(master == "projects"){var compareList = projects; var field = "PROJECT_CODE"; var descField = "PROJECT_NAME";}
	if(master == "activities"){var compareList = activities; var field = "ACTIVITY_CODE"; var descField = "ACTIVITY_NAME";}
	if(master == "zones"){var compareList = zones; var field = "ZONE_CODE"; var descField = "ZONE_NAME";}
	if(master == "entities"){var compareList = entities; var field = "ENTITY_CODE"; var descField = "ENTITY_NAME";}
	if(master == "etnias"){var compareList = etnias; var field = "ETNIA_CODE"; var descField = "ETNIA_NAME";}
	if(master == "conditions"){var compareList = conditions; var field = "CONDITION_CODE"; var descField = "CONDITION_NAME";}
	if(master == "hoods"){var compareList = hoods; var field = "HOOD_CODE"; var descField = "HOOD_NAME";}
	if(master == "institutes"){var compareList = institutes; var field = "INSTITUTE_CODE"; var descField = "INSTITUTE_NAME";}
	if(master == "users"){var compareList = actualDB.contratists; var field = "USER_CODE"; var descField = "USER_FULL_NAME";}
	if(master == "contracts"){var compareList = actualDB.contracts; var field = "CONTRACT_CODE"; var descField = "CONTRACT_NUMBER";}
	if(master == "groups"){var compareList = actualDB.groups; var field = "GROUP_CODE"; var descField = "GROUP_NAME";}
	if(master == "inigroups"){var compareList = inigroups; var field = "GROUP_CODE"; var descField = "GROUP_NAME";}
	if(master == "citizens"){var compareList = actualDB.citizens; var field = "CITIZEN_IDNUM"; var descField = "CITIZEN_FULL_NAME";}
	if(master == "etaries"){var compareList = actualDB.etaries; var field = "ETARIE_CODE"; var descField = "ETARIE_NAME";}
	if(master == "genders"){var compareList = rGenders; var field = "GENDER_CODE"; var descField = "GENDER_NAME";}
	if(master == "urbral"){var compareList = rUrbral; var field = "URBRAL_CODE"; var descField = "URBRAL_NAME";}
	if(master == "instcom"){var compareList = rInstcom; var field = "INSTCOM_CODE"; var descField = "INSTCOM_NAME";}
	if(master == "previr"){var compareList = rPrevir; var field = "PREVIR_CODE"; var descField = "PREVIR_NAME";}
	if(master == "owner"){var compareList = avaRequestContracts; var field = "CONTRACT_OWNER"; var descField = "FULL_DESC";}
	
	if(master == "tipoin"){var compareList = tipoin; var field = "TIPOIN_CODE"; var descField = "TIPOIN_NAME";}
	
	if(master == "eps"){var compareList = eps; var field = "EPS_CODE"; var descField = "EPS_NAME";}
	if(master == "patoen"){var compareList = patoen; var field = "PATOEN_CODE"; var descField = "PATOEN_NAME";}
	if(master == "components"){var compareList = components; var field = "COMPONENT_CODE"; var descField = "COMPONENT_NAME";}
	
	if(master == "scomponents"){var compareList = scomponents; var field = "SCOMPONENT_CODE"; var descField = "SCOMPONENT_NAME";}
	
	if(master == "genre"){var compareList = scomponents; var field = "GENRE_CODE"; var descField = "GENRE_NAME";}
	
	
	var friendly = "";
	
	// console.log(items);
	
	for(var i=0; i<items.length; i++)
	{
		
		if(items[i] == null || items[i] == "null"){continue;}
		if(items[i].split("-").length>1)
		{var item1 = items[i].split("-")[1];}
		else
		{var item1 = items[i];}
		
		
		for(var j=0; j<compareList.length; j++)
		{
			var item2 = compareList[j];
			if(item2[field] == item1)
			{
				if(i != items.length-1)
				{
					if(line != null){var friendly = friendly+item2[descField]+", ";}
					else{var friendly = friendly+item2[descField]+", <br>";}
				}
				else
				{
					var friendly = friendly+item2[descField];
				}
				
				break;
			}
		}
	}
	return friendly;
	
	
}
function tableClear(tableId)
{
  var table = document.getElementById(tableId);
  var rows = table.children;
  
  while(rows.length > 1)
  {
	 var elem = rows[1];
	 elem.parentNode.removeChild(elem);
	 var rows = table.children;
  }
}
function cellCreator(name, content, espAlign)
{
	var cell = document.createElement("div");
	cell.className = "column";
	
	// SPECIAL ALIGN
	if(espAlign != null){cell.style.textAlign = espAlign;}
	
	// console.log(name);
	
	cell.setAttribute('data-label',name);
	var expansive = createExpansive(decodeURIComponent(content));
	cell.appendChild(expansive);
	return cell;
}
function createExpansive(text)
{
	var span = document.createElement("span");

	var maxLenght = 150;
	
	if(text.length > maxLenght)
	{
		if(text.includes("https")){var shorText = text.substring(0, 20);}
		else{var shorText = text.substring(0, maxLenght);}
		
		var extraBox = document.createElement("span");
		extraBox.innerHTML = " ...Más";
		extraBox.className = "extraBox";
		extraBox.full = text;
		extraBox.short = shorText;
		extraBox.state = 0;
		extraBox.onclick = function ()
		{
			var fisrtSpan = this.parentNode.children[0];
			console.log(this.state);
			if(this.state == 0)
			{
				fisrtSpan.innerHTML = this.full;
				this.state = 1;
				this.innerHTML = " ...Ocultar"
				this.style.color = "red";
				
			}
			else
			{
				fisrtSpan.innerHTML = this.short;
				this.state = 0;
				this.innerHTML = " ...Más"
				this.style.color = "#2b7bb3";
			}
		}
		
		var firstSpan = document.createElement("span");
		firstSpan.innerHTML = shorText;

		
		span.appendChild(firstSpan);
		span.appendChild(extraBox);
	}
	else
	{
		span.innerHTML = text;
	}

	
	
	
	return span;
}
function cellOptionsCreator(name, icons)
{
	var cell = document.createElement("div");
	cell.className = "column opts";
	cell.setAttribute('data-label',name);
	
	for(var i = 0; i<icons.length; i++)
	{
		cell.appendChild(icons[i]);
	}

	return cell;
}
function cellFieldCreator(name, field)
{
	var cell = document.createElement("div");
	cell.className = "column loneIconCell";
	cell.setAttribute('data-label',name);
	cell.appendChild(field);
	return cell;
}
function faIcon(data, css, label, color)
{
	var icon = document.createElement("i");
	icon.reg = data;
	icon.className = "fa fa-"+css+" tableIcon";
	icon.style.color = color;
	icon.setAttribute('title', label);
	icon.setAttribute('alt', label);
	
	// icon.innerHTML = label;
	
	return icon;
}
function encry (str) 
{  
    return encodeURIComponent(str).replace(/[!'()*]/g, escape);  
}
function decry (str) 
{  
    return decodeURIComponent(str);  
}


// DELETE ITEMS
function deleteItem(params)
{
	var table = params[0];
	var data = params[1];

	var info = {};
	info.table = table;
	
	// DEFINE CODE FIELD
	
	if(table == "wp_contracts")
	{
		info.field = "CONTRACT_CODE";
		info.USER_EMAIL = userData.USER_EMAIL;
		info.CONTRACT_NUMBER = data.CONTRACT_NUMBER;
	}
	if(table == "wp_trusers"){info.field = "USER_CODE";}
	if(table == "wp_citizens"){info.field = "CITIZEN_IDNUM";}
	if(table == "wp_programs"){info.field = "PROGRAM_CODE";}
	if(table == "wp_projects"){info.field = "PROJECT_CODE";}
	if(table == "wp_activities"){info.field = "ACTIVITY_CODE";}
	if(table == "wp_entities"){info.field = "ENTITY_CODE";}
	if(table == "wp_zones"){info.field = "ZONE_CODE";}
	if(table == "wp_hoods"){info.field = "HOOD_CODE";}
	if(table == "wp_conditions"){info.field = "CONDITION_CODE";}
	if(table == "wp_etnias"){info.field = "ETNIA_CODE";}
	if(table == "wp_groups"){info.field = "GROUP_CODE";}
	if(table == "wp_classes"){info.field = "CLASS_CODE";}
	if(table == "wp_etaries"){info.field = "ETARIE_CODE";}
	if(table == "wp_institutes"){info.field = "INSTITUTE_CODE";}
	if(table == "wp_events"){info.field = "EVENT_CODE";}
	if(table == "wp_events_r"){info.field = "EVENT_CODE";}
	if(table == "wp_visits"){info.field = "VISIT_CODE";}
	if(table == "wp_groups_citizens")
	{
		info.field = "CITIZEN_IDNUM";
		info.GROUP_CODE = actualGroupCode;
	}
	if(table == "wp_master_edlevel"){info.field = "EDLEVEL_CODE";}
	if(table == "wp_master_ocucond"){info.field = "OCUCOND_CODE";}
	if(table == "wp_master_trasdes"){info.field = "TRASDES_CODE";}
	if(table == "wp_master_tipovi"){info.field = "TIPOVI_CODE";}
	if(table == "wp_master_genre"){info.field = "GENRE_CODE";}
	if(table == "wp_master_eps"){info.field = "EPS_CODE";}
	if(table == "wp_master_riskfa"){info.field = "RISKFA_CODE";}
	if(table == "wp_master_prevfa"){info.field = "PREVFA_CODE";}
	if(table == "wp_master_ingrec"){info.field = "INGREC_CODE";}
	if(table == "wp_master_convac"){info.field = "CONVAC_CODE";}
	if(table == "wp_master_patoen"){info.field = "PATOEN_CODE";}
	if(table == "wp_master_courses"){info.field = "COURSES_CODE";}
	if(table == "wp_master_tipoco"){info.field = "TIPOCO_CODE";}
	if(table == "wp_master_tiposo"){info.field = "TIPOSO_CODE";}
	if(table == "wp_master_migrea"){info.field = "MIGREA_CODE";}
	if(table == "wp_master_tipoin"){info.field = "TIPOIN_CODE";}
	if(table == "wp_remitions"){info.field = "REM_CODE";}
	if(table == "wp_master_component"){info.field = "COMPONENT_CODE";}
	if(table == "wp_master_scomponent"){info.field = "SCOMPONENT_CODE";}
	
	// LOCAL DELETE
	if(table == "wp_groups_hours")
	{
		var field = "GROUP_TIME_CODE";
		var code = data[field];
		
		for(var i=0; i<actualGroupHours.length; i++)
		{
			var item = actualGroupHours[i];
			if(item.GROUP_TIME_CODE == code)
			{
				var pos = i;
				actualGroupHours.splice(pos, 1);
				break;
			}
		}
		
		tableCreator("wp_groups_hours", actualGroupHours);
		
		return;
	}
	if(table == "wp_events_support")
	{
		var field = "SUPPORT_CONTRACT";
		var code = data[field];
		
		for(var i=0; i<actualSupportList.length; i++)
		{
			var item = actualSupportList[i];
			if(item.SUPPORT_CONTRACT == code)
			{
				var pos = i;
				actualSupportList.splice(pos, 1);
				break;
			}
		}
		
		tableCreator("wp_events_support", actualSupportList);
		
		return;
	}

	info.code = data[info.field];
	actualMT = "3";
	
	
	sendAjax("users","deleteItem",info,function(response)
	{
		var ans = response.message;
		console.log(ans)
		
		if(ans == "cantP")
		{
			fastPop("Hay contratos con este programa asignado no puede eliminar este elemento", 3000);
			return;
		}
		
		if(ans == "cantPR")
		{
			fastPop("Hay actividades con este proyecto asignado no puede eliminar este elemento", 3000);
			return;
		}
		
		if(ans == "cantA")
		{
			fastPop("Hay contratos con esta actividad asignada no puede eliminar este elemento", 3000);
			return;
		}
		
		if(ans == "cantE")
		{
			fastPop("Hay contratos con esta entidad asignada no puede eliminar este elemento", 3000);
			return;
		}
		
		if(ans == "cantH")
		{
			fastPop("Hay barrios o veredas con esta comuna o corregimiento asignado no puede eliminar este elemento", 3000);
			return;
		}
		
		if(ans == "cantU")
		{
			fastPop("Hay solicitudes de contrato o contratos asignados a este usuario no puede eliminar este elemento", 3000);
			return;
		}
		
		if(ans == "cantCom")
		{
			fastPop("No se puede eliminar esta atención pues el contratista ya ha agregado comentarios a ella.", 3000);
			return;
		}
		
		if(ans == "cantComPON")
		{
			fastPop("No se puede eliminar este componente pues tiene subcomponentes asociados.", 3000);
			return;
		}
		
		if(ans == "cantCitGroup")
		{
			fastPop("Hay grupos que incluyen a este ciudadano, no puede eliminarlo", 3000);
			return;
		}
		
		if(ans == "cantCitClass")
		{
			fastPop("Hay clases que incluyen a este ciudadano, no puede eliminarlo", 3000);
			return;
		}
		
		if(ans == "cantCitEvent")
		{
			fastPop("Hay eventos que incluyen a este ciudadano como solicitante o cooperador, no puede eliminarlo", 3000);
			return;
		}
		
		if(ans == "cantEtniaCit")
		{
			fastPop("Hay ciudadanos que tienen esta etnia, no puede eliminarla", 3000);
			return;
		}
		
		if(ans == "cantCondCit")
		{
			fastPop("Hay ciudadanos que tienen esta Condición, no puede eliminarla", 3000);
			return;
		}
		
		if(ans == "cantGC")
		{
			fastPop("Existen clases creadas para este grupo, no puede eliminarlo", 3000);
			return;
		}


		if(info.table == "wp_contracts")
		{
			fastPop("Se ha rechazado la solicitud de contrato "+info.CONTRACT_NUMBER, 3000);
		}
		else if(info.table == "wp_groups_citizens")
		{
			fastPop("Se ha eliminado el elemento", 2000);
			// IF THIS DELETE ANS = NEW actualGroupCitizens
			actualGroupCitizens = ans;
			refreshTable(info.table);
			return;
		}
		else
		{
			fastPop("Se ha eliminado el elemento", 2000);
		}
		
		
		refreshTable(info.table);
	});
}

// DELETE ASIGNATION
function deleteAssign(params)
{
	var info = {};
	info.GROUP_CODE = params[0].GROUP_CODE;
	info.GROUP_CONTRACT = params[0].GROUP_CONTRACT;

	sendAjax("users","deleteAssign",info,function(response)
	{
		var ans = response.message;
		refreshTable("wp_groups");
		fastPop("Se ha desasignado el grupo", 2000);
		userDataReload();
	});
}

// FILTERBOX VALUE READER
function getFilters()
{
	var filtersBox = document.getElementById("filtersBox");
	var filters = {};
	var fields = filtersBox.children;
	
	for(var i=0; i<fields.length; i++)
	{
		var item = fields[i];
		
		var input = item.children[1];
		var fieldType = input.tagName.toLowerCase();
		if(fieldType != "button"){filters[input.id] = input.value;}
	}
	return filters;
}
// FILTERBOX VALUE CLEARER
function clearFilters()
{
	var filtersBox = document.getElementById("filtersBox");
	var fields = filtersBox.children;
	
	for(var i=0; i<fields.length; i++)
	{
		var item = fields[i];
		var input = item.children[1];
		var fieldType = input.tagName.toLowerCase();
		if(fieldType != "button"){input.value = "";}
	}
}
function fieldCreator(sizes, title, object, type, id)
{
	  var label = document.createElement("span");
	  label.innerHTML = title;
	  label.className = "fieldLabel";
	  
	  var box = document.createElement("div");
	  box.id = id+"_BOX";
	  var classname = "col-xs-"+sizes[0]+" col-sm-"+sizes[1]+" col-md-"+sizes[2]+" col-lg-"+sizes[3];
	  box.className = classname;

	  if(object == "picture")
	  {
		var classname = "col-xs-"+sizes[0]+" col-sm-"+sizes[1]+" col-md-"+sizes[2]+" col-lg-"+sizes[3]+" picPicker";
		box.className = classname;
		
		var field = document.createElement("img");
		field.id = id;
		
		var loc = window.location.href;
		if(loc.includes("192.168"))
		{
			field.src = "http://192.168.0.60/www/diogenes/app/isrc/blankPic.png";
		}
		else
		{
			field.src = "https://sistemadiogenes.com/app/isrc/blankPic.png";
		}
		
		field.type = "img";
		field.className = "profilePic";
		field.onclick = function ()
		{
			console.log("open pic selector")
			actualPicType = "0";
			document.getElementById("fileSelector").click();
		}
	  }
	  else if(object == "multiselect")
	  {
		var field = document.createElement("div");
		field.id = id;
		field.className = "multiselectBox";  
	  }
	  else if(object == "chartBox")
	  {
		var field = document.createElement("div");
		field.id = id;
		field.className = "chartBox";  
	  }
	  else if(object == "dropdown")
	  {
		var field = document.createElement("div");
		var dropButton = document.createElement("button");
		dropButton.fieldId = id;
		dropButton.pickedCode = "";
		dropButton.id = "SEARCH_BUTTON_"+id;
		dropButton.innerHTML = "Buscar "+ title;
		dropButton.className = "dropbtn";
		dropButton.onclick = function ()
		{
			showHideList(this.fieldId);
		}
		
		var searchField = document.createElement("input");
		searchField.type = "text";
		searchField.fieldId = id;
		searchField.id = "SEARCHFIELD_"+id;
		searchField.placeholder = "Buscar";
		searchField.className = "searchField";
		searchField.onkeyup = function ()
		{
			var myId = this.id;
			filterFunction(myId);
		}
		
		var dropdBox = document.createElement("div");
		dropdBox.id = "SEARCHBOX_"+id;
		dropdBox.className = "dropdown-content";
		dropdBox.appendChild(searchField)

		field.id = id;
		field.appendChild(dropButton)
		field.appendChild(dropdBox)
		field.className = "dropdown";  

	  }
	  else if(object == "tableField")
	  {
		var field = document.createElement("div");
		field.id = id;
		field.className = "tableField";  
	  }
	  else
	  {
		var field = document.createElement(object);
		field.id = id;
		field.type = type;
		field.className = "formField";
	  }
	  

	  box.appendChild(label);
	  box.appendChild(field);
	  
	  return box;
}

// SEARCH DROPDOWN
function searchListFiller(listId, list, textField, codeField, noneTitle)
{
	var listBox = document.getElementById("SEARCHBOX_"+listId);
	var searchField = listBox.children[0];
	
	if(list.length == 0)
	{
		document.getElementById("SEARCH_BUTTON_"+listId).innerHTML = noneTitle;
		document.getElementById("SEARCH_BUTTON_"+listId).pickedCode = "";
	}
	
	document.body.appendChild(searchField);
	listBox.innerHTML = "";
	listBox.appendChild(searchField);
	
	
	for(var i=0; i<list.length; i++)
	{
		var item = list[i];
		var text = item[textField];
		var code = item[codeField];
		
		var span = document.createElement("span");
		span.id = "span-"+code;
		span.innerHTML= text;
		span.code = code;
		span.fieldId = listId;
		span.className = "searchBoxOption";
		span.onclick = function ()
		{
			var picked = this.innerHTML;
			document.getElementById("SEARCHBOX_"+this.fieldId).classList.toggle("show");
			var searchButton = document.getElementById("SEARCH_BUTTON_"+this.fieldId);
			searchButton.innerHTML = picked;
			searchButton.pickedCode = this.code;
			
			setActParents();
			
			if(this.fieldId == "GROUP_INSTITUTE")
			{
				console.log("InstiPick")
				getInstituteData("Groups", this.code);
				
			}
			else if(this.fieldId == "EVENT_INSTITUTE")
			{
				console.log("InstiPick")
				getInstituteData("Events", this.code);
				
			}
			else if(this.fieldId == "EVENT_SUPPORT_PICKER")
			{
				if(this.code == "")
				{
					actualContractData = "";
					document.getElementById("EVENT_SUPPORT_ACTIVITIES").innerHTML = "";
					return;
				}
				
				if(document.getElementById("SEARCH_BUTTON_EVENT_OWNER"))
				{
					var pickedOwner = document.getElementById("SEARCH_BUTTON_EVENT_OWNER").pickedCode
					console.log(pickedOwner);
					
					if(this.code == pickedOwner)
					{
						fastPop("El director del evento no puede ser apoyo", 4000);
						document.getElementById("SEARCH_BUTTON_EVENT_SUPPORT_PICKER").innerHTML = "";
						document.getElementById("SEARCH_BUTTON_EVENT_SUPPORT_PICKER").pickedCode = "";
						
						multiSelectFillerDic("EVENT_SUPPORT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_NAME", [],clistA,singlePicker,locked);
						
						return;
					}
				}
				
				
				var contract = this.code;
				
				for(var i=0; i<avaEventContracts.length; i++)
				{
					var item = avaEventContracts[i];
					if(item.CONTRACT_CODE == contract)
					{actualContractData = item; break;}
				}
				
				var eventGoals = JSON.parse(actualContractData.CONTRACT_EVENT_GOALS)
				var supportActis = [];
				
				for(var i=0; i<eventGoals.length; i++)
				{
					var item = eventGoals[i];
					var supportValue = item.V2;
					
					if(supportValue > 0)
					{
						var act = {};
						act.ACTIVITY_CODE = item.ID;
						act.DIRECT_GOAL = item.V1;
						act.SUPPORT_GOAL = item.V2;

						var thearray = JSON.stringify([act.ACTIVITY_CODE]);
						var activity = getFriendDescs(thearray,"activities");
						
						act.ACTIVITY_NAME = activity;
						supportActis.push(act)
					}
				}
				
				var clistA = [];
				var singlePicker = "1";
				var locked = "0";
				multiSelectFillerDic("EVENT_SUPPORT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_NAME", 
				supportActis,clistA,singlePicker,locked);
				
				
				
				
			}
			else if(this.fieldId == "EVENT_OWNER")
			{
				if(this.code == "")
				{
					actualContractData = "";
					actualRequestEventActivities = [];
					actualSupportList = [];
					tableCreator("wp_events_support", actualSupportList);
					document.getElementById("EVENT_ACTIVITIES").innerHTML = "";
					return;
				}
				
				
				var contract = this.code;
				
				for(var i=0; i<avaRequestContracts.length; i++)
				{
					var item = avaRequestContracts[i];
					if(item.CONTRACT_CODE == contract)
					{actualContractData = item; break;}
				}
				
				console.log(actualContractData);
				
				var data = {};
				data.EVENT_CODE = "";
				data.EVENT_OWNER = actualContractData.CONTRACT_OWNER;
				data.EVENT_DATE_INI = document.getElementById("EVENT_DATE_INI").value;
				data.EVENT_DATE_END = document.getElementById("EVENT_DATE_END").value;
				
				// CHECK EVENT USER COINCIDENCE
				if(data.EVENT_DATE_INI == "" || data.EVENT_DATE_END == "")
				{
					fastPop("Debe seleccionar Fecha/hora inicio ejecución y Fecha/hora fin ejecución, antes de seleccionar el contratista.", 3000);
					this.value = "";
					this.onchange();
				}
				else
				{
					console.log(data);
					sendAjax("users","checkSimulEvents",data,function(response)
					{
						var ans = response.message;
						console.log(ans);
						
						if(ans == 1)
						{
							fastPop("Existe otro evento asignado para este día y hora para este contratista", 2000);
							this.value = "";
							this.onchange();
						}
						
					});
						
				}
				
				var eventGoals = JSON.parse(actualContractData.CONTRACT_EVENT_GOALS)
				var supportActis = [];
				
				for(var i=0; i<eventGoals.length; i++)
				{
					var item = eventGoals[i];
					var supportValue = item.V1;
					
					if(supportValue > 0)
					{
						var act = {};
						act.ACTIVITY_CODE = item.ID;
						act.DIRECT_GOAL = item.V1;
						act.SUPPORT_GOAL = item.V2;

						var thearray = JSON.stringify([act.ACTIVITY_CODE]);
						var activity = getFriendDescs(thearray,"activities");
						
						act.ACTIVITY_NAME = activity;
						supportActis.push(act)
					}
				}
				
				actualRequestEventActivities = supportActis;
				
				// FILL ACTIVITIES
				var clistA = [];
				var singlePicker = "1";
				
				if(viewMode == "1")
				{var locked = "1";}
				else
				{var locked = "0";}
				
				multiSelectFillerDic("EVENT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_NAME", supportActis,clistA,singlePicker,locked);
				
				// CHECK 
				var actualOwner = actualEditData.EVENT_OWNER;
				var newOwner = this.value;
				
				if(actualOwner != newOwner)
				{
					actualSupportList = [];
					tableCreator("wp_events_support", actualSupportList);
				}
				
				console.log("refresca apoyos");
				
				// FILL SUPPORT PICKER
				// ---------------------------------------------------
				// CREATE DESC FIELD
				for(var i=0; i<avaEventContracts.length; i++)
				{
					var contract = avaEventContracts[i];
					var desc = contract.CONTRACT_OWNER_NAME+" Contrato: "+contract.CONTRACT_NUMBER+" Tipo: "+contract.CONTRACT_USERTYPE;
					avaEventContracts[i]["FULL_DESC"] = desc;
				}
				// INDEX BY NAME
				var indexed = sortByKey(avaEventContracts, "FULL_DESC");
				searchListFiller("EVENT_SUPPORT_PICKER", indexed, "FULL_DESC", "CONTRACT_CODE", "Seleccione usuario de apoyo");
			}
			else if(this.fieldId == "REM_ACTIVITY")
			{
				var pickedCode = this.code;
				var pickedContratists = [];
				
				for(var i=0; i<remContratists.length; i++)
				{
					var contratist = remContratists[i];
					if(contratist.USER_ACTIVITIES.includes(pickedCode))
					{pickedContratists.push(contratist);}
				}

				var finalist = [];
				for(var i=0; i<pickedContratists.length; i++)
				{
					var pickedContratist = pickedContratists[i];
					var item = {};
					item.CONTRATIST_CODE = pickedContratist.USER_CODE;
					item.CONTRATIST_LINE = pickedContratist.USER_NAME+" "+pickedContratist.USER_LASTNAME+" - Contrato: "+pickedContratist.USER_CONTRACT;
					
					finalist.push(item)
					
				}
				
				document.getElementById("SEARCH_BUTTON_REM_CONTRATIST").innerHTML = "";
				document.getElementById("SEARCH_BUTTON_REM_CONTRATIST").pickedCode = "";
				
				searchListFiller("REM_CONTRATIST", finalist, "CONTRATIST_LINE", "CONTRATIST_CODE",  "Seleccione contratista");
				
			}
			else if(this.fieldId == "REMCOM_ACTIVITY")
			{
				var pickedCode = this.code;
				var pickedContratists = [];
				for(var i=0; i<remContratists.length; i++)
				{
					var contratist = remContratists[i];
					if(contratist.USER_ACTIVITIES.includes(pickedCode))
					{pickedContratists.push(contratist);}
				}

				var finalist = [];
				for(var i=0; i<pickedContratists.length; i++)
				{
					var pickedContratist = pickedContratists[i];
					var item = {};
					item.CONTRATIST_CODE = pickedContratist.USER_CODE;
					item.CONTRATIST_LINE = pickedContratist.USER_NAME+" "+pickedContratist.USER_LASTNAME+" - Contrato: "+pickedContratist.USER_CONTRACT;
					finalist.push(item)
				}
				
				document.getElementById("SEARCH_BUTTON_REMCOM_CONTRATIST").innerHTML = "";
				document.getElementById("SEARCH_BUTTON_REMCOM_CONTRATIST").pickedCode = "";
				
				searchListFiller("REMCOM_CONTRATIST", finalist, "CONTRATIST_LINE", "CONTRATIST_CODE",  "Seleccione contratista");
				
			}
			else if(this.fieldId == "CLASS_GROUP")
			{
				var pickedCode = this.code;
				for(var i=0; i<actualClassGroups.length; i++)
				{
					var item = actualClassGroups[i];
					if(item.GROUP_CODE == pickedCode){actualClassGroupData = item}
				}
								
				// FILL ACTIVITIES
				
				var actis = JSON.parse(actualClassGroupData.GROUP_CONTRACT_ACTIVITIES);
				console.log(actis);
				
				var actiArray = [];
				
				for(var i=0; i<actis.length; i++)
				{
					var item = {};
					var aCode = actis[i];
					
					item.ACTIVITY_CODE = aCode;
					
					var thearray = JSON.stringify([aCode]);
					var activity = getFriendDescs(thearray,"activities");
					
					item.ACTIVITY_DESC = activity;
					
					actiArray.push(item);
					
				}
				
				
				
				// FILL GROUPS
				searchListFiller("CLASS_GROUP_ACTIVITY", actiArray, "ACTIVITY_DESC", "ACTIVITY_CODE", "Seleccione Grupo");
				
				
				
				
			}
			else if(this.fieldId == "CITIZEN_CITY")
			{
				var pickedCode = this.code;
				
				searchListFiller("CITIZEN_ZONE", [], "ZONE_NAME", "ZONE_CODE", "Seleccione Comuna/Corregimiento");
				searchListFiller("CITIZEN_HOOD", [], "HOOD_NAME", "HOOD_CODE", "Seleccione Barrio/Vereda");
				
				var cityZones = [];
				for(var i=0; i<allZones.length; i++)
				{
					var item = allZones[i];
					if(item.ZONE_CITY == pickedCode){cityZones.push(item)}
				}
				
				searchListFiller("CITIZEN_ZONE", cityZones, "ZONE_NAME", "ZONE_CODE", "Seleccione Comuna/Corregimiento");
				
				
			}
			else if(this.fieldId == "CITIZEN_ZONE")
			{
				searchListFiller("CITIZEN_HOOD", [], "HOOD_NAME", "HOOD_CODE", "Seleccione Barrio/Vereda");
				var pick = this.code;
				var pickedList = [];
				// PREPARE LIST
				for(var i=0; i<allHoods.length; i++)
				{
					var item = allHoods[i];
					if(item.HOOD_ZONE == pick){pickedList.push(item);}
				}
				searchListFiller("CITIZEN_HOOD", pickedList, "HOOD_NAME", "HOOD_CODE", "Seleccione Barrio/Vereda");
			}
			else if(this.fieldId == "REMCOM_COMPONENT")
			{
				
				var pick = this.code;

				var info = {};
				info.COMPONENT_CODE = pick;
				
				sendAjax("users","getSubcomps",info,function(response)
				{
					var list = response.message;
					searchListFiller("REMCOM_SCOMPONENT", list, "SCOMPONENT_NAME", "SCOMPONENT_CODE", "Seleccione Sub componente");
				});
			}
			else if(this.fieldId == "REM_PROGRAM")
			{
				var pick = this.code;
				
				document.getElementById("SEARCH_BUTTON_REM_PROJECT").innerHTML = "Seleccione proyecto";
				document.getElementById("SEARCH_BUTTON_REM_PROJECT").pickedCode = "";
				
				document.getElementById("SEARCH_BUTTON_REM_ACTIVITY").innerHTML = "Seleccione actividad";
				document.getElementById("SEARCH_BUTTON_REM_ACTIVITY").pickedCode = "";
				
				var choosen = [];
				
				for(var i=0; i<validProjects.length; i++)
				{
					var pr = validProjects[i];
					if(pr.PROJECT_PROGRAM == pick){if(!choosen.includes(pr)){choosen.push(pr);}}
				}
				
				searchListFiller("REM_PROJECT", choosen, "PROJECT_NAME", "PROJECT_CODE",  "Seleccione projecto");
				
				searchListFiller("REM_ACTIVITY", [], "ACTIVITY_FULL_NAME", "ACTIVITY_CODE",  "Seleccione actividad");
				
				searchListFiller("REM_CONTRATIST", [], "ACTIVITY_FULL_NAME", "ACTIVITY_CODE",  "Seleccione Contratista");
				
			}
			else if(this.fieldId == "REM_PROJECT")
			{
				var pick = this.code;
				
				document.getElementById("SEARCH_BUTTON_REM_ACTIVITY").innerHTML = "Seleccione actividad";
				document.getElementById("SEARCH_BUTTON_REM_ACTIVITY").pickedCode = "";
				
				var choosen = [];
				
				
				
				for(var i=0; i<fixedActis.length; i++)
				{
					var acti = fixedActis[i];
					if(acti.ACTIVITY_PROJECT == pick){if(!choosen.includes(acti)){choosen.push(acti);}}
				}
				
				searchListFiller("REM_ACTIVITY", choosen, "ACTIVITY_FULL_NAME", "ACTIVITY_CODE",  "Seleccione actividad");
				
				searchListFiller("REM_CONTRATIST", [], "ACTIVITY_FULL_NAME", "ACTIVITY_CODE",  "Seleccione Contratista");
			}
			else if(this.fieldId == "REMCOM_PROGRAM")
			{
				var pick = this.code;
				
				
				document.getElementById("SEARCH_BUTTON_REMCOM_PROJECT").innerHTML = "Seleccione proyecto";
				document.getElementById("SEARCH_BUTTON_REMCOM_PROJECT").pickedCode = "";
				document.getElementById("SEARCH_BUTTON_REMCOM_ACTIVITY").innerHTML = "Seleccione actividad";
				document.getElementById("SEARCH_BUTTON_REMCOM_ACTIVITY").pickedCode = "";
				document.getElementById("SEARCH_BUTTON_REMCOM_CONTRATIST").innerHTML = "Seleccione contratista";
				document.getElementById("SEARCH_BUTTON_REMCOM_CONTRATIST").pickedCode = "";
				
				var choosen = [];
				
				for(var i=0; i<validProjects.length; i++)
				{
					var pr = validProjects[i];
					if(pr.PROJECT_PROGRAM == pick){if(!choosen.includes(pr)){choosen.push(pr);}}
				}
				
				searchListFiller("REMCOM_PROJECT", choosen, "PROJECT_NAME", "PROJECT_CODE",  "Seleccione projecto");
				
				searchListFiller("REMCOM_ACTIVITY", [], "ACTIVITY_NAME", "ACTIVITY_CODE",  "Seleccione actividad");
				
				searchListFiller("REMCOM_CONTRATIST", [], "CONTRATIST_LINE", "CONTRATIST_CODE",  "Seleccione contratista");
			}
			else if(this.fieldId == "REMCOM_PROJECT")
			{
				var pick = this.code;
				
				document.getElementById("SEARCH_BUTTON_REMCOM_ACTIVITY").innerHTML = "Seleccione actividad";
				document.getElementById("SEARCH_BUTTON_REMCOM_ACTIVITY").pickedCode = "";
				document.getElementById("SEARCH_BUTTON_REMCOM_CONTRATIST").innerHTML = "Seleccione contratista";
				document.getElementById("SEARCH_BUTTON_REMCOM_CONTRATIST").pickedCode = "";
				
				var choosen = [];
				
				for(var i=0; i<fixedActis.length; i++)
				{
					var acti = fixedActis[i];
					if(acti.ACTIVITY_PROJECT == pick){if(!choosen.includes(acti)){choosen.push(acti);}}
				}
				
				searchListFiller("REMCOM_ACTIVITY", choosen, "ACTIVITY_FULL_NAME", "ACTIVITY_CODE",  "Seleccione actividad");
				
				searchListFiller("REMCOM_CONTRATIST", [], "CONTRATIST_LINE", "CONTRATIST_CODE",  "Seleccione contratista");
				
			}
			else if(this.fieldId == "GROUP_PROGRAM")
			{
				var pick = this.code;
				
				document.getElementById("SEARCH_BUTTON_GROUP_PROJECT").innerHTML = "Seleccione proyecto";
				document.getElementById("SEARCH_BUTTON_GROUP_PROJECT").pickedCode = "";
				document.getElementById("SEARCH_BUTTON_GROUP_ACTIVITY").innerHTML = "Seleccione actividad";
				document.getElementById("SEARCH_BUTTON_GROUP_ACTIVITY").pickedCode = "";
				
				var choosen = [];
				
				for(var i=0; i<validProjects.length; i++)
				{
					var pr = validProjects[i];
					if(pr.PROJECT_PROGRAM == pick){if(!choosen.includes(pr)){choosen.push(pr);}}
				}
				
				searchListFiller("GROUP_PROJECT", choosen, "PROJECT_NAME", "PROJECT_CODE",  "Seleccione projecto");
				
				searchListFiller("GROUP_ACTIVITY", [], "ACTIVITY_FULL_NAME", "ACTIVITY_CODE",  "Seleccione actividad");
				
				
			}
			else if(this.fieldId == "GROUP_PROJECT")
			{
				var pick = this.code;
				
				document.getElementById("SEARCH_BUTTON_GROUP_ACTIVITY").innerHTML = "Seleccione actividad";
				document.getElementById("SEARCH_BUTTON_GROUP_ACTIVITY").pickedCode = "";
				
				var choosen = [];
				
				for(var i=0; i<fixedActis.length; i++)
				{
					var acti = fixedActis[i];
					if(acti.ACTIVITY_PROJECT == pick){if(!choosen.includes(acti)){choosen.push(acti);}}
				}
				
				searchListFiller("GROUP_ACTIVITY", choosen, "ACTIVITY_FULL_NAME", "ACTIVITY_CODE",  "Seleccione actividad");
			}
			else
			{
				console.log("otherPick")
			}
			
			
		}

		listBox.appendChild(span);
		
	}
}
function showHideList(id) 
{
  document.getElementById("SEARCHBOX_"+id).classList.toggle("show");
}
function filterFunction(id) 
{
  var input, filter, ul, li, a, i;
  input = document.getElementById(id);
  filter = input.value.toUpperCase();
  
  var boxId = id.split("SEARCHFIELD_")[1];
  console.log(boxId)
  div = document.getElementById("SEARCHBOX_"+boxId);
  // console.log(div)
  a = div.getElementsByTagName("span");
  for (i = 0; i < a.length; i++) {
    txtValue = a[i].textContent || a[i].innerText;
    if (txtValue.toUpperCase().indexOf(filter) > -1) {
      a[i].style.display = "";
    } else {
      a[i].style.display = "none";
    }
  }
}

function buttonCreator(sizes, title, fun)
{
	var button = document.createElement("button");
	button.innerHTML = title;
	button.className = "filtersButton";
	button.onclick = function(){fun()}
	button.id = title;
	
	var box = document.createElement("div");
	var classname = "col-xs-"+sizes[0]+" col-sm-"+sizes[1]+" col-md-"+sizes[2]+" col-lg-"+sizes[3];
	box.className = classname;
	
	var br = document.createElement("br");
	br.className = "hidden-xs";
	
	box.appendChild(br);
	box.appendChild(button);
	
	return box;
}
function selectFiller(id, initial, options, valueField, descField)
{
	var picker = document.getElementById(id);
	picker.innerHTML = "";
	
	var option = document.createElement("option");
	option.value = "";
	option.innerHTML = initial;
	picker.appendChild(option);
	
	for(var i=0; i<options.length; i++)
	{
		var item = options[i];
		if(valueField != null)
		{
			var value = item[valueField];
			var desc = item[descField];
		}
		else
		{
			var value = item;
			var desc = item;
		}
		
		var option = document.createElement("option");
		option.value = value;
		option.innerHTML = desc;
		picker.appendChild(option);
	}
}
function selectFillerActiFull(id, initial, options, valueField, descField)
{
	var picker = document.getElementById(id);
	picker.innerHTML = "";
	
	var option = document.createElement("option");
	option.value = "";
	option.innerHTML = initial;
	picker.appendChild(option);
	
	for(var i=0; i<options.length; i++)
	{
		var item = options[i];
		if(valueField != null)
		{
			var value = item[valueField];
			var fullDesc = getActiFullDesc(value);
			var desc = fullDesc;
		}
		
		var option = document.createElement("option");
		option.value = value;
		option.innerHTML = desc;
		picker.appendChild(option);
	}
}
function getActiFullDesc(code)
{
	for(var i=0; i<activities.length; i++)
	{
		var item = activities[i];
		if(item.ACTIVITY_CODE == code)
		{
			var actiName = item.ACTIVITY_NAME;
			var actiProjectCode = item.ACTIVITY_PROJECT;
			for(var n=0; n<projects.length; n++)
			{
				var project = projects[n];
				if(project.PROJECT_CODE == actiProjectCode)
				{
					var projectName = project.PROJECT_NAME;
					var projectProgramCode = project.PROJECT_PROGRAM;
					for(var m=0; m<programs.length; m++)
					{
						var program = programs[m];
						if(program.PROGRAM_CODE == projectProgramCode)
						{var programName = program.PROGRAM_NAME;}
					}
				}
			}
		}
	}
	var desc = actiName+" - Proyecto: "+projectName+" - Programa: "+programName;
	
	return desc;
}
function selectFillerContractAssign(id, initial, options, valueField, descField)
{
	var picker = document.getElementById(id);
	picker.innerHTML = "";
	
	var option = document.createElement("option");
	option.value = "";
	option.innerHTML = initial;
	picker.appendChild(option);
	
	for(var i=0; i<options.length; i++)
	{
		var item = options[i];
		if(valueField != null)
		{
			var value = item[valueField];
			var desc = "Número contrato : "+item["CONTRACT_NUMBER"]+
						" - Tipo: "+item["CONTRACT_USERTYPE"]+
						" - Asignado a: "+item["CONTRACT_OWNER_NAME"];
		}
		else
		{
			var value = item;
			var desc = item;
		}
		
		var option = document.createElement("option");
		option.value = value;
		option.innerHTML = desc;
		picker.appendChild(option);
	}
}
function multiSelectFillerDic(id, value, desc, list, compareList, single, locked)
{
	var picker = document.getElementById(id);
	picker.innerHTML = "";
	
	for(var i=0; i<list.length; i++)
	{
		var itemValue = list[i][value];
		var itemDesc = list[i][desc];
		
		var option = document.createElement("div");
		option.className = "custom-control custom-checkbox";
		
		var random = Math.random();
		
		var input = document.createElement("input");
		input.className = "custom-control-input";
		input.id = random+"-"+itemValue;
		input.type = "checkbox";
		
		// MARK IF IN ARRAY
		if(compareList != null)
		{
			if(compareList.includes(itemValue))
			{input.checked = true;}
		}
		
		// DISABLE INPUT IF LOCKED
		if(locked == "1"){input.disabled = true;}
				
		var label = document.createElement("label");
		label.innerHTML = itemDesc;
		label.htmlFor  = random+"-"+itemValue;
		label.className = "custom-control-label";
		
		option.appendChild(input);
		option.appendChild(label);

		// SINGLE BEHAVIOR
		if(single == "0" && locked != "1")
		{
			option.onclick = function()
			{
				var me = document.getElementById(this.children[0].id);
				var options = this.parentNode.children;
				for(var n=0; n<options.length; n++)
				{
					var box = options[n].children[0];
					box.checked = false;
				}
				me.checked = true;
			}
		}
		
		picker.appendChild(option);

	}
}

// MULTIFILLER SEARCHBOX_
function multiSelectFillerDicF(id, value, desc, list, compareList, single, locked)
{
	var picker = document.getElementById(id);
	picker.innerHTML = "";
	
	var searchField = document.createElement("input");
	searchField.type = "text";
	searchField.fieldId = id;
	searchField.id = "SEARCHFIELD_"+id;
	searchField.placeholder = "Buscar";
	searchField.className = "searchField";
	searchField.onkeyup = function ()
	{
		var myId = this.id;
		filterFunctionMultipicker(this);
	}
	
	var allPicker = document.createElement("input");
	allPicker.type = "checkbox";
	allPicker.id = "thisPicker-"+id;
	allPicker.className = "allPicker";
	allPicker.onchange = function ()
	{
		var state = this.checked;
		var dad = this.parentNode;
		var lines = dad.getElementsByTagName("div");
		for(var i=0; i<lines.length; i++)
		{
			var line = lines[i];
			var visible = line.style.display;
			if(visible != "none"){line.children[0].checked = state;}
		}
		
		pickedCheck(this, 1);
	}
	
	picker.myAllBox = allPicker;
	
	picker.appendChild(searchField);
	picker.appendChild(allPicker);
	if(locked == "1"){allPicker.disabled = true;}
	
	for(var i=0; i<list.length; i++)
	{
		var itemValue = list[i][value];
		var itemDesc = list[i][desc];
		
		var option = document.createElement("div");
		option.className = "custom-control custom-checkbox";
		
		var random = Math.random();
		
		var input = document.createElement("input");
		input.className = "custom-control-input";
		input.id = random+"-"+itemValue;
		input.type = "checkbox";
		
		if(id == "CONTRACT_ACTIVITIES" || id == "COMPONENT_ACTIVITIES")
		{
			input.checked = false;
		}
		else
		{
			input.checked = true;
		}
		
		// MARK IF IN ARRAY
		if(compareList != null)
		{
			if(compareList.includes(itemValue))
			{
				input.checked = true;
			}
			else
			{
				if(id == "CONTRACT_ACTIVITIES")
				{
					input.checked = false;
				}
				
			}
		}
		
		input.onchange = function ()
		{
			pickedCheck(this, 2);
		}
		
		// DISABLE INPUT IF LOCKED
		if(locked == "1"){input.disabled = true;}
				
		var label = document.createElement("label");
		
		
		if(id == "CONTRACT_ACTIVITIES")
		{
			var parents = getActivityParents(itemValue);
			var projectCode = parents.split(" - ")[0];
			var programCode = parents.split(" - ")[1];
			
			for(var j=0; j<programs.length; j++)
			{
				var prog = programs[j];
				if(prog.PROGRAM_CODE == programCode){var progName = prog.PROGRAM_NAME; break;}
			}
			
			for(var j=0; j<projects.length; j++)
			{
				var proj = projects[j];
				if(proj.PROJECT_CODE == projectCode){var projName = proj.PROJECT_NAME; break;}
			}
			
			label.innerHTML = itemDesc+" - "+projName+" - "+progName;
		}
		else
		{
			label.innerHTML = itemDesc;
		}
		
		label.htmlFor  = random+"-"+itemValue;
		label.className = "custom-control-label";
		
		option.appendChild(input);
		option.appendChild(label);

		// SINGLE BEHAVIOR
		if(single == "0" && locked != "1")
		{
			option.onclick = function()
			{
				var me = document.getElementById(this.children[0].id);
				var options = this.parentNode.children;
				for(var n=0; n<options.length; n++)
				{
					var box = options[n].children[0];
					box.checked = false;
				}
				me.checked = true;
			}
		}
		
		picker.appendChild(option);

	}
}

// ON PICKED SEARCH MULTIPICKER OPTION
function pickedCheck(box, level)
{
	if(level == 1){var daddy = box.parentNode;}
	if(level == 2){var daddy = box.parentNode.parentNode;}
	var state = box.checked;
	
	// GET ACTUAL PICKED FROM DAD ACCORDING TO PICKER ID GET VALUES TO FILL SONS AND GRANDSONS
	var picked = getPickedIds(daddy.id);
	
	
	if(daddy.id == "CONTRACT_ACTIVITIES")
	{
		if(contractEdit == 1)
		{
			if(box.checked == false)
			{
				var contract = actualEditData.CONTRACT_CODE;
				console.log(contractEdit);
				
				var boxId = box.id.split("-")[1];
				console.log(boxId);
				
				
				// GET CONTRACT GROUPS
				console.log();
				
				
				// SHOW LOADER
				PUM.open(889);
				
				var info = {};
				info.CONTRACT_CODE = contract;
				info.box = box;
				info.boxId = boxId;
				
				
				sendAjax("users","getContractGroups",info,function(response)
				{
					
					var list = response.message;
					console.log(list)
					
					PUM.close(889);
					
					if(list.length > 0)
					{
						for(var i=0; i<list.length; i++)
						{
							var gActi = list[i].GROUP_ACTIVITY;
							if(boxId == gActi)
							{
								console.log("no quitar");
								info.box.checked = true;
								fastPop("Este contrato tiene asignado uno o más grupos con esta actividad, no podrá quitarla hasta desvincular estos grupos.", 5000);
							}
						}
					}

				});
				
			}
		}
	}

	
	
	
	if(daddy.id == "URBRAL_PICKER")
	{
		var pickedZones = [];
		for(var i=0; i<rZones.length; i++)
		{
			var zone = rZones[i];
			if(picked.length == 0){pickedZones.push(zone);continue;}
			
			for(var n=0; n<picked.length; n++)
			{
				var type = picked[n];
				if(type == "Urbano"){type = "Comuna";}
				if(type == "Rural"){type = "Corregimiento";}
				if(zone.ZONE_TYPE == type){pickedZones.push(zone);}
			}
		}
		multiSelectFillerDicF("ZONE_PICKER", "ZONE_CODE", "ZONE_NAME", pickedZones, [], "1","0");
		
		document.getElementById("ZONE_PICKER").myAllBox.checked = state;
		document.getElementById("ZONE_PICKER").myAllBox.onchange();
		
	}
	
	if(daddy.id == "ZONE_PICKER")
	{
		var pickedHoods = [];
		for(var i=0; i<rHoods.length; i++)
		{
			var hood = rHoods[i];
			if(picked.length == 0){pickedHoods.push(hood);continue;}
			
			for(var n=0; n<picked.length; n++)
			{
				var code = picked[n];
				if(hood.HOOD_ZONE == code){pickedHoods.push(hood);}
			}
		}
		multiSelectFillerDicF("HOOD_PICKER", "HOOD_CODE", "HOOD_NAME", pickedHoods, [], "1","0");
	}
	
	if(daddy.id == "PROGRAMS_PICKER")
	{
		var pickedActivities = [];
		for(var i=0; i<rActivities.length; i++)
		{
			var activity = rActivities[i];
			if(picked.length == 0){pickedActivities.push(activity);continue;}
			
			// console.log(picked);

			for(var n=0; n<picked.length; n++)
			{
				// THIS ARE PROGRAM CODES
				var programCode = picked[n];
				
				// GET PROGRAM PROJECTS AND RUN FOR EVERY PROJECT
				var pprojects = getProjectCodes(programCode);
				for(var p=0; p<pprojects.length; p++)
				{
					var pr = pprojects[p];
					if(activity.ACTIVITY_PROJECT == pr.PROJECT_CODE){pickedActivities.push(activity);}
				}

			}
		}
		multiSelectFillerDicF("ACTIVITY_PICKER", "ACTIVITY_CODE", "ACTIVITY_NAME", pickedActivities, [], "1","0");
	}
	
	if(daddy.id == "PROJECT_PICKER")
	{
		var pickedActivities = [];
		for(var i=0; i<rActivities.length; i++)
		{
			var activity = rActivities[i];
			if(picked.length == 0){pickedActivities.push(activity);continue;}
			
			for(var n=0; n<picked.length; n++)
			{
				var code = picked[n];
				if(activity.ACTIVITY_PROJECT == code){pickedActivities.push(activity);}
			}
		}
		multiSelectFillerDicF("ACTIVITY_PICKER", "ACTIVITY_CODE", "ACTIVITY_NAME", pickedActivities, [], "1","0");
	}
	if(daddy.id == "GFILTERS_PICKER")
	{
		if(filteredResult.length > 0){refreshChart("GENERAL_CHART");}
	}
	
	
	
}
function getProjectCodes(program)
{
	var pickd = [];
	for(var i=0; i<rProjects.length; i++)
	{
		var item = rProjects[i];
		if(item.PROJECT_PROGRAM == program){pickd.push(item)}
	}
	return pickd;
}
function getPickedIds(id)
{
	var daddy = document.getElementById(id);
	// console.log(id);
	// console.log(daddy);
	var kids = daddy.getElementsByTagName("div");
	var picked = [];
	for(var i=0; i<kids.length; i++)
	{
		var kbox = kids[i].children[0];
		if(kbox.checked == true)
		{picked.push(kbox.id.split("-")[1]);}
	}
	return picked;
}
function filterFunctionMultipicker(me) 
{
  
  var input, filter, ul, li, a, i;
  input = me;
  filter = input.value.toUpperCase();

  var box = me.parentNode;

  a = box.getElementsByTagName("div");
  for (i = 0; i < a.length; i++) 
  {
    var line = a[i].children[1];
	txtValue = line.textContent || line.innerText;
    if(txtValue.toUpperCase().includes(filter)) 
	{
      line.parentNode.style.display = "";
    } else {
      line.parentNode.style.display = "none";
    }
  }
}
function checkEmail(email) 
{

    var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

    if (!filter.test(email)) 
	{
		return false;
	}
	else
	{
		return true;
	}
 }
function condsBox()
{
	PUM.open(332);
	
	var content = document.getElementById("condsText");
	content.innerHTML = language["condsText"];
	
	var accept = document.getElementById("acceptButtonConds");
	accept.innerHTML = language["acceptButtonConds"];
}
function closeConds()
{
	PUM.close(332)
}
function fastPop(message, time)
{
	document.getElementById("fastPopText").innerHTML = message;
	setTimeout(function(){PUM.open(763);}, 500);
	// PUM.open(763);
	setTimeout(function(){ PUM.close(763); }, time);
}
function alertBox(header, message)
{
	PUM.open(174);
	var tittle = document.getElementById("alertTitle");
	tittle.innerHTML = header;
	var content = document.getElementById("alertContent");
	content.innerHTML = message;
	var accept = document.getElementById("acceptButtonAlert");
	accept.innerHTML = language["acceptButtonAlert"];
}
function closeAlert()
{
	PUM.close(174)
}
function confirmBox(title, message, method, params)
{
	PUM.open(664);
	document.getElementById("confirmTitle").innerHTML = title;
	document.getElementById("confirmContent").innerHTML = message;
	var acceptB = document.getElementById("acceptConfirmButton");
	acceptB.method = method;
	acceptB.innerHTML = language["acceptButtonAlert"];
	acceptB.params = params;
	acceptB.onclick = function()
	{this.method(this.params);closeConfirm();}
	var cancelB = document.getElementById("cancelConfirmButton");
	cancelB.innerHTML = language["cancel"];
	cancelB.onclick = function(){closeConfirm()}
}
function closeConfirm()
{
	PUM.close(664);
}
function getNowFormat(date, mode)
{
	var currentdate = date; 

	var year = currentdate.getFullYear();
	var month = (currentdate.getMonth()+1);
	var day = currentdate.getDate();
	var hour = currentdate.getHours();
	var minute = currentdate.getMinutes();
	var second = currentdate.getSeconds();
	
	if(parseFloat(month) < 10){month = "0"+month};
	if(parseFloat(day) < 10){day = "0"+day};
	
	if(mode == "ini")
	{
		if(parseFloat(hour) < 10){hour = "0"+hour};
		if(parseFloat(minute) < 10){minute = "0"+minute};
		if(parseFloat(second) < 10){second = "0"+second};
	}
	else
	{
		if(parseFloat(hour) < 10){hour = "23"};
		if(parseFloat(minute) < 10){minute = "59"};
		if(parseFloat(second) < 10){second = "59"};
	}
	
	
	
	var datetime =  year + "-" +  month + "-" + day + " "  + hour + ":"  + minute + ":"  + second;	
	
	return datetime;
}
function getdDiff(startDate, endDate)
{
	var date1 = new Date(startDate);
	var date2 = new Date(endDate);
	var timeDiff = date2.getTime() - date1.getTime();
	var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
	return diffDays;
}
function getdDiffSecs(startDate, endDate)
{
	var date1 = new Date(startDate);
	var date2 = new Date(endDate);
	var timeDiff = date2.getTime() - date1.getTime();
	var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
	return timeDiff/1000;
}
function toPhrase(string)
{
  return string.charAt(0).toUpperCase() + string.slice(1);
}
function addCommas(nStr)
{
	nStr = parseFloat(nStr);
	
	var d = 0;
	var actualCurrency = "COP";
	
	if(actualCurrency == "COP")
	{
		d = 0;
		var currency = "$";
	}
	if(actualCurrency == "CLP")
	{
		d = 0;
		var currency = "$";
	}
	if(actualCurrency == "PEN")
	{
		d = 2;
		var currency = "S/";
	}
	if(actualCurrency == "MXN")
	{
		d = 2;
		var currency = "$";
	}
	if(actualCurrency == "ARS")
	{
		d = 2;
		var currency = "$";
	}
	if(actualCurrency == "USD")
	{
		d = 2;
		var currency = "$";
	}
	if(actualCurrency == "EUR")
	{
		d = 2;
		var currency = "â‚¬";
	}
	if(actualCurrency == "GBP")
	{
		d = 2;
		var currency = "Â£";
	}
	
	return currency + "" + nStr.toFixed(d).replace(/./g, function(c, i, a) 
	{
		return i > 0 && c !== "." && (a.length - i) % 3 === 0 ? "," + c : c;
	});

}
function isNumber(n)
{
  return !isNaN(parseFloat(n)) && isFinite(n);
}
function getNow(extra, dayonly)
{
	var currentdate = new Date(); 
	
	if(extra != null)
	{
		currentdate.setDate(currentdate.getDate() + (extra));
	}
	
	var year = currentdate.getFullYear();
	var month = (currentdate.getMonth()+1);
	var day = currentdate.getDate();
	var hour = currentdate.getHours();
	var minute = currentdate.getMinutes();
	var second = currentdate.getSeconds();
	
	if(parseFloat(month) < 10){month = "0"+month};
	if(parseFloat(day) < 10){day = "0"+day};
	if(parseFloat(hour) < 10){hour = "0"+hour};
	if(parseFloat(minute) < 10){minute = "0"+minute};
	if(parseFloat(second) < 10){second = "0"+second};
	
	if(dayonly != null)
	{
		var datetime =  year + "-" +  month + "-" + day;	
	}
	else
	{
		var datetime =  year + "-" +  month + "-" + day + " "  + hour + ":"  + minute + ":"  + second;	
	}

	return datetime;
}
function setCountries()
{
	
	var picked = [];
	
	for(var i=0; i<countryList.length; i++)
	{
		var country = countryList[i];
		var fixed = {};
		fixed.COUNTRY = country;
		picked.push(fixed);
		
	}
	
	return picked;
}

Array.prototype.in_array=function()
{ 
        for(var j in this)
        { 
                if(this[j]==arguments[0])
                {
                        return true; 
                } 
        } 
        return false;     
} 
String.prototype.replaceAll = function(search, replacement) 
{
    var target = this;
    return target.replace(new RegExp(search, 'g'), replacement);
};

// FAST LOADER/BUTTON LOCKER
function loadManager(state, trigger)
{
	
	// AUTO DISABLED FOR DEVELOPMENT
	if(showLoaderActive == 0)
	{
		console.log("ignore loader");
		return;
	};
	
	if(state == 1)
	{
		// console.log("show");
		PUM.open(889);
	}
	else
	{
		// console.log("hide");
		PUM.close(889);
	}
	if(trigger != null)
	{
		var thisTrigger = document.getElementById(trigger);
		console.log(thisTrigger);
		
		return;
		
		if(state == 1)
		{
			console.log("lock test try on return");
			// thisTrigger.oldFunction = thisTrigger.onclick;
			thisTrigger.onclick = function ()
			{
				console.log("isLocked: "+this.id);
				return;
			}
		}
		else
		{
			console.log("unlock");
			thisTrigger.onclick = thisTrigger.oldFunction;
		}
	}
}

// COMMS
function sendAjax(obj, method, data, responseFunction)
{
	var info = {};
	info.class = obj;
	info.method = method;
	info.data = data;
	
	// LOG DATA ----------------------
	info.data.mt = actualMT;
	info.data.ucode = actualUser;
	info.data.iface = imfoo;
	info.data.logEntity = actualEntity;
	// LOG DATA ----------------------
	
	launched = getNow();
	// console.log(info)
	// console.log("inicia: "+getNow())	
	
	
	console.log(entityAlive);
	if(entityAlive == "0")
	{
		if(method != "refreshTable" && method != "logout")
		{
			fastPop("La entidad se encuentra vencida, solo puede consultar  tablas.", 3000);
			console.log("locked");
			return;
		}
		
	}
	
	
	curl = root+'app/php/mentry.php';
	jQuery.ajax(
	{
			type: 'POST',
			url: curl,
			contentType: 'application/json',
			data: JSON.stringify(info),
			cache: false,
			async: true,
			success: function(data)
			{
				 try
				 {
					var tmpJson = jQuery.parseJSON(data);
					setTimeout(function(){ responseFunction(tmpJson.data); }, 300);
					// console.log("llega: "+getNow())	
					returned = getNow();
					
					var timed = getdDiffSecs(launched, returned);
					
					// console.log(timed+" segs")	
					
					// console.log(info.method);
					// console.log(tmpJson);
				 }
				 catch(e)
				 {
					 console.log(data);
				 }
			},
			error: function( jqXhr, textStatus, errorThrown )
			{ 
				console.log( errorThrown );
			}
		});
}



countryList = [
	"Afghanistan",
	"Albania",
	"Algeria",
	"American Samoa",
	"Andorra",
	"Angola",
	"Anguilla",
	"Antarctica",
	"Antigua and Barbuda",
	"Argentina",
	"Armenia",
	"Aruba",
	"Australia",
	"Austria",
	"Azerbaijan",
	"Bahamas (the)",
	"Bahrain",
	"Bangladesh",
	"Barbados",
	"Belarus",
	"Belgium",
	"Belize",
	"Benin",
	"Bermuda",
	"Bhutan",
	"Bolivia (Plurinational State of)",
	"Bonaire, Sint Eustatius and Saba",
	"Bosnia and Herzegovina",
	"Botswana",
	"Bouvet Island",
	"Brazil",
	"British Indian Ocean Territory (the)",
	"Brunei Darussalam",
	"Bulgaria",
	"Burkina Faso",
	"Burundi",
	"Cabo Verde",
	"Cambodia",
	"Cameroon",
	"Canada",
	"Cayman Islands (the)",
	"Central African Republic (the)",
	"Chad",
	"Chile",
	"China",
	"Christmas Island",
	"Cocos (Keeling) Islands (the)",
	"Colombia",
	"Comoros (the)",
	"Congo (the Democratic Republic of the)",
	"Congo (the)",
	"Cook Islands (the)",
	"Costa Rica",
	"Croatia",
	"Cuba",
	"Curaçao",
	"Cyprus",
	"Czechia",
	"Côte d'Ivoire",
	"Denmark",
	"Djibouti",
	"Dominica",
	"Dominican Republic (the)",
	"Ecuador",
	"Egypt",
	"El Salvador",
	"Equatorial Guinea",
	"Eritrea",
	"Estonia",
	"Eswatini",
	"Ethiopia",
	"Falkland Islands (the) [Malvinas]",
	"Faroe Islands (the)",
	"Fiji",
	"Finland",
	"France",
	"French Guiana",
	"French Polynesia",
	"French Southern Territories (the)",
	"Gabon",
	"Gambia (the)",
	"Georgia",
	"Germany",
	"Ghana",
	"Gibraltar",
	"Greece",
	"Greenland",
	"Grenada",
	"Guadeloupe",
	"Guam",
	"Guatemala",
	"Guernsey",
	"Guinea",
	"Guinea-Bissau",
	"Guyana",
	"Haiti",
	"Heard Island and McDonald Islands",
	"Holy See (the)",
	"Honduras",
	"Hong Kong",
	"Hungary",
	"Iceland",
	"India",
	"Indonesia",
	"Iran (Islamic Republic of)",
	"Iraq",
	"Ireland",
	"Isle of Man",
	"Israel",
	"Italy",
	"Jamaica",
	"Japan",
	"Jersey",
	"Jordan",
	"Kazakhstan",
	"Kenya",
	"Kiribati",
	"Korea (the Democratic People's Republic of)",
	"Korea (the Republic of)",
	"Kuwait",
	"Kyrgyzstan",
	"Lao People's Democratic Republic (the)",
	"Latvia",
	"Lebanon",
	"Lesotho",
	"Liberia",
	"Libya",
	"Liechtenstein",
	"Lithuania",
	"Luxembourg",
	"Macao",
	"Madagascar",
	"Malawi",
	"Malaysia",
	"Maldives",
	"Mali",
	"Malta",
	"Marshall Islands (the)",
	"Martinique",
	"Mauritania",
	"Mauritius",
	"Mayotte",
	"Mexico",
	"Micronesia (Federated States of)",
	"Moldova (the Republic of)",
	"Monaco",
	"Mongolia",
	"Montenegro",
	"Montserrat",
	"Morocco",
	"Mozambique",
	"Myanmar",
	"Namibia",
	"Nauru",
	"Nepal",
	"Netherlands (the)",
	"New Caledonia",
	"New Zealand",
	"Nicaragua",
	"Niger (the)",
	"Nigeria",
	"Niue",
	"Norfolk Island",
	"Northern Mariana Islands (the)",
	"Norway",
	"Oman",
	"Pakistan",
	"Palau",
	"Palestine, State of",
	"Panama",
	"Papua New Guinea",
	"Paraguay",
	"Peru",
	"Philippines (the)",
	"Pitcairn",
	"Poland",
	"Portugal",
	"Puerto Rico",
	"Qatar",
	"Republic of North Macedonia",
	"Romania",
	"Russian Federation (the)",
	"Rwanda",
	"Réunion",
	"Saint Barthélemy",
	"Saint Helena, Ascension and Tristan da Cunha",
	"Saint Kitts and Nevis",
	"Saint Lucia",
	"Saint Martin (French part)",
	"Saint Pierre and Miquelon",
	"Saint Vincent and the Grenadines",
	"Samoa",
	"San Marino",
	"Sao Tome and Principe",
	"Saudi Arabia",
	"Senegal",
	"Serbia",
	"Seychelles",
	"Sierra Leone",
	"Singapore",
	"Sint Maarten (Dutch part)",
	"Slovakia",
	"Slovenia",
	"Solomon Islands",
	"Somalia",
	"South Africa",
	"South Georgia and the South Sandwich Islands",
	"South Sudan",
	"Spain",
	"Sri Lanka",
	"Sudan (the)",
	"Suriname",
	"Svalbard and Jan Mayen",
	"Sweden",
	"Switzerland",
	"Syrian Arab Republic",
	"Taiwan",
	"Tajikistan",
	"Tanzania, United Republic of",
	"Thailand",
	"Timor-Leste",
	"Togo",
	"Tokelau",
	"Tonga",
	"Trinidad and Tobago",
	"Tunisia",
	"Turkey",
	"Turkmenistan",
	"Turks and Caicos Islands (the)",
	"Tuvalu",
	"Uganda",
	"Ukraine",
	"United Arab Emirates (the)",
	"United Kingdom of Great Britain and Northern Ireland (the)",
	"United States Minor Outlying Islands (the)",
	"United States of America (the)",
	"Uruguay",
	"Uzbekistan",
	"Vanuatu",
	"Venezuela (Bolivarian Republic of)",
	"Viet Nam",
	"Virgin Islands (British)",
	"Virgin Islands (U.S.)",
	"Wallis and Futuna",
	"Western Sahara",
	"Yemen",
	"Zambia",
	"Zimbabwe",
	"Åland Islands"
];









// (function (global) {

    // if(typeof (global) === "undefined") {
        // throw new Error("window is undefined");
    // }

    // var _hash = "!";
    // var noBackPlease = function () {
        // global.location.href += "#";

        // global.setTimeout(function () {
            // global.location.href += "!";
        // }, 50);
    // };

    // global.onhashchange = function () {
        // if (global.location.hash !== _hash) {
            // global.location.hash = _hash;
        // }
    // };

    // global.onload = function () {
        // noBackPlease();

        // document.body.onkeydown = function (e) {
            // var elm = e.target.nodeName.toLowerCase();
            // if (e.which === 8 && (elm !== 'input' && elm  !== 'textarea')) {
                // e.preventDefault();
            // }

			// console.log("stoped")
            // e.stopPropagation();
        // };
    // }
// })(window);