var locations = [  
    {  
        "id":0,
        "departamento":"Amazonas",
        "ciudades":[  
            "Leticia",
            "Puerto Nari\u00f1o"
			
        ]
    },
    {  
        "id":1,
        "departamento":"Antioquia",
        "ciudades":[  
            "Abejorral",
            "Abriaqu\u00ed",
            "Alejandr\u00eda",
            "Amag\u00e1",
            "Amalfi",
            "Andes",
            "Angel\u00f3polis",
            "Angostura",
            "Anor\u00ed",
            "Anz\u00e1",
            "Apartad\u00f3",
            "Arboletes",
            "Argelia",
            "Armenia",
            "Barbosa",
            "Bello",
            "Belmira",
            "Betania",
            "Betulia",
            "Brice\u00f1o",
            "Buritic\u00e1",
            "C\u00e1ceres",
            "Caicedo",
            "Caldas",
            "Campamento",
            "Ca\u00f1asgordas",
            "Caracol\u00ed",
            "Caramanta",
            "Carepa",
            "Carolina del Pr\u00edncipe",
            "Caucasia",
            "Chigorod\u00f3",
            "Cisneros",
            "Ciudad Bol\u00edvar",
            "Cocorn\u00e1",
            "Concepci\u00f3n",
            "Concordia",
            "Copacabana",
            "Dabeiba",
            "Donmat\u00edas",
            "Eb\u00e9jico",
            "El Bagre",
            "El Carmen de Viboral",
            "El Pe\u00f1ol",
            "El Retiro",
            "El Santuario",
            "Entrerr\u00edos",
            "Envigado",
            "Fredonia",
            "Frontino",
            "Giraldo",
            "Girardota",
            "G\u00f3mez Plata",
            "Granada",
            "Guadalupe",
            "Guarne",
            "Guatap\u00e9",
            "Heliconia",
            "Hispania",
            "Itag\u00fc\u00ed",
            "Ituango",
            "Jard\u00edn",
            "Jeric\u00f3",
            "La Ceja",
            "La Estrella",
            "La Pintada",
            "La Uni\u00f3n",
            "Liborina",
            "Maceo",
            "Marinilla",
            "Medell\u00edn",
            "Montebello",
            "Murind\u00f3",
            "Mutat\u00e1",
            "Nari\u00f1o",
            "Nech\u00ed",
            "Necocl\u00ed",
            "Olaya",
            "Peque",
            "Pueblorrico",
            "Puerto Berr\u00edo",
            "Puerto Nare",
            "Puerto Triunfo",
            "Remedios",
            "Rionegro",
            "Sabanalarga",
            "Sabaneta",
            "Salgar",
            "San Andr\u00e9s de Cuerquia",
            "San Carlos",
            "San Francisco",
            "San Jer\u00f3nimo",
            "San Jos\u00e9 de la Monta\u00f1a",
            "San Juan de Urab\u00e1",
            "San Luis",
            "San Pedro de Urab\u00e1",
            "San Pedro de los Milagros",
            "San Rafael",
            "San Roque",
            "San Vicente",
            "Santa B\u00e1rbara",
            "Santa Fe de Antioquia",
            "Santa Rosa de Osos",
            "Santo Domingo",
            "Segovia",
            "Sons\u00f3n",
            "Sopetr\u00e1n",
            "T\u00e1mesis",
            "Taraz\u00e1",
            "Tarso",
            "Titirib\u00ed",
            "Toledo",
            "Turbo",
            "Uramita",
            "Urrao",
            "Valdivia",
            "Valpara\u00edso",
            "Vegach\u00ed",
            "Venecia",
            "Vig\u00eda del Fuerte",
            "Yal\u00ed",
            "Yarumal",
            "Yolomb\u00f3",
            "Yond\u00f3",
            "Zaragoza"
        ]
    },
    {  
        "id":2,
        "departamento":"Arauca",
        "ciudades":[  
            "Arauca",
            "Arauquita",
            "Cravo Norte",
            "Fortul",
            "Puerto Rond\u00f3n",
            "Saravena",
            "Tame"
        ]
    },
    {  
        "id":3,
        "departamento":"Atl\u00e1ntico",
        "ciudades":[  
            "Baranoa",
            "Barranquilla",
            "Campo de la Cruz",
            "Candelaria",
            "Galapa",
            "Juan de Acosta",
            "Luruaco",
            "Malambo",
            "Manat\u00ed",
            "Palmar de Varela",
            "Pioj\u00f3",
            "Polonuevo",
            "Ponedera",
            "Puerto Colombia",
            "Repel\u00f3n",
            "Sabanagrande",
            "Sabanalarga",
            "Santa Luc\u00eda",
            "Santo Tom\u00e1s",
            "Soledad",
            "Su\u00e1n",
            "Tubar\u00e1",
            "Usiacur\u00ed"
        ]
    },
    {  
        "id":4,
        "departamento":"Bol\u00edvar",
        "ciudades":[  
            "Ach\u00ed",
            "Altos del Rosario",
            "Arenal",
            "Arjona",
            "Arroyohondo",
            "Barranco de Loba",
            "Brazuelo de Papayal",
            "Calamar",
            "Cantagallo",
            "Cartagena de Indias",
            "Cicuco",
            "Clemencia",
            "C\u00f3rdoba",
            "El Carmen de Bol\u00edvar",
            "El Guamo",
            "El Pe\u00f1\u00f3n",
            "Hatillo de Loba",
            "Magangu\u00e9",
            "Mahates",
            "Margarita",
            "Mar\u00eda la Baja",
            "Momp\u00f3s",
            "Montecristo",
            "Morales",
            "Noros\u00ed",
            "Pinillos",
            "Regidor",
            "R\u00edo Viejo",
            "San Crist\u00f3bal",
            "San Estanislao",
            "San Fernando",
            "San Jacinto del Cauca",
            "San Jacinto",
            "San Juan Nepomuceno",
            "San Mart\u00edn de Loba",
            "San Pablo",
            "Santa Catalina",
            "Santa Rosa",
            "Santa Rosa del Sur",
            "Simit\u00ed",
            "Soplaviento",
            "Talaigua Nuevo",
            "Tiquisio",
            "Turbaco",
            "Turban\u00e1",
            "Villanueva",
            "Zambrano"
        ]
    },
    {  
        "id":5,
        "departamento":"Boyac\u00e1",
        "ciudades":[  
            "Almeida",
            "Aquitania",
            "Arcabuco",
            "Bel\u00e9n",
            "Berbeo",
            "Bet\u00e9itiva",
            "Boavita",
            "Boyac\u00e1",
            "Brice\u00f1o",
            "Buenavista",
            "Busbanz\u00e1",
            "Caldas",
            "Campohermoso",
            "Cerinza",
            "Chinavita",
            "Chiquinquir\u00e1",
            "Ch\u00edquiza",
            "Chiscas",
            "Chita",
            "Chitaraque",
            "Chivat\u00e1",
            "Chivor",
            "Ci\u00e9nega",
            "C\u00f3mbita",
            "Coper",
            "Corrales",
            "Covarach\u00eda",
            "Cubar\u00e1",
            "Cucaita",
            "Cu\u00edtiva",
            "Duitama",
            "El Cocuy",
            "El Espino",
            "Firavitoba",
            "Floresta",
            "Gachantiv\u00e1",
            "G\u00e1meza",
            "Garagoa",
            "Guacamayas",
            "Guateque",
            "Guayat\u00e1",
            "G\u00fcic\u00e1n",
            "Iza",
            "Jenesano",
            "Jeric\u00f3",
            "La Capilla",
            "La Uvita",
            "La Victoria",
            "Labranzagrande",
            "Macanal",
            "Marip\u00ed",
            "Miraflores",
            "Mongua",
            "Mongu\u00ed",
            "Moniquir\u00e1",
            "Motavita",
            "Muzo",
            "Nobsa",
            "Nuevo Col\u00f3n",
            "Oicat\u00e1",
            "Otanche",
            "Pachavita",
            "P\u00e1ez",
            "Paipa",
            "Pajarito",
            "Panqueba",
            "Pauna",
            "Paya",
            "Paz del R\u00edo",
            "Pesca",
            "Pisba",
            "Puerto Boyac\u00e1",
            "Qu\u00edpama",
            "Ramiriqu\u00ed",
            "R\u00e1quira",
            "Rond\u00f3n",
            "Saboy\u00e1",
            "S\u00e1chica",
            "Samac\u00e1",
            "San Eduardo",
            "San Jos\u00e9 de Pare",
            "San Luis de Gaceno",
            "San Mateo",
            "San Miguel de Sema",
            "San Pablo de Borbur",
            "Santa Mar\u00eda",
            "Santa Rosa de Viterbo",
            "Santa Sof\u00eda",
            "Santana",
            "Sativanorte",
            "Sativasur",
            "Siachoque",
            "Soat\u00e1",
            "Socha",
            "Socot\u00e1",
            "Sogamoso",
            "Somondoco",
            "Sora",
            "Sorac\u00e1",
            "Sotaquir\u00e1",
            "Susac\u00f3n",
            "Sutamarch\u00e1n",
            "Sutatenza",
            "Tasco",
            "Tenza",
            "Tiban\u00e1",
            "Tibasosa",
            "Tinjac\u00e1",
            "Tipacoque",
            "Toca",
            "Tog\u00fc\u00ed",
            "T\u00f3paga",
            "Tota",
            "Tunja",
            "Tunungu\u00e1",
            "Turmequ\u00e9",
            "Tuta",
            "Tutaz\u00e1",
            "\u00dambita",
            "Ventaquemada",
            "Villa de Leyva",
            "Viracach\u00e1",
            "Zetaquira"
        ]
    },
    {  
        "id":6,
        "departamento":"Caldas",
        "ciudades":[  
            "Aguadas",
            "Anserma",
            "Aranzazu",
            "Belalc\u00e1zar",
            "Chinchin\u00e1",
            "Filadelfia",
            "La Dorada",
            "La Merced",
            "Manizales",
            "Manzanares",
            "Marmato",
            "Marquetalia",
            "Marulanda",
            "Neira",
            "Norcasia",
            "P\u00e1cora",
            "Palestina",
            "Pensilvania",
            "Riosucio",
            "Risaralda",
            "Salamina",
            "Saman\u00e1",
            "San Jos\u00e9",
            "Sup\u00eda",
            "Victoria",
            "Villamar\u00eda",
            "Viterbo"
        ]
    },
    {  
        "id":7,
        "departamento":"Caquet\u00e1",
        "ciudades":[  
            "Albania",
            "Bel\u00e9n de los Andaqu\u00edes",
            "Cartagena del Chair\u00e1",
            "Curillo",
            "El Doncello",
            "El Paujil",
            "Florencia",
            "La Monta\u00f1ita",
            "Mil\u00e1n",
            "Morelia",
            "Puerto Rico",
            "San Jos\u00e9 del Fragua",
            "San Vicente del Cagu\u00e1n",
            "Solano",
            "Solita",
            "Valpara\u00edso"
        ]
    },
    {  
        "id":8,
        "departamento":"Casanare",
        "ciudades":[  
            "Aguazul",
            "Ch\u00e1meza",
            "Hato Corozal",
            "La Salina",
            "Man\u00ed",
            "Monterrey",
            "Nunch\u00eda",
            "Orocu\u00e9",
            "Paz de Ariporo",
            "Pore",
            "Recetor",
            "Sabanalarga",
            "S\u00e1cama",
            "San Luis de Palenque",
            "T\u00e1mara",
            "Tauramena",
            "Trinidad",
            "Villanueva",
            "Yopal"
        ]
    },
    {  
        "id":9,
        "departamento":"Cauca",
        "ciudades":[  
            "Almaguer",
            "Argelia",
            "Balboa",
            "Bol\u00edvar",
            "Buenos Aires",
            "Cajib\u00edo",
            "Caldono",
            "Caloto",
            "Corinto",
            "El Tambo",
            "Florencia",
            "Guachen\u00e9",
            "Guap\u00ed",
            "Inz\u00e1",
            "Jambal\u00f3",
            "La Sierra",
            "La Vega",
            "L\u00f3pez de Micay",
            "Mercaderes",
            "Miranda",
            "Morales",
            "Padilla",
            "P\u00e1ez",
            "Pat\u00eda",
            "Piamonte",
            "Piendam\u00f3",
            "Popay\u00e1n",
            "Puerto Tejada",
            "Purac\u00e9",
            "Rosas",
            "San Sebasti\u00e1n",
            "Santa Rosa",
            "Santander de Quilichao",
            "Silvia",
            "Sotar\u00e1",
            "Su\u00e1rez",
            "Sucre",
            "Timb\u00edo",
            "Timbiqu\u00ed",
            "Torib\u00edo",
            "Totor\u00f3",
            "Villa Rica"
        ]
    },
    {  
        "id":10,
        "departamento":"Cesar",
        "ciudades":[  
            "Aguachica",
            "Agust\u00edn Codazzi",
            "Astrea",
            "Becerril",
            "Bosconia",
            "Chimichagua",
            "Chiriguan\u00e1",
            "Curuman\u00ed",
            "El Copey",
            "El Paso",
            "Gamarra",
            "Gonz\u00e1lez",
            "La Gloria (Cesar)",
            "La Jagua de Ibirico",
            "La Paz",
            "Manaure Balc\u00f3n del Cesar",
            "Pailitas",
            "Pelaya",
            "Pueblo Bello",
            "R\u00edo de Oro",
            "San Alberto",
            "San Diego",
            "San Mart\u00edn",
            "Tamalameque",
            "Valledupar"
        ]
    },
    {  
        "id":11,
        "departamento":"Choc\u00f3",
        "ciudades":[  
            "Acand\u00ed",
            "Alto Baud\u00f3",
            "Bagad\u00f3",
            "Bah\u00eda Solano",
            "Bajo Baud\u00f3",
            "Bojay\u00e1",
            "Cant\u00f3n de San Pablo",
            "C\u00e9rtegui",
            "Condoto",
            "El Atrato",
            "El Carmen de Atrato",
            "El Carmen del Dari\u00e9n",
            "Istmina",
            "Jurad\u00f3",
            "Litoral de San Juan",
            "Llor\u00f3",
            "Medio Atrato",
            "Medio Baud\u00f3",
            "Medio San Juan",
            "N\u00f3vita",
            "Nuqu\u00ed",
            "Quibd\u00f3",
            "R\u00edo Ir\u00f3",
            "R\u00edo Quito",
            "Riosucio",
            "San Jos\u00e9 del Palmar",
            "Sip\u00ed",
            "Tad\u00f3",
            "Uni\u00f3n Panamericana",
            "Ungu\u00eda"
        ]
    },
    {  
        "id":12,
        "departamento":"Cundinamarca",
        "ciudades":[  
            "Agua de Dios",
            "Alb\u00e1n",
            "Anapoima",
            "Anolaima",
            "Apulo",
            "Arbel\u00e1ez",
            "Beltr\u00e1n",
            "Bituima",
            "Bogot\u00e1",
            "Bojac\u00e1",
            "Cabrera",
            "Cachipay",
            "Cajic\u00e1",
            "Caparrap\u00ed",
            "C\u00e1queza",
            "Carmen de Carupa",
            "Chaguan\u00ed",
            "Ch\u00eda",
            "Chipaque",
            "Choach\u00ed",
            "Chocont\u00e1",
            "Cogua",
            "Cota",
            "Cucunub\u00e1",
            "El Colegio",
            "El Pe\u00f1\u00f3n",
            "El Rosal",
            "Facatativ\u00e1",
            "F\u00f3meque",
            "Fosca",
            "Funza",
            "F\u00faquene",
            "Fusagasug\u00e1",
            "Gachal\u00e1",
            "Gachancip\u00e1",
            "Gachet\u00e1",
            "Gama",
            "Girardot",
            "Granada",
            "Guachet\u00e1",
            "Guaduas",
            "Guasca",
            "Guataqu\u00ed",
            "Guatavita",
            "Guayabal de S\u00edquima",
            "Guayabetal",
            "Guti\u00e9rrez",
            "Jerusal\u00e9n",
            "Jun\u00edn",
            "La Calera",
            "La Mesa",
            "La Palma",
            "La Pe\u00f1a",
            "La Vega",
            "Lenguazaque",
            "Machet\u00e1",
            "Madrid",
            "Manta",
            "Medina",
            "Mosquera",
            "Nari\u00f1o",
            "Nemoc\u00f3n",
            "Nilo",
            "Nimaima",
            "Nocaima",
            "Pacho",
            "Paime",
            "Pandi",
            "Paratebueno",
            "Pasca",
            "Puerto Salgar",
            "Pul\u00ed",
            "Quebradanegra",
            "Quetame",
            "Quipile",
            "Ricaurte",
            "San Antonio del Tequendama",
            "San Bernardo",
            "San Cayetano",
            "San Francisco",
            "San Juan de Rioseco",
            "Sasaima",
            "Sesquil\u00e9",
            "Sibat\u00e9",
            "Silvania",
            "Simijaca",
            "Soacha",
            "Subachoque",
            "Suesca",
            "Supat\u00e1",
            "Susa",
            "Sutatausa",
            "Tabio",
            "Tausa",
            "Tena",
            "Tenjo",
            "Tibacuy",
            "Tibirita",
            "Tocaima",
            "Tocancip\u00e1",
            "Topaip\u00ed",
            "Ubal\u00e1",
            "Ubaque",
            "Ubat\u00e9",
            "Une",
            "\u00datica",
            "Venecia",
            "Vergara",
            "Vian\u00ed",
            "Villag\u00f3mez",
            "Villapinz\u00f3n",
            "Villeta",
            "Viot\u00e1",
            "Yacop\u00ed",
            "Zipac\u00f3n",
            "Zipaquir\u00e1"
        ]
    },
    {  
        "id":13,
        "departamento":"C\u00f3rdoba",
        "ciudades":[  
            "Ayapel",
            "Buenavista",
            "Canalete",
            "Ceret\u00e9",
            "Chim\u00e1",
            "Chin\u00fa",
            "Ci\u00e9naga de Oro",
            "Cotorra",
            "La Apartada",
            "Lorica",
            "Los C\u00f3rdobas",
            "Momil",
            "Montel\u00edbano",
            "Monter\u00eda",
            "Mo\u00f1itos",
            "Planeta Rica",
            "Pueblo Nuevo",
            "Puerto Escondido",
            "Puerto Libertador",
            "Pur\u00edsima",
            "Sahag\u00fan",
            "San Andr\u00e9s de Sotavento",
            "San Antero",
            "San Bernardo del Viento",
            "San Carlos",
            "San Jos\u00e9 de Ur\u00e9",
            "San Pelayo",
            "Tierralta",
            "Tuch\u00edn",
            "Valencia"
        ]
    },
    {  
        "id":14,
        "departamento":"Guain\u00eda",
        "ciudades":[  
            "In\u00edrida"
        ]
    },
    {  
        "id":15,
        "departamento":"Guaviare",
        "ciudades":[  
            "Calamar",
            "El Retorno",
            "Miraflores",
            "San Jos\u00e9 del Guaviare"
        ]
    },
    {  
        "id":16,
        "departamento":"Huila",
        "ciudades":[  
            "Acevedo",
            "Agrado",
            "Aipe",
            "Algeciras",
            "Altamira",
            "Baraya",
            "Campoalegre",
            "Colombia",
            "El Pital",
            "El\u00edas",
            "Garz\u00f3n",
            "Gigante",
            "Guadalupe",
            "Hobo",
            "\u00cdquira",
            "Isnos",
            "La Argentina",
            "La Plata",
            "N\u00e1taga",
            "Neiva",
            "Oporapa",
            "Paicol",
            "Palermo",
            "Palestina",
            "Pitalito",
            "Rivera",
            "Saladoblanco",
            "San Agust\u00edn",
            "Santa Mar\u00eda",
            "Suaza",
            "Tarqui",
            "Tello",
            "Teruel",
            "Tesalia",
            "Timan\u00e1",
            "Villavieja",
            "Yaguar\u00e1"
        ]
    },
    {  
        "id":17,
        "departamento":"La Guajira",
        "ciudades":[  
            "Albania",
            "Barrancas",
            "Dibulla",
            "Distracci\u00f3n",
            "El Molino",
            "Fonseca",
            "Hatonuevo",
            "La Jagua del Pilar",
            "Maicao",
            "Manaure",
            "Riohacha",
            "San Juan del Cesar",
            "Uribia",
            "Urumita",
            "Villanueva"
        ]
    },
    {  
        "id":18,
        "departamento":"Magdalena",
        "ciudades":[  
            "Algarrobo",
            "Aracataca",
            "Ariguan\u00ed",
            "Cerro de San Antonio",
            "Chibolo",
            "Chibolo",
            "Ci\u00e9naga",
            "Concordia",
            "El Banco",
            "El Pi\u00f1\u00f3n",
            "El Ret\u00e9n",
            "Fundaci\u00f3n",
            "Guamal",
            "Nueva Granada",
            "Pedraza",
            "Piji\u00f1o del Carmen",
            "Pivijay",
            "Plato",
            "Pueblo Viejo",
            "Remolino",
            "Sabanas de San \u00c1ngel",
            "Salamina",
            "San Sebasti\u00e1n de Buenavista",
            "San Zen\u00f3n",
            "Santa Ana",
            "Santa B\u00e1rbara de Pinto",
            "Santa Marta",
            "Sitionuevo",
            "Tenerife",
            "Zapay\u00e1n",
            "Zona Bananera"
        ]
    },
    {  
        "id":19,
        "departamento":"Meta",
        "ciudades":[  
            "Acac\u00edas",
            "Barranca de Up\u00eda",
            "Cabuyaro",
            "Castilla la Nueva",
            "Cubarral",
            "Cumaral",
            "El Calvario",
            "El Castillo",
            "El Dorado",
            "Fuente de Oro",
            "Granada",
            "Guamal",
            "La Macarena",
            "La Uribe",
            "Lejan\u00edas",
            "Mapirip\u00e1n",
            "Mesetas",
            "Puerto Concordia",
            "Puerto Gait\u00e1n",
            "Puerto Lleras",
            "Puerto L\u00f3pez",
            "Puerto Rico",
            "Restrepo",
            "San Carlos de Guaroa",
            "San Juan de Arama",
            "San Juanito",
            "San Mart\u00edn",
            "Villavicencio",
            "Vista Hermosa"
        ]
    },
    {  
        "id":20,
        "departamento":"Nari\u00f1o",
        "ciudades":[  
            "Aldana",
            "Ancuy\u00e1",
            "Arboleda",
            "Barbacoas",
            "Bel\u00e9n",
            "Buesaco",
            "Chachag\u00fc\u00ed",
            "Col\u00f3n",
            "Consac\u00e1",
            "Contadero",
            "C\u00f3rdoba",
            "Cuaspud",
            "Cumbal",
            "Cumbitara",
            "El Charco",
            "El Pe\u00f1ol",
            "El Rosario",
            "El Tabl\u00f3n",
            "El Tambo",
            "Francisco Pizarro",
            "Funes",
            "Guachucal",
            "Guaitarilla",
            "Gualmat\u00e1n",
            "Iles",
            "Imu\u00e9s",
            "Ipiales",
            "La Cruz",
            "La Florida",
            "La Llanada",
            "La Tola",
            "La Uni\u00f3n",
            "Leiva",
            "Linares",
            "Los Andes",
            "Mag\u00fc\u00ed Pay\u00e1n",
            "Mallama",
            "Mosquera",
            "Nari\u00f1o",
            "Olaya Herrera",
            "Ospina",
            "Pasto",
            "Policarpa",
            "Potos\u00ed",
            "Providencia",
            "Puerres",
            "Pupiales",
            "Ricaurte",
            "Roberto Pay\u00e1n",
            "Samaniego",
            "San Bernardo",
            "San Jos\u00e9 de Alb\u00e1n",
            "San Lorenzo",
            "San Pablo",
            "San Pedro de Cartago",
            "Sandon\u00e1",
            "Santa B\u00e1rbara",
            "Santacruz",
            "Sapuyes",
            "Taminango",
            "Tangua",
            "Tumaco",
            "T\u00faquerres",
            "Yacuanquer"
        ]
    },
    {  
        "id":21,
        "departamento":"Norte de Santander",
        "ciudades":[  
            "\u00c1brego",
            "Arboledas",
            "Bochalema",
            "Bucarasica",
            "C\u00e1chira",
            "C\u00e1cota",
            "Chin\u00e1cota",
            "Chitag\u00e1",
            "Convenci\u00f3n",
            "C\u00facuta",
            "Cucutilla",
            "Duran\u00eda",
            "El Carmen",
            "El Tarra",
            "El Zulia",
            "Gramalote",
            "Hacar\u00ed",
            "Herr\u00e1n",
            "La Esperanza",
            "La Playa de Bel\u00e9n",
            "Labateca",
            "Los Patios",
            "Lourdes",
            "Mutiscua",
            "Oca\u00f1a",
            "Pamplona",
            "Pamplonita",
            "Puerto Santander",
            "Ragonvalia",
            "Salazar de Las Palmas",
            "San Calixto",
            "San Cayetano",
            "Santiago",
            "Santo Domingo de Silos",
            "Sardinata",
            "Teorama",
            "Tib\u00fa",
            "Toledo",
            "Villa Caro",
            "Villa del Rosario"
        ]
    },
    {  
        "id":22,
        "departamento":"Putumayo",
        "ciudades":[  
            "Col\u00f3n",
            "Mocoa",
            "Orito",
            "Puerto As\u00eds",
            "Puerto Caicedo",
            "Puerto Guzm\u00e1n",
            "Puerto Legu\u00edzamo",
            "San Francisco",
            "San Miguel",
            "Santiago",
            "Sibundoy",
            "Valle del Guamuez",
            "Villagarz\u00f3n"
        ]
    },
    {  
        "id":23,
        "departamento":"Quind\u00edo",
        "ciudades":[  
            "Armenia",
            "Buenavista",
            "Calarc\u00e1",
            "Circasia",
            "C\u00f3rdoba",
            "Filandia",
            "G\u00e9nova",
            "La Tebaida",
            "Montenegro",
            "Pijao",
            "Quimbaya",
            "Salento"
        ]
    },
    {  
        "id":24,
        "departamento":"Risaralda",
        "ciudades":[  
            "Ap\u00eda",
            "Balboa",
            "Bel\u00e9n de Umbr\u00eda",
            "Dosquebradas",
            "Gu\u00e1tica",
            "La Celia",
            "La Virginia",
            "Marsella",
            "Mistrat\u00f3",
            "Pereira",
            "Pueblo Rico",
            "Quinch\u00eda",
            "Santa Rosa de Cabal",
            "Santuario"
        ]
    },
    {  
        "id":25,
        "departamento":"San Andr\u00e9s y Providencia",
        "ciudades":[  
            "Providencia y Santa Catalina Islas",
            "San Andr\u00e9s"
        ]
    },
    {  
        "id":26,
        "departamento":"Santander",
        "ciudades":[  
            "Aguada",
            "Albania",
            "Aratoca",
            "Barbosa",
            "Barichara",
            "Barrancabermeja",
            "Betulia",
            "Bol\u00edvar",
            "Bucaramanga",
            "Cabrera",
            "California",
            "Capitanejo",
            "Carcas\u00ed",
            "Cepit\u00e1",
            "Cerrito",
            "Charal\u00e1",
            "Charta",
            "Chima",
            "Chipat\u00e1",
            "Cimitarra",
            "Concepci\u00f3n",
            "Confines",
            "Contrataci\u00f3n",
            "Coromoro",
            "Curit\u00ed",
            "El Carmen de Chucur\u00ed",
            "El Guacamayo",
            "El Pe\u00f1\u00f3n",
            "El Play\u00f3n",
            "El Socorro",
            "Encino",
            "Enciso",
            "Flori\u00e1n",
            "Floridablanca",
            "Gal\u00e1n",
            "G\u00e1mbita",
            "Gir\u00f3n",
            "Guaca",
            "Guadalupe",
            "Guapot\u00e1",
            "Guavat\u00e1",
            "G\u00fcepsa",
            "Hato",
            "Jes\u00fas Mar\u00eda",
            "Jord\u00e1n",
            "La Belleza",
            "La Paz",
            "Land\u00e1zuri",
            "Lebrija",
            "Los Santos",
            "Macaravita",
            "M\u00e1laga",
            "Matanza",
            "Mogotes",
            "Molagavita",
            "Ocamonte",
            "Oiba",
            "Onzaga",
            "Palmar",
            "Palmas del Socorro",
            "P\u00e1ramo",
            "Piedecuesta",
            "Pinchote",
            "Puente Nacional",
            "Puerto Parra",
            "Puerto Wilches",
            "Rionegro",
            "Sabana de Torres",
            "San Andr\u00e9s",
            "San Benito",
            "San Gil",
            "San Joaqu\u00edn",
            "San Jos\u00e9 de Miranda",
            "San Miguel",
            "San Vicente de Chucur\u00ed",
            "Santa B\u00e1rbara",
            "Santa Helena del Op\u00f3n",
            "Simacota",
            "Suaita",
            "Sucre",
            "Surat\u00e1",
            "Tona",
            "Valle de San Jos\u00e9",
            "V\u00e9lez",
            "Vetas",
            "Villanueva",
            "Zapatoca"
        ]
    },
    {  
        "id":27,
        "departamento":"Sucre",
        "ciudades":[  
            "Buenavista",
            "Caimito",
            "Chal\u00e1n",
            "Colos\u00f3",
            "Corozal",
            "Cove\u00f1as",
            "El Roble",
            "Galeras",
            "Guaranda",
            "La Uni\u00f3n",
            "Los Palmitos",
            "Majagual",
            "Morroa",
            "Ovejas",
            "Sampu\u00e9s",
            "San Antonio de Palmito",
            "San Benito Abad",
            "San Juan de Betulia",
            "San Marcos",
            "San Onofre",
            "San Pedro",
            "Sinc\u00e9",
            "Sincelejo",
            "Sucre",
            "Tol\u00fa",
            "Tol\u00fa Viejo"
        ]
    },
    {  
        "id":28,
        "departamento":"Tolima",
        "ciudades":[  
            "Alpujarra",
            "Alvarado",
            "Ambalema",
            "Anzo\u00e1tegui",
            "Armero",
            "Ataco",
            "Cajamarca",
            "Carmen de Apical\u00e1",
            "Casabianca",
            "Chaparral",
            "Coello",
            "Coyaima",
            "Cunday",
            "Dolores",
            "El Espinal",
            "Fal\u00e1n",
            "Flandes",
            "Fresno",
            "Guamo",
            "Herveo",
            "Honda",
            "Ibagu\u00e9",
            "Icononzo",
            "L\u00e9rida",
            "L\u00edbano",
            "Mariquita",
            "Melgar",
            "Murillo",
            "Natagaima",
            "Ortega",
            "Palocabildo",
            "Piedras",
            "Planadas",
            "Prado",
            "Purificaci\u00f3n",
            "Rioblanco",
            "Roncesvalles",
            "Rovira",
            "Salda\u00f1a",
            "San Antonio",
            "San Luis",
            "Santa Isabel",
            "Su\u00e1rez",
            "Valle de San Juan",
            "Venadillo",
            "Villahermosa",
            "Villarrica"
        ]
    },
    {  
        "id":29,
        "departamento":"Valle del Cauca",
        "ciudades":[  
            "Alcal\u00e1",
            "Andaluc\u00eda",
            "Ansermanuevo",
            "Argelia",
            "Bol\u00edvar",
            "Buenaventura",
            "Buga",
            "Bugalagrande",
            "Caicedonia",
            "Cali",
            "Calima",
            "Candelaria",
            "Cartago",
            "Dagua",
            "El \u00c1guila",
            "El Cairo",
            "El Cerrito",
            "El Dovio",
            "Florida",
            "Ginebra",
            "Guacar\u00ed",
            "Jamund\u00ed",
            "La Cumbre",
            "La Uni\u00f3n",
            "La Victoria",
            "Obando",
            "Palmira",
            "Pradera",
            "Restrepo",
            "Riofr\u00edo",
            "Roldanillo",
            "San Pedro",
            "Sevilla",
            "Toro",
            "Trujillo",
            "Tulu\u00e1",
            "Ulloa",
            "Versalles",
            "Vijes",
            "Yotoco",
            "Yumbo",
            "Zarzal"
        ]
    },
    {  
        "id":30,
        "departamento":"Vaup\u00e9s",
        "ciudades":[  
            "Carur\u00fa",
            "Mit\u00fa",
            "Taraira"
        ]
    },
    {  
        "id":31,
        "departamento":"Vichada",
        "ciudades":[  
            "Cumaribo",
            "La Primavera",
            "Puerto Carre\u00f1o",
            "Santa Rosal\u00eda"
        ]
    }
];
window.addEventListener('popstate', function(event) 
{
	PUM.close(1515);
	history.pushState(null, null, window.location.pathname);
}, false);
// APP START START
jQuery(document).ready( function(){loadCheck();});
function loadCheck()
{
	
	actualMT = "";
	actualUser = "";
	actualEditData = "";
	
	actualBudgetSubTotal = 0;
	
	// FILE STARTERS
	actualLoadedFile = "";
	actualLoadedFileName = "";
	actualLoadedFileFormat = "";
	actualPickedQuote = "";
	
	lastBudget = "";
	lastQuote = "";
	lastCategory = "";

	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	history.pushState("", "empty", "");
	
	// Action index
	actionsDictionary = {};
	actionsDictionary.a0 = "Inicia sesión";
	actionsDictionary.a1 = "Creación";
	actionsDictionary.a2 = "Edición";
	actionsDictionary.a3 = "Eliminación";
	actionsDictionary.a4 = "Aprobación";
	actionsDictionary.a5 = "Cierra sesión";
	
	// Location index
	locationsDictionary = {};
	locationsDictionary.home = "Inicio";
	locationsDictionary.profile = "Perfíl de usuario";
	locationsDictionary.register = "Registro";

	// States index
	statesDictionary = {};
	statesDictionary.s0 = "Nueva";
	
	// User types index
	utypesDictionary = {};
	utypesDictionary.General = "Sin asignar";
	utypesDictionary.Principal1 = "Secretario";
	
	// LOCAL ARRAYS ----------
	weekDays = ["Domingo","Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"];
	weekDays2 = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado","Domingo"];
	
	timeOptions = [];
	for(var i=1; i<24; i++)
	{
		if(i<10)
		{
			var hour = "0"+i+":00";
			var ten1 = "0"+i+":10";
			var quarter1 = "0"+i+":15";
			var ten2 = "0"+i+":20";
			var half = "0"+i+":30";
			var ten3 = "0"+i+":40";
			var quarter2 = "0"+i+":45";
			var ten4 = "0"+i+":50";
		}
		else
		{
			var hour = i+":00";
			var ten1 = i+":10";
			var quarter1 = i+":15";
			var ten2 = i+":20";
			var half = i+":30";
			var ten3 = i+":40";
			var quarter2 = i+":45";
			var ten4 = i+":50";
		}
		
		timeOptions.push(hour);
		// timeOptions.push(ten1);
		timeOptions.push(quarter1);
		// timeOptions.push(ten2);
		timeOptions.push(half);
		// timeOptions.push(ten3);
		timeOptions.push(quarter2);
		// timeOptions.push(ten4);
	}
	// LOCAL ARRAYS ----------
	
	if(imfoo == "home"){root = "";}
	else{root ="../";}
	
	langPickIni();
	
	history.pushState("", "empty", "");
	jQuery("#username").on('keyup', function (e) { if (e.keyCode === 13) {login();}});
	jQuery("#password").on('keyup', function (e) { if (e.keyCode === 13) {login();}});

	
	theCroppie = null;
	actualCroppedPic = "";
	prepareImgCropper();
	prepareFileLoader();
	
}
function liveRefresh()
{
	var loc = window.location.href;
	var imported = document.createElement('script');
	
	imported.src = root+'app/js/live.js';
	
	console.log("Welcome to cotizamelo");
	
	if(loc.includes("192.168"))
	{
		document.head.appendChild(imported);
		// fastPop("La herramienta cotizamelo esta temporalmente fuera de línea, por favor usar los aplicativos alternativos. Gracias por su comprensión.", 1000000);
		document.getElementById("coverloader").style.display = "none";
	}
	else
	{
		// fastPop("La herramienta cotizamelo esta temporalmente fuera de línea por proceso de actualización, intentalo más tarde.", 1000000);
		document.getElementById("coverloader").style.display = "none";
	}
}
function langPickIni()
{
	langGetIni("es_co");
	jQuery.datetimepicker.setLocale("es");
}
function langGetIni(l) 
{
	var info ={};
	info.lang = l;
	lang = l;
	// console.log(info)
	sendAjax("users","langGet",info,function(response)
	{
		// console.log(response)
		if(imfoo == "home"){}
		
		language = response.message.lang;
		setLang();
	});
}
function setLang()
{
	for (var text in language)
	{
		if(document.getElementById(text))
		{
			var element = document.getElementById(text);
			element.innerHTML = language[text];

			if(element.type == "text" || element.type == "password"){element.placeholder = language[text];}
			if(element.type == "textarea" || element.type == "password"){element.innerHTML = "";element.placeholder = language[text];}
		}
	}
	
	// console.log(getUrlParameter("me"))
	
	if(getUrlParameter("me"))
	{
		console.log("passrec")
		recSetPop();
		return;
	}

	checkLogin();
}
function checkLogin()
{
	if (window.localStorage.getItem("tmpkey")) 
	{
		var c = localStorage.getItem("tmpkey");
		var info = {};
		info.c = c;
		
		var method = "rlAud";
		
		sendAjax("users",method,info,function(response)
		{
			
			var ans = response.message;
			
			if(ans == "Disabled")
			{
				fastPop("Este usuario ha sido desactivado contacte a soporte técnico para conocer la posible causa.", 5000);
				return;
			}
			if(response.message == "ne")
			{
				userData = "";
				setLoged("0");
			}
			else
			{
				userData = response.message;
				actualUser = userData.USER_CODE;
			
				setLoged("1");
			}
		});
	}
	else
	{
		
		userData = "";
		actualUser = "";
		
		actualEntity = "";
		
		// IF NOT LOGED AND NOT HOME.... SEND TO HOME
		
		setLoged("0");
	}

}

// -------------SESSION---------------
function setLoged(mode)
{
	
	lockRequest = "0";
	
	if(mode == "1")
	{	
		jQuery('html, body').animate({scrollTop : 1}, 300);
		// SHOW
		jQuery('#mainheader').show();
		jQuery('#loginbox').hide();
		jQuery('#homeBox').show();
		
		setMenuItems();
		
		loadIf("budgetsMainB");
		// loadIf("catsMainB");
		// loadIf("quotesMainB");
		
	}
	if(mode == "0")
	{
		jQuery('html, body').animate({scrollTop : 1}, 300);
		// SHOW
		jQuery('#loginbox').show();
		// HIDE
		jQuery('#mainheader').hide();
		jQuery('#regBox').hide();
		jQuery('#homeBox').hide();

	}
	
	liveRefresh();
	
	

}
function purifyEntity(list,key)
{
	var newList = [];
	
	for(var i=0; i<list.length; i++)
	{
		var item = list[i];
		if(item[key] == actualEntity)
		{newList.push(item);}
	}
	return newList;
}
function purifyCity(list,key)
{
	var newList = [];
	
	for(var i=0; i<list.length; i++)
	{
		var item = list[i];
		if(item[key] == actualCity)
		{newList.push(item);}
	}
	return newList;
}
function setMenuItems()
{
	var menuBox = document.getElementById("myTopnav");
	menuBox.innerHTML = "";
	var headerLine = document.getElementById("headerLine");
	
	// HOME ICON
	menuBox.appendChild(menuCreator("welcomeBmenu", "welcomeB", "<i class='fas fa-home'></i>"));
	

	// NOT CALLER USER MENU
	if(userData.USER_TYPE == "General")
	{
		menuBox.appendChild(menuCreator("budgetsMainBmenu", "budgetsMainB", "Presupuestos"));
		menuBox.appendChild(menuCreator("catsMainBmenu", "catsMainB", "Categorías"));
		menuBox.appendChild(menuCreator("quotesMainBmenu", "quotesMainB", "Listas de cotización"));
	}
	
	menuBox.appendChild(menuCreator("exitMenu", "logout", "Cerrar sesión"));
	
	// MOBILE ICON
	menuBox.appendChild(menuCreator("respBox", "respBox", "<i class='fa fa-bars'>"));
	
}
function menuCreator(id, iface, content)
{
	var item = document.createElement("a");
	item.href = "javascript:void(0)";
	item.innerHTML = content;
	item.iface = iface;
	item.className = ".topnav a";
	item.id = id;
	
	if(iface == "logout")
	{
		item.onclick = function ()
		{logout();}
	}
	else if(iface == "respBox")
	{
		item.className = "icon";
		item.onclick = function ()
		{myFunction();}
	}
	else
	{
		item.onclick = function ()
		{loadIf(this.iface,this);}
	}

	return item;
}
function login()
{
	var email = document.getElementById("username").value.toLowerCase().replace(/\s+/g, '');
	var pssw = document.getElementById("password").value;
	var info = {};
	info.email = email;
	info.pssw = pssw;
	actualMT = "0";
	imfoo = "home";

	if(email == "")
	{
		fastPop("Debe escribir el email de usuario.", 2000);
		return;
	}
	if(!checkEmail(email))
	{
		fastPop("Debes ingresar un Email válido.", 2000);
		return;
	}
	if(pssw == "")
	{
		fastPop("Debe escribir la contraseña de usuario.", 2000);
		return;
	}
	
	loadManager(1, "loginButton");
	sendAjax("users","login",info,function(response)
	{
		loadManager(0, "loginButton");
		var ans = response.message;
		console.log(ans)
		
		if(ans == "Disabled")
		{
			fastPop("Este usuario ha sido desactivado contacte a soporte técnico para conocer la posible causa.", 5000);
			return;
		}
		else if(ans == "")
		{
			fastPop("Email o contraseña incorrectos", 2000);
		}
		else
		{
			userData = ans;
			actualUser = userData.USER_CODE;
			localStorage.setItem("tmpkey", actualUser);
			setLoged("1");
		}
	});
}
function logout()
{
	document.getElementById("coverloader").style.display = "block";
	localStorage.removeItem("tmpkey");
	var info = {};
	actualMT = "9";
	imfoo = "home";
	
	loadManager(1, "exitMenu");
	sendAjax("users","logout",info,function(response)
	{
		loadManager(0, "exitMenu");
		
		userData = "";
		
		var loc = window.location.href;
		if(loc.includes("192.168"))
		{
			location.replace("http://192.168.0.60/www/cotizamelo/");
		}
		else
		{
			location.replace("http://incocrea.com/cotiza/");
		}
		
	});
	
	
}
function recPop()
{
	PUM.open(948);
	document.getElementById("passRecField").value = "";
	
	var acceptB = document.getElementById("recoverConfirmButton");
	acceptB.innerHTML = language["accept"];
	acceptB.onclick = function()
	{
		var entity = document.getElementById("userEntityRec").value.replace(/\s+/g, '');
		var email = document.getElementById("passRecField").value.replace(/\s+/g, '');
		
		if(entity == "")
		{
			fastPop("Debes seleccionar la institución.", 2000);
			return;
		}
		if(email == "")
		{
			fastPop("Debes escribir el Email.", 2000);
			return;
		}
		if(!checkEmail(email))
		{
			// fastPop("Debes ingresar un Email válido.", 2000);
			// return;
		}
		
		var info = {};
		info.entity = entity;
		info.email = email;
		info.lang = lang;
		
		loadManager(1, "recoverConfirmButton");
		sendAjax("users","mailExist",info,function(response)
		{
			loadManager(0, "recoverConfirmButton");
			var ans = response.message;
			console.log(ans)
			
			if(ans == "notSent")
			{
				setTimeout(function()
				{
					fastPop("No existe un usuario con esta combinación de institución y Email", 3000); 
				}, 500);
				return;
			}
			else if(ans == "notmail")
			{
				setTimeout(function()
				{
					fastPop("Para recuperar la contraseña de este usuario debe contactar a soporte técnico.", 5000);
				
					closeRecover();
				}, 500);
			}
			else
			{
				setTimeout(function()
				{
					fastPop("Se ha enviado un Email con las instrucciones de recuperación, en caso de no verlo en la bandeja de entrada revisar la bandeja de correo no deseado o spam", 5000);
				
					closeRecover();
				}, 500);
				
				
				
			}
			
		});
		
	}
	var cancelB = document.getElementById("recoverCancelButton");
	cancelB.innerHTML = language["cancel"];
	cancelB.onclick = function(){closeRecover()}
	
}
function closeRecover()
{
	PUM.close(948);
}
function recSetPop()
{
	document.getElementById("coverloader").style.display = "block";
	PUM.open(944);
	tmpkey = getUrlParameter("tmpkey");
	document.getElementById("passRecSetField1").value = "";
	document.getElementById("passRecSetField2").value = "";
	
	var acceptB = document.getElementById("recoverSetConfirmButton");
	acceptB.innerHTML = "Establecer";
	acceptB.onclick = function()
	{
		var pass1 = document.getElementById("passRecSetField1").value.replace(/\s+/g, '');
		var pass2 = document.getElementById("passRecSetField2").value.replace(/\s+/g, '');
		
		if(pass1 == "")
		{
			fastPop("Debes escribir la contraseña.", 2000);
			return;
		}
		if(pass1 != pass2)
		{
			fastPop("La contraseña y la confirmación no coinciden", 2000);
			return;
		}
	
		var info = {};
		info.code = tmpkey;
		info.pass = pass1;
		loadManager(1, "recoverSetConfirmButton");
		sendAjax("users","setPass",info,function(response)
		{
			loadManager(0, "recoverSetConfirmButton");
			var ans = response.message;
			userData = "";
			localStorage.removeItem("tmpkey");
			
			fastPop("Contraseña establecida", 3000);
			setTimeout(function()
			{
				
				var loc = window.location.href;
				if(loc.includes("192.168"))
				{
					window.location.href = "http://192.168.0.60/www/cotizamelo/";
				}
				else
				{
					window.location.href = "http://incocrea.com/cotiza/";
				}
				
			
			}, 3000);
			
			
		});
		
	}

}
function getUrlParameter(sParam) 
{
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
        }
    }
};
function sendContact()
{
	var info = {};
	info.name = document.getElementById("contactNameField").value;
	info.email = document.getElementById("contactMailField").value.toLowerCase().replace(/\s+/g, '');
	info.message = document.getElementById("contactMslField").value;
	
	if(info.name == "" || info.email == "" || info.message == "")
	{
		fastPop(language["mustFieldsReg"], 2000);
		return;
	}
	if(!checkEmail(info.email))
	{
		fastPop("Debes ingresar un Email válido.", 2000);
		return;
	}
	
	sendAjax("users","sendContact",info,function(response)
	{
		var ans = response.message;
		console.log(ans);
		fastPop(language["messageSent"], 6000);
	});
	
}

// -------------MENU---------------
function gomenu(menu)
{
	jQuery('html, body').animate( {scrollTop : 0}, 300 );
	
	console.log("to define home if load");
	return;
	
	var innerSections = ["#homeBox","#regBox","#contactsBox","#likesBox", "#statsBox","#friendProfileBox"];
	showManager(innerSections,"0");
	
	showManager(["#"+menu],"1");
	var width = jQuery( window ).width();
	if(width < 768){document.getElementById(menu).style.marginTop = "80px";}
	else{document.getElementById(menu).style.marginTop = "70px";}

	if(menu == "homeBox")
	{
		randomHome();
		return;
	}
	if(menu == "likesBox")
	{
		actualLikes = [];
		blockSize = 50;
		iniLikeRange = 0;
		endLikeRange = iniLikeRange+blockSize;
		actualLikeFilter = "2";
		
		var filter1 = document.getElementById("likeFilter1");
		filter1.className = "likeFilter";
		filter1.innerHTML = language["likeFilter1"];
		filter1.onclick = function (){actualLikeFilter = "";getLikes("likeFilter1");}
		
		var filter2 = document.getElementById("likeFilter2");
		filter2.className = "likeFilter";
		filter2.innerHTML = language["likeFilter2"];
		filter2.onclick = function (){actualLikeFilter = "1";getLikes("likeFilter2");}
		
		var filter3 = document.getElementById("likeFilter3");
		filter3.className = "likeFilter";
		filter3.innerHTML = language["likeFilter3"];
		filter3.onclick = function (){actualLikeFilter = "2";getLikes("likeFilter3");}

		getLikes("menuLikesBox");
	}
	if(menu == "contactsBox")
	{
		document.getElementById("inviteMail").value = "";
		getFriends(userData.CODE, "0");
		return;
	}
	if(menu == "regBox")
	{
		document.getElementById("usernameReg").value = userData.NAME;
		document.getElementById("usermailReg").value = userData.EMAIL;
		document.getElementById("usermailReg2").value = userData.EMAIL;
		document.getElementById("userbdayReg").value = userData.BDAY;
		document.getElementById("userCelReg").value = userData.PHONE;
		document.getElementById("userGenderReg").value = userData.GENDER;
		document.getElementById("userLocationReg").value = userData.LOCATION;
		document.getElementById("userPass1Reg").value = "******";
		document.getElementById("userPass2Reg").value = "******";
		actualAvatar = userData.AVATAR;
		document.getElementById("profileIcon").src = "app/isrc/avatars/av"+actualAvatar+".png";
		
		return;
	}
	if(menu == "statsBox")
	{
		getStats();
	}

}
function myFunction() 
{
  var x = document.getElementById("myTopnav");
  if (x.className === "topnav") {
    x.className += " responsive";
  } else {
    x.className = "topnav";
  }
}


// -------------APP FUNCTIONS---------------
// -------------APP FUNCTIONS---------------
// -------------APP FUNCTIONS---------------

// SAVERS/EDITERS-----
function saveUdata(mode)
{
	
	var info = {};
	
	info.USER_NAME = document.getElementById("USER_NAME").value;
	info.USER_TYPE = "General";
	info.USER_PHONE = document.getElementById("USER_PHONE").value;
	info.USER_EMAIL = document.getElementById("USER_EMAIL").value;
	info.USER_PASS = document.getElementById("USER_PASS").value;
	info.USER_PASS2 = document.getElementById("USER_PASS2").value;
	info.MODE = mode;

	if(info.USER_NAME == ""){fastPop("Debe escribir el nombre.", 2000);return;}
	if(info.USER_PHONE == ""){fastPop("Debe escribir el Teléfono.", 2000);return;}
	if(info.USER_EMAIL == ""){fastPop("Debe escribir el email.", 2000);return;}
	
	if(!checkEmail(info.USER_EMAIL))
	{
		fastPop("Debes ingresar un Email válido.", 2000);
		return;
	}
	
	
	if(info.USER_PASS == ""){fastPop("Debe escribir la contraseña.", 2000);return;}
	if(info.USER_PASS2 == ""){fastPop("Debe escribir la confirmación de contraseña.", 2000);return;}

	
	if(info.USER_PASS != info.USER_PASS2)
	{
		fastPop("Las contraseñas no coinciden", 2000);
		return;
	}
	
	// SET DATA ACCORDING TO MODE
	if(info.MODE != "0")
	{
		if(info.USER_PASS != "******")
		{info.CHANGEPASS = "1";}
		else{info.CHANGEPASS = "0";}
		
		if(imfoo != "user")
		{
			info.USER_CODE = userData.USER_CODE;
		}
		else
		{
			info.USER_CODE = actualEditData.USER_CODE;
		}
	}
	else
	{
		info.USER_CODE = "";
	}
	
	console.log(info)
		
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveUdata",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans)
		
		if(ans == "exists")
		{
			fastPop("Ya existe un usuario con este email, si ha olvidado su contraseña de click en 'Recuperar Contraseña'.", 6000);
			// PUM.close(1515);
			return;
		}
		else if(ans == "updatednpc")
		{
			fastPop(language["dataSaved"], 2000);
			// SAME PASS
			
			if(imfoo != "user")
			{
				userData.USER_NAME = info.USER_NAME;
				userData.USER_PHONE = info.USER_PHONE;
				PUM.close(1515);
			}
			else
			{
				console.log("other changed")
				refreshTable("ct_trusers");
				PUM.close(1515);
			}
			return;
		}
		else if(ans == "updatedpc")
		{
			fastPop(language["dataSavedPass"], 2000);
			
			if(imfoo != "user")
			{
				document.getElementById("USER_PASS").value = "******";
				document.getElementById("USER_PASS2").value = "******";
				// CHANGED PASS
				userData.USER_NAME = info.USER_NAME;
				userData.USER_PHONE = info.USER_PHONE;
				PUM.close(1515);
			}
			else
			{
				console.log("other changed pass")
				refreshTable("ct_trusers");
				PUM.close(1515);
			}
			return;
		}
		else
		{
			fastPop("Registro exitoso", 2000);
			
			document.getElementById("username").value = info.USER_EMAIL;
			document.getElementById("password").value = info.USER_PASS;
			
			PUM.close(1515);

			if(imfoo != "user")
			{
				setTimeout(function(){ login(); }, 2000);
			}
		}
		
	});
}
function saveBudget(mode)
{
	
	var info = {};
	
	info.BUDGET_NAME = document.getElementById("BUDGET_NAME").value;
	info.BUDGET_USER = userData.USER_CODE;
	info.MODE = mode;

	if(info.BUDGET_NAME == ""){fastPop("Debe escribir el nombre del presupuesto.", 2000);return;}

	// SET DATA ACCORDING TO MODE
	if(info.MODE != "0")
	{
		info.BUDGET_CODE = actualEditData.BUDGET_CODE;
	}
	else
	{
		info.BUDGET_CODE = "";
	}
	
	console.log(info)
		
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveBudget",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans)
		
		if(ans == "exists")
		{
			fastPop("Ya existe un presupuesto con este nombre en tu cuenta.", 3000);
			return;
		}
		else
		{
			lastBudget = ans;
			fastPop("Presupuesto guardado", 2000);
			PUM.close(1515);
			getUserMasters();
		}
		
	});
}
function saveQuote(mode)
{
	
	var info = {};
	
	info.QUOTE_NAME = document.getElementById("QUOTE_NAME").value;
	info.QUOTE_USER = userData.USER_CODE;
	info.MODE = mode;

	if(info.QUOTE_NAME == ""){fastPop("Debe escribir el nombre de la lista.", 2000);return;}

	// SET DATA ACCORDING TO MODE
	if(info.MODE != "0")
	{
		info.QUOTE_CODE = actualEditData.QUOTE_CODE;
	}
	else
	{
		info.QUOTE_CODE = "";
	}
	
	// console.log(info)
		
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveQuote",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		// console.log(ans)
		
		if(ans == "exists")
		{
			fastPop("Ya existe una lista de cotización con este nombre en tu cuenta.", 3000);
			return;
		}
		else
		{
			lastQuote = ans;
			fastPop("Lista de cotización guardada.", 2000);
			PUM.close(1515);
			getQuoteMasters();
		}
		
	});
}
function saveCategory(mode)
{
	
	var info = {};
	
	info.CATEGORY_NAME = document.getElementById("CATEGORY_NAME").value;
	info.CATEGORY_USER = userData.USER_CODE;
	info.MODE = mode;

	if(info.CATEGORY_NAME == ""){fastPop("Debe escribir el nombre de la categoría.", 2000);return;}

	// SET DATA ACCORDING TO MODE
	if(info.MODE != "0")
	{
		info.CATEGORY_CODE = actualEditData.CATEGORY_CODE;
	}
	else
	{
		info.CATEGORY_CODE = "";
	}
	
	console.log(info)
		
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveCategory",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans)
		
		if(ans == "exists")
		{
			fastPop("Ya existe una categoría con este asociada a tu cuenta.", 3000);
			return;
		}
		else
		{
			if(info.MODE == "0")
			{fastPop("Categoría creada", 2000);}
			else
			{fastPop("Categoría guardada", 2000);}
			
			console.log(imfoo)
			
			if(imfoo == "catsMainB")
			{
				console.log("refresca solo lista")
				refreshTable("ct_categories");
			}
			else
			{
				console.log("refresca solo select")
				getUserMasters();
			}
			
			
			PUM.close(1515);
			
		}
		
	});
}
function saveItem (mode)
{
	
	var info = {};
	
	info.ITEM_BUDGET = document.getElementById("ITEM_BUDGET").value;
	info.ITEM_CATEGORY = document.getElementById("ITEM_CATEGORY").value;
	info.ITEM_CATEGORY_NAME = jQuery( "#ITEM_CATEGORY option:selected" ).text();
	info.ITEM_ACTIVITY = document.getElementById("ITEM_ACTIVITY").value;
	info.ITEM_UNIT = document.getElementById("ITEM_UNIT").value;
	info.ITEM_QTY = document.getElementById("ITEM_QTY").value;
	info.ITEM_DETAILS = document.getElementById("ITEM_DETAILS").value;
	info.ITEM_UNIT_VALUE = document.getElementById("ITEM_UNIT_VALUE").value;
	info.ITEM_PIC = actualLoadedFile;
	info.MODE = mode;

	if(info.ITEM_BUDGET == ""){fastPop("Debes seleccionar presupuesto.", 2000);return;}
	if(info.ITEM_CATEGORY == ""){fastPop("Debes seleccionar categoría.", 2000);return;}
	if(info.ITEM_ACTIVITY == ""){fastPop("Debes escribir el nombre de la actividad.", 2000);return;}
	if(info.ITEM_UNIT == ""){fastPop("Debes escribir el tipo de unidad.", 2000);return;}
	if(info.ITEM_QTY == ""){fastPop("Debes escribir la cantidad del item.", 2000);return;}
	if(info.ITEM_UNIT_VALUE == ""){fastPop("Debes escribir el precio unitario del item.", 2000);return;}

	// SET DATA ACCORDING TO MODE
	if(info.MODE != "0")
	{
		info.ITEM_CODE = actualEditData.ITEM_CODE;
	}
	else
	{
		info.ITEM_CODE = "";
	}
	
	console.log(info)
		
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveItem",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		console.log(ans)
		
		if(ans == "exists")
		{
			fastPop("Ya existe un item con este nombre para este presupuesto.", 3000);
			return;
		}
		else
		{
			if(info.MODE == "0")
			{fastPop("Item creado", 2000);}
			else
			{fastPop("Item guardado", 2000);}
			
			lastBudget = info.ITEM_BUDGET;
			document.getElementById("BUDGET_LIST").value = lastBudget;
			
			refreshTable("ct_items");
			
			PUM.close(1515);
			
		}
		
	});
}
function saveInvited (mode)
{
	
	var info = {};
	
	info.BUDGET_INVITED = JSON.stringify(actualInvited);
	info.BUDGET_CODE = bData.BUDGET_CODE;
		
	loadManager(1, "popFormSaveButton");
	sendAjax("users","saveInvited",info,function(response)
	{
		loadManager(0, "popFormSaveButton");
		var ans = response.message;
		fastPop("Guardado exitoso.", 3000);
		document.getElementById("BUDGET_LIST").onchange();
		PUM.close(1515);
		return;
	});
}
// SAVERS/EDITERS-----

function getUserMasters()
{
	var info = {};
	info.USER_CODE = userData.USER_CODE;
	info.USER_EMAIL = userData.USER_EMAIL;
	
	sendAjax("users","getUserMasters",info,function(response)
	{
		var ans = response.message;
		
		actualBudgets = ans.budgets;
		actualCategories = ans.categories;
		
		var budgetPicker = document.getElementById("BUDGET_LIST");
		budgetPicker.innerHTML = "";
		
		var option = document.createElement("option");
		option.innerHTML = "Selecciona presupuesto";
		option.value = "";
		budgetPicker.appendChild(option);
		
		for(var i=0; i<actualBudgets.length; i++)
		{
			var item = actualBudgets[i];
			var option = document.createElement("option");
		
			if(item.BUDGET_USER == userData.USER_CODE)
			{var ownship = " (Propio)";}
			else
			{var ownship = " (Invitado)";}
			
			option.innerHTML = item.BUDGET_NAME+ownship;
			option.value = item.BUDGET_CODE;
			budgetPicker.appendChild(option);
		}
		
		budgetPicker.onchange = function ()
		{
			
			if(this.value == "")
			{
				document.getElementById("BUDGET_ADMINISTRATION").value = 0;
				document.getElementById("BUDGET_IMPREVIST").value = 0;
				document.getElementById("BUDGET_UTILITY").value = 0;
				document.getElementById("BUDGET_UTILITY_TAX").value = 0;
				document.getElementById("BUDGET_SUBTOTAL").value = "$0";
				document.getElementById("BUDGET_TOTAL").value = "$0";
				actualBudgetSubTotal = 0;
				
				tableCreator("ct_items", []);	
				
				return;
			}
			lastBudget = this.value;
			console.log(lastBudget)
			refreshTable("ct_items");
		}
		if(lastBudget != "")
		{
			budgetPicker.value = lastBudget
			budgetPicker.onchange();
		}
		else
		{
			budgetPicker.value = "";
		}
	});
	
}
function getQuoteMasters()
{
	var info = {};
	info.USER_CODE = userData.USER_CODE;
	info.USER_EMAIL = userData.USER_EMAIL;
	
	sendAjax("users","getQuoteMasters",info,function(response)
	{
		var ans = response.message;
		console.log(ans)
		
		actualQuotes = ans.quotes;
		
		
		var quotePicker = document.getElementById("QUOTE_LIST");
		quotePicker.innerHTML = "";
		
		var option = document.createElement("option");
		option.innerHTML = "Selecciona lista de cotización";
		option.value = "";
		quotePicker.appendChild(option);
		
		for(var i=0; i<actualQuotes.length; i++)
		{
			var item = actualQuotes[i];
			var option = document.createElement("option");
			option.innerHTML = item.QUOTE_NAME;
			option.value = item.QUOTE_CODE;
			quotePicker.appendChild(option);
		}
		
		quotePicker.onchange = function ()
		{
			
			if(this.value == "")
			{
				tableCreator("ct_quote_items", []);	
				return;
			}
			lastQuote = this.value;
			refreshTable("ct_quote_items");
		}
		if(lastQuote != "")
		{
			quotePicker.value = lastQuote
			quotePicker.onchange();
		}
		else
		{
			quotePicker.value = "";
		}
	});
	
}

// EDIT FILLER---------
function formEditFiller(containerId, data)
{
	var fieldsBox = document.querySelector("#"+containerId);
	
	var keys = Object.keys(data);
	for(var i=0; i<keys.length; i++)
	{
		var item = keys[i];
		if(fieldsBox.querySelector("#"+item) != null)
		{document.getElementById(item).value = data[item];}
	}
	
	actualMT = "2";
}

// INTERFACES MANAGE-----
function loadIf(iface, menu)
{
	
	var ifacesBox = document.getElementById("mainBox");
	var interfaces = ifacesBox.children;
	
	for(var i=0; i<interfaces.length; i++)
	{
		var item = interfaces[i];
		document.getElementById(item.id).style.display = "none";
	}
	
	document.getElementById(iface).style.display = "block";
	
	ifaceBuilder(iface);

	// MARK MENUS
	var menuBox = document.getElementById("myTopnav");
	var menus = menuBox.children;
	
	for(var i=0; i<menus.length; i++)
	{
		var item = menus[i];
		if(i<(menus.length)-1){item.className = ".topnav a";}
	}
	if(menu != null)
	{
		menu.className = "active";
		myFunction();
	}
	else
	{
		document.getElementById("welcomeBmenu").className = "active";
	}
}

// INTERFACES BUILDER
function ifaceBuilder(type)
{
	
	console.log(type)
	
	// CLEAR ALL INTERFACES TO AVOID FILTER ERROR
	var interfaces = document.getElementById("mainBox").children;
	for(var i=0; i<interfaces.length; i++)
	{
		var iface = interfaces[i];
		iface.innerHTML = "";
	}
	
	imfoo = type;
	
	var ifaceBox = document.getElementById(type);
	// ifaceBox.innerHTML = "";
	
	var title = document.createElement("div");
	title.className = "col-12";
	var titleLine = document.createElement("span");
	titleLine.className = "ifTitle";
	
	var buttonBox = document.createElement("div");
	buttonBox.className = "row ifaceButtonsBox";
	
	var filtersBox = document.createElement("div");
	filtersBox.id = "filtersBox";
	filtersBox.innerHTML = "";
	filtersBox.className = "row filtersBox";
	
	title.appendChild(titleLine);
	
	if(type == "welcomeB")
	{
		// TITLE
		titleLine.innerHTML = "Inicio";
		ifaceBox.appendChild(title);
	}

	if(type == "budgetsMainB")
	{
		
		actualPickedBudget = "-";
		
		// TITLE
		titleLine.innerHTML = "Presupuestos";
		
		// BUTTONS--
		var button = document.createElement("button");
		button.className = "ifaceButton";
		button.innerHTML = "Crear presupuesto";
		button.onclick = function ()
		{loadForm("budgets");}
		
		buttonBox.appendChild(button);
		
		var button = document.createElement("button");
		button.className = "ifaceButton";
		button.innerHTML = "Crear categoría";
		button.onclick = function ()
		{loadForm("categories");}
		
		buttonBox.appendChild(button);
		
		var button = document.createElement("button");
		button.className = "ifaceButton";
		button.innerHTML = "Crear item";
		button.onclick = function ()
		{loadForm("items");}
		
		buttonBox.appendChild(button);
		
		var button = document.createElement("button");
		button.className = "ifaceButton";
		button.innerHTML = "Invitar usuario";
		button.onclick = function ()
		{userInvite();}
		
		buttonBox.appendChild(button);
		
		var button = document.createElement("button");
		button.className = "ifaceButton";
		button.innerHTML = "Crear lista de cotización";
		button.onclick = function ()
		{loadForm("quotes");}
		
		buttonBox.appendChild(button);
		
		// FILTERS (SAMPLE COMMENTED)
		
		var BUDGET_LIST = fieldCreator([12,4,4,3], "Presupuestos", "select", "select", "BUDGET_LIST");

		var deleteButton = buttonCreator([12,4,4,1], "Eliminar", function()
		{
			var budget = document.getElementById("BUDGET_LIST").value;
			var budgetName = jQuery( "#BUDGET_LIST option:selected" ).text();
			if(budget == ""){fastPop("No hay un presupuesto seleccionado.", 2000);return;}
			
			console.log(bProperty)
			
			if(bProperty != "Owner"){fastPop("Solo puedes eliminar presupuestos propios", 2000);return;}			
			var params = ["ct_budgets",budget,budgetName];
			confirmBox(language["confirm"], "¿Desea eliminar el presupuesto:  "+budgetName+" y todos sus items?",deleteBudgetCheck, params);
		});
		
	
		var BUDGET_ADMINISTRATION = fieldCreator([12,4,4,2], "Administración (%)", "input", "number", "BUDGET_ADMINISTRATION");
		var BUDGET_IMPREVIST = fieldCreator([12,4,4,2], "Imprevistos (%)", "input", "number", "BUDGET_IMPREVIST");
		var BUDGET_UTILITY = fieldCreator([12,4,4,2], "Utilidad (%)", "input", "number", "BUDGET_UTILITY");
		var BUDGET_UTILITY_TAX = fieldCreator([12,4,4,2], "IVA utilidad (%)", "input", "number", "BUDGET_UTILITY_TAX");
		var BUDGET_SUBTOTAL = fieldCreatorTotal([12,4,4,2], "Subtotal actividades", "input", "text", "BUDGET_SUBTOTAL");
		var BUDGET_ADMIN_SUBTOTAL = fieldCreatorTotal([12,4,4,2], "Subtotal administración", "input", "text", "BUDGET_ADMIN_SUBTOTAL");
		var BUDGET_IMPRE_SUBTOTAL = fieldCreatorTotal([12,4,4,2], "Subtotal Imprevistos", "input", "text", "BUDGET_IMPRE_SUBTOTAL");
		var BUDGET_UTILITY_SUBTOTAL = fieldCreatorTotal([12,4,4,2], "Subtotal utilidad", "input", "text", "BUDGET_UTILITY_SUBTOTAL");
		var BUDGET_IVA_SUBTOTAL = fieldCreatorTotal([12,4,4,2], "IVA utilidad", "input", "text", "BUDGET_IVA_SUBTOTAL");
		var BUDGET_TOTAL = fieldCreatorTotal([12,4,4,2], "Total presupuesto", "input", "text", "BUDGET_TOTAL");
		
		filtersBox.appendChild(BUDGET_LIST);
		filtersBox.appendChild(deleteButton);
		filtersBox.appendChild(BUDGET_ADMINISTRATION);
		filtersBox.appendChild(BUDGET_IMPREVIST);
		filtersBox.appendChild(BUDGET_UTILITY);
		filtersBox.appendChild(BUDGET_UTILITY_TAX);
		filtersBox.appendChild(BUDGET_SUBTOTAL);
		filtersBox.appendChild(BUDGET_ADMIN_SUBTOTAL);
		filtersBox.appendChild(BUDGET_IMPRE_SUBTOTAL);
		filtersBox.appendChild(BUDGET_UTILITY_SUBTOTAL);
		filtersBox.appendChild(BUDGET_IVA_SUBTOTAL);
		filtersBox.appendChild(BUDGET_TOTAL);

		// TABLE
		var table = tableDraw("ct_items",["Actividad", "Detalles", "Unidad", "Cantidad", "Valor unitario", "Subtotal", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(buttonBox);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		document.getElementById("BUDGET_ADMINISTRATION").value = 0;
		document.getElementById("BUDGET_IMPREVIST").value = 0;
		document.getElementById("BUDGET_UTILITY").value = 0;
		document.getElementById("BUDGET_UTILITY_TAX").value = 0;
		document.getElementById("BUDGET_SUBTOTAL").value = "$0";
		document.getElementById("BUDGET_ADMIN_SUBTOTAL").value = "$0";
		document.getElementById("BUDGET_IMPRE_SUBTOTAL").value = "$0";
		document.getElementById("BUDGET_UTILITY_SUBTOTAL").value = "$0";
		document.getElementById("BUDGET_IVA_SUBTOTAL").value = "$0";
		document.getElementById("BUDGET_TOTAL").value = "$0";
		
		document.getElementById("BUDGET_SUBTOTAL").disabled = true;
		document.getElementById("BUDGET_TOTAL").disabled = true;
		
		document.getElementById("BUDGET_SUBTOTAL").className = "totalField";
		document.getElementById("BUDGET_TOTAL").className = "totalField";
		
		document.getElementById("BUDGET_ADMINISTRATION").onblur = function (){setFullTotal("blur");}
		document.getElementById("BUDGET_IMPREVIST").onblur = function (){setFullTotal("blur");}
		document.getElementById("BUDGET_UTILITY").onblur = function (){setFullTotal("blur");}
		document.getElementById("BUDGET_UTILITY_TAX").onblur = function (){setFullTotal("blur");}

		var locKeys = Object.keys(locationsDictionary);
		var options = [];
		for(var i=0; i<locKeys.length; i++)
		{
			var item = {};
			item.TYPE = locKeys[i];
			item.DESC = locationsDictionary[locKeys[i]];
			options.push(item);
		}
		
		getUserMasters();
		
	}

	if(type == "catsMainB")
	{
		
		// TITLE
		titleLine.innerHTML = "Categorías";
	
		var button = document.createElement("button");
		button.className = "ifaceButton";
		button.innerHTML = "Crear categoría";
		button.onclick = function ()
		{loadForm("categories");}
		
		buttonBox.appendChild(button);

		// TABLE
		var table = tableDraw("ct_categories",["Categoría", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(buttonBox);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		refreshTable("ct_categories");
	}
	
	if(type == "quotesMainB")
	{
		
		// TITLE
		titleLine.innerHTML = "Listas de cotización";
	
		var button = document.createElement("button");
		button.className = "ifaceButton";
		button.innerHTML = "Crear lista de cotización";
		button.onclick = function ()
		{loadForm("quotes");}
		
		buttonBox.appendChild(button);
		
		var QUOTE_LIST = fieldCreator([12,4,4,3], "Listas de cotización", "select", "select", "QUOTE_LIST");
		
		var deleteButton = buttonCreator([12,4,4,1], "Eliminar", function()
		{
			var quote = document.getElementById("QUOTE_LIST").value;
			var quoteName = jQuery( "#QUOTE_LIST option:selected" ).text();
			if(quote == ""){fastPop("No hay una lista seleccionada.", 2000);return;}

			var params = ["ct_quotes",quote,quoteName];
			confirmBox(language["confirm"], "¿Desea eliminar esta lista de cotización: "+quoteName+"?",deleteQuoteCheck, params);
		});
		
		filtersBox.appendChild(QUOTE_LIST);
		filtersBox.appendChild(deleteButton);

		// TABLE
		var table = tableDraw("ct_quote_items",["Actividad", "Detalles", "Unidad", "Cantidad", "Valor unidad", "Subtotal", "Opciones"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(buttonBox);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		getQuoteMasters()
	}
	
	if(type == "logB")
	{
		// TITLE
		titleLine.innerHTML = "Log";
		
		// BUTTONS--
		var button1 = document.createElement("button");
		button1.className = "ifaceButton";
		button1.innerHTML = "Limpiar log";
		button1.onclick = function ()
		{
			var params = ["",""];
			confirmBox(language["confirm"], "¿Desea limpiar el log de la aplicación?",clearLog, params);
		}
		
		buttonBox.appendChild(button1);
		
		// FILTERS (SAMPLE COMMENTED)
		
		var LOG_DATE_INI_F = fieldCreator([12,4,4,2], "Fecha inicial", "input", "text", "LOG_DATE_INI_F");
		var LOG_DATE_END_F = fieldCreator([12,4,4,2], "Fecha final", "input", "text", "LOG_DATE_END_F");
		
		var LOG_ENTITY = fieldCreator([12,4,4,2], "Entidad", "input", "text", "LOG_ENTITY");
		var LOG_USER = fieldCreator([12,4,4,2], "Usuario", "input", "text", "LOG_USER");
		var LOG_MT = fieldCreator([12,4,4,2], "Operación", "select", "select", "LOG_MT");
		var LOG_IFACE = fieldCreator([12,4,4,2], "Ubicación", "select", "select", "LOG_IFACE");
		
		
		
		var searchButton = buttonCreator([12,4,4,2], "Buscar", function(){refreshTable("ct_log")});
		
		var clearFiltersButton = buttonCreator([12,4,4,2], "Limpiar filtro", function()
		{
			clearFilters();
			refreshTable("ct_log")
		});
		
		filtersBox.appendChild(LOG_DATE_INI_F);
		filtersBox.appendChild(LOG_DATE_END_F);
		filtersBox.appendChild(LOG_ENTITY);
		filtersBox.appendChild(LOG_USER);
		filtersBox.appendChild(LOG_MT);
		filtersBox.appendChild(LOG_IFACE);
		filtersBox.appendChild(searchButton);
		filtersBox.appendChild(clearFiltersButton);
		
		// TABLE
		var table = tableDraw("ct_log",["Usuario", "Fecha/hora","Ubicación", "Operación", "Entidad"]);
		
		ifaceBox.appendChild(title);
		ifaceBox.appendChild(buttonBox);
		ifaceBox.appendChild(filtersBox);
		ifaceBox.appendChild(table);
		
		// SET DATE FIELDS
		setDateField("LOG_DATE_INI_F");
		setDateField("LOG_DATE_END_F");
		
		var locKeys = Object.keys(locationsDictionary);
		var options = [];
		for(var i=0; i<locKeys.length; i++)
		{
			var item = {};
			item.TYPE = locKeys[i];
			item.DESC = locationsDictionary[locKeys[i]];
			options.push(item);
		}
		
		// FILL SPECIAL TYPES
		selectFiller("LOG_IFACE", "Seleccione interfaz", options, "TYPE", "DESC");
		
		
		var opKeys = Object.keys(actionsDictionary);
		var options = [];
		for(var i=0; i<opKeys.length; i++)
		{
			if(actionsDictionary[opKeys[i]] == ""){continue;}
			var item = {};
			item.TYPE = opKeys[i].split("a")[1];
			item.DESC = actionsDictionary[opKeys[i]];
			options.push(item);
		}
		
		// FILL SPECIAL TYPES
		selectFiller("LOG_MT", "Seleccione operación", options, "TYPE", "DESC");
		
		
		
		
		
		refreshTable("ct_log");
	}

}

function userInvite()
{
	var actualBuget = document.getElementById("BUDGET_LIST").value;
	if(actualBuget == ""){fastPop("No hay un presupuesto seleccionado.", 2000);return;}
	if(bProperty == "Invited"){fastPop("No puedes administrar esta sección como invitado del presupuesto.", 2000);return;}
	loadForm("invite")
}

function setFullTotal(from)
{
	var admin = document.getElementById("BUDGET_ADMINISTRATION").value;
	if(admin == ""){admin = 0;document.getElementById("BUDGET_ADMINISTRATION").value = 0;}
	var imprev = document.getElementById("BUDGET_IMPREVIST").value;
	if(imprev == ""){imprev = 0;document.getElementById("BUDGET_IMPREVIST").value = 0;}
	var util = document.getElementById("BUDGET_UTILITY").value;
	if(util == ""){util = 0;document.getElementById("BUDGET_UTILITY").value = 0;}
	var utiliva = document.getElementById("BUDGET_UTILITY_TAX").value;
	if(utiliva == ""){utiliva = 0;document.getElementById("BUDGET_UTILITY_TAX").value = 0;}

	var adminValue = (actualBudgetSubTotal*admin)/100;
	var imprevValue = (actualBudgetSubTotal*imprev)/100;
	var utilValue = (actualBudgetSubTotal*util)/100;
	var utilivaValue = (utilValue*utiliva)/100;
	
	document.getElementById("BUDGET_ADMIN_SUBTOTAL").value = "$"+addCommas(adminValue);
	document.getElementById("BUDGET_IMPRE_SUBTOTAL").value = "$"+addCommas(imprevValue);
	document.getElementById("BUDGET_UTILITY_SUBTOTAL").value = "$"+addCommas(utilValue);
	document.getElementById("BUDGET_IVA_SUBTOTAL").value = "$"+addCommas(utilivaValue);
	
	
	var total = actualBudgetSubTotal+adminValue+imprevValue+utilValue+utilivaValue;
	document.getElementById("BUDGET_TOTAL").value = "$"+addCommas(total);
	if(from == "blur")
	{
		console.log("si guarda")
		
		var info = {};
		info.BUDGET_CODE = document.getElementById("BUDGET_LIST").value;
		
		if(info.BUDGET_CODE == "")
		{
			document.getElementById("BUDGET_ADMINISTRATION").value = 0;
			document.getElementById("BUDGET_IMPREVIST").value = 0;
			document.getElementById("BUDGET_UTILITY").value = 0;
			document.getElementById("BUDGET_UTILITY_TAX").value = 0;
			document.getElementById("BUDGET_SUBTOTAL").value = "$0";
			document.getElementById("BUDGET_TOTAL").value = "$0";
			actualBudgetSubTotal = 0;
			
			if(admin != 0 || imprev != 0 || util != 0 || utiliva != 0)
			{fastPop("No hay un presupuesto seleccionado.", 3000);return;}
		}
		
		info.BUDGET_ADMINISTRATION = admin;
		info.BUDGET_IMPREVIST = imprev;
		info.BUDGET_UTILITY = util;
		info.BUDGET_UTILITY_TAX = utiliva;
		
		console.log(info)
		
		sendAjax("users","updateCosts",info,function(response)
		{			
			var ans = response.message;
			console.log("Cost updated");
		});




		
	}
	
}

// LOADFORMS-----------------
// LOADFORMS-----------------
// LOADFORMS-----------------
// LOADFORMS-----------------
function loadForm(type)
{
	var formTitle = document.getElementById("popFormTitle");
	var popFormFieldBox = document.getElementById("popFormFieldBox");
	popFormFieldBox.innerHTML = "";
	var saveButton = document.getElementById("popFormSaveButton");
	var closeButton = document.getElementById("popFormExitButton");
	closeButton.onclick = function (){PUM.close(1515);}
	
	saveButton.style.display = "initial";
	closeButton.style.display = "initial";
	
	if(type == "profile")
	{

		var USER_NAME = fieldCreator([12,4,4,12], "Nombre completo", "input", "text", "USER_NAME");
		var USER_PHONE = fieldCreator([12,4,4,12], "Teléfono(s)", "input", "text", "USER_PHONE");
		var USER_EMAIL = fieldCreator([12,4,4,12], "Email", "input", "text", "USER_EMAIL");
		var USER_PASS = fieldCreator([12,4,4,6], "Contraseña", "input", "text", "USER_PASS");
		var USER_PASS2 = fieldCreator([12,4,4,6], "Confirmación contraseña", "input", "text", "USER_PASS2");

		
		popFormFieldBox.appendChild(USER_NAME);
		popFormFieldBox.appendChild(USER_PHONE);
		popFormFieldBox.appendChild(USER_EMAIL);
		popFormFieldBox.appendChild(USER_PASS);
		popFormFieldBox.appendChild(USER_PASS2);
				
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Perfil de usuario";
		saveButton.onclick = function (){saveUdata('0');}

		PUM.open(1515);
	}

	if(type == "items")
	{
		
		actualLoadedFile = "";
		actualLoadedFileName = "";
		actualLoadedFileFormat = "";
		
		
		var ITEM_BUDGET = fieldCreator([12,4,4,6], "Presupuesto", "select", "select", "ITEM_BUDGET");
		var ITEM_CATEGORY = fieldCreator([12,4,4,6], "Categoría", "select", "select", "ITEM_CATEGORY");
		var ITEM_ACTIVITY = fieldCreator([12,4,4,12], "Actividad", "input", "text", "ITEM_ACTIVITY");
		var ITEM_UNIT = fieldCreator([12,4,4,4], "Unidad de medida", "select", "select", "ITEM_UNIT");
		var ITEM_QTY = fieldCreator([12,4,4,4], "Cantidad", "input", "number", "ITEM_QTY");
		var ITEM_UNIT_VALUE = fieldCreator([12,4,4,4], "Valor unitario", "input", "number", "ITEM_UNIT_VALUE");
		var ITEM_DETAILS = fieldCreator([12,4,4,12], "Detalles adicionales del item", "textarea", "textarea", "ITEM_DETAILS");
				
		
		popFormFieldBox.appendChild(ITEM_BUDGET);
		popFormFieldBox.appendChild(ITEM_CATEGORY);
		popFormFieldBox.appendChild(ITEM_ACTIVITY);
		popFormFieldBox.appendChild(ITEM_UNIT);
		popFormFieldBox.appendChild(ITEM_QTY);
		popFormFieldBox.appendChild(ITEM_UNIT_VALUE);
		popFormFieldBox.appendChild(ITEM_DETAILS);
		
		// FILE BOX FORMAT
		var fileBox = document.createElement("div");
		fileBox.className = "blockBox col-xs-12 col-sm-12 col-md-12 col-lg-12";
		var loadFile = document.createElement("span");
		loadFile.id = "loadItemPicA";
		loadFile.className = "loadFileLink";
		loadFile.innerHTML = "Cargar imágen (boceto, plano, foto) jpg";
		loadFile.onclick = function ()
		{
			actualFileOrigin = "loadItemPicA";
			document.getElementById("fileSelectorfile").click();
		}
		fileBox.appendChild(loadFile);
		popFormFieldBox.appendChild(fileBox);
		
		document.getElementById("ITEM_DETAILS").placeholder = "De ser posible incluye medidas, peso, material, marca u otros elementos que faciliten la cotización.";

		// FILL SPECIAL TYPES
		selectFiller("ITEM_BUDGET", "Seleccione presupuesto", actualBudgets, "BUDGET_CODE", "BUDGET_NAME");
		selectFiller("ITEM_CATEGORY", "Seleccione categoría", actualCategories, "CATEGORY_CODE", "CATEGORY_NAME");
		
		// FILL DOCTYPES
		var options = ["Unidad", "Mes", "Mt2", "Mtl", "Mt3", "Caja", "Kilo"];
		selectFiller("ITEM_UNIT", "Seleccione unidad de medida", options);
		
		document.getElementById("ITEM_BUDGET").onchange = function ()
		{lastBudget = this.value;}
		document.getElementById("ITEM_CATEGORY").onchange = function ()
		{lastCategory = this.value;}
		
		
		if(lastBudget != ""){document.getElementById("ITEM_BUDGET").value = lastBudget;}
		if(lastCategory != ""){document.getElementById("ITEM_CATEGORY").value = lastCategory;}
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear item";
		saveButton.onclick = function (){saveItem('0');}
		saveButton.style.display = "initial";

		PUM.open(1515);
		
		
	}
	
	if(type == "budgets")
	{
		
		var BUDGET_NAME = fieldCreator([12,4,4,12], "Nombre del Presupuesto", "input", "text", "BUDGET_NAME");
	
		popFormFieldBox.appendChild(BUDGET_NAME);
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear presupuesto";
		saveButton.onclick = function (){saveBudget('0');}
		saveButton.style.display = "initial";

		PUM.open(1515);
		
		
	}
	
	if(type == "invite")
	{
		
		var INVITE_EMAIL = fieldCreator([12,4,4,5], "Email a invitar", "input", "text", "INVITE_EMAIL");
		var INVITE_MODE = fieldCreator([12,4,4,5], "Nivel de acceso", "select", "select", "INVITE_MODE");
	
		popFormFieldBox.appendChild(INVITE_EMAIL);
		popFormFieldBox.appendChild(INVITE_MODE);
		
		var INVITE_ADD = buttonCreator([12,4,4,2], "Agregar invitado", function()
		{
			var line = {};
			line.INVITE_EMAIL = document.getElementById("INVITE_EMAIL").value;
			line.INVITE_MODE = document.getElementById("INVITE_MODE").value;
			if(!checkEmail(line.INVITE_EMAIL)){fastPop("Debes ingresar un Email válido.", 2000);return;}
			if(line.INVITE_EMAIL == ""){fastPop("Debe escribir un email válido.", 2000);return;}
			if(line.INVITE_MODE == ""){fastPop("Debe seleccionar un tipo de permiso.", 2000);return;}
			
			if(line.INVITE_EMAIL == userData.USER_EMAIL)
			{fastPop("El usuario invitado debe ser diferente al suyo.", 2000);return;}
			
			// CHECKIF INVITED EXIST
			for(var i=0; i<actualInvited.length; i++)
			{
				var item = actualInvited[i];
				if(item.INVITE_EMAIL == line.INVITE_EMAIL)
				{fastPop("Este Email ya se encuentra en la lista de invitados.", 2000);	}
			}
			
			actualInvited.push(line);
			
			tableCreator("ct_invited", actualInvited);
			
			document.getElementById("INVITE_EMAIL").value = "";
			document.getElementById("INVITE_MODE").value = "";
		});
		
		popFormFieldBox.appendChild(INVITE_ADD);
		
		var innerListBox = document.createElement("div");
		innerListBox.id = "innerListBox";
		innerListBox.className = "blockBox";
		popFormFieldBox.appendChild(innerListBox);
		addInvitedBlock();
		
		var options = [];
		var item = {};
		item.TYPE = "ACTAS";
		item.DESC = "ACTAS (Solo tiene acceso a creación de actas de avance)";
		options.push(item);
		
		var item = {};
		item.TYPE = "TOTAL";
		item.DESC = "TOTAL (Tambien puede cambiar el presupuesto)";
		options.push(item);
		
		// FILL SPECIAL TYPES
		selectFiller("INVITE_MODE", "Nivel de acceso", options, "TYPE", "DESC");
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Invitar usuario al presupuesto: "+bData.BUDGET_NAME;
		saveButton.onclick = function (){saveInvited();}
		saveButton.style.display = "initial";

		PUM.open(1515);
		
		
	}
	
	if(type == "pricePick")
	{
		
		var innerListBox = document.createElement("div");
		innerListBox.id = "innerListBox";
		innerListBox.className = "blockBox";
		popFormFieldBox.appendChild(innerListBox);
		addPricesBlock();
		
				
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Seleccionar precio desde lista";
		
		saveButton.style.display = "none";
		// closeButton.style.display = "none";

		PUM.open(1515);
		
		
	}
	
	if(type == "categories")
	{
		
		var CATEGORY_NAME = fieldCreator([12,4,4,12], "Nombre de categoría", "input", "text", "CATEGORY_NAME");
	
		popFormFieldBox.appendChild(CATEGORY_NAME);
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear categoría";
		saveButton.onclick = function (){saveCategory('0');}
		saveButton.style.display = "initial";

		PUM.open(1515);
		
		
	}
	
	if(type == "quotes")
	{
		
		var QUOTE_NAME = fieldCreator([12,4,4,12], "Nombre de lista de cotización", "input", "text", "QUOTE_NAME");
	
		popFormFieldBox.appendChild(QUOTE_NAME);
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Crear lista de cotización";
		saveButton.onclick = function (){saveQuote('0');}
		saveButton.style.display = "initial";

		PUM.open(1515);
		
		
	}
	
	if(type == "quoteAdd")
	{
		
		var QUOTE_CODE = fieldCreator([12,4,4,12], "Nombre de lista de cotización", "select", "select", "QUOTE_CODE");
	
		popFormFieldBox.appendChild(QUOTE_CODE);
		
		// FILL SPECIAL TYPES
		selectFiller("QUOTE_CODE", "Seleccione lista de cotización", actualQuoteList, "QUOTE_CODE", "QUOTE_NAME");
		
		document.getElementById("QUOTE_CODE").onchange = function (){lastQuote = this.value;}
		
		
		if(lastQuote != ""){document.getElementById("QUOTE_CODE").value = lastQuote;}
		
		// DEFINE ACTION
		actualMT = "1";
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Agregar a lista de cotización";
		saveButton.onclick = function (){addToQuote();}
		saveButton.style.display = "initial";

		PUM.open(1515);
		
		
	}

	

	goTopPop();
}

// GENERAL EDIT METHOD
function editDataForm(type)
{
	var formTitle = document.getElementById("popFormTitle");
	var popFormFieldBox = document.getElementById("popFormFieldBox");
	popFormFieldBox.innerHTML = "";
	var saveButton = document.getElementById("popFormSaveButton");
	saveButton.style.display = "initial";
	actualMT = "2";
	
	if(type == "profile")
	{
		// LOAD FORM
		loadForm("profile");
		
		userEditing = 1;

		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", userData);
				
		// SET FAKE PASSWD
		document.getElementById("USER_PASS").value = "******";
		document.getElementById("USER_PASS2").value = "******";
		
		// DISABLE EDIT ENTITY AND EMAIL
		if(userData.USER_CTYPE != "Superior")
		{
			document.getElementById("USER_EMAIL").disabled = true;
		}
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Perfil de usuario";
		saveButton.onclick = function (){saveUdata('1');}
		
		// ADD DIRECT CONTRACT ACCESS IF CONTRAACTIVE
		var utype = userData.USER_CTYPE;
		console.log(utype)
		formTitle.innerHTML = "Perfil de usuario";
		saveButton.onclick = function (){saveUdata('1');}
		saveButton.innerHTML = "Guardar";

	}
	if(type == "categories")
	{
		// LOAD FORM
		loadForm("categories");

		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Edición de categoría";
		saveButton.onclick = function (){saveCategory('1');}
		saveButton.innerHTML = "Guardar";

	}
	if(type == "items")
	{
		// LOAD FORM
		loadForm("items");

		
		// CHECK IF CAT EXIST, IF NOT CREATE
		var thisCatCode = actualEditData.ITEM_CATEGORY;
		var thisCatName = actualEditData.ITEM_CATEGORY_NAME;
		var create = 1;
		for(var i=0; i<actualCategories.length; i++)
		{
			var item = actualCategories[i];
			if(item.CATEGORY_CODE == thisCatCode){create = 0;	break;}
		}
		if(create == 1)
		{
			var option = document.createElement("option");
			option.innerHTML = thisCatName;
			option.value = thisCatCode;
			document.getElementById("ITEM_CATEGORY").appendChild(option);
		}
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		// SET TITLE AND SAVE FUNCTION
		formTitle.innerHTML = "Edición de items";
		saveButton.onclick = function (){saveItem('1');}
		saveButton.innerHTML = "Guardar";

	}
	
	// APROBED CONTRACT DETAIL VIEW ONLY
	if(type == "aprobeD")
	{
		var bypass = 0;
		if(lockRequest == "1")
		{ lockRequest = "0"; bypass = 1;}
		
		// LOAD FORM
		loadForm("contract");
		
		if(bypass == 1)
		{lockRequest = "1"}
		
		
		// FILL USER DATA HEADER
		var line = document.getElementById("formHeaderLine");
		
		line.innerHTML = 
		"<b>Solicitante:</b> "+actualEditData.CONTRACT_REQUESTER_NAME+"<br>"+
		"<b>Documento de identidad:</b> "+actualEditData.CONTRACT_REQUESTER_ID+"<br>"+
		"<b>Teléfono:</b> "+actualEditData.CONTRACT_REQUESTER_PHONE;
		
		
		// FILL DATA IN FORM
		formEditFiller("popFormFieldBox", actualEditData);
		
		// FIRE FIELDS PICKER
		document.getElementById("CONTRACT_USERTYPE").onchange();
		
		// LOCK TYPE AND USERTYPE
		document.getElementById("CONTRACT_REQTYPE").disabled = true;
		document.getElementById("CONTRACT_USERTYPE").disabled = true;
		
		// LOCK CONTRACT IF CESION
		if(actualEditData.CONTRACT_STATE == "4")
		{
			document.getElementById("CONTRACT_NUMBER").disabled = true;
			document.getElementById("CONTRACT_INIDATE").disabled = true;
			document.getElementById("CONTRACT_ENDATE").disabled = true;
		}
		
		// FILL AND LOCK MULTIPICKERS
		var locked = "1";
		var singlePicker = "1";
		var allActivities = activities;
				
		var clistP = JSON.parse(actualEditData.CONTRACT_PROGRAM);
		// SET MULTIPICKER PROGRAM
		multiSelectFillerDic("CONTRACT_PROGRAM", "PROGRAM_CODE", "PROGRAM_NAME", programs, clistP,singlePicker,locked);
		
		var clistZ = JSON.parse(actualEditData.CONTRACT_ZONES);
		// SET MULTIPICKER ZONES
		multiSelectFillerDic("CONTRACT_ZONES", "ZONE_CODE", "ZONE_NAME", zones, clistZ, singlePicker,locked);
		
		if(actualEditData.CONTRACT_USERTYPE == "Cogestor")
		{
			var myActis = [];
		
			// SHOW ONLY COG SELECTED
			for(var i=0; i<activities.length; i++)
			{
				var item = activities[i];
				if(item.ACTIVITY_COG == "1")
				{myActis.push(item);}
			}
			allActivities = myActis;
			
			singlePicker = "1";
		}

		// SET MULTIPICKER ACTIVITIES
		var clistA = JSON.parse(actualEditData.CONTRACT_ACTIVITIES);
		multiSelectFillerDic("CONTRACT_ACTIVITIES", "ACTIVITY_CODE", "ACTIVITY_NAME", allActivities, clistA, singlePicker,locked);

		// SET TITLE 
		if(actualEditData.CONTRACT_STATE == "4")
		{
			formTitle.innerHTML = "Detalle de contrato aprobado";
			saveButton.style.display = "none";
		}
		
		// SET SAVE FUNCTION
		saveButton.onclick = function ()
		{
			var params = ["",""];
			
			if(actualEditData.CONTRACT_STATE == "2")
			{
				var question = "¿Desea aprobar el contrato ";
			}
			else
			{
				var question = "¿Desea aprobar la cesión del contrato ";
			}
			
			var contractNumber = document.getElementById("CONTRACT_NUMBER").value;
			confirmBox(language["confirm"], question + contractNumber +"?",aprobeContract, params);
		}
		saveButton.innerHTML = "Aprobar";

		// ADD GOALS BLOCK
		addGoalsBlock();

	}
	
}

// -------------APP FUNCTIONS---------------
// -------------APP FUNCTIONS---------------
// -------------APP FUNCTIONS---------------

// TABLES
// TABLES
// TABLES
// TABLES
// TABLES
// TABLES

// TABLE REFRESHER
function refreshTable(table, print)
{
	var info = {};
	
	if(print == null){print = "0";}
	
	if(table == "ct_quote_items")
	{
		var filters = getFilters();
		
		var index = " QUOTE_CODE ";
		var order = " QUOTE_ITEM_CODE ASC";
	}
	if(table == "ct_items")
	{
		var filters = getFilters();
		// ADD FILTERS IF NECESARY HERE filters.XXX = XXX
		var index = " ITEM_CODE ";
		var order = " ITEM_CATEGORY_NAME ASC, ITEM_ACTIVITY ASC ";
	}
	if(table == "ct_categories")
	{
		var filters = getFilters();
		// ADD FILTERS IF NECESARY HERE filters.XXX = XXX
		filters.USER_CODE_F = userData.USER_CODE;
		filters.USER_EMAIL_F = userData.USER_EMAIL;
		
		
		var index = " CATEGORY_CODE ";
		var order = " CATEGORY_NAME ASC ";
	}
	if(table == "ct_log")
	{
		var filters = getFilters();
		// ADD FILTERS IF NECESARY HERE filters.XXX = XXX
		var index = "MC";
		var order = " DATE DESC";
	}
	
	// LOCAL REFRESH
	if(table == "wp_groups_citizens")
	{
		tableCreator("wp_groups_citizens", actualGroupCitizens);
		return;
	}
	
	info.FILTERS = filters;
	info.TABLE = table;
	info.INDEX = index;
	info.ORDER = order;
	info.EXPORT = print;
	
	console.log(info)
	// document.getElementById("coverloader").style.display = "block";

	sendAjax("users","refreshTable",info,function(response)
	{
		// document.getElementById("coverloader").style.display = "none";
		var ans = response.message;
		console.log(ans);
		
		if(info.TABLE == "ct_items")
		{
			
			bData = response.bData;
			
			if(bData.BUDGET_USER == userData.USER_CODE)
			{
				bProperty = "Owner";
				bAccess = "TOTAL";
			}
			else
			{
				bProperty = "Invited";
				var invited = JSON.parse(bData.BUDGET_INVITED);
				console.log(invited)
				for(var i=0; i<invited.length; i++)
				{
					var item = invited[i];
					if(item.INVITE_EMAIL == userData.USER_EMAIL)
					{
						bAccess = item.INVITE_MODE;
					}
				}
			}
			
			console.log(bAccess)
			
			document.getElementById("BUDGET_ADMINISTRATION").value = bData.BUDGET_ADMINISTRATION;
			document.getElementById("BUDGET_IMPREVIST").value = bData.BUDGET_IMPREVIST;
			document.getElementById("BUDGET_UTILITY").value = bData.BUDGET_UTILITY;
			document.getElementById("BUDGET_UTILITY_TAX").value = bData.BUDGET_UTILITY_TAX;
			
			console.log(bProperty)
			
			
			listTotalizer("ct_items", ans);
			setSubTotalProyect();
			
			return;
		}
		if(info.TABLE == "ct_quote_items")
		{
			
		}
		if(info.TABLE == "ct_categories"){}
	
		tableCreator(info.TABLE, ans);	
		
		if(info.EXPORT != "0")
		{
			console.log(response.path);
			
			var file = response.path;
			var a = document.createElement("a"); //Create <a>
			a.href = "app/reports/"+file+".xls"; 
			a.download = response.path+".xls"; //File name Here
			a.click(); 
		}	
	});
}

// ADD INVITED BLOCK
function addInvitedBlock()
{
	// GOALS BLOCK -----------
	// GOALS BLOCK -----------
	
	var innerListBox = document.getElementById("innerListBox");
	innerListBox.innerHTML = "";
	var INNER_TABLE	= fieldCreator([12,12,12,12], "", "tableField", "tableField", "INNER_TABLE");
	var table = tableDraw("ct_invited",["Email","Acceso","Eliminar"]);
	innerListBox.appendChild(INNER_TABLE);
	
	document.getElementById("INNER_TABLE").appendChild(table);
	
	if(bData.BUDGET_INVITED != "" && bData.BUDGET_INVITED != null){actualInvited = JSON.parse(bData.BUDGET_INVITED);}
	else{actualInvited = [];}
	
	console.log(actualInvited)
	

	tableCreator("ct_invited", actualInvited);
	
}

// ADD PRICES BLOCK
function addPricesBlock()
{
	// PRICES BLOCK -----------
	// PRICES BLOCK -----------
	var innerListBox = document.getElementById("innerListBox");
	innerListBox.innerHTML = "";
	var INNER_TABLE	= fieldCreator([12,12,12,12], "", "tableField", "tableField", "INNER_TABLE");
	var table = tableDraw("ct_quotePrices",["Lista de cotización","Precio unitario","Seleccionar"]);
	innerListBox.appendChild(INNER_TABLE);
	document.getElementById("INNER_TABLE").appendChild(table);
	tableCreator("ct_quotePrices", actualBudgetPrices);
	
}

function setSubTotalProyect()
{
	var total = 0;
	var keys = Object.keys(totalCats);
	for(var i=0; i<keys.length; i++)
	{
		var item = keys[i];
		total = total+parseInt(totalCats[item]);
	}
	actualBudgetSubTotal = total;
	document.getElementById("BUDGET_SUBTOTAL").value = "$"+addCommas(actualBudgetSubTotal);
	
	setFullTotal("refresh");
	
}

// TABLE FILLER
// TABLE FILLER
// TABLE FILLER
// TABLE FILLER
function tableCreator(tableId, list)
{
	var table = document.getElementById(tableId);
	tableClear(tableId);
	
	if(tableId == "wp_contracts")
	{var list = reArrange(list, "wp_contracts");}
	
	if(tableId == "wp_groups")
	{var list = reArrange(list, "wp_groups");}
	
	// CANTIDAD DE REGISTROS Y MENSAJE DE NO ENCONTRADO
	var qty = list.length+" Registros ";
	if(list.length == 1){var qty = list.length+" Registros ";}
	if(list.length == 0)
	{
		var nInYet = document.createElement("div");
		nInYet.innerHTML = "Sin resultados";
		nInYet.className = "blankProducts";
		table.appendChild(nInYet);
		return;
	}
	// CATEGORIES
	if(tableId == "ct_categories")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a = cellCreator('Categoría', list[i].CATEGORY_NAME);
			
			var edit = faIcon(list[i],"edit","Editar","#007bff");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("categories")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["ct_categories",data];
				confirmBox(language["confirm"], "¿Desea eliminar esta categoría?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [a,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// ITEMS
	if(tableId == "ct_items")
	{
		
		actualTmpCat = "";
		
		var fullTotal = 0;
		
		for(var i=0; i<list.length; i++)
		{
			
			var row = document.createElement("div");
			row.className = "rowT";
			var a = cellCreator('Actividad', list[i].ITEM_ACTIVITY);
			var b = cellCreator('Unidad', list[i].ITEM_UNIT);
			
			
			var field = editableField(list[i],"number",12,"ct_items","ITEM_QTY","ITEM_CODE",list[i].ITEM_QTY,"Debe ingresar una cantidad","1");
			var c = celloneIconCreator('Cantidad', [field]);
			
			var field = editableField(list[i],"number",12,"ct_items","ITEM_UNIT_VALUE","ITEM_CODE",list[i].ITEM_UNIT_VALUE,"Debe ingresar un valor unitario","1");
			var d = celloneIconCreator('Valor unitario', [field]);
						
			var e = cellCreator('Detalles', list[i].ITEM_DETAILS);
			var subtotal = "$"+addCommas(parseFloat(list[i].ITEM_QTY)*parseFloat(list[i].ITEM_UNIT_VALUE));
			var f = cellCreator('Subtotal', subtotal);
			
			var edit = faIcon(list[i],"edit","Editar","#559a91");
			edit.onclick = function()
			{
				actualEditData = this.reg;
				editDataForm("items")
			}
			
			var addToQuote = faIcon(list[i],"file-invoice-dollar","Agregar a lista de cotización","#db90e8");
			addToQuote.onclick = function()
			{
				actualEditData = this.reg;
				actualItemCode = actualEditData.ITEM_CODE;
				getQuoteList();
				
			}
			
			console.log(list[i].ITEM_QUOTE_ITEM)
			
			if(list[i].ITEM_QUOTE_ITEM != "" && list[i].ITEM_QUOTE_ITEM != null){var pricePicerColor = "#f1a769";}
			else{var pricePicerColor = "#bdb7b7";}
			
			var quotePricePicker = faIcon(list[i],"dollar-sign","Seleccionar precio desde cotización",pricePicerColor);
			quotePricePicker.onclick = function()
			{
				actualEditData = this.reg;
				actualItemCode = actualEditData.ITEM_CODE;
				actualBudgetPrices = actualEditData.QUOTE_PRICES;
				actualPickedQuote = actualEditData.ITEM_QUOTE_ITEM;
				loadForm("pricePick");
				
			}
			
			var itemPic = faIcon(list[i],"camera","Descargar imágen del item", "#76c38a");
			itemPic.reg = list[i];
			itemPic.onclick = function()
			{
				getRegFile("ct_items", "ITEM_PIC", "ITEM_CODE", this.reg.ITEM_CODE, this.reg.ITEM_ACTIVITY+".")
			}
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["ct_items",data];
				confirmBox(language["confirm"], "¿Desea eliminar este item?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(edit);
			icons.push(addToQuote);
			
			if(list[i].QUOTE_PRICES.length > 0)
			{
				icons.push(quotePricePicker);
			}
			
			
			if(list[i].ITEM_PIC != ""){icons.push(itemPic);}
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [a,e,b,c,d,f,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			
			// HEADER AND TOTAL LINES
			// HEADER AND TOTAL LINES
			// HEADER AND TOTAL LINES

			var reg = list[i];
			if(i == 0)
			{
				actualTmpCat = reg.ITEM_CATEGORY_NAME;
				
				var line = [actualTmpCat, "", "", "", "", "", ""];
				var catHeaderRow = starterRow(line);
				table.appendChild(catHeaderRow);
								
				table.appendChild(row);
				
				var nextItemCat = list[i].ITEM_CATEGORY_NAME;
				if(nextItemCat != actualTmpCat)
				{
					// console.log("cambio en linea "+i+" Insertar total categoría "+actualTmpCat+" aquí.")
					var line = ["Total "+actualTmpCat, "", "", "", "", "$"+addCommas(totalCats[actualTmpCat]), ""];
					var totalRow = enderRow(line);
					table.appendChild(totalRow);
					actualTmpCat = nextItemCat;
				}
			}
			else
			{
				var nextItemCat = list[i].ITEM_CATEGORY_NAME;
				if(nextItemCat != actualTmpCat)
				{
					// console.log("cambio en linea "+i+" Insertar total categoría "+actualTmpCat+" aquí.")
					var line = ["Total "+actualTmpCat, "", "", "", "", "$"+addCommas(totalCats[actualTmpCat]), ""];
					var totalRow = enderRow(line);
					table.appendChild(totalRow);
					actualTmpCat = nextItemCat;
					var line = [actualTmpCat, "", "", "", "", "", ""];
					var catHeaderRow = starterRow(line);
					table.appendChild(catHeaderRow);
				}
				
				table.appendChild(row);
				
				if(i == list.length-1)
				{
					console.log("Last line")
					var line = ["Total "+actualTmpCat, "", "", "", "", "$"+addCommas(totalCats[actualTmpCat]), ""];
					var totalRow = enderRow(line);
					table.appendChild(totalRow);
				}
			}
		}
	}
	// CATEGORIES
	if(tableId == "ct_quote_items")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a = cellCreator('Item', list[i].ITEM_ACTIVITY);
			var a2 = cellCreator('Detalles', list[i].ITEM_DETAILS);
			var b = cellCreator('Unidad', list[i].ITEM_UNIT);
			var c = cellCreator('Cantidad', list[i].ITEM_QTY);
			var field = editableField(list[i],"number",12,"ct_quote_items","QUOTE_UNIT_VALUE","QUOTE_ITEM_CODE",list[i].QUOTE_UNIT_VALUE,"Debe ingresar un valor unitario","1");
			var d = celloneIconCreator('Valor unitario', [field]);
			var subTotal = parseFloat(list[i].ITEM_QTY)*parseFloat(list[i].QUOTE_UNIT_VALUE);
			var e = cellCreator('SubTotal', "$"+addCommas(subTotal));

			var itemPic = faIcon(list[i],"camera","Descargar imágen del item", "#76c38a");
			itemPic.reg = list[i];
			itemPic.onclick = function()
			{
				getRegFile("ct_items", "ITEM_PIC", "ITEM_CODE", this.reg.QUOTE_ORIGINAL_CODE, this.reg.ITEM_ACTIVITY+".")
			
			}
			
			var del = faIcon(list[i],"trash","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["ct_quote_items",data];
				confirmBox(language["confirm"], "¿Desea eliminar este item de la lista de cotización?",deleteItem, params);
			}
			
			var icons = [];
			
			if(list[i].ITEM_PIC != ""){icons.push(itemPic);}
			icons.push(del);
			
			icons.push(del);

			var x = cellOptionsCreator('', icons)
			var cells = [a,a2,b,c,d,e,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}
	// LOG
	if(tableId == "ct_log")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var locationLog = locationsDictionary[list[i].IFACE];
			var a = cellCreator('Ubicación', locationLog);
			var b = cellCreator('Usuario', list[i].USER_NAME);
			var c = cellCreator('Fecha/hora', list[i].DATE);
			
			var action = actionsDictionary["a"+list[i].MT];
			var d = cellCreator('Operación', action);
			
			// TURN SINGLE INTO ARRAY TO GET DESCRIPTION
			var thearray = JSON.stringify([list[i].ENTITY]);
			var entity = getFriendDescs(thearray,"entities");
			
			var e = cellCreator('Entidad', entity);
			
			var icons = [];

			var x = cellOptionsCreator('', icons)
			var cells = [b,c,a,d,e];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}

	// -------------- LOCAL TABLES
	
	// EVENT ASSIST
	if(tableId == "ct_invited")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a = cellCreator('Email', list[i].INVITE_EMAIL);
			var b = cellCreator('Acceso', list[i].INVITE_MODE);
			
			var del = faIcon(list[i],"trash-alt","Eliminar","#e83e8c");
			del.onclick = function()
			{
				var data = this.reg;
				var params = ["ct_invited",data];
				confirmBox(language["confirm"], "¿Desea este invitado?",deleteItem, params);
			}
			
			var icons = [];
			icons.push(del);
			var x = cellOptionsCreator('', icons)
			
			var cells = [a,b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);
		}
	}
	// QUOTE PRICES
	if(tableId == "ct_quotePrices")
	{
		for(var i=0; i<list.length; i++)
		{
			var row = document.createElement("div");
			row.className = "rowT";
			
			var a = cellCreator('Lista de cotización', list[i].QUOTE_NAME);
			var b = cellCreator('Precio de cotización', list[i].QUOTE_UNIT_VALUE);
			
			
			console.log(actualPickedQuote)
			console.log(list[i].QUOTE_ITEM_CODE)
			
			if(actualPickedQuote == list[i].QUOTE_ITEM_CODE)
			{
				var pick = faIcon(list[i],"check","Seleccionar este precio para el item","#e83e8c");
			}
			else
			{
				var pick = faIcon(list[i],"check","Seleccionar este precio para el item","#b7aeae");
			}
			
			
			pick.onclick = function()
			{
				var data = this.reg;
				var params = [data];
				confirmBox(language["confirm"], "¿Desea seleccionar el precio de esta cotización para el item?",pickPrice, params);
			}
			
			var icons = [];
			icons.push(pick);

			var x = cellOptionsCreator('', icons)
			var cells = [a,b,x];
			
			for(var r=0; r<cells.length; r++){row.appendChild(cells[r]);}
			table.appendChild(row);

		}
	}

}

function listTotalizer(table,list)
{
	
	if(table == "ct_items"){var gField = "ITEM_CATEGORY_NAME";}
	
	var cats = [];
	var catCounter = 0;
	
	// GET CATS
	for(var i=0; i<list.length; i++)
	{
		var item = list[i];
		var itemCat = item[gField];
		if(!cats.includes(itemCat)){cats.push(itemCat)}
	}
	
	// GET TOTALS PER CAT
	totalCats = {};
	for(var i=0; i<cats.length; i++)
	{
		var cat = cats[i];
		var catSubtotal = 0;
		
		for(var j=0; j<list.length; j++)
		{
			var item = list[j];
			if(item.ITEM_CATEGORY_NAME == cat)
			{
				var add = parseFloat(item.ITEM_QTY) * parseFloat(item.ITEM_UNIT_VALUE);
				catSubtotal = catSubtotal+add;
			}
		}
		
		totalCats[cat] = catSubtotal;
		
	}
	
	tableCreator(table, list);	
	
}

function starterRow(line)
{
	var row = document.createElement("div");
	row.className = "rowHeader";
	for(var i=0; i<line.length; i++)
	{
		var content = line[i];
		
		var cell = document.createElement("div");
		cell.className = "column totalCell";
		cell.setAttribute('data-label',name);
		cell.innerHTML = decodeURIComponent(content);
		
		row.appendChild(cell);
	}
	
	return row;
}

function enderRow(line)
{
	var row = document.createElement("div");
	row.className = "rowTotal";
	for(var i=0; i<line.length; i++)
	{
		var content = line[i];
		
		var cell = document.createElement("div");
		cell.className = "column totalCell";
		cell.setAttribute('data-label',name);
		cell.innerHTML = decodeURIComponent(content);
		
		row.appendChild(cell);
	}
	
	return row;
}

function celloneIconCreator(name, icons)
{
	var cell = document.createElement("div");
	cell.className = "column loneIconCell";
	cell.setAttribute('data-label',name);
	for(var i = 0; i<icons.length; i++)
	{cell.appendChild(icons[i]);}
	return cell;
}

function editableField(data,fieldType,maxlength,table,efield,keyField,actual,warn,mandatory)
{
	var field = document.createElement("input");
	field.type = fieldType;
	field.data = data;
	field.className = "tableField ltf";
	field.value = actual;
	field.maxLength = maxlength;
	field.onblur = function()
	{
		var data = this.data; 
		var thisvalue = this.value;
		
		// WARN IF EMPTY
		if(thisvalue == ""){this.value = actual;if(mandatory == "1"){fastPop(warn, 2000);return;}}

		// IGNORE IF SAME
		if(data[efield] == thisvalue){return;}
		
				
		var info = {};
		info.FIELD = efield;
		info.NEW = thisvalue;
		info.TABLE = table;
		info.KEY = keyField;
		info.CODE = data[keyField];
		
		console.log(info)
	
		sendAjax("users","updateFromLine",info,function(response)
		{
			var ans = response.message;
			refreshTable(info.TABLE);
		});
	}
	
	return field;
}

// DELETE ITEMS

function deleteBudgetCheck(params)
{
	
	console.log(params)
	actualDeleteParams = params;
	
	setTimeout(function()
	{
		console.log(params)
		confirmBox(language["confirm"], "Se eliminarán todos los items asociados al presupuesto, esta acción no se puede revertir. <br><br>¿Confirma que desea eliminar el presupuesto: "+actualDeleteParams[2]+"?",deleteItem, actualDeleteParams);
	}, 1000);
	
}

function deleteQuoteCheck (params)
{
	
	console.log(params)
	actualDeleteParams = params;
	
	setTimeout(function()
	{
		console.log(params)
		confirmBox(language["confirm"], "Se eliminará la lista de cotización y sus precios asociados. <br><br>¿Confirma que desea eliminar la lista: "+actualDeleteParams[2]+"?",deleteItem, actualDeleteParams);
	}, 1000);
	
}

function deleteItem(params)
{
	var table = params[0];
	var data = params[1];

	var info = {};
	info.table = table;
	
	// DEFINE CODE FIELD
	
	if(table == "ct_budgets")
	{
		info.field = "BUDGET_CODE";
		info.code = data;
	}
	if(table == "ct_quotes")
	{
		info.field = "QUOTE_CODE";
		info.code = data;
	}
	if(table == "ct_categories")
	{
		info.field = "CATEGORY_CODE";
		info.code = data[info.field];
	}
	if(table == "ct_items")
	{
		info.field = "ITEM_CODE";
		info.code = data[info.field];
	}
	if(table == "ct_quote_items")
	{
		info.field = "QUOTE_ITEM_CODE";
		info.code = data[info.field];
	}

	// LOCAL DELETE
	if(table == "ct_invited")
	{
		var field = "INVITE_EMAIL";
		var code = data[field];
		
		for(var i=0; i<actualInvited.length; i++)
		{
			var item = actualInvited[i];
			if(item.INVITE_EMAIL == code)
			{
				var pos = i;
				actualInvited.splice(pos, 1);
				break;
			}
		}
		
		tableCreator("ct_invited", actualInvited);
		
		return;
	}
	
	
	actualMT = "3";
	
	
	sendAjax("users","deleteItem",info,function(response)
	{
		var ans = response.message;
		console.log(ans)
		
		if(ans == "cantItem")
		{
			fastPop("Existen items con esta categoría asignada, debe desasignar la categoría para poder eliminarla.", 4000);
			return;
		}
		if(info.table == "ct_categories")
		{
			fastPop("Se ha eliminado la categoría.", 3000);
		}
		if(info.table == "ct_quote_items")
		{
			fastPop("Se ha eliminado el item de la lista.", 3000);
		}
		if(info.table == "ct_items")
		{
			fastPop("Se ha eliminado el item.", 3000);
		}
		if(info.table == "ct_budgets")
		{
			fastPop("Se ha eliminado el presupuesto y sus items.", 3000);
			lastBudget = "";
			getUserMasters();
			return;
		}
		if(info.table == "ct_quotes")
		{
			fastPop("Se ha eliminado la lista de cotización.", 3000);
			lastQuote = "";
			getQuoteMasters();
			refreshTable("ct_quote_items");
			return;
		}
		
		refreshTable(info.table);
	});
}

// TABLE DRAWER---------
function tableDraw(id,fields)
{
	var tableBox = document.createElement("div");
	tableBox.className = "table";
	tableBox.id = id;
	
	var tableHead = document.createElement("div");
	tableHead.className = "table-head";
	
	for(var i=0; i<fields.length; i++)
	{
		var item = fields[i];
		var field = document.createElement("div");
		field.className = "column";
		field.innerHTML = item;
		tableHead.appendChild(field);
	}
	tableBox.appendChild(tableHead);
	return tableBox;
	
}

// FILTERBOX VALUE READER
function getFilters()
{
	var filtersBox = document.getElementById("filtersBox");
	var filters = {};
	var fields = filtersBox.children;
	
	for(var i=0; i<fields.length; i++)
	{
		var item = fields[i];
		var input = item.children[1];
		var fieldType = input.tagName.toLowerCase();
		if(fieldType != "button"){filters[input.id] = input.value;}
	}
	return filters;
}

// FILTERBOX VALUE CLEARER
function clearFilters()
{
	var filtersBox = document.getElementById("filtersBox");
	var fields = filtersBox.children;
	
	for(var i=0; i<fields.length; i++)
	{
		var item = fields[i];
		var input = item.children[1];
		var fieldType = input.tagName.toLowerCase();
		if(fieldType != "button"){input.value = "";}
	}
}
// TABLES
// TABLES
// TABLES
// TABLES
// TABLES
// TABLES

function pickPrice(params)
{

	var quoteData = params[0];
	
	// SET UNIT PRICE AND SAVE QUOTE ITEM CODE ON ITEM QUOTE PRICE
	var info = {};
	info.NEW_PRICE = quoteData.QUOTE_UNIT_VALUE;
	info.QUOTE_ITEM_CODE = quoteData.QUOTE_ITEM_CODE;
	info.ITEM_CODE = actualItemCode;
	
	sendAjax("users","pickPrice",info,function(response)
	{
		var ans = response.message;
		
		fastPop("Se ha asignado el precio de esta cotización al item", 2000);
		
		refreshTable("ct_items");
		PUM.close(1515);
	});
	
}

function getQuoteList()
{
	var info = {};
	info.QUOTE_USER = userData.USER_CODE; 
	
	sendAjax("users","getQuoteList",info,function(response)
	{
		actualQuoteList = response.message;
		console.log(actualQuoteList)
		loadForm("quoteAdd");
		
	});
	
	
}

function addToQuote ()
{
	var info = {};
	info.QUOTE_CODE = document.getElementById("QUOTE_CODE").value; 
	info.QUOTE_ORIGINAL_CODE = actualItemCode;
	
	console.log(info);
	
	if(info.QUOTE_CODE == ""){fastPop("Debe seleccionar una lista de cotización.", 2000);return;}
	
	
	sendAjax("users","addToQuote",info,function(response)
	{
		var ans = response.message;
		console.log(ans);
		
		if(ans == "Exists")
		{
			fastPop("Este item ya se encuentra en esta lista de cotización.", 2000);return;
		}
		else
		{
			fastPop("Se ha agregado el item a la lista de cotización.", 2000);
			refreshTable("ct_items");
			PUM.close(1515);
		}
		
		
	});
}



// GET ITEM LIST FROM CODE
function getItemList(code, type)
{
	var info = {};
	info.code = code;
	if(type == "citizens")
	{
		info.table = "wp_groups";
		info.field = "GROUP_CITIZENS";
	}
	if(type == "citizensAssist")
	{
		info.table = "wp_classes";
		info.field = "CLASS_CITIZENS";
	}
	sendAjax("users","getItemList",info,function(response)
	{
		var ans = response.message;
		console.log(ans)
		if(info.field == "GROUP_CITIZENS")
		{
			actualGroupCitizens = ans;
			if(actualGroupCitizens.length > 0)
			{loadForm("citizensList");}
			else
			{fastPop("No hay ciudadanos asignados a este grupo", 2000);return;}
		}
		if(info.field == "CLASS_CITIZENS")
		{
			actualGroupCitizens = ans;
			if(actualGroupCitizens.length > 0)
			{loadForm("citizensList");}
			else
			{fastPop("No hay ciudadanos asignados a esta clase", 2000);return;}
		}
		
	});
	
	
}

// GET USER GROUPS
function getUserGroups(list)
{
	list = JSON.parse(list);
	var mygroups = [];
	for(var i=0; i<list.length; i++)
	{
		var item = list[i];
		
		if(item.hasOwnProperty("V4"))
		{
			mygroups.push(item.V4);
		}
	}
	return mygroups;
}

// CLEAR LOG
function clearLog()
{
	var info = {};
	info.entity = userData.USER_ENTITY;
	
	sendAjax("users","clearLog",info,function(response)
	{
		var ans = response.message;
		fastPop("Se ha limpiado el Log", 2000);
		refreshTable("ct_log");
	});
}

// -------------CORE FUNCTIONS---------------
function getMultiCheckValue(id)
{
	var options = document.getElementById(id).children;
	var picked = [];
	
	for(var i=0; i<options.length; i++)
	{
		var input = options[i].children[0];

		if(input.checked)
		{
			picked.push(input.id.split("-")[1]);
		}
	}
	return JSON.stringify(picked);
}

// SET CITYFIELDS
function setLocations(fieldId)
{
	var list = locations;
	var ready = [];
	
	for(var i=0; i<list.length; i++)
	{
		var depto = list[i].departamento;
		
		var list2 = list[i].ciudades;
		
		for(var j=0; j<list2.length; j++)
		{
			var city = list2[j];
			
			var munip = city+" - "+depto;
			ready.push(munip);
		}
		
	}
	
	
	ready.sort();
	
	var list = ready;
	
	var places = [];

	for(var i=0; i<list.length; i++)
	{
		var pr = list[i];
		var desc = pr;
		
		desc = desc.toLowerCase();
		if(desc[0] == "-"){desc = desc.substring(1);}
		// desc = toPhrase(desc);
		places.push(desc);
	}
	
	// SET AUTOCOMPLETE TYPEAHEAD FROM ARRAY
	// jQuery('#'+fieldId).typeahead('destroy');
	// jQuery('#'+fieldId).typeahead({fitToElement: false,source: places});
	
	// FILL SELECT FIELD
	var picker = document.getElementById(fieldId);
	picker.innerHTML = "";
	
	var option = document.createElement("option");
	option.value = "";
	option.innerHTML = "Seleccione ciudad";
	picker.appendChild(option);
	
	for(var i=0; i<places.length; i++)
	{
		var item = places[i];
		var option = document.createElement("option");
		option.value = item;
		option.innerHTML = item;
		picker.appendChild(option);
	}
	
	

}

// SET DATE FIELD ----------
function setDateField(id, time)
{
	if(time != null)
	{
		jQuery('#'+id).datetimepicker({ dateFormat: 'yy-mm-dd' });
	}
	else
	{
		jQuery('#'+id).datetimepicker
		({
			timepicker:false,
			format:'Y-m-d',
		}).on('change', function() {
			jQuery('.xdsoft_datetimepicker').hide();
			var str = jQuery(this).val();
			str = str.split(".");
		});
	}
}

// EDITABLE TABLE FIELDS
function inpuTableClass(id,type,val,fillArray)
{
	var field = document.createElement(type);
	field.id = id;
	field.type = type;
	field.className = "tableFieldSelect";
	for(var i=0; i<fillArray.length; i++)
	{
		var item = fillArray[i];
		var option = document.createElement("option");
		option.value = item;
		option.innerHTML = item;
		field.appendChild(option);
	}
	field.onchange = function ()
	{
		
		var thisDay = this.reg.GROUP_TIME_DAY;
		var thisRegCode = this.reg.GROUP_TIME_CODE;
		// CHECK TODAY AND HOUR CONDITION
		var today = getNow();
		var dayNumber = new Date(today).getDay();
		var dayName = weekDays[dayNumber];
		if(thisDay == dayName)
		{
			var time1 = getNow().split(" ")[1];
			var time2 = this.reg.GROUP_TIME_INI;
			var now = new Date("01/01/2000 "+time1);
			var limit = new Date("01/01/2000 "+time2);

			if(now <= limit)
			{
				var fieldKey = this.id.split("-")[1];
				var field = document.getElementById(this.id);
				field.value = this.reg[fieldKey];
				fastPop(language["hourLockWarn"], 4000);return;
			}
		}

		var fieldKey = this.id.split("-")[1];
		var newValue = this.value;

		// CHECK COMPARE HOURS INI
		if(fieldKey == "GROUP_TIME_INI")
		{
			var time1 = newValue;
			var time2 = this.reg.GROUP_TIME_END;
			var time1Date= new Date("01/01/2000 "+time1);
			var time2Date= new Date("01/01/2000 "+time2);
			if(time1Date >= time2Date )
			{
				var field = document.getElementById(this.id);
				field.value = this.reg[fieldKey];
				fastPop("La hora inicial no puede ser posterior o igual a la final", 2000);return;
			}
			
			console.log(this.reg)
			
			// CHECK IF DAY INI IN DAY RANGE
			for(var i=0; i<actualGroupHours.length; i++)
			{
				var item = actualGroupHours[i];
				
				if(item.GROUP_TIME_DAY == thisDay && item.GROUP_TIME_CODE != thisRegCode) 
				{
					var initialHour = new Date("01/01/2000 "+time1);
					var itemIniHour = new Date("01/01/2000 "+item.GROUP_TIME_INI);
					var itemEndHour = new Date("01/01/2000 "+item.GROUP_TIME_END);
					
					if(initialHour >= itemIniHour && initialHour <= itemEndHour)
					{
						var field = document.getElementById(this.id);
						field.value = this.reg[fieldKey];
						fastPop("La hora de inicio se encuentra dentro de otro rango para este mismo Día.", 2000);
						return;
					}
				}
			}
			
		}
		
		// CHECK COMPARE HOURS END
		if(fieldKey == "GROUP_TIME_END")
		{
			var time1 = this.reg.GROUP_TIME_INI;
			var time2 = newValue;
			var time1Date= new Date("01/01/2000 "+time1);
			var time2Date= new Date("01/01/2000 "+time2);
			if(time1Date >= time2Date )
			{
				var field = document.getElementById(this.id);
				field.value = this.reg[fieldKey];
				fastPop("La hora inicial no puede ser posterior o igual a la final", 2000);return;
			}
			
			// CHECK IF DAY INI OR END HOUR IN DAY RANGE
			for(var i=0; i<actualGroupHours.length; i++)
			{
				var item = actualGroupHours[i];
				
				if(item.GROUP_TIME_DAY == thisDay && item.GROUP_TIME_CODE != thisRegCode)
				{
					
					var finalHour = new Date("01/01/2000 "+time2);
					var itemIniHour = new Date("01/01/2000 "+item.GROUP_TIME_INI);
					var itemEndHour = new Date("01/01/2000 "+item.GROUP_TIME_END);
					
					if(finalHour <= itemEndHour && finalHour >= itemIniHour)
					{
						var field = document.getElementById(this.id);
						field.value = this.reg[fieldKey];
						fastPop("La hora final se encuentra dentro de otro rango para este mismo Día.", 2000);
						return;
					}
				}
			}
		}
		
		// SAVE TO MAIN ARRAY
		for(var i=0; i<actualGroupHours.length; i++)
		{
			var item = actualGroupHours[i];
			if(item.GROUP_TIME_CODE == this.reg.GROUP_TIME_CODE)
			{
				actualGroupHours[i][fieldKey] = newValue;
				actualGroupHours[i]["GROUP_TIME_LST"] = getNow();
			}
		}
		
		tableCreator("wp_groups_hours", actualGroupHours);
	
	}
	
	field.value = val;
	return field;
}
function inpuTableNum(id,min,val)
{
	var field = document.createElement("input");
	field.type = "number";
	field.min = min;
	field.className = "tableFieldInput";
	field.value = val;
	field.onblur = function()
	{
		if(parseInt(this.value) < this.min){this.value = this.min}
	}
	
	// LOCK FIELD IF APROVED
	if(actualEditData.CONTRACT_STATE == "4")
	{
		if(userData.USER_CTYPE != "Superior" && userData.USER_CTYPE != "Principal3")
		{field.disabled = true;}
	}
	return field;
}
function inpuTableAssist(id,min,val)
{
	var field = document.createElement("input");
	field.type = "number";
	field.min = min;
	field.regId = id;
	field.className = "tableFieldInput";
	field.value = val;
	field.onblur = function()
	{
		if(this.value < this.min){this.value = this.min; return;}
		
		var val = this.value;
		var code = this.regId;
		
		for(var i=0; i<actualAssistList.length; i++)
		{
			var item = actualAssistList[i];
			if(item.ASSIST_CODE == code)
			{
				actualAssistList[i].ASSIST_VALUE = val;
			}
		}
		// console.log(actualAssistList);
	}
	
	if(viewMode == "1"){field.disabled = true;}
	
	
	return field;
}
function inpuTableNeed(id,min,val,fieldName)
{
	var field = document.createElement("input");
	field.type = "number";
	field.min = min;
	field.fieldName = fieldName;
	field.regId = id;
	field.className = "tableFieldInput";
	field.value = val;
	field.onblur = function()
	{
		if(this.value < this.min){this.value = this.min; return;}
		
		var val = this.value;
		var code = this.regId;
		
		for(var i=0; i<actualNeedsList.length; i++)
		{
			var item = actualNeedsList[i];
			if(item.NEED_CODE == code)
			{actualNeedsList[i][this.fieldName] = val;}
		}
		console.log(actualNeedsList);
	}
	
	// LOCK FIELD IF APROVED
	if(requestState == "4")
	{field.disabled = true;}
	
	return field;
}
function inpuTableNeedDesc(id,min,val,fieldName)
{
	var field = document.createElement("input");
	field.type = "text";
	field.fieldName = fieldName;
	field.regId = id;
	field.className = "tableFieldInputDesc";
	field.value = val;
	field.onblur = function()
	{
		if(this.value < this.min){this.value = this.min; return;}
		
		var val = this.value;
		var code = this.regId;
		
		for(var i=0; i<actualNeedsList.length; i++)
		{
			var item = actualNeedsList[i];
			if(item.NEED_CODE == code)
			{actualNeedsList[i][this.fieldName] = val;}
		}
		console.log(actualNeedsList);
	}
	
	// LOCK FIELD IF APROVED
	if(requestState == "4")
	{field.disabled = true;}
	
	return field;
}


// GENERAL UTILITY METHODS --------------------
// GENERAL UTILITY METHODS --------------------
// GENERAL UTILITY METHODS --------------------
function getFriendDescs(list, master)
{
	var items = JSON.parse(list);
	
	if(master == "programs"){var compareList = programs; var field = "PROGRAM_CODE"; var descField = "PROGRAM_NAME";}
	if(master == "projects"){var compareList = projects; var field = "PROJECT_CODE"; var descField = "PROJECT_NAME";}
	if(master == "activities"){var compareList = activities; var field = "ACTIVITY_CODE"; var descField = "ACTIVITY_NAME";}
	if(master == "zones"){var compareList = zones; var field = "ZONE_CODE"; var descField = "ZONE_NAME";}
	if(master == "entities"){var compareList = entities; var field = "ENTITY_CODE"; var descField = "ENTITY_NAME";}
	if(master == "etnias"){var compareList = etnias; var field = "ETNIA_CODE"; var descField = "ETNIA_NAME";}
	if(master == "conditions"){var compareList = conditions; var field = "CONDITION_CODE"; var descField = "CONDITION_NAME";}
	if(master == "hoods"){var compareList = hoods; var field = "HOOD_CODE"; var descField = "HOOD_NAME";}
	if(master == "institutes"){var compareList = institutes; var field = "INSTITUTE_CODE"; var descField = "INSTITUTE_NAME";}
	
	// console.log(items)
	// console.log(compareList)
	
	var friendly = "";
	
	for(var i=0; i<items.length; i++)
	{
		if(items[i].split("-").length>1)
		{var item1 = items[i].split("-")[1];}
		else
		{var item1 = items[i];}
		
		
		for(var j=0; j<compareList.length; j++)
		{
			var item2 = compareList[j];
			if(item2[field] == item1)
			{
				if(i != items.length-1)
				{
					var friendly = friendly+item2[descField]+", <br>";
				}
				else
				{
					var friendly = friendly+item2[descField];
				}
				
				break;
			}
		}
	}
	// console.log("RESULT "+friendly)
	return friendly;
	
	
}
function tableClear(tableId)
{
  var table = document.getElementById(tableId);
  var rows = table.children;
  
  while(rows.length > 1)
  {
	 var elem = rows[1];
	 elem.parentNode.removeChild(elem);
	 var rows = table.children;
  }
}
function cellCreator(name, content)
{
	var cell = document.createElement("div");
	cell.className = "column";
	cell.setAttribute('data-label',name);
	cell.innerHTML = decodeURIComponent(content);

	return cell;
}
function cellOptionsCreator(name, icons)
{
	var cell = document.createElement("div");
	cell.className = "column opts";
	cell.setAttribute('data-label',name);
	
	for(var i = 0; i<icons.length; i++)
	{
		cell.appendChild(icons[i]);
	}

	return cell;
}
function cellFieldCreator(name, field)
{
	var cell = document.createElement("div");
	cell.className = "column loneIconCell";
	cell.setAttribute('data-label',name);
	cell.appendChild(field);
	return cell;
}
function faIcon(data, css, label, color)
{
	var icon = document.createElement("i");
	icon.reg = data;
	icon.className = "fa fa-"+css+" tableIcon";
	icon.style.color = color;
	icon.setAttribute('title', label);
	icon.setAttribute('alt', label);
	
	// icon.innerHTML = label;
	
	return icon;
}
function encry (str) 
{  
    return encodeURIComponent(str).replace(/[!'()*]/g, escape);  
}
function decry (str) 
{  
    return decodeURIComponent(str);  
}
function addDays(date, days) 
{
  var result = new Date(date);
  result.setDate(result.getDate() + days);
  return result;
}
function getRegFile(table, fileField, codeField, code, filename)
{
	var info = {}
	info.table = table;
	info.fileField = fileField;
	info.codeField = codeField;
	info.code = code;
	info.filename = filename;
	
	sendAjax("users","getRegFile",info,function(response)
	{
		var ans = response.message;
		if(ans != "")
		{
			var format = ans.split(",")[0].split("/")[1].split(";")[0];
			var file = ans;
			var a = document.createElement("a"); //Create <a>
			a.href = file; 
			a.download = info.filename+format; //File name Here
			a.click(); 
		}
		else
		{
			fastPop("Este archivo no se ha cargado.", 2000);
		}
	});
	
}
// GET FULL REG USING KEY FROM DICTIONARY
function getRegFromKey(list, keyfield, val)
{
	var res = {};
	for(var n=0; n<list.length; n++)
	{
		var item = list[n];
		if(item[keyfield] == val)
		{res = item;break;}
	}
	return res;
}
// GET PLAIN ARRAY FIELD VALUES FROM DICTIONARY
function getListCodes(list, field)
{
	var newList = [];
	for(var i=0; i<list.length; i++)
	{
		var item = list[i];
		newList.push(item[field]);
	}
	return newList;
}
// REARRANGE LIST
function reArrange(list, table)
{
	if(table == "wp_contracts")
	{
		var tempArray = [];
		var pos = 0;
		
		for(var i=0; i<list.length; i++)
		{
			var item = list[i];
			// GET MY OWN ACTIVE CONTRACT
			if((list[i].CONTRACT_REQUESTER == userData.USER_CODE && list[i].CONTRACT_OWNER == userData.USER_CODE) && list[i].CONTRACT_STATE == "4")
			{pos = i; break;}
		}
		if(pos != 0)
		{
			var tempItem = list[pos];
			// REMOVE ITEM FROM ARRAY
			list.splice(pos, 1);
			// ADD ITEM TO ARRAY IN POSITION 0
			list.splice(0, 0, tempItem);
		}
	}
	
	if(table == "wp_groups")
	{
		var tempArray = [];
		var pos = 0;
		
		for(var i=0; i<list.length; i++)
		{
			var item = list[i];
			// GET MY OWN ACTIVE CONTRACT
			if((list[i].GROUP_CONTRACT == userData.USER_CONTRACT))
			{
				// unshift
				tempArray.unshift(item);
			}
			else
			{
				// push
				tempArray.push(item);
			}
		}
		list = tempArray;
	}
	
	return list;
}
// STATES CHANGER
function stateChanger(table, field, key, code, actual)
{
	var info = {};
	info.table = table;
	info.field = field;
	info.key = key;
	info.code = code;
	info.actual = actual;
	
	// GET GOALS IF USER CALLER
	if(field == "USER_CALLER")
	{
		if(info.actual == "0")
		{
			info.USER_CALLER_GOAL = document.getElementById("USER_CALLER_GOAL").value; 
			info.USER_CALLER_ENDATE = document.getElementById("USER_CALLER_ENDATE").value; 
		}
	}
	
	
	sendAjax("users","stateChanger",info,function(response)
	{
		var ans = response.message;
		fastPop("Se ha cambiado el estado", 2000);
		refreshTable(info.table);
	});
}
function goTopPop()
{
	// -------------------------------------------------------------------
	// SCROLL TOP IN FORMS
	var contentsList = document.getElementsByClassName("pum-content");
	for(var i=0; i<contentsList.length; i++)
	{contentsList[i].scrollTop = 0;}
	// SCROLL TOP IN FORMS
	// -------------------------------------------------------------------
}
// -------- GEOLOCATION
function success(pos) 
{
	var crd = pos.coords;
	// console.log('Your current position is:');
	// console.log('Latitude : ' + crd.latitude);
	// console.log('Longitude: ' + crd.longitude);	
	// console.log('More or less ' + crd.accuracy + ' meters.');
	
	var decimals = 6;
	
	var lat = String(crd.latitude);
	var latParts = lat.split(".");
	var latInt = latParts[0];
	var latDec = latParts[1];
	latDec = latDec.substring(0, decimals);
	lat = latInt+"."+latDec;
	
	var lon = String(crd.longitude);
	var lonParts = lon.split(".");
	var lonInt = lonParts[0];
	var lonDec = lonParts[1];
	var lonDec = lonDec.substring(0, decimals);
	lon = lonInt+"."+lonDec;
	
	
	actualVisitCords = lat+", "+lon;
	console.log(actualVisitCords)
	
	var showCoords = fixCoords(actualVisitCords);
	
	if(document.getElementById("geoLine"))
	{
		document.getElementById("geoLine").innerHTML = showCoords;
	}
	else
	{
		console.log("coord fill failed");
	}
	
};
function error(err) 
{
	
	
	actualVisitCords = "Negado por usuario";
	fastPop("Usuario ha negado permiso para ubicación", 2000);
	console.warn('ERROR(' + err.code + '): ' + err.message);
};
function fixCoords(coord)
{
	console.log(coord)
	if(coord != "" && coord != null )
	{
		var c1 = coord.split(", ")[0];
		var c2 = coord.split(", ")[1];
		
		var pieces1 = c1.split(".");
		var pieces2 = c2.split(".");
		
		var newDecLat = pieces1[1][0]+pieces1[1][1]+pieces1[1][2];
		var newDecLon = pieces2[1][0]+pieces2[1][1]+pieces2[1][2];
		
		var newCoord = pieces1[0]+"."+newDecLat+", "+pieces2[0]+"."+newDecLon;
	}
	else
	{
		var newCoord = "-";
	}
	
	return newCoord;
}
function addCommas(nStr)
{
	nStr = parseFloat(nStr);
	
	var d = 0;
    var actualCurrency = "COP";
	
	if(actualCurrency == "COP")
	{
		d = 0;
		var currency = "";
	}
	if(actualCurrency == "CLP")
	{
		d = 0;
		var currency = "$";
	}
	if(actualCurrency == "PEN")
	{
		d = 2;
		var currency = "S/";
	}
	if(actualCurrency == "MXN")
	{
		d = 2;
		var currency = "$";
	}
	if(actualCurrency == "ARS")
	{
		d = 2;
		var currency = "$";
	}
	if(actualCurrency == "USD")
	{
		d = 2;
		var currency = "$";
	}
	if(actualCurrency == "EUR")
	{
		d = 2;
		var currency = "€";
	}
	if(actualCurrency == "GBP")
	{
		d = 2;
		var currency = "£";
	}
	return currency + "" + nStr.toFixed(d).replace(/./g, function(c, i, a) 
	{
		return i > 0 && c !== "." && (a.length - i) % 3 === 0 ? "," + c : c;
	});

}
// RELOAD USER DATA
function userDataReload()
{
	var c = localStorage.getItem("tmpkey");
	var info = {};
	info.c = c;
	var method = "rlAud";
	sendAjax("users",method,info,function(response)
	{
		var ans = response.message;
		console.log(ans)
		userData = response.message;
	});
}
// FILES ADMIN------------------
function prepareFileLoader()
{
	document.querySelector('#fileSelectorfile').addEventListener('change', function()
	{
		var reader = new FileReader();
		reader.readAsDataURL(this.files[0]);
		reader.onload = function(e) 
		{
			
			// console.log(e)
			
			var fileSelector = document.getElementById('fileSelectorfile');
			var spfname = fileSelector.value.split('.');
			
			var spfnameLen = spfname.length;
			
			var format = spfname[(spfnameLen-1)];
			var filename = spfname[(spfnameLen-2)];
			
			var filePath = filename+"."+format;
			
			var actualLoadedFileName = filePath.split("C:\\fakepath\\")[1];
			console.log(actualLoadedFileName)
			
			// SET LOAD LINK AS LOAD ORIGIN
			if(actualFileOrigin == "loadItemPicA")
			{var fileLink = document.getElementById("loadItemPicA");}
			
			
			// LOAD FILE NOT PIC EXCLUSIVE
			if(actualFileOrigin == "-")
			{
				if(actualFileOrigin == "event" && format != "jpg" && format != "JPG" && format != "jpeg" && format != "JPEG" && format != "pdf" && format != "PDF")
				{
					actualLoadedFile = "";
					actualLoadedFileFormat = "";
					fastPop("Tipo de archivo invalido, solo puedes cargar archivos tipo jpg o pdf", 4000);
					fileSelector.value = "";
					fileLink.innerHTML = "Cargar foto o pdf";
					return;
				}
			}
			else if(actualFileOrigin == "--")
			{
				if(actualFileOrigin == "planClass" && format != "jpg" && format != "JPG" && format != "jpeg" && format != "JPEG" && format != "pdf" && format != "PDF" && format != "xls" && format != "XLS" && format != "doc" && format != "DOC" && format != "xlsx" && format != "XLSX" && format != "docx" && format != "DOCX")
				{
					actualLoadedFile = "";
					actualLoadedFileFormat = "";
					fastPop("Tipo de archivo invalido, solo puedes cargar archivos tipo jpg, pdf, doc o xls", 4000);
					fileSelector.value = "";
					fileLink.innerHTML = "Cargar plan de clase";
					return;
				}
			}
			// LOAD FILE PIC EXCLUSIVE
			else
			{
				if(format != "jpg" && format != "JPG" && format != "jpeg" && format != "JPEG")
				{
					actualLoadedFile = "";
					actualLoadedFileFormat = "";

					fastPop("Tipo de archivo invalido, solo puedes cargar archivos tipo jpg", 4000);
					fileSelector.value = "";
					fileLink.innerHTML = "Cargar imágen (boceto, plano, foto) jpg";
					return;
				}
				
				// RESIZE PIC FOR LOAD
				var resize_width = 600;
			
				var img = new Image();
				img.src = e.target.result;
				img.name = e.target.name;
				img.size = e.target.size;
				img.onload = function(el)
				{
					var elem = document.createElement('canvas');//create a canvas
					var scaleFactor = resize_width / el.target.width;
					elem.width = resize_width;
					elem.height = el.target.height * scaleFactor;
					var ctx = elem.getContext('2d');
					ctx.drawImage(el.target, 0, 0, elem.width, elem.height);
					var pic = ctx.canvas.toDataURL('image/jpeg', 0.7);
					actualEventPic = pic;
					actualEventPicFormat = format;
				}
			}
			
			if(actualFileOrigin == "loadItemPicA")
			{
				actualLoadedFile = reader.result;
				actualLoadedFileFormat = format;
			}
			
			
			fileLink.innerHTML = fileSelector.value;
		}
		
	})
}
// IMG ADMIN------------------
function prepareImgCropper()
{
	document.querySelector('#fileSelector').addEventListener('change', function()
	{
		var reader = new FileReader();
		reader.onload = function(e) 
		{
			var img = new Image;
			var fileSelector = document.getElementById('fileSelector');
			var spfname = fileSelector.value.split('.');
			var spfnameLen = spfname.length;
			var format = spfname[(spfnameLen-1)];
			
			console.log(format)
			
			if(format != "jpg" && format != "JPG" && format != "jpeg" && format != "JPEG")
			{
				actualCroppedPic = "";
				fastPop("Tipo de archivo invalido, solo puedes cargar archivos tipo jpg", 4000);
				fileSelector.value = "";
				return;
			}
			
			var size = parseInt(e.loaded/1000);
			
			img.onload = function() 
			{
				var fileSelector = document.getElementById('fileSelector');
				var spfname = fileSelector.value.split('.');
				var spfnameLen = spfname.length;
				var format = spfname[(spfnameLen-1)];

				var w = img.width;
				var h = img.height;

				croppieQ = 0.7;
				console.log(size)
				
				if(size <= 499)
				{
					croppieQ = 0.7;
				}
				if(size <= 500 && size >= 999)
				{
					croppieQ = 0.5;
				}
				if(size >= 1000)
				{
					croppieQ = 0.4;
				}
				args = 
				{
					url: e.target.result,
					orientation: 1, 
				}
				croppieSet();

			};
			
			img.src = reader.result;
		}
		reader.readAsDataURL(this.files[0]);
	})
}
// -----------CROPPIE--------------
function croppieSet()
{


	if(theCroppie != null){theCroppie.destroy();}
	
	console.log("gets-1")
	
	var container = document.getElementById("croppieBox");
	container.innerHTML = "";
	var cpie = document.createElement("div");
	cpie.id = "cpie";
	
	var footer = document.createElement("div");
	footer.className = "modal-footer";
	
	var cancel = document.createElement("button");
	cancel.className = "btn btn-secondary btn-sm";
	cancel.onclick = function ()
	{
		PUM.close(1530);
		document.getElementById("fileSelector").value = "";
	}
	cancel.innerHTML = "Cancelar";
	
	console.log("gets0")
	
	var accept = document.createElement("button");
	accept.className = "btn btn-primary btn-sm";
	accept.onclick = function ()
	{
		getCroppieR();
	}
	accept.innerHTML = "Guardar";

	footer.appendChild(cancel);
	footer.appendChild(accept);
	
	console.log("gets")

	container.appendChild(cpie);
	container.appendChild(footer);

	if(jQuery(window).width() < 800)
	{
		var opts = 
		{
			viewport: { width: 180, height: 200 },
			boundary: { width: 180, height: 200 },
			showZoomer: true,
			enableOrientation: true,
			mouseWheelZoom: 'ctrl',
			
		}
	}
	else
	{
		if(actualPicType == "0")
		{
			var opts = 
			{
				viewport: { width: 180, height: 200},
				boundary: { width: 180, height: 200 },
				showZoomer: true,
				enableOrientation: true,
				mouseWheelZoom: 'ctrl',
			}
		}
		
		
	}
	
	theCroppie = new Croppie(document.getElementById('cpie'), opts);
	theCroppie.bind(args);
	
	
	PUM.open(1530);
	
	var zoomBar = document.getElementsByClassName("cr-slider")[0];
	
	if(jQuery(window).width() < 800)
	{
		zoomBar.value = "0.3";
		var pic = document.getElementsByClassName("cr-image")[0];
	}
	else
	{
		zoomBar.value = "1";
		zoomBar.min = "0.3";
	}
	zoomBar.max = "1.5";
	
	
}
function getCroppieR()
{
	var args =
	{
		type: 'base64',
		size: 'original',
		format: 'jpeg',
		quality: croppieQ,
		circle: false
	}	
	
	theCroppie.result(args).then(function(resp) 
	{
		actualCroppedPic = resp;
		if(actualPicType == "0")
		{
			PUM.close(1530);
			document.getElementById("USER_PIC").src = actualCroppedPic;
		}
		
	});

}
// GENERAL UTILITY METHODS --------------------
// GENERAL UTILITY METHODS --------------------
// GENERAL UTILITY METHODS --------------------


function fieldCreator(sizes, title, object, type, id)
{
	  var label = document.createElement("span");
	  label.innerHTML = title;
	  label.className = "fieldLabel";
	  
	  var box = document.createElement("div");
	  box.id = id+"_BOX";
	  var classname = "col-xs-"+sizes[0]+" col-sm-"+sizes[1]+" col-md-"+sizes[2]+" col-lg-"+sizes[3];
	  box.className = classname;
	  
	  if(object == "picture")
	  {
		var classname = "col-xs-"+sizes[0]+" col-sm-"+sizes[1]+" col-md-"+sizes[2]+" col-lg-"+sizes[3]+" picPicker";
		box.className = classname;
		
		var field = document.createElement("img");
		field.id = id;
		
		var loc = window.location.href;
		if(loc.includes("192.168"))
		{
			field.src = "http://192.168.0.60/www/cotizamelo/app/isrc/blankPic.png";
		}
		else
		{
			field.src = "http://incocrea.com/cotiza/app/isrc/blankPic.png";
		}
		
		field.type = "img";
		field.className = "profilePic";
		field.onclick = function ()
		{
			console.log("open pic selector")
			actualPicType = "0";
			document.getElementById("fileSelector").click();
		}
	  }
	  else if(object == "multiselect")
	  {
		var field = document.createElement("div");
		field.id = id;
		field.className = "multiselectBox";  
	  }
	  else if(object == "tableField")
	  {
		var field = document.createElement("div");
		field.id = id;
		field.className = "tableField";  
	  }
	  else
	  {
		var field = document.createElement(object);
		field.id = id;
		field.type = type;
		field.className = "formField";
	  }
	  

	  box.appendChild(label);
	  box.appendChild(field);
	  
	  return box;
}
function fieldCreatorTotal(sizes, title, object, type, id)
{
	var label = document.createElement("span");
	label.innerHTML = title;
	label.className = "totaLabel";

	var box = document.createElement("div");
	box.id = id+"_BOX";
	var classname = "col-xs-"+sizes[0]+" col-sm-"+sizes[1]+" col-md-"+sizes[2]+" col-lg-"+sizes[3];
	box.className = classname;
	  
	var field = document.createElement(object);
	field.id = id;
	field.type = type;
	field.className = "totalField";
	  

	box.appendChild(label);
	box.appendChild(field);

	return box;
}
function buttonCreator(sizes, title, fun)
{
	var button = document.createElement("button");
	button.innerHTML = title;
	button.className = "filtersButton";
	button.onclick = function(){fun()}
	
	var box = document.createElement("div");
	var classname = "col-xs-"+sizes[0]+" col-sm-"+sizes[1]+" col-md-"+sizes[2]+" col-lg-"+sizes[3];
	box.className = classname;
	
	var br = document.createElement("br");
	br.className = "hidden-xs";
	
	box.appendChild(br);
	box.appendChild(button);
	
	return box;
}
function selectFiller(id, initial, options, valueField, descField)
{
	var picker = document.getElementById(id);
	picker.innerHTML = "";
	
	var option = document.createElement("option");
	option.value = "";
	option.innerHTML = initial;
	picker.appendChild(option);
	
	for(var i=0; i<options.length; i++)
	{
		var item = options[i];
		if(valueField != null)
		{
			var value = item[valueField];
			var desc = item[descField];
		}
		else
		{
			var value = item;
			var desc = item;
		}
		
		var option = document.createElement("option");
		option.value = value;
		option.innerHTML = desc;
		picker.appendChild(option);
	}
}
function multiSelectFillerDic(id, value, desc, list, compareList, single, locked)
{
	var picker = document.getElementById(id);
	picker.innerHTML = "";
	
	for(var i=0; i<list.length; i++)
	{
		var itemValue = list[i][value];
		var itemDesc = list[i][desc];
		
		var option = document.createElement("div");
		option.className = "custom-control custom-checkbox";
		
		var random = Math.random();
		
		var input = document.createElement("input");
		input.className = "custom-control-input";
		input.id = random+"-"+itemValue;
		input.type = "checkbox";
		
		// MARK IF IN ARRAY
		if(compareList != null)
		{
			if(compareList.includes(itemValue))
			{input.checked = true;}
		}
		
		// DISABLE INPUT IF LOCKED
		if(locked == "1"){input.disabled = true;}
				
		var label = document.createElement("label");
		label.innerHTML = itemDesc;
		label.htmlFor  = random+"-"+itemValue;
		label.className = "custom-control-label";
		
		option.appendChild(input);
		option.appendChild(label);

		// SINGLE BEHAVIOR
		if(single == "0" && locked != "1")
		{
			option.onclick = function()
			{
				var me = document.getElementById(this.children[0].id);
				var options = this.parentNode.children;
				for(var n=0; n<options.length; n++)
				{
					var box = options[n].children[0];
					box.checked = false;
				}
				me.checked = true;
			}
		}
		
		picker.appendChild(option);

	}
}
function checkEmail(email) 
{

    var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

    if (!filter.test(email)) 
	{
		return false;
	}
	else
	{
		return true;
	}
 }
function condsBox()
{
	PUM.open(332);
	
	var content = document.getElementById("condsText");
	content.innerHTML = language["condsText"];
	
	var accept = document.getElementById("acceptButtonConds");
	accept.innerHTML = language["acceptButtonConds"];
}
function closeConds()
{
	PUM.close(332)
}
function fastPop(message, time)
{
	document.getElementById("fastPopText").innerHTML = message;
	setTimeout(function(){PUM.open(763);}, 500);
	// PUM.open(763);
	setTimeout(function(){ PUM.close(763); }, time);
}
function alertBox(header, message)
{
	PUM.open(174);
	var tittle = document.getElementById("alertTitle");
	tittle.innerHTML = header;
	var content = document.getElementById("alertContent");
	content.innerHTML = message;
	var accept = document.getElementById("acceptButtonAlert");
	accept.innerHTML = language["acceptButtonAlert"];
}
function closeAlert()
{
	PUM.close(174)
}
function confirmBox(title, message, method, params)
{
	PUM.open(664);
	document.getElementById("confirmTitle").innerHTML = title;
	document.getElementById("confirmContent").innerHTML = message;
	var acceptB = document.getElementById("acceptConfirmButton");
	acceptB.method = method;
	acceptB.innerHTML = language["acceptButtonAlert"];
	acceptB.params = params;
	acceptB.onclick = function()
	{this.method(this.params);closeConfirm();}
	var cancelB = document.getElementById("cancelConfirmButton");
	cancelB.innerHTML = language["cancel"];
	cancelB.onclick = function(){closeConfirm()}
}
function closeConfirm()
{
	PUM.close(664);
}
function getNow()
{
	var currentdate = new Date(); 
	
	
	
	var year = currentdate.getFullYear();
	var month = (currentdate.getMonth()+1);
	var day = currentdate.getDate();
	var hour = currentdate.getHours();
	var minute = currentdate.getMinutes();
	var second = currentdate.getSeconds();
	
	if(parseFloat(month) < 10){month = "0"+month};
	if(parseFloat(day) < 10){day = "0"+day};
	if(parseFloat(hour) < 10){hour = "0"+hour};
	if(parseFloat(minute) < 10){minute = "0"+minute};
	if(parseFloat(second) < 10){second = "0"+second};
	
	var datetime =  year + "-" +  month + "-" + day + " "  + hour + ":"  + minute + ":"  + second;	
	
	return datetime;
}
function getdDiff(startDate, endDate)
{
	var date1 = new Date(startDate);
	var date2 = new Date(endDate);
	var timeDiff = date2.getTime() - date1.getTime();
	var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
	return diffDays;
}
function toPhrase(string)
{
  return string.charAt(0).toUpperCase() + string.slice(1);
}
function isNumber(n)
{
  return !isNaN(parseFloat(n)) && isFinite(n);
}
function getNow(extra, dayonly)
{
	var currentdate = new Date(); 
	
	if(extra != null)
	{
		currentdate.setDate(currentdate.getDate() + (extra));
	}
	
	var year = currentdate.getFullYear();
	var month = (currentdate.getMonth()+1);
	var day = currentdate.getDate();
	var hour = currentdate.getHours();
	var minute = currentdate.getMinutes();
	var second = currentdate.getSeconds();
	
	if(parseFloat(month) < 10){month = "0"+month};
	if(parseFloat(day) < 10){day = "0"+day};
	if(parseFloat(hour) < 10){hour = "0"+hour};
	if(parseFloat(minute) < 10){minute = "0"+minute};
	if(parseFloat(second) < 10){second = "0"+second};
	
	if(dayonly != null)
	{
		var datetime =  year + "-" +  month + "-" + day;	
	}
	else
	{
		var datetime =  year + "-" +  month + "-" + day + " "  + hour + ":"  + minute + ":"  + second;	
	}

	return datetime;
}
Array.prototype.in_array=function()
{ 
        for(var j in this)
        { 
                if(this[j]==arguments[0])
                {
                        return true; 
                } 
        } 
        return false;     
} 
String.prototype.replaceAll = function(search, replacement) 
{
    var target = this;
    return target.replace(new RegExp(search, 'g'), replacement);
};

// FAST LOADER/BUTTON LOCKER
function loadManager(state, trigger)
{
	if(state == 1){PUM.open(889);}
	else{PUM.close(889);}
	if(trigger != null)
	{
		var thisTrigger = document.getElementById(trigger);
		if(state == 1)
		{
			thisTrigger.oldFunction = thisTrigger.onclick;
			thisTrigger.onclick = function (){console.log("isLocked: "+this.id);return;}
		}
		else
		{
			thisTrigger.onclick = thisTrigger.oldFunction;
		}
	}
}

// COMMS
function sendAjax(obj, method, data, responseFunction)
{
	var info = {};
	info.class = obj;
	info.method = method;
	info.data = data;
	
	
	// LOG DATA ----------------------
	info.data.ucode = actualUser;
	info.data.iface = imfoo;
	info.data.mt = actualMT;
	// LOG DATA ----------------------

	curl = root+'app/php/mentry.php';
	jQuery.ajax(
	{
			type: 'POST',
			url: curl,
			contentType: 'application/json',
			data: JSON.stringify(info),
			cache: false,
			async: true,
			success: function(data)
			{
				 try
				 {
					var tmpJson = jQuery.parseJSON(data);
					setTimeout(function(){ responseFunction(tmpJson.data); }, 300);
					// console.log(info.method);
					// console.log(tmpJson);
				 }
				 catch(e)
				 {
					 console.log(data);
				 }
			},
			error: function( jqXhr, textStatus, errorThrown )
			{ 
				console.log( errorThrown );
			}
		});
}
